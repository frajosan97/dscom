import{r as c,R as O,u as ne,j as e,$ as me}from"./app-CcdzEu0R.js";import{f as te,g as ue,h as he,i as xe,j as oe,k as se,l as pe,F as fe,m as je,n as ge,o as be}from"./index-BMkeTrLY.js";import{P as v,I as m,R,y as L}from"./Footer-4Livvlxt.js";import{S as ye}from"./sweetalert2.esm.all-DpIEGYsy.js";import{P as we,C as Ne}from"./PaymentMethods-C6mLRo8L.js";import{f as T}from"./helpers-B9XmgPRl.js";import{C as k}from"./Card-CSAU_t4j.js";import{B as ve}from"./Badge-CBjpO1io.js";import{T as Ce}from"./Table-D-OHgQ10.js";import{b as j,C as N,F as Se}from"./Form-CLPTCCgE.js";import{B}from"./Image-D_GvnDn_.js";import{P as Pe}from"./ProductCard-BXdh38lj.js";import{u as ie}from"./useData-CRgTl60a.js";import{S as Te}from"./Spinner-CGeZwkQ1.js";import{A as re}from"./Alert-oiq05XfP.js";import{E as Oe}from"./ErpLayout-u_y7Ersr.js";import{x as ae}from"./axios-COTtbvZI.js";import{L as U}from"./ListGroup-Dslilh18.js";import{B as ke}from"./ButtonGroup-CEgI5t_N.js";import"./iconBase-CciruWzR.js";import"./CloseButton-Bv_xupVB.js";import"./formik.esm-pgZf8OxT.js";import"./index.esm-lEXyK6iT.js";import"./Modal-BeCmzXVe.js";import"./Tabs-CvU7mztw.js";import"./Tab-B5PsefMC.js";import"./AddToCartBtn-D_lSC-75.js";/* empty css                      */function Y(){return Y=Object.assign||function(t){for(var l=1;l<arguments.length;l++){var s=arguments[l];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},Y.apply(this,arguments)}function Le(t,l){if(t==null)return{};var s=_e(t,l),r,o;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(o=0;o<n.length;o++)r=n[o],!(l.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(s[r]=t[r])}return s}function _e(t,l){if(t==null)return{};var s={},r=Object.keys(t),o,n;for(n=0;n<r.length;n++)o=r[n],!(l.indexOf(o)>=0)&&(s[o]=t[o]);return s}var V=c.forwardRef(function(t,l){var s=t.color,r=s===void 0?"currentColor":s,o=t.size,n=o===void 0?24:o,d=Le(t,["color","size"]);return O.createElement("svg",Y({ref:l,xmlns:"http://www.w3.org/2000/svg",width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},d),O.createElement("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),O.createElement("polyline",{points:"17 21 17 13 7 13 7 21"}),O.createElement("polyline",{points:"7 3 7 8 15 8"}))});V.propTypes={color:v.string,size:v.oneOfType([v.string,v.number])};V.displayName="Save";function G(){return G=Object.assign||function(t){for(var l=1;l<arguments.length;l++){var s=arguments[l];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},G.apply(this,arguments)}function Ee(t,l){if(t==null)return{};var s=Fe(t,l),r,o;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(o=0;o<n.length;o++)r=n[o],!(l.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(s[r]=t[r])}return s}function Fe(t,l){if(t==null)return{};var s={},r=Object.keys(t),o,n;for(n=0;n<r.length;n++)o=r[n],!(l.indexOf(o)>=0)&&(s[o]=t[o]);return s}var J=c.forwardRef(function(t,l){var s=t.color,r=s===void 0?"currentColor":s,o=t.size,n=o===void 0?24:o,d=Ee(t,["color","size"]);return O.createElement("svg",G({ref:l,xmlns:"http://www.w3.org/2000/svg",width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},d),O.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),O.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))});J.propTypes={color:v.string,size:v.oneOfType([v.string,v.number])};J.displayName="X";const Ae=({paymentData:t={},totalPaid:l})=>{const{cartItems:s,removeFromCart:r,updateQuantity:o,cartTotal:n,itemCount:d}=ne(),b=a=>Array.isArray(a)?a:a&&Array.isArray(a.transactions)?a.transactions:[],x=c.useMemo(()=>Object.entries(t).filter(([,a])=>Array.isArray(a)||Array.isArray(a==null?void 0:a.transactions)).map(([a,u])=>{const S=b(u).reduce((F,_)=>F+(Number(_.amount)||0),0);return{method:a,total:S}}),[t]),C=c.useMemo(()=>x.reduce((a,u)=>a+u.total,0),[x]),p=typeof l=="number"?l:C,g=Math.max(n-p,0),E=p>n?p-n:0,z=(a,u)=>{u>=1&&o(a,u)};return e.jsxs(k,{className:"border-0 rounded-0 shadow-sm",children:[e.jsxs(k.Header,{className:"bg-white fw-bold d-flex justify-content-between align-items-center py-3",children:[e.jsx("span",{children:"Sale Summary"}),e.jsxs(ve,{bg:"primary",pill:!0,children:[e.jsx(te,{className:"me-1"}),d]})]}),e.jsx(k.Body,{className:"p-0",style:{maxHeight:"400px",overflowY:"auto"},children:s.length===0?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(te,{size:48,className:"text-muted mb-3"}),e.jsx("h4",{children:"Your cart is empty"}),e.jsx("p",{className:"text-muted mb-4",children:"Looks like you haven't added any items yet"})]}):e.jsxs(Ce,{responsive:!0,hover:!0,className:"mb-0",children:[e.jsx("thead",{className:"bg-light",children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-3",children:"Product"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Total"}),e.jsx("th",{className:"pe-3",children:"Action"})]})}),e.jsx("tbody",{children:s.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"align-middle ps-3",children:a.name||`Product ${a.id}`}),e.jsx("td",{className:"align-middle text-end",children:T(a.price)}),e.jsx("td",{className:"align-middle",children:e.jsx(j,{type:"number",min:"1",className:"text-center",style:{width:"70px"},value:a.quantity,onChange:u=>z(a.id,parseInt(u.target.value)||1)})}),e.jsx("td",{className:"align-middle text-end fw-semibold",children:T(a.price*a.quantity)}),e.jsx("td",{className:"align-middle text-end pe-3",children:e.jsx(B,{variant:"outline-danger",size:"sm",onClick:()=>r(a.id),title:"Remove item",children:e.jsx(ue,{})})})]},a.id))})]})}),e.jsxs(k.Footer,{className:"bg-white p-3",children:[e.jsx("div",{className:"mb-3",children:e.jsxs(m,{children:[e.jsxs(m.Text,{className:"fw-bold bg-light",style:{width:"160px"},children:[e.jsx(he,{className:"me-1"}),"Total Billed"]}),e.jsx(j,{value:T(n),className:"text-end fw-bold bg-light",disabled:!0})]})}),e.jsx(R,{className:"g-2 mb-3",children:x.map(({method:a,total:u})=>e.jsx(N,{md:12,children:e.jsxs(m,{children:[e.jsxs(m.Text,{className:"fw-bold bg-light text-capitalize",style:{width:"160px"},children:[e.jsx(xe,{className:"me-1"}),a]}),e.jsx(j,{value:T(u),className:"text-end fw-bold bg-light",disabled:!0})]})},a))}),e.jsx("hr",{}),e.jsx("div",{className:"mb-2",children:e.jsxs(m,{children:[e.jsxs(m.Text,{className:"fw-bold bg-light",style:{width:"160px"},children:[e.jsx(oe,{className:"me-1"}),"Total Paid"]}),e.jsx(j,{value:T(p),className:"text-end fw-bold bg-light",disabled:!0})]})}),e.jsx("div",{className:"mb-2",children:e.jsxs(m,{children:[e.jsxs(m.Text,{className:`fw-bold ${g>0?"text-warning":"text-success"} bg-light`,style:{width:"160px"},children:[e.jsx(se,{className:"me-1"}),"Balance Due"]}),e.jsx(j,{value:T(g),className:`text-end fw-bold ${g>0?"text-warning":"text-success"}`,disabled:!0})]})}),E>0&&e.jsx("div",{className:"mb-2",children:e.jsxs(m,{children:[e.jsxs(m.Text,{className:"fw-bold text-info bg-light",style:{width:"160px"},children:[e.jsx(se,{className:"me-1"}),"Change"]}),e.jsx(j,{value:T(E),className:"text-end fw-bold text-info",disabled:!0})]})})]})]})},De=()=>{const{products:t,isLoading:l}=ie(),[s,r]=c.useState(""),o=c.useMemo(()=>{if(!s.trim())return t;const d=s.toLowerCase().trim();return t.filter(b=>{var x,C,p,g;return((x=b.barcode)==null?void 0:x.toLowerCase().includes(d))||((C=b.name)==null?void 0:C.toLowerCase().includes(d))||((p=b.specifications)==null?void 0:p.toLowerCase().includes(d))||((g=b.description)==null?void 0:g.toLowerCase().includes(d))})},[t,s]),n=c.useCallback(d=>{r(d.target.value)},[]);return c.useCallback(()=>{r("")},[]),e.jsxs(k,{className:"border-0 rounded-0 shadow-sm",children:[e.jsx(k.Header,{className:"bg-white fw-bold py-2",children:e.jsxs(m,{children:[e.jsx(m.Text,{className:"rounded-0 bg-light",children:e.jsx(pe,{})}),e.jsx(j,{type:"search",placeholder:"Search by barcode, name, specifications...",className:"rounded-0",value:s,onChange:n,autoFocus:!0})]})}),e.jsx(k.Body,{children:l?e.jsx("div",{className:"d-flex justify-content-center align-items-center py-5",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Te,{animation:"border",variant:"primary"}),e.jsx("h6",{className:"mt-2 text-muted",children:"Loading products..."})]})}):o.length===0?e.jsx("div",{className:"text-center py-5",children:s?e.jsxs(re,{variant:"light",className:"rounded-0",children:[e.jsx("h6",{children:"No products found"}),e.jsxs("p",{className:"text-muted mb-0",children:['No products match "',e.jsx("strong",{children:s}),'"']})]}):e.jsxs(re,{variant:"light",className:"rounded-0",children:[e.jsx("h6",{children:"No products available"}),e.jsx("p",{className:"text-muted mb-0",children:"Please add products to get started"})]})}):e.jsx(R,{className:"g-2",children:o.map(d=>e.jsx(N,{xs:6,md:4,lg:3,xl:2,children:e.jsx(Pe,{systemMode:"erp",item:d})},d.id))})})]})},dt=({sale:t=null})=>{var Z,ee;const{cartItems:l,clearCart:s,cartTotal:r,setCartItems:o}=ne(),[n,d]=c.useState(!1),[b,x]=c.useState(!1),[C,p]=c.useState(((Z=t==null?void 0:t.customer)==null?void 0:Z.name)||((ee=t==null?void 0:t.customer)==null?void 0:ee.full_name)||""),[g,E]=c.useState([]),[z,a]=c.useState(!1),[u,I]=c.useState((t==null?void 0:t.customer_id)||null),[S,F]=c.useState(t!=null&&t.date?new Date(t.date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0]),_=c.useRef(null),{paymentMethods:Q}=ie(),[A,M]=c.useState({});c.useEffect(()=>{const i=Q.reduce((h,y)=>{var f;const P=((f=t==null?void 0:t.payments)==null?void 0:f.filter(w=>{var D;return((D=w.payment_method_name)==null?void 0:D.toLowerCase())===y.name.toLowerCase()}))||[];return h[y.name.toLowerCase()]=P.map(w=>w.metadata),h},{});M(i)},[t,Q]);const $=c.useMemo(()=>({id:(t==null?void 0:t.id)||null,order_number:(t==null?void 0:t.order_number)||null,date:(t==null?void 0:t.date)||S,customer_id:(t==null?void 0:t.customer_id)||u}),[t,S,u]);c.useEffect(()=>{var i;((i=t==null?void 0:t.items)==null?void 0:i.length)>0?setTimeout(()=>{o(t.items.map(h=>({id:h.product_id,name:h.product_name,price:h.price,image:"",quantity:h.quantity})))},0):s()},[t,s,o]),c.useEffect(()=>{const i=h=>{_.current&&!_.current.contains(h.target)&&a(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]);const le=c.useCallback(async i=>{var y,P;const h=i.target.value;if(p(h),h.length<=2){a(!1);return}try{const{data:f}=await ae.get(route("api.customer.search"),{params:{value:h}});f.success?(E(f.customers),a(!0)):(L.error(f.message),a(!1))}catch(f){L.error(((P=(y=f.response)==null?void 0:y.data)==null?void 0:P.message)||"An error occurred"),a(!1)}},[]),X=c.useCallback(i=>{I(i.id),p(i.name||i.full_name),a(!1)},[]),ce=c.useCallback(i=>{F(i.target.value)},[]),W=c.useCallback(()=>{s(),F(new Date().toISOString().split("T")[0]),I(null),p(""),x(!1),a(!1),d(!1)},[s]),K=c.useCallback(async(i,h=!1)=>{var y,P;if(i.preventDefault(),!u){L.error("Please select a customer before submitting.");return}if(r===0){L.error("Cart is empty. Please add products before submitting.");return}d(!0);try{if(!(await ye.fire({title:"Confirm submission",text:t?"Do you want to update this sale?":"Do you want to save this sale?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:t?"Yes, update it!":"Yes, save it!"})).isConfirmed){d(!1);return}const w=new FormData;Object.entries({...$,date:S,customer_id:u,_method:t?"PUT":"POST"}).forEach(([de,H])=>{H!=null&&w.append(de,H)}),w.append("cartItems",JSON.stringify(l)),w.append("paymentData",JSON.stringify(A));const D=t?route("sales.update",{sale:t.id}):route("sales.store"),{data:q}=await ae.post(D,w);q.success&&(L.success(q.message),t||W(),h&&window.open(route("sales.print",{sale:q.sale.id}),"_blank"))}catch(f){L.error(((P=(y=f.response)==null?void 0:y.data)==null?void 0:P.message)||"An error occurred")}finally{d(!1)}},[$,l,r,W,A,t,u,S]);return e.jsxs(Oe,{children:[e.jsx(me,{title:t?"Edit Sale":"Create New Sale"}),e.jsx(Se,{onSubmit:i=>K(i,!1),children:e.jsxs(R,{className:"g-2",children:[e.jsx(N,{md:8,children:e.jsxs(R,{className:"g-2",children:[e.jsx(N,{md:4,children:e.jsxs(m,{children:[e.jsx(m.Text,{className:"rounded-0",children:e.jsx(fe,{})}),e.jsx(j,{type:"date",value:S,onChange:ce,className:"rounded-0"})]})}),e.jsx(N,{md:4,children:e.jsxs(m,{children:[e.jsx(m.Text,{className:"rounded-0",children:e.jsx(oe,{})}),e.jsx(j,{type:"text",value:$.order_number||"",placeholder:"Order Number",className:"rounded-0",disabled:!0})]})}),e.jsx(N,{md:4,ref:_,children:e.jsxs(m,{children:[e.jsx(m.Text,{className:"rounded-0",children:e.jsx(je,{})}),e.jsx(j,{type:"search",placeholder:"Customer Name or Phone...",className:"rounded-0",value:C,onChange:le,onFocus:()=>C.length>2&&a(!0)}),e.jsx(m.Text,{className:"rounded-0",style:{cursor:"pointer"},onClick:()=>x(!0),children:e.jsx(ge,{})}),z&&e.jsx(U,{className:"position-absolute rounded-0 w-100",style:{zIndex:1050,top:"100%"},children:g.length>0?g.map(i=>e.jsxs(U.Item,{action:!0,onClick:()=>X(i),className:"rounded-0",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{children:i.name||i.full_name}),e.jsx("small",{className:"text-muted",children:i.phone})]}),i.email&&e.jsx("div",{className:"small text-muted",children:i.email})]},i.id)):e.jsx(U.Item,{className:"rounded-0 text-center text-muted",children:"No customers found"})})]})}),e.jsxs(N,{md:12,children:[e.jsx(De,{}),e.jsx(we,{paymentData:A,setPaymentData:M})]})]})}),e.jsxs(N,{md:4,children:[e.jsx(Ae,{paymentData:A,setPaymentData:M}),e.jsxs(ke,{className:"d-flex gap-2 mt-2",children:[e.jsxs(B,{type:"button",variant:"success",className:"rounded-0 shadow-sm",onClick:i=>K(i,!0),disabled:r===0||n,children:[e.jsx(be,{className:"me-1"}),n?"Processing...":t?"Update & Print":"Save & Print"]}),e.jsxs(B,{type:"button",variant:"warning",className:"rounded-0 shadow-sm",onClick:W,disabled:n,children:[e.jsx(J,{className:"me-1"}),t?"Reset Changes":"Cancel"]}),e.jsxs(B,{type:"submit",variant:"primary",className:"rounded-0 shadow-sm",disabled:r===0||n,children:[e.jsx(V,{className:"me-1"}),n?"Processing...":t?"Update Sale":"Save"]})]})]})]})}),e.jsx(Ne,{show:b,onHide:()=>x(!1),onClose:()=>x(!1),onSuccess:i=>{X(i),x(!1)}})]})};export{dt as default};
