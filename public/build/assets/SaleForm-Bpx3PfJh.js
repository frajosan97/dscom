import{r as c,R as T,u as oe,j as e,$ as he}from"./app-BpU72QA_.js";import{g as se,h as xe,i as pe,j as fe,k as ie,l as re,m as je,a as ge,n as be,o as ye,p as Ne}from"./index-Cj7izV5U.js";import{P as w,I as m,R as I,y as L}from"./Footer-DjpVzd94.js";import{p as we}from"./PrintReceipt-PZSPJf7g.js";import{C as ve}from"./CustomerModal-DjrK-hw0.js";import{a as P}from"./helpers-BNTm1457.js";import{C as O}from"./Card-Cp-86i-4.js";import{B as Ce}from"./Badge-B6rI1Uxb.js";import{T as Se}from"./Table-SQ5jitNG.js";import{b as j,C as N,F as Pe}from"./Form-DSkscyKP.js";import{B as z}from"./Image-BN5bHObg.js";import{P as Te}from"./PaymentMethods-O1M1auhk.js";import{P as Oe}from"./ProductCard-7VkFstNZ.js";import{u as le}from"./useData-DDSsGf-N.js";import{S as ke}from"./Spinner-uVVsfYQv.js";import{A as ae}from"./Alert-BBqBwfkm.js";import{E as Le}from"./ErpLayout-oVKLuB-n.js";import{x as ne}from"./axios-BLP8DAb-.js";import{S as Ee}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{L as U}from"./ListGroup-BJtaGRdj.js";import{B as _e}from"./ButtonGroup-o28-6IFt.js";import"./iconBase-BYoGFqIX.js";import"./CloseButton-DU9gCyfI.js";import"./formik.esm-Qlw1j0EE.js";import"./hoist-non-react-statics.cjs-C-Qo8PK8.js";import"./index.esm-CbTMCKBK.js";import"./useErrorToast-_ClzXyjB.js";import"./Modal-Bw8Xv3kR.js";import"./Tabs-Cc41tZyO.js";import"./Tab-C3HYXY4w.js";import"./AddToCartBtn-CWo9IU0F.js";/* empty css                      */function Y(){return Y=Object.assign||function(t){for(var l=1;l<arguments.length;l++){var s=arguments[l];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},Y.apply(this,arguments)}function Fe(t,l){if(t==null)return{};var s=Ae(t,l),r,o;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(o=0;o<n.length;o++)r=n[o],!(l.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(s[r]=t[r])}return s}function Ae(t,l){if(t==null)return{};var s={},r=Object.keys(t),o,n;for(n=0;n<r.length;n++)o=r[n],!(l.indexOf(o)>=0)&&(s[o]=t[o]);return s}var V=c.forwardRef(function(t,l){var s=t.color,r=s===void 0?"currentColor":s,o=t.size,n=o===void 0?24:o,d=Fe(t,["color","size"]);return T.createElement("svg",Y({ref:l,xmlns:"http://www.w3.org/2000/svg",width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},d),T.createElement("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),T.createElement("polyline",{points:"17 21 17 13 7 13 7 21"}),T.createElement("polyline",{points:"7 3 7 8 15 8"}))});V.propTypes={color:w.string,size:w.oneOfType([w.string,w.number])};V.displayName="Save";function G(){return G=Object.assign||function(t){for(var l=1;l<arguments.length;l++){var s=arguments[l];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},G.apply(this,arguments)}function De(t,l){if(t==null)return{};var s=Re(t,l),r,o;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(o=0;o<n.length;o++)r=n[o],!(l.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(s[r]=t[r])}return s}function Re(t,l){if(t==null)return{};var s={},r=Object.keys(t),o,n;for(n=0;n<r.length;n++)o=r[n],!(l.indexOf(o)>=0)&&(s[o]=t[o]);return s}var J=c.forwardRef(function(t,l){var s=t.color,r=s===void 0?"currentColor":s,o=t.size,n=o===void 0?24:o,d=De(t,["color","size"]);return T.createElement("svg",G({ref:l,xmlns:"http://www.w3.org/2000/svg",width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},d),T.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),T.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))});J.propTypes={color:w.string,size:w.oneOfType([w.string,w.number])};J.displayName="X";const Be=({paymentData:t={},totalPaid:l})=>{const{cartItems:s,removeFromCart:r,updateQuantity:o,cartTotal:n,itemCount:d}=oe(),b=a=>Array.isArray(a)?a:a&&Array.isArray(a.transactions)?a.transactions:[],x=c.useMemo(()=>Object.entries(t).filter(([,a])=>Array.isArray(a)||Array.isArray(a==null?void 0:a.transactions)).map(([a,u])=>{const C=b(u).reduce((D,E)=>D+(Number(E.amount)||0),0);return{method:a,total:C}}),[t]),v=c.useMemo(()=>x.reduce((a,u)=>a+u.total,0),[x]),p=typeof l=="number"?l:v,g=Math.max(n-p,0),A=p>n?p-n:0,M=(a,u)=>{u>=1&&o(a,u)};return e.jsxs(O,{className:"border-0 rounded-0 shadow-sm",children:[e.jsxs(O.Header,{className:"bg-white fw-bold d-flex justify-content-between align-items-center py-3",children:[e.jsx("span",{children:"Sale Summary"}),e.jsxs(Ce,{bg:"primary",pill:!0,children:[e.jsx(se,{className:"me-1"}),d]})]}),e.jsx(O.Body,{className:"p-0",style:{maxHeight:"400px",overflowY:"auto"},children:s.length===0?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(se,{size:48,className:"text-muted mb-3"}),e.jsx("h4",{children:"Your cart is empty"}),e.jsx("p",{className:"text-muted mb-4",children:"Looks like you haven't added any items yet"})]}):e.jsxs(Se,{responsive:!0,hover:!0,className:"mb-0",children:[e.jsx("thead",{className:"bg-light",children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-3",children:"Product"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Total"}),e.jsx("th",{className:"pe-3",children:"Action"})]})}),e.jsx("tbody",{children:s.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"align-middle ps-3",children:a.name||`Product ${a.id}`}),e.jsx("td",{className:"align-middle text-end",children:P(a.price)}),e.jsx("td",{className:"align-middle",children:e.jsx(j,{type:"number",min:"1",className:"text-center",style:{width:"70px"},value:a.quantity,onChange:u=>M(a.id,parseInt(u.target.value)||1)})}),e.jsx("td",{className:"align-middle text-end fw-semibold",children:P(a.price*a.quantity)}),e.jsx("td",{className:"align-middle text-end pe-3",children:e.jsx(z,{variant:"outline-danger",size:"sm",onClick:()=>r(a.id),title:"Remove item",children:e.jsx(xe,{})})})]},a.id))})]})}),e.jsxs(O.Footer,{className:"bg-white p-3",children:[e.jsx("div",{className:"mb-3",children:e.jsxs(m,{children:[e.jsxs(m.Text,{className:"fw-bold bg-light",style:{width:"160px"},children:[e.jsx(pe,{className:"me-1"}),"Total Billed"]}),e.jsx(j,{value:P(n),className:"text-end fw-bold bg-light",disabled:!0})]})}),e.jsx(I,{className:"g-2 mb-3",children:x.map(({method:a,total:u})=>e.jsx(N,{md:12,children:e.jsxs(m,{children:[e.jsxs(m.Text,{className:"fw-bold bg-light text-capitalize",style:{width:"160px"},children:[e.jsx(fe,{className:"me-1"}),a]}),e.jsx(j,{value:P(u),className:"text-end fw-bold bg-light",disabled:!0})]})},a))}),e.jsx("hr",{}),e.jsx("div",{className:"mb-2",children:e.jsxs(m,{children:[e.jsxs(m.Text,{className:"fw-bold bg-light",style:{width:"160px"},children:[e.jsx(ie,{className:"me-1"}),"Total Paid"]}),e.jsx(j,{value:P(p),className:"text-end fw-bold bg-light",disabled:!0})]})}),e.jsx("div",{className:"mb-2",children:e.jsxs(m,{children:[e.jsxs(m.Text,{className:`fw-bold ${g>0?"text-warning":"text-success"} bg-light`,style:{width:"160px"},children:[e.jsx(re,{className:"me-1"}),"Balance Due"]}),e.jsx(j,{value:P(g),className:`text-end fw-bold ${g>0?"text-warning":"text-success"}`,disabled:!0})]})}),A>0&&e.jsx("div",{className:"mb-2",children:e.jsxs(m,{children:[e.jsxs(m.Text,{className:"fw-bold text-info bg-light",style:{width:"160px"},children:[e.jsx(re,{className:"me-1"}),"Change"]}),e.jsx(j,{value:P(A),className:"text-end fw-bold text-info",disabled:!0})]})})]})]})},ze=()=>{const{products:t,isLoading:l}=le(),[s,r]=c.useState(""),o=c.useMemo(()=>{if(!s.trim())return t;const d=s.toLowerCase().trim();return t.filter(b=>{var x,v,p,g;return((x=b.barcode)==null?void 0:x.toLowerCase().includes(d))||((v=b.name)==null?void 0:v.toLowerCase().includes(d))||((p=b.specifications)==null?void 0:p.toLowerCase().includes(d))||((g=b.description)==null?void 0:g.toLowerCase().includes(d))})},[t,s]),n=c.useCallback(d=>{r(d.target.value)},[]);return c.useCallback(()=>{r("")},[]),e.jsxs(O,{className:"border-0 rounded-0 shadow-sm",children:[e.jsx(O.Header,{className:"bg-white fw-bold py-2",children:e.jsxs(m,{children:[e.jsx(m.Text,{className:"rounded-0 bg-light",children:e.jsx(je,{})}),e.jsx(j,{type:"search",placeholder:"Search by barcode, name, specifications...",className:"rounded-0",value:s,onChange:n,autoFocus:!0})]})}),e.jsx(O.Body,{children:l?e.jsx("div",{className:"d-flex justify-content-center align-items-center py-5",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ke,{animation:"border",variant:"primary"}),e.jsx("h6",{className:"mt-2 text-muted",children:"Loading products..."})]})}):o.length===0?e.jsx("div",{className:"text-center py-5",children:s?e.jsxs(ae,{variant:"light",className:"rounded-0",children:[e.jsx("h6",{children:"No products found"}),e.jsxs("p",{className:"text-muted mb-0",children:['No products match "',e.jsx("strong",{children:s}),'"']})]}):e.jsxs(ae,{variant:"light",className:"rounded-0",children:[e.jsx("h6",{children:"No products available"}),e.jsx("p",{className:"text-muted mb-0",children:"Please add products to get started"})]})}):e.jsx(I,{className:"g-2",children:o.map(d=>e.jsx(N,{xs:6,md:4,lg:3,xl:2,children:e.jsx(Oe,{systemMode:"erp",item:d})},d.id))})})]})},jt=({sale:t=null})=>{var ee,te;const{cartItems:l,clearCart:s,cartTotal:r,setCartItems:o}=oe(),[n,d]=c.useState(!1),[b,x]=c.useState(!1),[v,p]=c.useState(((ee=t==null?void 0:t.customer)==null?void 0:ee.name)||((te=t==null?void 0:t.customer)==null?void 0:te.full_name)||""),[g,A]=c.useState([]),[M,a]=c.useState(!1),[u,$]=c.useState((t==null?void 0:t.customer_id)||null),[C,D]=c.useState(t!=null&&t.date?new Date(t.date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0]),E=c.useRef(null),{paymentMethods:Q}=le(),[R,W]=c.useState({});c.useEffect(()=>{const i=Q.reduce((h,y)=>{var f;const S=((f=t==null?void 0:t.payments)==null?void 0:f.filter(k=>{var _;return((_=k.payment_method_name)==null?void 0:_.toLowerCase())===y.name.toLowerCase()}))||[];return h[y.name.toLowerCase()]=S.map(k=>k.metadata),h},{});W(i)},[t,Q]);const q=c.useMemo(()=>({id:(t==null?void 0:t.id)||null,order_number:(t==null?void 0:t.order_number)||null,date:(t==null?void 0:t.date)||C,customer_id:(t==null?void 0:t.customer_id)||u}),[t,C,u]);c.useEffect(()=>{var i;((i=t==null?void 0:t.items)==null?void 0:i.length)>0&&setTimeout(()=>{o(t.items.map(h=>({id:h.product_id,name:h.product_name,price:h.price,image:"",quantity:h.quantity})))},0)},[t,s,o]),c.useEffect(()=>{const i=h=>{E.current&&!E.current.contains(h.target)&&a(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]);const ce=c.useCallback(async i=>{var y,S;const h=i.target.value;if(p(h),h.length<=2){a(!1);return}try{const{data:f}=await ne.get(route("api.customer.search"),{params:{value:h}});f.success?(A(f.customers),a(!0)):(L.error(f.message),a(!1))}catch(f){L.error(((S=(y=f.response)==null?void 0:y.data)==null?void 0:S.message)||"An error occurred"),a(!1)}},[]),X=c.useCallback(i=>{$(i.id),p(i.name||i.full_name),a(!1)},[]),de=c.useCallback(i=>{D(i.target.value)},[]),K=c.useCallback(()=>{s(),D(new Date().toISOString().split("T")[0]),$(null),p(""),x(!1),a(!1),d(!1)},[s]),Z=c.useCallback(async(i,h=!1)=>{var y,S,f,k;if(i.preventDefault(),!u){L.error("Please select a customer before submitting.");return}if(r===0){L.error("Cart is empty. Please add products before submitting.");return}d(!0);try{if(!(await Ee.fire({title:"Confirm submission",text:t?"Do you want to update this sale?":"Do you want to save this sale?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:t?"Yes, update it!":"Yes, save it!"})).isConfirmed){d(!1);return}const B=new FormData;Object.entries({...q,date:C,customer_id:u,_method:t?"PUT":"POST"}).forEach(([ue,H])=>{H!=null&&B.append(ue,H)}),B.append("cartItems",JSON.stringify(l)),B.append("paymentData",JSON.stringify(R));const me=t?route("sales.update",{sale:t.id}):route("sales.store"),F=await ne.post(me,B);F.data.success===!0&&(L.success(F.data.message),h&&we((S=(y=F==null?void 0:F.data)==null?void 0:y.data)==null?void 0:S.order),s())}catch(_){L.error(((k=(f=_.response)==null?void 0:f.data)==null?void 0:k.message)||"An error occurred")}finally{d(!1)}},[q,l,r,K,R,t,u,C]);return e.jsxs(Le,{children:[e.jsx(he,{title:t?"Edit Sale":"Create New Sale"}),e.jsx(Pe,{onSubmit:i=>Z(i,!1),children:e.jsxs(I,{className:"g-2",children:[e.jsx(N,{md:8,children:e.jsxs(I,{className:"g-2",children:[e.jsx(N,{md:4,children:e.jsxs(m,{children:[e.jsx(m.Text,{className:"rounded-0",children:e.jsx(ge,{})}),e.jsx(j,{type:"date",value:C,onChange:de,className:"rounded-0"})]})}),e.jsx(N,{md:4,children:e.jsxs(m,{children:[e.jsx(m.Text,{className:"rounded-0",children:e.jsx(ie,{})}),e.jsx(j,{type:"text",value:q.order_number||"",placeholder:"Order Number",className:"rounded-0",disabled:!0})]})}),e.jsx(N,{md:4,ref:E,children:e.jsxs(m,{children:[e.jsx(m.Text,{className:"rounded-0",children:e.jsx(be,{})}),e.jsx(j,{type:"search",placeholder:"Customer Name or Phone...",className:"rounded-0",value:v,onChange:ce,onFocus:()=>v.length>2&&a(!0)}),e.jsx(m.Text,{className:"rounded-0",style:{cursor:"pointer"},onClick:()=>x(!0),children:e.jsx(ye,{})}),M&&e.jsx(U,{className:"position-absolute rounded-0 w-100",style:{zIndex:1050,top:"100%"},children:g.length>0?g.map(i=>e.jsxs(U.Item,{action:!0,onClick:()=>X(i),className:"rounded-0",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{children:i.name||i.full_name}),e.jsx("small",{className:"text-muted",children:i.phone})]}),i.email&&e.jsx("div",{className:"small text-muted",children:i.email})]},i.id)):e.jsx(U.Item,{className:"rounded-0 text-center text-muted",children:"No customers found"})})]})}),e.jsxs(N,{md:12,children:[e.jsx(ze,{}),e.jsx(Te,{paymentData:R,setPaymentData:W})]})]})}),e.jsxs(N,{md:4,children:[e.jsx(Be,{paymentData:R,setPaymentData:W}),e.jsxs(_e,{className:"d-flex gap-2 mt-2",children:[e.jsxs(z,{type:"button",variant:"success",className:"rounded-0 shadow-sm",onClick:i=>Z(i,!0),disabled:r===0||n,children:[e.jsx(Ne,{className:"me-1"}),n?"Processing...":t?"Update & Print":"Save & Print"]}),e.jsxs(z,{type:"button",variant:"warning",className:"rounded-0 shadow-sm",onClick:K,disabled:n,children:[e.jsx(J,{className:"me-1"}),t?"Reset Changes":"Cancel"]}),e.jsxs(z,{type:"submit",variant:"primary",className:"rounded-0 shadow-sm",disabled:r===0||n,children:[e.jsx(V,{className:"me-1"}),n?"Processing...":t?"Update Sale":"Save"]})]})]})]})}),e.jsx(ve,{show:b,onHide:()=>x(!1),onClose:()=>x(!1),onSuccess:i=>{X(i),x(!1)}})]})};export{jt as default};
