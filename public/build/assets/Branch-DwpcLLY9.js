import{j as e,r as x,$ as T}from"./app-CGCcTJnQ.js";import{R as o,y as B}from"./Footer-CRm-FYLZ.js";import{E as D}from"./ErpLayout-Dd3SuRvB.js";import{c as L,d as c,b as y,u as G}from"./index.esm-DQ4HJBQI.js";import{x as I}from"./axios-Q-ZagsbW.js";import{M as C}from"./Modal-BLOzEIBk.js";import{F as a,C as n}from"./Form-CztmhhS9.js";import{B as g,C as q}from"./Image-C1oIC0_0.js";import{S as w}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{B as F}from"./ButtonGroup-CGPVR6rS.js";import{P as M}from"./plus-circle-DHFvihAX.js";import{C as S}from"./Card-BYpRWYjG.js";import{T as E}from"./Table-DdKforGC.js";import"./CloseButton-DfHhhRN2.js";/* empty css                      */import"./hoist-non-react-statics.cjs-C-Qo8PK8.js";function P({show:v,onHide:u,branch:l,onSuccess:j}){const p=!!l,_=L().shape({name:c().required("Name is required"),code:c().required("Code is required"),email:c().email("Invalid email format").nullable(),phone:c().required("Phone is required"),address:c().required("Address is required"),city:c().required("City is required"),state:c().required("State is required"),country:c().required("Country is required"),postal_code:c().required("Postal code is required"),is_active:y(),is_online:y(),has_pickup:y(),has_delivery:y(),currency:c().required("Currency is required")}),s=G({enableReinitialize:!0,initialValues:{name:(l==null?void 0:l.name)||"",code:(l==null?void 0:l.code)||"",email:(l==null?void 0:l.email)||"",phone:(l==null?void 0:l.phone)||"",manager_name:(l==null?void 0:l.manager_name)||"",manager_contact:(l==null?void 0:l.manager_contact)||"",address:(l==null?void 0:l.address)||"",city:(l==null?void 0:l.city)||"",state:(l==null?void 0:l.state)||"",country:(l==null?void 0:l.country)||"drc",postal_code:(l==null?void 0:l.postal_code)||"",latitude:(l==null?void 0:l.latitude)||"",longitude:(l==null?void 0:l.longitude)||"",opening_time:(l==null?void 0:l.opening_time)||"",closing_time:(l==null?void 0:l.closing_time)||"",working_days:(l==null?void 0:l.working_days)||[],is_active:(l==null?void 0:l.is_active)??!0,is_online:(l==null?void 0:l.is_online)??!1,has_pickup:(l==null?void 0:l.has_pickup)??!1,has_delivery:(l==null?void 0:l.has_delivery)??!1,delivery_radius:(l==null?void 0:l.delivery_radius)||"",delivery_fee:(l==null?void 0:l.delivery_fee)||"",currency:(l==null?void 0:l.currency)||"CDF",notes:(l==null?void 0:l.notes)||"",_method:p?"PUT":"POST"},validationSchema:_,onSubmit:async(i,{setSubmitting:t,setErrors:h})=>{var d,r;try{const m=p?route("branch.update",l.id):route("branch.store"),N=await I.post(m,i);N.data.success===!0&&(j(N.data.message),u())}catch(m){(r=(d=m.response)==null?void 0:d.data)!=null&&r.errors?h(m.response.data.errors):console.error("Error submitting form:",m)}finally{t(!1)}}}),f=[{id:1,name:"Monday"},{id:2,name:"Tuesday"},{id:3,name:"Wednesday"},{id:4,name:"Thursday"},{id:5,name:"Friday"},{id:6,name:"Saturday"},{id:7,name:"Sunday"}],k=i=>{const t=s.values.working_days||[],h=t.includes(i)?t.filter(d=>d!==i):[...t,i];s.setFieldValue("working_days",h)};return e.jsxs(C,{show:v,onHide:u,size:"lg",centered:!0,backdrop:"static",children:[e.jsx(C.Header,{closeButton:!0,children:e.jsx(C.Title,{children:p?"Edit Branch":"Create New Branch"})}),e.jsxs(a,{onSubmit:s.handleSubmit,children:[e.jsxs(C.Body,{children:[e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{md:6,children:e.jsxs(a.Group,{controlId:"name",children:[e.jsx(a.Label,{children:"Name *"}),e.jsx(a.Control,{type:"text",name:"name",value:s.values.name,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.name&&!!s.errors.name}),e.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.name})]})}),e.jsx(n,{md:6,children:e.jsxs(a.Group,{controlId:"code",children:[e.jsx(a.Label,{children:"Code *"}),e.jsx(a.Control,{type:"text",name:"code",value:s.values.code,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.code&&!!s.errors.code}),e.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.code})]})})]}),e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{md:6,children:e.jsxs(a.Group,{controlId:"email",children:[e.jsx(a.Label,{children:"Email"}),e.jsx(a.Control,{type:"email",name:"email",value:s.values.email,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.email&&!!s.errors.email}),e.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.email})]})}),e.jsx(n,{md:6,children:e.jsxs(a.Group,{controlId:"phone",children:[e.jsx(a.Label,{children:"Phone *"}),e.jsx(a.Control,{type:"text",name:"phone",value:s.values.phone,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.phone&&!!s.errors.phone}),e.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.phone})]})})]}),e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{md:6,children:e.jsxs(a.Group,{controlId:"manager_name",children:[e.jsx(a.Label,{children:"Manager Name"}),e.jsx(a.Control,{type:"text",name:"manager_name",value:s.values.manager_name,onChange:s.handleChange})]})}),e.jsx(n,{md:6,children:e.jsxs(a.Group,{controlId:"manager_contact",children:[e.jsx(a.Label,{children:"Manager Contact"}),e.jsx(a.Control,{type:"text",name:"manager_contact",value:s.values.manager_contact,onChange:s.handleChange})]})})]}),e.jsxs(a.Group,{controlId:"address",className:"mb-3",children:[e.jsx(a.Label,{children:"Address *"}),e.jsx(a.Control,{as:"textarea",rows:2,name:"address",value:s.values.address,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.address&&!!s.errors.address}),e.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.address})]}),e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{md:4,children:e.jsxs(a.Group,{controlId:"city",children:[e.jsx(a.Label,{children:"City *"}),e.jsx(a.Control,{type:"text",name:"city",value:s.values.city,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.city&&!!s.errors.city}),e.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.city})]})}),e.jsx(n,{md:4,children:e.jsxs(a.Group,{controlId:"state",children:[e.jsx(a.Label,{children:"State *"}),e.jsx(a.Control,{type:"text",name:"state",value:s.values.state,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.state&&!!s.errors.state}),e.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.state})]})}),e.jsx(n,{md:4,children:e.jsxs(a.Group,{controlId:"postal_code",children:[e.jsx(a.Label,{children:"Postal Code *"}),e.jsx(a.Control,{type:"text",name:"postal_code",value:s.values.postal_code,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.postal_code&&!!s.errors.postal_code}),e.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.postal_code})]})})]}),e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{md:6,children:e.jsxs(a.Group,{controlId:"country",children:[e.jsx(a.Label,{children:"Country *"}),e.jsxs(a.Control,{as:"select",name:"country",value:s.values.country,onChange:s.handleChange,children:[e.jsx("option",{value:"drc",children:"DR Congo"}),e.jsx("option",{value:"other",children:"Other"})]})]})}),e.jsx(n,{md:6,children:e.jsxs(a.Group,{controlId:"currency",children:[e.jsx(a.Label,{children:"Currency *"}),e.jsxs(a.Control,{as:"select",name:"currency",value:s.values.currency,onChange:s.handleChange,children:[e.jsx("option",{value:"CDF",children:"CDF"}),e.jsx("option",{value:"USD",children:"USD"})]})]})})]}),e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{md:6,children:e.jsxs(a.Group,{controlId:"opening_time",children:[e.jsx(a.Label,{children:"Opening Time"}),e.jsx(a.Control,{type:"time",name:"opening_time",value:s.values.opening_time,onChange:s.handleChange})]})}),e.jsx(n,{md:6,children:e.jsxs(a.Group,{controlId:"closing_time",children:[e.jsx(a.Label,{children:"Closing Time"}),e.jsx(a.Control,{type:"time",name:"closing_time",value:s.values.closing_time,onChange:s.handleChange})]})})]}),e.jsxs(a.Group,{controlId:"working_days",className:"mb-3",children:[e.jsx(a.Label,{children:"Working Days"}),e.jsx("div",{className:"d-flex flex-wrap gap-2",children:f.map(i=>{var t;return e.jsx(g,{variant:(t=s.values.working_days)!=null&&t.includes(i.id)?"primary":"outline-secondary",onClick:()=>k(i.id),size:"sm",children:i.name},i.id)})})]}),e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{md:6,children:e.jsxs(a.Group,{controlId:"latitude",children:[e.jsx(a.Label,{children:"Latitude"}),e.jsx(a.Control,{type:"number",step:"0.000001",name:"latitude",value:s.values.latitude,onChange:s.handleChange})]})}),e.jsx(n,{md:6,children:e.jsxs(a.Group,{controlId:"longitude",children:[e.jsx(a.Label,{children:"Longitude"}),e.jsx(a.Control,{type:"number",step:"0.000001",name:"longitude",value:s.values.longitude,onChange:s.handleChange})]})})]}),e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{children:e.jsx(a.Check,{type:"switch",id:"is_active",label:"Is Active",checked:s.values.is_active,onChange:s.handleChange,name:"is_active"})}),e.jsx(n,{children:e.jsx(a.Check,{type:"switch",id:"is_online",label:"Supports Online Orders",checked:s.values.is_online,onChange:s.handleChange,name:"is_online"})})]}),e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{children:e.jsx(a.Check,{type:"switch",id:"has_pickup",label:"Supports Pickup",checked:s.values.has_pickup,onChange:s.handleChange,name:"has_pickup"})}),e.jsx(n,{children:e.jsx(a.Check,{type:"switch",id:"has_delivery",label:"Supports Delivery",checked:s.values.has_delivery,onChange:s.handleChange,name:"has_delivery"})})]}),s.values.has_delivery&&e.jsxs(o,{className:"mb-3",children:[e.jsx(n,{md:6,children:e.jsxs(a.Group,{controlId:"delivery_radius",children:[e.jsx(a.Label,{children:"Delivery Radius (km)"}),e.jsx(a.Control,{type:"number",min:"0",name:"delivery_radius",value:s.values.delivery_radius,onChange:s.handleChange})]})}),e.jsx(n,{md:6,children:e.jsxs(a.Group,{controlId:"delivery_fee",children:[e.jsx(a.Label,{children:"Delivery Fee"}),e.jsx(a.Control,{type:"number",min:"0",step:"0.01",name:"delivery_fee",value:s.values.delivery_fee,onChange:s.handleChange})]})})]}),e.jsxs(a.Group,{controlId:"notes",className:"mb-3",children:[e.jsx(a.Label,{children:"Notes"}),e.jsx(a.Control,{as:"textarea",rows:3,name:"notes",value:s.values.notes,onChange:s.handleChange})]})]}),e.jsxs(C.Footer,{children:[e.jsx(g,{variant:"secondary",onClick:u,children:"Cancel"}),e.jsx(g,{variant:"primary",type:"submit",disabled:s.isSubmitting,children:s.isSubmitting?"Saving...":"Save Changes"})]})]})]})}function se(){const[v,u]=x.useState(!1),[l,j]=x.useState(null),p=x.useCallback(()=>{$.fn.DataTable.isDataTable("#branchesTable")&&$("#branchesTable").DataTable().destroy(),$("#branchesTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("branch.index"),type:"GET"},columns:[{data:"name",title:"Name"},{data:"code",title:"Code"},{data:"city",title:"City"},{data:"phone",title:"Phone"},{data:"status_badge",title:"Status"},{data:"action",title:"Actions"}],drawCallback:()=>{$(".edit-btn").off("click").on("click",function(){const t=$(this).data("id");k(t)}),$(".delete-btn").off("click").on("click",function(){const t=$(this).data("id");i(t)})}})},[]);x.useEffect(()=>{p()},[p]);const _=x.useCallback(()=>{j(null),u(!0)},[]),s=x.useCallback(()=>{u(!1),j(null)},[]),f=x.useCallback(t=>{B.success(t),$("#branchesTable").DataTable().ajax.reload(null,!1),u(!1)},[]),k=async t=>{var h,d;try{const r=await I.get(route("branch.edit",t));r.data.success===!0?(j(r.data.data),u(!0)):B.error(r.data.message)}catch(r){console.log(r),B.error(((d=(h=r.response)==null?void 0:h.data)==null?void 0:d.message)||"An error occurred")}},i=async t=>{var d;if((await w.fire({title:"Delete Branch?",text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await I.delete(route("branch.destroy",t)),$("#branchesTable").DataTable().ajax.reload(null,!1),w.fire("Deleted!","Branch has been deleted.","success")}catch(r){let m="Delete failed.";((d=r.response)==null?void 0:d.status)===403&&(m="You don't have permission to delete this branch."),w.fire("Error!",m,"error")}};return e.jsxs(D,{children:[e.jsx(T,{title:"Branches Management"}),e.jsx(q,{fluid:!0,children:e.jsxs(o,{className:"g-3",children:[e.jsxs(n,{md:12,className:"d-flex justify-content-between align-items-center",children:[e.jsx("h2",{className:"mb-0",children:"Branches Management"}),e.jsx(F,{children:e.jsxs(g,{variant:"primary",onClick:_,className:"d-flex align-items-center gap-2",children:[e.jsx(M,{size:18}),"Add New Branch"]})})]}),e.jsx(n,{md:12,children:e.jsx("hr",{className:"dashed-hr"})}),e.jsx(n,{md:12,children:e.jsx(S,{children:e.jsx(S.Body,{children:e.jsx(E,{bordered:!0,striped:!0,hover:!0,responsive:!0,id:"branchesTable",className:"w-100"})})})})]})}),e.jsx(P,{show:v,onHide:s,branch:l,onSuccess:f})]})}export{se as default};
