import{j as e,r as c,$ as B}from"./app-DDPmmEsP.js";import{R as f,y as v}from"./Footer-DHiARg5T.js";import{E as F}from"./ErpLayout-BTroGK5i.js";import{c as q,d as m,a as D,b as _,u as E}from"./index.esm-CdR14npU.js";import{x as k}from"./axios-CX_3tIE5.js";import{M as h}from"./Modal-CuFKoZEN.js";import{F as r,C as l}from"./Form-Cqgl9C35.js";import{B as T,C as I}from"./Image-CfrpkxQr.js";import{S as M}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{B as G}from"./ButtonGroup-BveU2NPQ.js";import{P as A}from"./plus-circle-CjFKlHv7.js";import{C as P}from"./Card-BnTkWAgR.js";import{T as L}from"./Table-DWCTgkd7.js";import"./CloseButton-bKfF9Hr0.js";/* empty css                      */import"./hoist-non-react-statics.cjs-C-Qo8PK8.js";function R({show:x,onHide:o,method:s,onSuccess:p}){const d=!!s,j=q().shape({name:m().required("Name is required"),code:m().required("Code is required"),description:m().nullable(),is_active:_(),is_default:_(),requires_approval:_(),processing_fee:D().min(0,"Fee cannot be negative"),fee_type:m().oneOf(["fixed","percentage"]).required("Fee type is required")}),a=E({enableReinitialize:!0,initialValues:{name:(s==null?void 0:s.name)||"",code:(s==null?void 0:s.code)||"",description:(s==null?void 0:s.description)||"",is_active:(s==null?void 0:s.is_active)??!0,is_default:(s==null?void 0:s.is_default)??!1,requires_approval:(s==null?void 0:s.requires_approval)??!1,processing_fee:(s==null?void 0:s.processing_fee)||0,fee_type:(s==null?void 0:s.fee_type)||"fixed",_method:d?"PUT":"POST"},validationSchema:j,onSubmit:async(y,{setSubmitting:b,setErrors:C})=>{var t,u;try{const n=d?route("payment-method.update",s.id):route("payment-method.store"),i=await k.post(n,y);i.data.success===!0&&(p(i.data.message),o())}catch(n){console.log(n),(u=(t=n.response)==null?void 0:t.data)!=null&&u.errors?C(n.response.data.errors):console.error("Error submitting form:",n)}finally{b(!1)}}});return e.jsxs(h,{show:x,onHide:o,size:"lg",centered:!0,backdrop:"static",children:[e.jsx(h.Header,{closeButton:!0,children:e.jsx(h.Title,{children:d?"Edit Payment Method":"Create New Payment Method"})}),e.jsxs(r,{onSubmit:a.handleSubmit,children:[e.jsxs(h.Body,{children:[e.jsxs(f,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsxs(r.Group,{controlId:"name",children:[e.jsx(r.Label,{children:"Name *"}),e.jsx(r.Control,{type:"text",name:"name",value:a.values.name,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.name&&!!a.errors.name}),e.jsx(r.Control.Feedback,{type:"invalid",children:a.errors.name})]})}),e.jsx(l,{md:6,children:e.jsxs(r.Group,{controlId:"code",children:[e.jsx(r.Label,{children:"Code *"}),e.jsx(r.Control,{type:"text",name:"code",value:a.values.code,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.code&&!!a.errors.code}),e.jsx(r.Control.Feedback,{type:"invalid",children:a.errors.code})]})})]}),e.jsxs(r.Group,{controlId:"description",className:"mb-3",children:[e.jsx(r.Label,{children:"Description"}),e.jsx(r.Control,{as:"textarea",rows:2,name:"description",value:a.values.description,onChange:a.handleChange})]}),e.jsxs(f,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsxs(r.Group,{controlId:"processing_fee",children:[e.jsx(r.Label,{children:"Processing Fee"}),e.jsx(r.Control,{type:"number",min:"0",step:"0.01",name:"processing_fee",value:a.values.processing_fee,onChange:a.handleChange,isInvalid:a.touched.processing_fee&&!!a.errors.processing_fee}),e.jsx(r.Control.Feedback,{type:"invalid",children:a.errors.processing_fee})]})}),e.jsx(l,{md:6,children:e.jsxs(r.Group,{controlId:"fee_type",children:[e.jsx(r.Label,{children:"Fee Type"}),e.jsxs(r.Select,{name:"fee_type",value:a.values.fee_type,onChange:a.handleChange,isInvalid:a.touched.fee_type&&!!a.errors.fee_type,children:[e.jsx("option",{value:"fixed",children:"Fixed Amount"}),e.jsx("option",{value:"percentage",children:"Percentage"})]}),e.jsx(r.Control.Feedback,{type:"invalid",children:a.errors.fee_type})]})})]}),e.jsxs(f,{className:"mb-3",children:[e.jsx(l,{children:e.jsx(r.Check,{type:"switch",id:"is_active",label:"Active",checked:a.values.is_active,onChange:a.handleChange,name:"is_active"})}),e.jsx(l,{children:e.jsx(r.Check,{type:"switch",id:"is_default",label:"Default Method",checked:a.values.is_default,onChange:a.handleChange,name:"is_default"})}),e.jsx(l,{children:e.jsx(r.Check,{type:"switch",id:"requires_approval",label:"Requires Approval",checked:a.values.requires_approval,onChange:a.handleChange,name:"requires_approval"})})]})]}),e.jsxs(h.Footer,{children:[e.jsx(T,{variant:"secondary",onClick:o,children:"Cancel"}),e.jsx(T,{variant:"primary",type:"submit",disabled:a.isSubmitting,children:a.isSubmitting?"Saving...":"Save Changes"})]})]})]})}function te(){const[x,o]=c.useState(!1),[s,p]=c.useState(null),d=c.useCallback(()=>{$.fn.DataTable.isDataTable("#paymentMethodsTable")&&$("#paymentMethodsTable").DataTable().destroy(),$("#paymentMethodsTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("payment-method.index"),type:"GET"},columns:[{data:"name",title:"Name"},{data:"code",title:"Code"},{data:"fee",title:"Processing Fee"},{data:"status",title:"Status"},{data:"action",title:"Actions"}],drawCallback:()=>{$(".edit-btn").off("click").on("click",function(){const t=$(this).data("id");b(t)}),$(".delete-btn").off("click").on("click",function(){const t=$(this).data("id");C(t)})}})},[]);c.useEffect(()=>{d()},[d]);const j=c.useCallback(()=>{p(null),o(!0)},[]),a=c.useCallback(()=>{o(!1),p(null)},[]),y=c.useCallback(t=>{v.success(t),$("#paymentMethodsTable").DataTable().ajax.reload(null,!1),o(!1)},[]),b=async t=>{var u,n;try{const i=await k.get(route("payment-method.edit",t));i.data.success===!0?(p(i.data.data),o(!0)):v.error(i.data.message)}catch(i){v.error(((n=(u=i.response)==null?void 0:u.data)==null?void 0:n.message)||"An error occurred")}},C=async t=>{var n,i,w,S;if((await M.fire({title:"Delete Payment Method?",text:"This cannot be undone. Transactions using this method will be preserved.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await k.delete(route("payment-method.destroy",t)),$("#paymentMethodsTable").DataTable().ajax.reload(null,!1),M.fire("Deleted!","Payment method has been deleted.","success")}catch(N){let g="Delete failed.";((n=N.response)==null?void 0:n.status)===403?g="You don't have permission to delete this method.":(S=(w=(i=N.response)==null?void 0:i.data)==null?void 0:w.message)!=null&&S.includes("default")&&(g="Cannot delete default payment method."),M.fire("Error!",g,"error")}};return e.jsxs(F,{children:[e.jsx(B,{title:"Payment Methods Management"}),e.jsx(I,{fluid:!0,children:e.jsxs(f,{className:"g-3",children:[e.jsxs(l,{md:12,className:"d-flex justify-content-between align-items-center",children:[e.jsx("h2",{className:"mb-0",children:"Payment Methods"}),e.jsx(G,{children:e.jsxs(T,{variant:"primary",onClick:j,className:"d-flex align-items-center gap-2",children:[e.jsx(A,{size:18}),"Add New Method"]})})]}),e.jsx(l,{md:12,children:e.jsx("hr",{className:"dashed-hr"})}),e.jsx(l,{md:12,children:e.jsx(P,{children:e.jsx(P.Body,{children:e.jsx(L,{bordered:!0,striped:!0,hover:!0,responsive:!0,id:"paymentMethodsTable",className:"w-100"})})})})]})}),e.jsx(R,{show:x,onHide:a,method:s,onSuccess:y})]})}export{te as default};
