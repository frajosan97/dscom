import{r as c,j as e,$ as X,Y as J}from"./app-CxIzz1Hm.js";import{A as L,C as Q,D as W,e as H,v as Z,b as ee,c as q,d as te}from"./index-CMQojAPB.js";import{S as se}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{y as d,R as V,I as T,D as S}from"./Footer-1rOk33u-.js";import{E as ae}from"./ErpLayout-CKY1G0eu.js";import{x as O}from"./axios-CbP2VCmx.js";import{a as z}from"./helpers-gygXJL7Y.js";import{x as re,F as le,a as ne,b as oe}from"./index-DEpCKpyh.js";import{M as F}from"./Modal-u0gFxUa_.js";import{F as j,C as I}from"./Form-C32FoLO3.js";import{B as f,C as ce}from"./Image-B2kFzfRD.js";import{P as ie}from"./ProgressBar-7O8_5FFN.js";import{u as de}from"./useData-DPZ4tnDZ.js";import{B as Y}from"./ButtonGroup-BeeULg22.js";import{C as G}from"./Card-BGz8PFHq.js";import{T as me}from"./Table-EbxAEte5.js";import"./iconBase-8l29Fq_8.js";import"./CloseButton-DTBn4gN-.js";/* empty css                      */function ue({show:b,onHide:k,onImportSuccess:p,importTemplateUrl:R}){const[i,_]=c.useState(null),[l,v]=c.useState(!1),[N,w]=c.useState(0),[y,u]=c.useState(""),[n,x]=c.useState([]),h=c.useRef(null),E=t=>{const s=t.target.files[0];if(!s)return;const a=["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv","application/vnd.oasis.opendocument.spreadsheet"],o=[".xlsx",".xls",".csv",".ods"],C="."+s.name.split(".").pop().toLowerCase();if(!a.includes(s.type)&&!o.includes(C)){d.error("Please select a valid Excel or CSV file (.xlsx, .xls, .csv)");return}if(s.size>10*1024*1024){d.error("File size should not exceed 10MB");return}_(s),x([])},A=async()=>{var s,a,o,C;if(!i){d.error("Please select a file to import");return}const t=new FormData;t.append("file",i),t.append("_method","POST"),v(!0),w(0),u("Uploading..."),x([]);try{const m=setInterval(()=>{w(B=>B>=90?(clearInterval(m),90):B+10)},300),P=await O.post(route("product.import"),t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:B=>{const K=Math.round(B.loaded*100/B.total);w(K)}});clearInterval(m),w(100),u("Processing products..."),setTimeout(()=>{if(P.data.success)u("Import completed successfully!"),setTimeout(()=>{d.success(P.data.message||`${P.data.count||0} products imported successfully!`),g(),k(),p==null||p()},500);else throw new Error(P.data.message||"Import failed")},1e3)}catch(m){if(v(!1),u("Import failed"),(a=(s=m.response)==null?void 0:s.data)!=null&&a.errors){const P=Object.values(m.response.data.errors).flat();x(P),d.error("There were errors during import. Please check the error list.")}else(C=(o=m.response)==null?void 0:o.data)!=null&&C.message?(d.error(m.response.data.message),x([m.response.data.message])):(d.error("Error importing products. Please try again."),x(["An unexpected error occurred during import."]))}},M=async()=>{try{const t=await O.get(R||route("product.import.template"),{responseType:"blob"}),s=window.URL.createObjectURL(new Blob([t.data])),a=document.createElement("a");a.href=s,a.setAttribute("download","product_import_template.xlsx"),document.body.appendChild(a),a.click(),a.remove(),d.success("Product template downloaded successfully!")}catch{d.error("Failed to download template. Please try again.")}},g=()=>{_(null),x([]),w(0),u(""),v(!1),h.current&&(h.current.value="")},D=()=>{l?window.confirm("Import is in progress. Are you sure you want to cancel?")&&(g(),k()):(g(),k())},U=t=>{t.preventDefault(),t.stopPropagation()},r=t=>{if(t.preventDefault(),t.stopPropagation(),l)return;const s=t.dataTransfer.files;if(s.length>0){const o={target:{files:[s[0]]}};E(o)}};return e.jsxs(F,{show:b,onHide:D,size:"lg",backdrop:l?"static":!0,keyboard:!l,children:[e.jsx(F.Header,{closeButton:!l,children:e.jsxs(F.Title,{className:"d-flex align-items-center",children:[e.jsx(L,{className:"me-2"}),"Import Products from Excel/CSV"]})}),e.jsxs(F.Body,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs(j.Group,{children:[e.jsx(j.Label,{className:"fw-semibold",children:"Select Excel/CSV File"}),e.jsx("div",{className:"border rounded p-4 text-center",onDragOver:U,onDrop:r,style:{borderStyle:"dashed",cursor:l?"not-allowed":"pointer",backgroundColor:l?"#f8f9fa":"white"},onClick:()=>{var t;return!l&&((t=h.current)==null?void 0:t.click())},children:i?e.jsxs("div",{className:"d-flex align-items-center justify-content-between bg-light p-3 rounded",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(Q,{className:"fs-4 text-primary me-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:i.name}),e.jsxs("small",{className:"text-muted",children:[(i.size/1024).toFixed(2)," ","KB â€¢"," ",i.name.split(".").pop().toUpperCase()]})]})]}),e.jsx(f,{variant:"outline-danger",size:"sm",onClick:t=>{t.stopPropagation(),g()},disabled:l,children:e.jsx(W,{})})]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"fs-1 text-muted mb-3"}),e.jsx("p",{className:"text-muted mb-3",children:"Drag & drop your Excel/CSV file here or click to browse"}),e.jsx(f,{variant:"outline-primary",onClick:t=>{var s;t.stopPropagation(),(s=h.current)==null||s.click()},disabled:l,children:"Browse Files"}),e.jsx(j.Control,{type:"file",ref:h,onChange:E,accept:".xlsx,.xls,.csv,.ods",className:"d-none",disabled:l})]})}),e.jsx(j.Text,{className:"text-muted",children:"Supported formats: .xlsx, .xls, .csv, .ods (Max 10MB)"})]})}),l&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("small",{className:"text-muted",children:"Import Progress"}),e.jsxs("small",{className:"text-muted",children:[N,"%"]})]}),e.jsx(ie,{now:N,animated:N<100,variant:N===100?"success":"primary",className:"mb-2"}),y&&e.jsx("small",{className:`d-block text-center ${y.includes("failed")?"text-danger":y.includes("success")?"text-success":"text-muted"}`,children:y})]}),n.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{className:"text-danger mb-2",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),"Import Errors (",n.length,"):"]}),e.jsx("div",{className:"border border-danger rounded p-3 bg-danger bg-opacity-10",children:e.jsx("ul",{className:"mb-0 ps-3",style:{maxHeight:"200px",overflowY:"auto"},children:n.map((t,s)=>e.jsxs("li",{className:"text-danger small mb-1",children:[s+1,". ",t]},s))})})]}),e.jsx("div",{className:"border-top pt-3",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsx("h6",{className:"mb-2",children:"Need a template?"}),e.jsx("p",{className:"small text-muted mb-2",children:"Download our pre-formatted Excel template with all required columns:"})]}),e.jsx("div",{className:"col-md-4 d-flex align-items-center justify-content-end",children:e.jsxs(f,{variant:"outline-success",onClick:M,disabled:l,size:"sm",className:"d-flex align-items-center",children:[e.jsx(H,{className:"me-1"}),"Download Template"]})})]})})]}),e.jsxs(F.Footer,{children:[e.jsx(f,{variant:"secondary",onClick:D,disabled:l,children:"Cancel"}),e.jsx(f,{variant:"primary",onClick:A,disabled:!i||l,className:"d-flex align-items-center",children:l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),"Importing..."]}):"Start Import"})]})]})}function _e(){const[b,k]=c.useState(""),[p,R]=c.useState("all"),[i,_]=c.useState("all"),[l,v]=c.useState(!1),[N,w]=c.useState(""),{categories:y}=de(),u=c.useRef(!1),n=c.useRef(null),x=c.useCallback(()=>{if(u.current)return;$.fn.DataTable.isDataTable("#productsTable")&&$("#productsTable").DataTable().destroy();const r=$("#productsTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("product.index"),type:"GET",data:function(t){t.search=b,t.status=p!=="all"?p:"",t.category=i!=="all"?i:""}},columns:[{data:"product_image",name:"product_image",title:"Image",orderable:!1,searchable:!1,width:"80px"},{data:"product_name",name:"product_name",title:"Product",className:"align-middle"},{data:"category.name",name:"category.name",title:"Category",className:"align-middle"},{data:"total_quantity",name:"total_quantity",title:"Stock",className:"text-center align-middle",render:function(t,s,a){if(!a.track_quantity)return'<span class="badge bg-info">N/A</span>';const o=parseInt(t)||0,C=a.low_stock_alert||0;let m="bg-success";return o===0?m="bg-danger":o<=C&&(m="bg-warning"),`
                            <span class="badge ${m}">
                                ${o} ${a.allow_backorders&&o===0?"(Backorder)":""}
                            </span>
                        `}},{data:"cost_per_item",name:"cost_per_item",title:"Cost",className:"text-end align-middle",render:function(t){return z(t||0)}},{data:"base_price",name:"base_price",title:"Price",className:"text-end align-middle",render:function(t,s,a){const o=z(t||0);return a.compare_price&&a.compare_price>t?`
                                <div>
                                    <div class="text-decoration-line-through text-muted small">
                                        ${z(a.compare_price)}
                                    </div>
                                    <div class="fw-semibold text-danger">
                                        ${o}
                                    </div>
                                </div>
                            `:o}},{data:"status_badge",name:"is_active",title:"Status",className:"text-center align-middle",orderable:!1,searchable:!1},{data:"action",name:"action",title:"Actions",className:"text-center align-middle",orderable:!1,searchable:!1,width:"100px"}],drawCallback:function(){$(".edit-btn").off("click").on("click",function(){const t=$(this).data("id");E(t)}),$(".view-btn").off("click").on("click",function(){const t=$(this).data("id");A(t)}),$(".delete-btn").off("click").on("click",function(){const t=$(this).data("id");M(t)})},initComplete:function(){u.current=!0},language:{emptyTable:'<div class="text-center py-5"><i class="bi bi-inbox display-4 text-muted"></i><p class="mt-2">No products found</p></div>',zeroRecords:'<div class="text-center py-5"><i class="bi bi-search display-4 text-muted"></i><p class="mt-2">No matching products found</p></div>'},responsive:!0,order:[[1,"asc"]],pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]]});return n.current=r,r},[b,p,i]);c.useEffect(()=>{u.current&&n.current&&n.current.ajax.reload()},[b,p,i]),c.useEffect(()=>(x(),()=>{$.fn.DataTable.isDataTable("#productsTable")&&($("#productsTable").DataTable().destroy(),u.current=!1)}),[x]);const h=()=>{n.current&&(n.current.ajax.reload(),d.success("Products imported successfully!"))},E=r=>{window.location.href=route("product.edit",r)},A=r=>{window.location.href=route("product.show",r)},M=async r=>{var t,s;try{if(!(await se.fire({title:"Are you sure?",text:"You won't be able to revert this! This will permanently delete the product.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;const o=await O.delete(route("product.destroy",r));o.data.success&&(d.success(o.data.message),n.current&&n.current.ajax.reload())}catch(a){d.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"An error occurred while deleting the product")}},g=r=>{if(n.current){const t=n.current.ajax.params(),s=new URL(route("product.export"));Object.keys(t).forEach(a=>{a!=="draw"&&a!=="_"&&a!=="start"&&a!=="length"&&s.searchParams.append(a,t[a])}),s.searchParams.append("type",r),window.open(s.toString(),"_blank")}},D=()=>{if(n.current){const r=n.current.ajax.params(),t=new URL(route("product.print"));Object.keys(r).forEach(s=>{s!=="draw"&&s!=="_"&&s!=="start"&&s!=="length"&&t.searchParams.append(s,r[s])}),window.open(t.toString(),"_blank")}},U=()=>{n.current&&(n.current.ajax.reload(),d.success("Product list refreshed!"))};return e.jsxs(ae,{children:[e.jsx(X,{title:"Product Management"}),e.jsxs(ce,{fluid:!0,children:[e.jsxs(V,{className:"mb-4 align-items-center",children:[e.jsxs(I,{md:6,children:[e.jsxs("h3",{className:"fw-bold text-primary mb-2",children:[e.jsx(Z,{className:"me-2"}),"Product Management"]}),e.jsx("p",{className:"text-muted mb-0",children:"View, manage, and maintain your product inventory."})]}),e.jsx(I,{md:6,className:"text-md-end",children:e.jsxs(Y,{className:"mb-2 mb-md-0",children:[e.jsxs(f,{variant:"outline-primary",as:J,href:route("product.create"),className:"d-flex align-items-center",children:[e.jsx(re,{className:"me-1"}),"Add Product"]}),e.jsxs(f,{variant:"primary",onClick:()=>v(!0),className:"d-flex align-items-center",children:[e.jsx(L,{className:"me-1"}),"Import Excel"]})]})})]}),e.jsxs(V,{className:"mb-4",children:[e.jsx(I,{md:6,lg:3,children:e.jsxs(T,{children:[e.jsx(T.Text,{children:e.jsx(ee,{})}),e.jsx(j.Control,{type:"text",placeholder:"Search products...",value:b,onChange:r=>k(r.target.value)})]})}),e.jsx(I,{md:6,lg:3,children:e.jsxs(T,{children:[e.jsx(T.Text,{children:e.jsx(q,{})}),e.jsxs(j.Select,{value:p,onChange:r=>R(r.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})}),e.jsx(I,{md:6,lg:3,children:e.jsxs(T,{children:[e.jsx(T.Text,{children:e.jsx(q,{})}),e.jsxs(j.Select,{value:i,onChange:r=>_(r.target.value),children:[e.jsx("option",{value:"all",children:"All Categories"}),y.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]})}),e.jsx(I,{md:6,lg:3,className:"text-lg-end mt-2 mt-lg-0",children:e.jsxs(Y,{className:"d-flex gap-2",children:[e.jsxs(f,{variant:"outline-info",onClick:U,className:"d-flex align-items-center rounded",children:[e.jsx(te,{className:"me-1"}),"Refresh"]}),e.jsxs(S,{children:[e.jsxs(S.Toggle,{variant:"outline-secondary",className:"d-flex align-items-center",children:[e.jsx(H,{className:"me-1"}),"Export"]}),e.jsxs(S.Menu,{children:[e.jsxs(S.Item,{onClick:()=>g("excel"),children:[e.jsx(le,{className:"me-2 text-success"})," ","Excel"]}),e.jsxs(S.Item,{onClick:()=>g("pdf"),children:[e.jsx(ne,{className:"me-2 text-danger"})," ","PDF"]}),e.jsxs(S.Item,{onClick:D,children:[e.jsx(oe,{className:"me-2 text-secondary"})," ","Print"]})]})]})]})})]}),e.jsx(G,{children:e.jsx(G.Body,{className:"p-0",children:e.jsx("div",{className:"table-responsive",children:e.jsx(me,{bordered:!0,hover:!0,responsive:!0,id:"productsTable",className:"align-middle mb-0"})})})})]}),e.jsx(ue,{show:l,onHide:()=>v(!1),onImportSuccess:h,importTemplateUrl:N})]})}export{_e as default};
