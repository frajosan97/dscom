import{j as e,r as x,$ as q}from"./app-CGCcTJnQ.js";import{R as h,y as I}from"./Footer-CRm-FYLZ.js";import{E as W}from"./ErpLayout-Dd3SuRvB.js";import{c as F,b as G,d as o,u as D}from"./index.esm-DQ4HJBQI.js";import{x as S}from"./axios-Q-ZagsbW.js";import{M as y}from"./Modal-BLOzEIBk.js";import{F as t,C as r}from"./Form-CztmhhS9.js";import{B as b,C as E}from"./Image-C1oIC0_0.js";import{S as N}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{u as M}from"./useData-B88Lp9nY.js";import{B as P}from"./ButtonGroup-CGPVR6rS.js";import{P as A}from"./plus-circle-DHFvihAX.js";import{C as L}from"./Card-BYpRWYjG.js";import{T as O}from"./Table-DdKforGC.js";import"./CloseButton-DfHhhRN2.js";/* empty css                      */import"./hoist-non-react-statics.cjs-C-Qo8PK8.js";function z({show:g,onHide:c,warehouse:a,branches:j,onSuccess:v}){const p=!!a,_=F().shape({name:o().required("Name is required"),code:o().required("Code is required"),branch_id:o().nullable(),address:o().required("Address is required"),city:o().required("City is required"),state:o().required("State is required"),country:o().required("Country is required"),postal_code:o().required("Postal code is required"),contact_person:o().required("Contact person is required"),contact_phone:o().required("Contact phone is required"),contact_email:o().email("Invalid email format").required("Contact email is required"),is_active:G(),is_primary:G()}),n=D({enableReinitialize:!0,initialValues:{name:(a==null?void 0:a.name)||"",code:(a==null?void 0:a.code)||"",branch_id:(a==null?void 0:a.branch_id)||"",address:(a==null?void 0:a.address)||"",city:(a==null?void 0:a.city)||"",state:(a==null?void 0:a.state)||"",country:(a==null?void 0:a.country)||"Nigeria",postal_code:(a==null?void 0:a.postal_code)||"",latitude:(a==null?void 0:a.latitude)||"",longitude:(a==null?void 0:a.longitude)||"",contact_person:(a==null?void 0:a.contact_person)||"",contact_phone:(a==null?void 0:a.contact_phone)||"",contact_email:(a==null?void 0:a.contact_email)||"",contact_position:(a==null?void 0:a.contact_position)||"",opening_time:(a==null?void 0:a.opening_time)||"08:00",closing_time:(a==null?void 0:a.closing_time)||"18:00",working_days:(a==null?void 0:a.working_days)||[],is_primary:(a==null?void 0:a.is_primary)||!1,is_active:(a==null?void 0:a.is_active)??!0,notes:(a==null?void 0:a.notes)||"",_method:p?"PUT":"POST"},validationSchema:_,onSubmit:async(l,{setSubmitting:s,setErrors:u})=>{var d,i;try{const m=p?route("warehouse.update",a.id):route("warehouse.store"),C=await S.post(m,l);C.data.success===!0&&(v(C.data.message),c())}catch(m){(i=(d=m.response)==null?void 0:d.data)!=null&&i.errors?u(m.response.data.errors):console.error("Error submitting form:",m)}finally{s(!1)}}}),f=[{id:"monday",name:"Monday"},{id:"tuesday",name:"Tuesday"},{id:"wednesday",name:"Wednesday"},{id:"thursday",name:"Thursday"},{id:"friday",name:"Friday"},{id:"saturday",name:"Saturday"},{id:"sunday",name:"Sunday"}],k=l=>{const s=n.values.working_days||[],u=s.includes(l)?s.filter(d=>d!==l):[...s,l];n.setFieldValue("working_days",u)};return e.jsxs(y,{show:g,onHide:c,size:"lg",centered:!0,backdrop:"static",children:[e.jsx(y.Header,{closeButton:!0,children:e.jsx(y.Title,{children:p?"Edit Warehouse":"Create New Warehouse"})}),e.jsxs(t,{onSubmit:n.handleSubmit,children:[e.jsxs(y.Body,{children:[e.jsxs(h,{className:"mb-3",children:[e.jsx(r,{md:6,children:e.jsxs(t.Group,{controlId:"name",children:[e.jsx(t.Label,{children:"Warehouse Name *"}),e.jsx(t.Control,{type:"text",name:"name",value:n.values.name,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.name&&!!n.errors.name}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.name})]})}),e.jsx(r,{md:6,children:e.jsxs(t.Group,{controlId:"code",children:[e.jsx(t.Label,{children:"Warehouse Code *"}),e.jsx(t.Control,{type:"text",name:"code",value:n.values.code,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.code&&!!n.errors.code}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.code})]})})]}),e.jsxs(h,{className:"mb-3",children:[e.jsx(r,{md:6,children:e.jsxs(t.Group,{controlId:"branch_id",children:[e.jsx(t.Label,{children:"Branch"}),e.jsxs(t.Select,{name:"branch_id",value:n.values.branch_id,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.branch_id&&!!n.errors.branch_id,children:[e.jsx("option",{value:"",children:"Select Branch"}),j.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.branch_id})]})}),e.jsx(r,{md:6,children:e.jsx(t.Group,{controlId:"is_primary",children:e.jsx(t.Check,{type:"switch",id:"is_primary",label:"Primary Warehouse",checked:n.values.is_primary,onChange:n.handleChange,name:"is_primary"})})})]}),e.jsxs(t.Group,{controlId:"address",className:"mb-3",children:[e.jsx(t.Label,{children:"Address *"}),e.jsx(t.Control,{as:"textarea",rows:2,name:"address",value:n.values.address,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.address&&!!n.errors.address}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.address})]}),e.jsxs(h,{className:"mb-3",children:[e.jsx(r,{md:4,children:e.jsxs(t.Group,{controlId:"city",children:[e.jsx(t.Label,{children:"City *"}),e.jsx(t.Control,{type:"text",name:"city",value:n.values.city,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.city&&!!n.errors.city}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.city})]})}),e.jsx(r,{md:4,children:e.jsxs(t.Group,{controlId:"state",children:[e.jsx(t.Label,{children:"State *"}),e.jsx(t.Control,{type:"text",name:"state",value:n.values.state,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.state&&!!n.errors.state}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.state})]})}),e.jsx(r,{md:4,children:e.jsxs(t.Group,{controlId:"postal_code",children:[e.jsx(t.Label,{children:"Postal Code *"}),e.jsx(t.Control,{type:"text",name:"postal_code",value:n.values.postal_code,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.postal_code&&!!n.errors.postal_code}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.postal_code})]})})]}),e.jsxs(h,{className:"mb-3",children:[e.jsx(r,{md:6,children:e.jsxs(t.Group,{controlId:"country",children:[e.jsx(t.Label,{children:"Country *"}),e.jsxs(t.Control,{as:"select",name:"country",value:n.values.country,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.country&&!!n.errors.country,children:[e.jsx("option",{value:"Nigeria",children:"Nigeria"}),e.jsx("option",{value:"Ghana",children:"Ghana"}),e.jsx("option",{value:"South Africa",children:"South Africa"}),e.jsx("option",{value:"Kenya",children:"Kenya"}),e.jsx("option",{value:"Other",children:"Other"})]}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.country})]})}),e.jsx(r,{md:6,children:e.jsx(t.Group,{controlId:"is_active",children:e.jsx(t.Check,{type:"switch",id:"is_active",label:"Is Active",checked:n.values.is_active,onChange:n.handleChange,name:"is_active"})})})]}),e.jsxs(h,{className:"mb-3",children:[e.jsx(r,{md:6,children:e.jsxs(t.Group,{controlId:"latitude",children:[e.jsx(t.Label,{children:"Latitude"}),e.jsx(t.Control,{type:"number",step:"0.000001",name:"latitude",value:n.values.latitude,onChange:n.handleChange})]})}),e.jsx(r,{md:6,children:e.jsxs(t.Group,{controlId:"longitude",children:[e.jsx(t.Label,{children:"Longitude"}),e.jsx(t.Control,{type:"number",step:"0.000001",name:"longitude",value:n.values.longitude,onChange:n.handleChange})]})})]}),e.jsx("h5",{className:"mt-4 mb-3",children:"Contact Information"}),e.jsxs(h,{className:"mb-3",children:[e.jsx(r,{md:4,children:e.jsxs(t.Group,{controlId:"contact_person",children:[e.jsx(t.Label,{children:"Contact Person *"}),e.jsx(t.Control,{type:"text",name:"contact_person",value:n.values.contact_person,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.contact_person&&!!n.errors.contact_person}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.contact_person})]})}),e.jsx(r,{md:4,children:e.jsxs(t.Group,{controlId:"contact_phone",children:[e.jsx(t.Label,{children:"Contact Phone *"}),e.jsx(t.Control,{type:"text",name:"contact_phone",value:n.values.contact_phone,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.contact_phone&&!!n.errors.contact_phone}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.contact_phone})]})}),e.jsx(r,{md:4,children:e.jsxs(t.Group,{controlId:"contact_email",children:[e.jsx(t.Label,{children:"Contact Email *"}),e.jsx(t.Control,{type:"email",name:"contact_email",value:n.values.contact_email,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.contact_email&&!!n.errors.contact_email}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.contact_email})]})})]}),e.jsxs(t.Group,{controlId:"contact_position",className:"mb-3",children:[e.jsx(t.Label,{children:"Contact Position"}),e.jsx(t.Control,{type:"text",name:"contact_position",value:n.values.contact_position,onChange:n.handleChange})]}),e.jsx("h5",{className:"mt-4 mb-3",children:"Operating Hours"}),e.jsxs(h,{className:"mb-3",children:[e.jsx(r,{md:6,children:e.jsxs(t.Group,{controlId:"opening_time",children:[e.jsx(t.Label,{children:"Opening Time"}),e.jsx(t.Control,{type:"time",name:"opening_time",value:n.values.opening_time,onChange:n.handleChange})]})}),e.jsx(r,{md:6,children:e.jsxs(t.Group,{controlId:"closing_time",children:[e.jsx(t.Label,{children:"Closing Time"}),e.jsx(t.Control,{type:"time",name:"closing_time",value:n.values.closing_time,onChange:n.handleChange})]})})]}),e.jsxs(t.Group,{controlId:"working_days",className:"mb-3",children:[e.jsx(t.Label,{children:"Working Days"}),e.jsx("div",{className:"d-flex flex-wrap gap-2",children:f.map(l=>{var s;return e.jsx(b,{variant:(s=n.values.working_days)!=null&&s.includes(l.id)?"primary":"outline-secondary",onClick:()=>k(l.id),size:"sm",children:l.name},l.id)})})]}),e.jsxs(t.Group,{controlId:"notes",className:"mb-3",children:[e.jsx(t.Label,{children:"Notes"}),e.jsx(t.Control,{as:"textarea",rows:3,name:"notes",value:n.values.notes,onChange:n.handleChange})]})]}),e.jsxs(y.Footer,{children:[e.jsx(b,{variant:"secondary",onClick:c,children:"Cancel"}),e.jsx(b,{variant:"primary",type:"submit",disabled:n.isSubmitting,children:n.isSubmitting?"Saving...":"Save Changes"})]})]})]})}function le(){const[g,c]=x.useState(!1),[a,j]=x.useState(null),{branches:v}=M(),p=x.useCallback(()=>{$.fn.DataTable.isDataTable("#warehousesTable")&&$("#warehousesTable").DataTable().destroy(),$("#warehousesTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("warehouse.index"),type:"GET"},columns:[{data:"name",title:"Name"},{data:"code",title:"Code"},{data:"branch",title:"Branch"},{data:"location",title:"Location"},{data:"status",title:"Status"},{data:"action",title:"Actions"}],drawCallback:()=>{$(".edit-btn").off("click").on("click",function(){const s=$(this).data("id");k(s)}),$(".delete-btn").off("click").on("click",function(){const s=$(this).data("id");l(s)})}})},[]);x.useEffect(()=>{p()},[p]);const _=x.useCallback(()=>{j(null),c(!0)},[]),n=x.useCallback(()=>{c(!1),j(null)},[]),f=x.useCallback(s=>{I.success(s),$("#warehousesTable").DataTable().ajax.reload(null,!1),c(!1)},[]),k=async s=>{var u,d;try{const i=await S.get(route("warehouse.edit",s));i.data.success===!0?(j(i.data.data),c(!0)):I.error(i.data.message)}catch(i){I.error(((d=(u=i.response)==null?void 0:u.data)==null?void 0:d.message)||"An error occurred")}},l=async s=>{var d,i,m,C;if((await N.fire({title:"Delete Warehouse?",text:"This cannot be undone. All related inventory data will be affected.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await S.delete(route("warehouse.destroy",s)),$("#warehousesTable").DataTable().ajax.reload(null,!1),N.fire("Deleted!","Warehouse has been deleted.","success")}catch(T){let B="Delete failed.";((d=T.response)==null?void 0:d.status)===403?B="You don't have permission to delete this warehouse.":(C=(m=(i=T.response)==null?void 0:i.data)==null?void 0:m.message)!=null&&C.includes("foreign key constraint")&&(B="Cannot delete warehouse because it has associated inventory records."),N.fire("Error!",B,"error")}};return e.jsxs(W,{children:[e.jsx(q,{title:"Warehouses Management"}),e.jsx(E,{fluid:!0,children:e.jsxs(h,{className:"g-3",children:[e.jsxs(r,{md:12,className:"d-flex justify-content-between align-items-center",children:[e.jsx("h2",{className:"mb-0",children:"Warehouses Management"}),e.jsx(P,{children:e.jsxs(b,{variant:"primary",onClick:_,className:"d-flex align-items-center gap-2",children:[e.jsx(A,{size:18}),"Add New Warehouse"]})})]}),e.jsx(r,{md:12,children:e.jsx("hr",{className:"dashed-hr"})}),e.jsx(r,{md:12,children:e.jsx(L,{children:e.jsx(L.Body,{children:e.jsx(O,{bordered:!0,striped:!0,hover:!0,responsive:!0,id:"warehousesTable",className:"w-100"})})})})]})}),e.jsx(z,{show:g,onHide:n,warehouse:a,branches:v,onSuccess:f})]})}export{le as default};
