import{r as i,j as e,$ as E,Y as B}from"./app-Dad_-i9_.js";import{J as I,b as L,c as N,d as A,e as M}from"./index-BoQ2QOGq.js";import{y as b,R as y,I as l,D as o}from"./Footer-DlTkX6Mv.js";import{E as O}from"./ErpLayout-DMTrf_ot.js";import{x as U}from"./axios-DzhX8CW2.js";import{a as z}from"./helpers-DhZjpvwe.js";import{p as G}from"./PrintReceipt-ByLe-D2c.js";import{x as Y,F as J,a as W,b as V}from"./index-DVp0WoSw.js";import{C as q,B as T}from"./Image-BqRrxf8V.js";import{C as c,F as j}from"./Form-U4ModQtX.js";import{B as S}from"./ButtonGroup-XXJqaYCs.js";import{C}from"./Card-Bgz6RJOm.js";import{T as H}from"./Table-CKJkyCIB.js";import"./iconBase-Iw_lzYxk.js";import"./CloseButton-BfcxKKqK.js";/* empty css                      */function pe(){const[m,D]=i.useState(""),[d,F]=i.useState("all"),[p,R]=i.useState("today"),[x,K]=i.useState("all"),h=i.useRef(!1),r=i.useRef(null),g=i.useCallback(()=>{if(h.current)return;$.fn.DataTable.isDataTable("#salesTable")&&$("#salesTable").DataTable().destroy();const n=$("#salesTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("sales.index"),type:"GET",data:function(t){t.search=m,t.status=d!=="all"?d:"",t.date_filter=p,t.customer=x!=="all"?x:""}},columns:[{data:"id",title:"No",className:"text-center",width:"5%",render:function(t,a,s,f){return f.row+f.settings._iDisplayStart+1}},{data:"created_at",title:"Date",className:"text-start",width:"10%",render:function(t){return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}},{data:"invoice_number",title:"Invoice No",className:"text-start",width:"12%"},{data:"order_number",title:"Order No",className:"text-start",width:"12%"},{data:"customer",title:"Customer",className:"text-start text-capitalize",render:function(t){return t||'<span class="text-muted">Walk-in Customer</span>'}},{data:"items_count",title:"Items",className:"text-center",width:"8%",render:function(t,a,s){return`<span class="badge bg-primary">${t||0}</span>`}},{data:"total",title:"Total Amount",className:"text-end fw-semibold",width:"12%",render:function(t){return`<span class="text-success fw-bold">${z(t||0)}</span>`}},{data:"user.full_name",title:"Cashier",className:"text-start",width:"10%",render:function(t){return t||'<span class="text-muted">N/A</span>'}},{data:"payment_status",title:"Status",className:"text-center",width:"10%",render:function(t){let a="bg-secondary",s="Pending";return t==="paid"?(a="bg-success",s="Paid"):t==="partial"?(a="bg-warning",s="Partial"):t==="refunded"&&(a="bg-danger",s="Refunded"),`<span class="badge ${a}">${s}</span>`}},{data:"id",title:"Actions",className:"text-center",width:"13%",orderable:!1,searchable:!1,render:function(t,a,s){return`
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-sm btn-outline-info view-btn" data-id="${t}">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-primary print-btn" data-id="${t}" data-order='${JSON.stringify(s)}'>
                                    <i class="bi bi-printer"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-success invoice-btn" data-id="${t}">
                                    <i class="bi bi-receipt"></i>
                                </button>
                            </div>
                        `}}],drawCallback:function(){$(".view-btn").off("click").on("click",function(){const t=$(this).data("id");w(t)}),$(".print-btn").off("click").on("click",function(){const t=$(this).data("order");G(t)}),$(".invoice-btn").off("click").on("click",function(){const t=$(this).data("id");_(t)}),$(this.api().table().body()).find("td:not(:last-child)").css("cursor","pointer").off("click").on("click",function(){const a=r.current.api().row($(this).parent()).data();a&&a.id&&w(a.id)})},initComplete:function(){h.current=!0},language:{emptyTable:'<div class="text-center py-5"><i class="bi bi-cart display-4 text-muted"></i><p class="mt-2">No sales records found</p></div>',zeroRecords:'<div class="text-center py-5"><i class="bi bi-search display-4 text-muted"></i><p class="mt-2">No matching sales found</p></div>'},responsive:!0,order:[[1,"desc"]],pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]]});return r.current=n,n},[m,d,p,x]);i.useEffect(()=>{h.current&&r.current&&r.current.ajax.reload()},[m,d,p,x]),i.useEffect(()=>(g(),()=>{$.fn.DataTable.isDataTable("#salesTable")&&($("#salesTable").DataTable().destroy(),h.current=!1)}),[g]);const w=n=>{window.location.href=route("sales.show",n)},_=async n=>{var t,a;try{const s=await U.get(route("sales.invoice.download",n),{responseType:"blob"}),f=window.URL.createObjectURL(new Blob([s.data])),u=document.createElement("a");u.href=f,u.setAttribute("download",`invoice_${n}.pdf`),document.body.appendChild(u),u.click(),u.remove(),b.success("Invoice downloaded successfully!")}catch(s){b.error(((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to download invoice")}},v=n=>{if(r.current){const t=r.current.ajax.params(),a=new URL(route("sales.export"));Object.keys(t).forEach(s=>{s!=="draw"&&s!=="_"&&s!=="start"&&s!=="length"&&a.searchParams.append(s,t[s])}),a.searchParams.append("type",n),window.open(a.toString(),"_blank")}},k=()=>{if(r.current){const n=r.current.ajax.params(),t=new URL(route("sales.print"));Object.keys(n).forEach(a=>{a!=="draw"&&a!=="_"&&a!=="start"&&a!=="length"&&t.searchParams.append(a,n[a])}),window.open(t.toString(),"_blank")}},P=()=>{r.current&&(r.current.ajax.reload(),b.success("Sales list refreshed!"))};return e.jsxs(O,{children:[e.jsx(E,{title:"Sales Management"}),e.jsxs(q,{fluid:!0,children:[e.jsxs(y,{className:"mb-4 align-items-center",children:[e.jsxs(c,{md:6,children:[e.jsxs("h3",{className:"fw-bold text-primary mb-2",children:[e.jsx(I,{className:"me-2"}),"Sales Management"]}),e.jsx("p",{className:"text-muted mb-0",children:"View, manage, and track all sales transactions."})]}),e.jsx(c,{md:6,className:"text-md-end",children:e.jsx(S,{className:"mb-2 mb-md-0",children:e.jsxs(T,{variant:"outline-primary",as:B,href:route("sales.create"),className:"d-flex align-items-center",children:[e.jsx(Y,{className:"me-1"}),"New Sale"]})})})]}),e.jsxs(y,{className:"mb-4",children:[e.jsx(c,{md:6,lg:3,children:e.jsxs(l,{children:[e.jsx(l.Text,{children:e.jsx(L,{})}),e.jsx(j.Control,{type:"text",placeholder:"Search sales...",value:m,onChange:n=>D(n.target.value)})]})}),e.jsx(c,{md:6,lg:3,children:e.jsxs(l,{children:[e.jsx(l.Text,{children:e.jsx(N,{})}),e.jsxs(j.Select,{value:d,onChange:n=>F(n.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"partial",children:"Partial"}),e.jsx("option",{value:"refunded",children:"Refunded"})]})]})}),e.jsx(c,{md:6,lg:3,children:e.jsxs(l,{children:[e.jsx(l.Text,{children:e.jsx(N,{})}),e.jsxs(j.Select,{value:p,onChange:n=>R(n.target.value),children:[e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"yesterday",children:"Yesterday"}),e.jsx("option",{value:"this_week",children:"This Week"}),e.jsx("option",{value:"this_month",children:"This Month"}),e.jsx("option",{value:"last_month",children:"Last Month"}),e.jsx("option",{value:"custom",children:"Custom Range"}),e.jsx("option",{value:"all",children:"All Time"})]})]})}),e.jsx(c,{md:6,lg:3,className:"text-lg-end mt-2 mt-lg-0",children:e.jsxs(S,{className:"d-flex gap-2",children:[e.jsxs(T,{variant:"outline-info",onClick:P,className:"d-flex align-items-center rounded",children:[e.jsx(A,{className:"me-1"}),"Refresh"]}),e.jsxs(o,{children:[e.jsxs(o.Toggle,{variant:"outline-secondary",className:"d-flex align-items-center",children:[e.jsx(M,{className:"me-1"}),"Export"]}),e.jsxs(o.Menu,{children:[e.jsxs(o.Item,{onClick:()=>v("excel"),children:[e.jsx(J,{className:"me-2 text-success"})," ","Excel"]}),e.jsxs(o.Item,{onClick:()=>v("pdf"),children:[e.jsx(W,{className:"me-2 text-danger"})," ","PDF"]}),e.jsxs(o.Item,{onClick:k,children:[e.jsx(V,{className:"me-2 text-secondary"})," ","Print"]})]})]})]})})]}),e.jsx(C,{children:e.jsx(C.Body,{className:"p-0",children:e.jsx("div",{className:"table-responsive",children:e.jsx(H,{bordered:!0,hover:!0,responsive:!0,id:"salesTable",className:"align-middle mb-0"})})})})]})]})}export{pe as default};
