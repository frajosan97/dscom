import{v as E,r as j,j as e,$ as M,m as P}from"./app-DDPmmEsP.js";import{R as h,B as U,y as v}from"./Footer-DHiARg5T.js";import{c as S,a as H,d as $,e as O}from"./index-CjSf-fsN.js";import{E as z}from"./ErpLayout-BTroGK5i.js";import{u as W}from"./useData-DDLfDtqJ.js";import{x as Y}from"./axios-CX_3tIE5.js";import{C as J,B as _}from"./Image-CfrpkxQr.js";import{C as n,F as a}from"./Form-Cqgl9C35.js";import{C as u}from"./Card-BnTkWAgR.js";import{A as K}from"./Alert-CYz88nDT.js";import{M as g}from"./Modal-CuFKoZEN.js";import"./CloseButton-bKfF9Hr0.js";import"./iconBase-CZOCq8hy.js";/* empty css                      */function me(){const{repairServices:y=[],deviceTypes:L=[],technicians:T=[],branches:G=[]}=W(),{data:r,setData:t,errors:i,processing:N}=E({customer_id:null,customer_name:"",customer_email:"",customer_phone:"",branch_id:null,repair_service_id:null,device_type_id:null,device_brand:"",device_model:"",device_serial:"",device_age:null,device_issue:"",device_notes:"",device_images:[],assigned_technician_id:null,diagnosis_fee:0,estimated_cost:0,priority:"medium",expected_completion_date:null,terms_accepted:!1}),[d,D]=j.useState(null),[q,b]=j.useState(!1),[Q,R]=j.useState(0),[x,C]=j.useState([]);j.useEffect(()=>{if(r.repair_service_id&&r.device_type_id){const s=y.find(l=>l.id===r.repair_service_id);if(s){D(s);const l=s.pricings.find(o=>o.device_type_id===r.device_type_id);l&&(t("diagnosis_fee",l.price*.2),t("estimated_cost",l.price))}}},[r.repair_service_id,r.device_type_id]);const A=async s=>{var l,o,p,I;if(s.preventDefault(),!r.terms_accepted){v.error("You must accept the terms and conditions");return}try{const c=await Y.post(route("repair-orders.store"),{...r,device_images:x.map(m=>m.file)},{onUploadProgress:m=>{const f=Math.round(m.loaded*100/m.total);R(f)}});c.data.success&&(v.success("Service request created successfully!"),P.visit(route("repair-orders.show",c.data.order.id)))}catch(c){if(console.error(c),(o=(l=c.response)==null?void 0:l.data)!=null&&o.errors){const m=c.response.data.errors;Object.values(m).forEach(f=>{f.forEach(B=>{v.error(B)})})}else v.error(((I=(p=c.response)==null?void 0:p.data)==null?void 0:I.message)||"An error occurred while creating the service request")}},F=s=>{const l=Array.from(s.target.files);if(l.length+x.length>5){v.error("Maximum 5 images allowed");return}const o=l.map(p=>({file:p,preview:URL.createObjectURL(p)}));C([...x,...o])},k=s=>{const l=[...x];URL.revokeObjectURL(l[s].preview),l.splice(s,1),C(l)},w=()=>r.diagnosis_fee+r.estimated_cost;return e.jsxs(z,{children:[e.jsx(M,{title:"Create New Service Request"}),e.jsxs(J,{fluid:!0,children:[e.jsx("form",{onSubmit:A,children:e.jsxs(h,{className:"g-4",children:[e.jsx(n,{lg:8,children:e.jsxs(u,{className:"mb-4",children:[e.jsxs(u.Header,{className:"bg-white d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx(S,{className:"me-2"}),e.jsx("strong",{children:"New Service Request"})]}),e.jsxs(U,{bg:"primary",children:[e.jsx(H,{className:"me-1"})," New Request"]})]}),e.jsxs(u.Body,{children:[e.jsxs("h5",{className:"mb-4",children:[e.jsx($,{className:"me-2"})," Customer Information"]}),e.jsxs(h,{children:[e.jsx(n,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Customer Name *"}),e.jsx(a.Control,{type:"text",value:r.customer_name,onChange:s=>t("customer_name",s.target.value),isInvalid:!!i.customer_name,required:!0}),i.customer_name&&e.jsx(a.Text,{className:"text-danger",children:i.customer_name})]})}),e.jsx(n,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Customer Email"}),e.jsx(a.Control,{type:"email",value:r.customer_email,onChange:s=>t("customer_email",s.target.value),isInvalid:!!i.customer_email}),i.customer_email&&e.jsx(a.Text,{className:"text-danger",children:i.customer_email})]})})]}),e.jsxs(h,{children:[e.jsx(n,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Customer Phone *"}),e.jsx(a.Control,{type:"tel",value:r.customer_phone,onChange:s=>t("customer_phone",s.target.value),isInvalid:!!i.customer_phone,required:!0}),i.customer_phone&&e.jsx(a.Text,{className:"text-danger",children:i.customer_phone})]})}),e.jsx(n,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Branch *"}),e.jsxs(a.Select,{value:r.branch_id||"",onChange:s=>t("branch_id",s.target.value?parseInt(s.target.value):null),isInvalid:!!i.branch_id,required:!0,children:[e.jsx("option",{value:"",children:"Select branch"}),G.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),i.branch_id&&e.jsx(a.Text,{className:"text-danger",children:i.branch_id})]})})]}),e.jsx("hr",{className:"my-4"}),e.jsxs("h5",{className:"mb-4",children:[e.jsx(S,{className:"me-2"})," Service Information"]}),e.jsxs(h,{children:[e.jsx(n,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Service Type *"}),e.jsxs(a.Select,{value:r.repair_service_id||"",onChange:s=>t("repair_service_id",s.target.value?parseInt(s.target.value):null),isInvalid:!!i.repair_service_id,required:!0,children:[e.jsx("option",{value:"",children:"Select service"}),y.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),i.repair_service_id&&e.jsx(a.Text,{className:"text-danger",children:i.repair_service_id})]})}),e.jsx(n,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Device Type *"}),e.jsxs(a.Select,{value:r.device_type_id||"",onChange:s=>t("device_type_id",s.target.value?parseInt(s.target.value):null),isInvalid:!!i.device_type_id,required:!0,disabled:!r.repair_service_id,children:[e.jsx("option",{value:"",children:"Select device type"}),L.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),i.device_type_id&&e.jsx(a.Text,{className:"text-danger",children:i.device_type_id})]})})]}),e.jsxs(h,{children:[e.jsx(n,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Device Brand *"}),e.jsx(a.Control,{type:"text",value:r.device_brand,onChange:s=>t("device_brand",s.target.value),isInvalid:!!i.device_brand,required:!0}),i.device_brand&&e.jsx(a.Text,{className:"text-danger",children:i.device_brand})]})}),e.jsx(n,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Device Model *"}),e.jsx(a.Control,{type:"text",value:r.device_model,onChange:s=>t("device_model",s.target.value),isInvalid:!!i.device_model,required:!0}),i.device_model&&e.jsx(a.Text,{className:"text-danger",children:i.device_model})]})})]}),e.jsxs(h,{children:[e.jsx(n,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Device Serial Number"}),e.jsx(a.Control,{type:"text",value:r.device_serial,onChange:s=>t("device_serial",s.target.value)})]})}),e.jsx(n,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Device Age (years)"}),e.jsx(a.Control,{type:"number",min:"0",value:r.device_age||"",onChange:s=>t("device_age",s.target.value?parseInt(s.target.value):null)})]})})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Device Issue Description *"}),e.jsx(a.Control,{as:"textarea",rows:3,value:r.device_issue,onChange:s=>t("device_issue",s.target.value),isInvalid:!!i.device_issue,required:!0,placeholder:"Describe the issue you're experiencing..."}),i.device_issue&&e.jsx(a.Text,{className:"text-danger",children:i.device_issue})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Additional Notes"}),e.jsx(a.Control,{as:"textarea",rows:2,value:r.device_notes,onChange:s=>t("device_notes",s.target.value),placeholder:"Any additional information about the device..."})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Device Images (Max 5)"}),e.jsx(a.Control,{type:"file",multiple:!0,accept:"image/*",onChange:F,className:"mb-2"}),e.jsx("div",{className:"d-flex flex-wrap gap-2",children:x.map((s,l)=>e.jsxs("div",{className:"position-relative",style:{width:"100px",height:"100px"},children:[e.jsx("img",{src:s.preview,alt:`Device preview ${l}`,className:"img-thumbnail h-100 w-100 object-fit-cover"}),e.jsx(_,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0 rounded-circle p-0",style:{width:"24px",height:"24px"},onClick:()=>k(l),children:"Ã—"})]},l))})]})]})]})}),e.jsxs(n,{lg:4,children:[e.jsxs(u,{className:"mb-4",children:[e.jsx(u.Header,{className:"bg-light",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(O,{className:"me-2"})," Billing & Assignment"]})}),e.jsxs(u.Body,{children:[d&&e.jsxs(K,{variant:"info",className:"mb-3",children:[e.jsx("strong",{children:d.name}),e.jsx("div",{className:"small mt-1",children:d.description})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Diagnosis Fee"}),e.jsx(a.Control,{type:"number",min:"0",step:"0.01",value:r.diagnosis_fee,onChange:s=>t("diagnosis_fee",parseFloat(s.target.value)||0),isInvalid:!!i.diagnosis_fee}),i.diagnosis_fee&&e.jsx(a.Text,{className:"text-danger",children:i.diagnosis_fee})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Estimated Repair Cost"}),e.jsx(a.Control,{type:"number",min:"0",step:"0.01",value:r.estimated_cost,onChange:s=>t("estimated_cost",parseFloat(s.target.value)||0),isInvalid:!!i.estimated_cost}),i.estimated_cost&&e.jsx(a.Text,{className:"text-danger",children:i.estimated_cost})]}),e.jsxs("div",{className:"bg-light p-3 mb-3 rounded",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("strong",{children:"Subtotal:"}),e.jsxs("span",{children:["$",w().toFixed(2)]})]}),e.jsxs("div",{className:"d-flex justify-content-between small text-muted",children:[e.jsx("span",{children:"Tax:"}),e.jsx("span",{children:"Calculated at checkout"})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"d-flex justify-content-between fw-bold",children:[e.jsx("span",{children:"Estimated Total:"}),e.jsxs("span",{children:["$",w().toFixed(2)]})]})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Priority"}),e.jsxs(a.Select,{value:r.priority,onChange:s=>t("priority",s.target.value),children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Assign Technician"}),e.jsxs(a.Select,{value:r.assigned_technician_id||"",onChange:s=>t("assigned_technician_id",s.target.value?parseInt(s.target.value):null),children:[e.jsx("option",{value:"",children:"Auto-assign"}),T.map(s=>e.jsxs("option",{value:s.id,children:[s.user.name," (",s.specialization,")"]},s.id))]})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Expected Completion Date"}),e.jsx(a.Control,{type:"date",value:r.expected_completion_date||"",onChange:s=>t("expected_completion_date",s.target.value),min:new Date().toISOString().split("T")[0]})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Check,{type:"checkbox",label:e.jsxs(e.Fragment,{children:["I accept the ",e.jsx("a",{href:"#",onClick:s=>{s.preventDefault(),b(!0)},children:"terms and conditions"})," *"]}),checked:r.terms_accepted,onChange:s=>t("terms_accepted",s.target.checked),isInvalid:!!i.terms_accepted}),i.terms_accepted&&e.jsx(a.Text,{className:"text-danger",children:i.terms_accepted})]})]})]}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsx(_,{variant:"primary",type:"submit",disabled:N,className:"mb-2",children:N?"Processing...":"Submit Service Request"}),e.jsx(_,{variant:"outline-secondary",onClick:()=>window.history.back(),children:"Cancel"})]})]})]})}),e.jsxs(g,{show:q,onHide:()=>b(!1),size:"lg",children:[e.jsx(g.Header,{closeButton:!0,children:e.jsx(g.Title,{children:"Terms and Conditions"})}),e.jsxs(g.Body,{children:[e.jsx("h5",{children:"Service Agreement"}),e.jsx("p",{children:"By submitting this service request, you agree to the following terms:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"A non-refundable diagnosis fee will be charged"}),e.jsx("li",{children:"Repair costs are estimates and may change after diagnosis"}),e.jsx("li",{children:"We are not responsible for data loss - please backup your device"}),e.jsx("li",{children:"Unclaimed devices will be disposed of after 30 days"}),e.jsx("li",{children:"Payment is due upon completion of service"})]}),e.jsx("h5",{className:"mt-4",children:"Warranty Information"}),e.jsxs("p",{children:["Repairs come with a ",(d==null?void 0:d.warranty_days)||30,"-day warranty on parts and labor. Warranty does not cover physical damage or unrelated issues."]})]}),e.jsx(g.Footer,{children:e.jsx(_,{variant:"primary",onClick:()=>{t("terms_accepted",!0),b(!1)},children:"I Accept"})})]})]})]})}export{me as default};
