import{r as i,j as e,$ as U}from"./app-CxIzz1Hm.js";import{m as T,n as H,b as O,c as Y,o as V,d as J,e as K}from"./index-CMQojAPB.js";import{S as Q}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{y as b,R as w,I as d,D as u}from"./Footer-1rOk33u-.js";import{E as W}from"./ErpLayout-CKY1G0eu.js";import{x as F}from"./axios-CbP2VCmx.js";import{F as X,a as Z,b as ee}from"./index-DEpCKpyh.js";import{C as te,B as j}from"./Image-B2kFzfRD.js";import{C as c,F as r}from"./Form-C32FoLO3.js";import{B}from"./ButtonGroup-BeeULg22.js";import{C as D}from"./Card-BGz8PFHq.js";import{T as ae}from"./Table-EbxAEte5.js";import{M as g}from"./Modal-u0gFxUa_.js";import"./iconBase-8l29Fq_8.js";import"./CloseButton-DTBn4gN-.js";/* empty css                      */function ge(){const[f,R]=i.useState(""),[m,E]=i.useState("all"),[x,P]=i.useState("all"),[A,k]=i.useState(!1),[o,C]=i.useState({customer:"",email:"",message:"",rating:5,status:"Pending"}),p=i.useRef(!1),l=i.useRef(null),N=i.useCallback(()=>{if(p.current)return;$.fn.DataTable.isDataTable("#feedbackTable")&&$("#feedbackTable").DataTable().destroy();const a=$("#feedbackTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("feedback.index"),type:"GET",data:function(t){t.search=f,t.status=m!=="all"?m:"",t.rating=x!=="all"?x:""}},columns:[{data:"DT_RowIndex",title:"#",className:"text-center",width:"3%",orderable:!1,searchable:!1},{data:"customer",title:"Customer",className:"text-start fw-semibold"},{data:"email",title:"Email",className:"text-start"},{data:"message",title:"Message",className:"text-start",render:function(t){return t.length>50?t.substring(0,50)+"...":t}},{data:"rating",title:"Rating",className:"text-center",width:"10%",render:function(t){return`
                            <div class="d-flex flex-column align-items-center">
                                <div class="text-warning">${"‚≠ê".repeat(t)}</div>
                                <small class="text-muted">(${t}/5)</small>
                            </div>
                        `}},{data:"created_at",title:"Date",className:"text-center",width:"10%",render:function(t){return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}},{data:"status",title:"Status",className:"text-center",width:"10%",render:function(t){let s="bg-warning text-dark",n="Pending";return t==="reviewed"?(s="bg-success",n="Reviewed"):t==="archived"&&(s="bg-secondary",n="Archived"),`<span class="badge ${s}">${n}</span>`}},{data:"id",title:"Actions",className:"text-center",width:"12%",orderable:!1,searchable:!1,render:function(t,s,n){return`
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-sm btn-outline-info view-btn" data-id="${t}">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-success respond-btn" data-id="${t}">
                                    <i class="bi bi-reply"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-danger delete-btn" data-id="${t}">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        `}}],drawCallback:function(){$(".view-btn").off("click").on("click",function(){const t=$(this).data("id");G(t)}),$(".respond-btn").off("click").on("click",function(){const t=$(this).data("id");I(t)}),$(".delete-btn").off("click").on("click",function(){const t=$(this).data("id");_(t)})},initComplete:function(){p.current=!0},language:{emptyTable:'<div class="text-center py-5"><i class="bi bi-chat-heart display-4 text-muted"></i><p class="mt-2">No feedback found</p></div>',zeroRecords:'<div class="text-center py-5"><i class="bi bi-search display-4 text-muted"></i><p class="mt-2">No matching feedback found</p></div>'},responsive:!0,order:[[5,"desc"]],pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]]});return l.current=a,a},[f,m,x]);i.useEffect(()=>{p.current&&l.current&&l.current.ajax.reload()},[f,m,x]),i.useEffect(()=>(N(),()=>{$.fn.DataTable.isDataTable("#feedbackTable")&&($("#feedbackTable").DataTable().destroy(),p.current=!1)}),[N]);const L=()=>k(!0),v=()=>{k(!1),C({customer:"",email:"",message:"",rating:5,status:"Pending"})},h=a=>{C({...o,[a.target.name]:a.target.value})},M=async a=>{var t,s;a.preventDefault();try{(await F.post(route("feedback.store"),o)).data.success&&(b.success("Feedback added successfully!"),v(),l.current&&l.current.ajax.reload())}catch(n){b.error(((s=(t=n.response)==null?void 0:t.data)==null?void 0:s.message)||"An error occurred while saving feedback")}},G=a=>{window.location.href=route("feedback.show",a)},I=a=>{window.location.href=route("feedback.respond",a)},_=async a=>{var t,s;try{if(!(await Q.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;const y=await F.delete(route("feedback.destroy",a));y.data.success&&(b.success(y.data.message),l.current&&l.current.ajax.reload())}catch(n){b.error(((s=(t=n.response)==null?void 0:t.data)==null?void 0:s.message)||"An error occurred while deleting the feedback")}},S=a=>{if(l.current){const t=l.current.ajax.params(),s=new URL(route("feedback.export"));Object.keys(t).forEach(n=>{n!=="draw"&&n!=="_"&&n!=="start"&&n!=="length"&&s.searchParams.append(n,t[n])}),s.searchParams.append("type",a),window.open(s.toString(),"_blank")}},q=()=>{if(l.current){const a=l.current.ajax.params(),t=new URL(route("feedback.print"));Object.keys(a).forEach(s=>{s!=="draw"&&s!=="_"&&s!=="start"&&s!=="length"&&t.searchParams.append(s,a[s])}),window.open(t.toString(),"_blank")}},z=()=>{l.current&&(l.current.ajax.reload(),b.success("Feedback list refreshed!"))};return e.jsxs(W,{children:[e.jsx(U,{title:"Customer Feedback"}),e.jsxs(te,{fluid:!0,children:[e.jsxs(w,{className:"mb-4 align-items-center",children:[e.jsxs(c,{md:6,children:[e.jsxs("h3",{className:"fw-bold text-primary mb-2",children:[e.jsx(T,{className:"me-2"}),"Customer Feedback"]}),e.jsx("p",{className:"text-muted mb-0",children:"View, manage, and respond to customer feedback."})]}),e.jsx(c,{md:6,className:"text-md-end",children:e.jsx(B,{className:"mb-2 mb-md-0",children:e.jsxs(j,{variant:"outline-primary",onClick:L,className:"d-flex align-items-center",children:[e.jsx(H,{className:"me-1"}),"Add Feedback"]})})})]}),e.jsxs(w,{className:"mb-4",children:[e.jsx(c,{md:6,lg:3,children:e.jsxs(d,{children:[e.jsx(d.Text,{children:e.jsx(O,{})}),e.jsx(r.Control,{type:"text",placeholder:"Search feedback...",value:f,onChange:a=>R(a.target.value)})]})}),e.jsx(c,{md:6,lg:2,children:e.jsxs(d,{children:[e.jsx(d.Text,{children:e.jsx(Y,{})}),e.jsxs(r.Select,{value:m,onChange:a=>E(a.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"reviewed",children:"Reviewed"}),e.jsx("option",{value:"archived",children:"Archived"})]})]})}),e.jsx(c,{md:6,lg:2,children:e.jsxs(d,{children:[e.jsx(d.Text,{children:e.jsx(V,{})}),e.jsxs(r.Select,{value:x,onChange:a=>P(a.target.value),children:[e.jsx("option",{value:"all",children:"All Ratings"}),e.jsx("option",{value:"5",children:"5 Stars"}),e.jsx("option",{value:"4",children:"4 Stars"}),e.jsx("option",{value:"3",children:"3 Stars"}),e.jsx("option",{value:"2",children:"2 Stars"}),e.jsx("option",{value:"1",children:"1 Star"})]})]})}),e.jsx(c,{md:12,lg:5,className:"text-lg-end mt-2 mt-lg-0",children:e.jsxs(B,{className:"d-flex gap-2",children:[e.jsxs(j,{variant:"outline-info",onClick:z,className:"d-flex align-items-center rounded",children:[e.jsx(J,{className:"me-1"}),"Refresh"]}),e.jsxs(u,{children:[e.jsxs(u.Toggle,{variant:"outline-secondary",className:"d-flex align-items-center",children:[e.jsx(K,{className:"me-1"}),"Export"]}),e.jsxs(u.Menu,{children:[e.jsxs(u.Item,{onClick:()=>S("excel"),children:[e.jsx(X,{className:"me-2 text-success"})," ","Excel"]}),e.jsxs(u.Item,{onClick:()=>S("pdf"),children:[e.jsx(Z,{className:"me-2 text-danger"})," ","PDF"]}),e.jsxs(u.Item,{onClick:q,children:[e.jsx(ee,{className:"me-2 text-secondary"})," ","Print"]})]})]})]})})]}),e.jsx(D,{children:e.jsx(D.Body,{className:"p-0",children:e.jsx("div",{className:"table-responsive",children:e.jsx(ae,{bordered:!0,hover:!0,responsive:!0,id:"feedbackTable",className:"align-middle mb-0"})})})})]}),e.jsxs(g,{show:A,onHide:v,centered:!0,children:[e.jsx(g.Header,{closeButton:!0,children:e.jsxs(g.Title,{className:"d-flex align-items-center",children:[e.jsx(T,{className:"me-2"}),"Add Customer Feedback"]})}),e.jsx(g.Body,{children:e.jsxs(r,{onSubmit:M,children:[e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Customer Name"}),e.jsx(r.Control,{type:"text",name:"customer",value:o.customer,onChange:h,required:!0})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Email"}),e.jsx(r.Control,{type:"email",name:"email",value:o.email,onChange:h,required:!0})]}),e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Message"}),e.jsx(r.Control,{as:"textarea",rows:3,name:"message",value:o.message,onChange:h,required:!0})]}),e.jsxs(w,{children:[e.jsx(c,{md:6,children:e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Rating"}),e.jsx(r.Select,{name:"rating",value:o.rating,onChange:h,children:[5,4,3,2,1].map(a=>e.jsxs("option",{value:a,children:[a," Star",a>1?"s":""]},a))})]})}),e.jsx(c,{md:6,children:e.jsxs(r.Group,{className:"mb-3",children:[e.jsx(r.Label,{children:"Status"}),e.jsxs(r.Select,{name:"status",value:o.status,onChange:h,children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"reviewed",children:"Reviewed"})]})]})})]}),e.jsxs("div",{className:"text-end",children:[e.jsx(j,{variant:"secondary",onClick:v,className:"me-2",children:"Cancel"}),e.jsx(j,{variant:"primary",type:"submit",children:"Save Feedback"})]})]})})]})]})}export{ge as default};
