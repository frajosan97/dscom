import{j as e,r as l,$ as L}from"./app-C8okO_FY.js";import{R as M,I as j,y as f}from"./Footer-DnT14h8L.js";import{d as R}from"./index-KQAv9TcM.js";import{E as P}from"./ErpLayout-enYR1Bf_.js";import{S as B}from"./sweetalert2.esm.all-DpIEGYsy.js";import{x as v}from"./axios-CrvAxd_j.js";import{u as z}from"./formik.esm-BfHSEgFn.js";import{c as q,d as U,b as E,a as m}from"./index.esm-Dfr3_SDK.js";import{S as O}from"./react-select.esm-BLFSKYkO.js";import{M as p}from"./Modal-DFnRobbl.js";import{F as s,C as g}from"./Form-WKlbRvmM.js";import{I as V,B as _}from"./Image-eY5NvQ05.js";import{S as A}from"./Spinner-DGBawsTY.js";import{C as F}from"./Card-CMRoatnC.js";import{B as H}from"./ButtonGroup-D0OsDQls.js";import{T as y}from"./Table-BgGj5UP2.js";import"./CloseButton-B9TEQAOu.js";import"./iconBase-ClMMaQi3.js";/* empty css                      */function X({show:S,onHide:o,category:t,onSuccess:h,parentCategories:w}){const c=!!t,b=q().shape({name:m().required("Category name is required").max(255,"Category name must not exceed 255 characters"),slug:m().nullable(),icon:m().max(255,"Icon must not exceed 255 characters"),description:m().nullable(),parent_id:m().nullable(),meta_title:m().nullable(),meta_description:m().nullable(),is_active:E(),is_featured:E(),order:U().integer("Must be an integer")}),a=z({enableReinitialize:!0,initialValues:{name:(t==null?void 0:t.name)||"",slug:(t==null?void 0:t.slug)||"",icon:(t==null?void 0:t.icon)||"",description:(t==null?void 0:t.description)||"",parent_id:(t==null?void 0:t.parent_id)||"",meta_title:(t==null?void 0:t.meta_title)||"",meta_description:(t==null?void 0:t.meta_description)||"",is_active:(t==null?void 0:t.is_active)??!0,is_featured:(t==null?void 0:t.is_featured)??!1,order:(t==null?void 0:t.order)||0,image:null,_method:c?"PUT":"POST"},validationSchema:b,onSubmit:async(n,{setSubmitting:N,setErrors:r})=>{var u,d;try{const i=new FormData;Object.entries(n).forEach(([G,T])=>{T!=null&&i.append(G,T)});const C=c?route("category.update",t.id):route("category.store"),D=await v.post(C,i,{headers:{"Content-Type":"multipart/form-data"}});D.data.success===!0&&(h(D.data.message),o())}catch(i){(d=(u=i.response)==null?void 0:u.data)!=null&&d.errors?r(i.response.data.errors):console.error("Error submitting form:",i)}finally{N(!1)}}}),I=n=>{a.setFieldValue("image",n.target.files[0])},k=()=>{a.setFieldValue("image",null)},x=w.map(n=>({value:n.id,label:n.name}));return e.jsxs(p,{show:S,onHide:o,size:"lg",centered:!0,backdrop:"static",children:[e.jsx(p.Header,{closeButton:!0,children:e.jsx(p.Title,{children:c?"Edit Category":"Create New Category"})}),e.jsxs(s,{onSubmit:a.handleSubmit,children:[e.jsx(p.Body,{children:e.jsxs(M,{children:[e.jsxs(g,{md:8,children:[e.jsxs(s.Group,{className:"mb-3",controlId:"name",children:[e.jsxs(s.Label,{children:["Category Name"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(j,{children:[e.jsx(j.Text,{children:e.jsx("i",{className:"bi bi-tag"})}),e.jsx(s.Control,{type:"text",name:"name",value:a.values.name,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.name&&!!a.errors.name,disabled:a.isSubmitting}),e.jsx(s.Control.Feedback,{type:"invalid",children:a.errors.name})]})]}),e.jsxs(s.Group,{className:"mb-3",controlId:"icon",children:[e.jsx(s.Label,{children:"Icon"}),e.jsxs(j,{children:[e.jsx(j.Text,{children:e.jsx("i",{className:"bi bi-emoji-smile"})}),e.jsx(s.Control,{type:"text",name:"icon",value:a.values.icon,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.icon&&!!a.errors.icon,disabled:a.isSubmitting}),e.jsx(s.Control.Feedback,{type:"invalid",children:a.errors.icon})]}),e.jsx(s.Text,{className:"text-muted",children:'Enter icon class (e.g., "bi bi-arrow-right")'})]}),e.jsxs(s.Group,{className:"mb-3",controlId:"description",children:[e.jsx(s.Label,{children:"Description"}),e.jsx(s.Control,{as:"textarea",rows:2,name:"description",value:a.values.description,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.description&&!!a.errors.description,disabled:a.isSubmitting}),e.jsx(s.Control.Feedback,{type:"invalid",children:a.errors.description})]}),e.jsxs(M,{children:[e.jsx(g,{md:6,children:e.jsxs(s.Group,{className:"mb-3",controlId:"parent_id",children:[e.jsx(s.Label,{children:"Parent Category"}),e.jsx(O,{name:"parent_id",value:x.find(n=>n.value===a.values.parent_id),onChange:n=>{a.setFieldValue("parent_id",n?n.value:"")},onBlur:a.handleBlur,options:x,isDisabled:a.isSubmitting,isClearable:!0,placeholder:"Parent category..."}),a.touched.parent_id&&a.errors.parent_id&&e.jsx(s.Control.Feedback,{type:"invalid",children:a.errors.parent_id})]})}),e.jsx(g,{md:6,children:e.jsxs(s.Group,{className:"mb-3",controlId:"order",children:[e.jsx(s.Label,{children:"Order"}),e.jsx(s.Control,{type:"number",name:"order",value:a.values.order,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.order&&!!a.errors.order,disabled:a.isSubmitting}),e.jsx(s.Control.Feedback,{type:"invalid",children:a.errors.order})]})})]})]}),e.jsxs(g,{md:4,children:[e.jsxs(s.Group,{className:"mb-3",controlId:"image",children:[e.jsx(s.Label,{children:"Category Image"}),e.jsx(s.Control,{type:"file",accept:"image/*",onChange:I,disabled:a.isSubmitting}),(a.values.image||(t==null?void 0:t.image_url))&&e.jsxs("div",{className:"mt-3 text-center",children:[e.jsx(V,{src:typeof a.values.image=="string"?a.values.image:a.values.image?URL.createObjectURL(a.values.image):t==null?void 0:t.image_url,alt:"Image Preview",fluid:!0,thumbnail:!0,style:{maxHeight:"150px"}}),e.jsx(_,{variant:"link",size:"sm",className:"text-danger mt-2",onClick:k,disabled:a.isSubmitting,children:"Remove Image"})]})]}),e.jsx(s.Group,{className:"mb-3",controlId:"is_active",children:e.jsx(s.Check,{type:"switch",id:"is_active",name:"is_active",label:"Active",checked:a.values.is_active,onChange:a.handleChange,disabled:a.isSubmitting})}),e.jsx(s.Group,{className:"mb-3",controlId:"is_featured",children:e.jsx(s.Check,{type:"switch",id:"is_featured",name:"is_featured",label:"Featured",checked:a.values.is_featured,onChange:a.handleChange,disabled:a.isSubmitting})}),e.jsxs(s.Group,{className:"mb-3",controlId:"meta_title",children:[e.jsx(s.Label,{children:"Meta Title"}),e.jsx(s.Control,{type:"text",name:"meta_title",value:a.values.meta_title,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.meta_title&&!!a.errors.meta_title,disabled:a.isSubmitting}),e.jsx(s.Control.Feedback,{type:"invalid",children:a.errors.meta_title})]}),e.jsxs(s.Group,{className:"mb-3",controlId:"meta_description",children:[e.jsx(s.Label,{children:"Meta Description"}),e.jsx(s.Control,{as:"textarea",rows:4,name:"meta_description",value:a.values.meta_description,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.meta_description&&!!a.errors.meta_description,disabled:a.isSubmitting}),e.jsx(s.Control.Feedback,{type:"invalid",children:a.errors.meta_description})]})]})]})}),e.jsxs(p.Footer,{children:[e.jsx(_,{variant:"secondary",onClick:o,disabled:a.isSubmitting,children:"Cancel"}),e.jsx(_,{variant:"primary",type:"submit",disabled:a.isSubmitting,children:a.isSubmitting?e.jsxs(e.Fragment,{children:[e.jsx(A,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true",className:"me-2"}),c?"Updating...":"Creating..."]}):`${c?"Update":"Create"} Category`})]})]})]})}function he(){const[S,o]=l.useState(!1),[t,h]=l.useState(null),[w,c]=l.useState([]),b=l.useCallback(()=>{$.fn.DataTable.isDataTable("#categoriesTable")&&$("#categoriesTable").DataTable().destroy(),$("#categoriesTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("category.index"),type:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}},columns:[{data:"DT_RowIndex",name:"DT_RowIndex",title:"#",orderable:!1,searchable:!1,width:"5%"},{data:"image_preview",name:"image_preview",title:"Image"},{data:"icon",name:"icon",title:"Icon"},{data:"name",name:"name",title:"Name"},{data:"status_badge",name:"status_badge",title:"Status"},{data:"featured_badge",name:"featured_badge",title:"Is Featured"},{data:"products_count",name:"products_count",title:"Products Count"},{data:"action",name:"action",title:"Actions",orderable:!1,searchable:!1,width:"10%"}],order:[[0,"desc"]],drawCallback:()=>{$(".edit-btn").off("click").on("click",function(){const r=$(this).data("id");n(r)}),$(".delete-btn").off("click").on("click",function(){const r=$(this).data("id");N(r)})}})},[]);l.useEffect(()=>{b(),a()},[b]);const a=l.useCallback(async()=>{try{const r=await v.get(route("api.categories"));c(r.data)}catch{f.error("Failed to load parent categories.")}},[]),I=l.useCallback(()=>{h(null),o(!0)},[]),k=l.useCallback(()=>{o(!1),h(null)},[]),x=l.useCallback(r=>{f.success(r),$("#categoriesTable").DataTable().ajax.reload(null,!1),a(),o(!1)},[a]),n=async r=>{var u,d;try{const i=await v.get(route("category.edit",r));i.data.success===!0?(h(i.data.category),o(!0)):f.error(i.data.message)}catch(i){console.log(i),f.error(((d=(u=i.response)==null?void 0:u.data)==null?void 0:d.message)||"An error occurred")}},N=async r=>{var d;if((await B.fire({title:"Delete Category?",text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await v.delete(route("category.destroy",r)),$("#categoriesTable").DataTable().ajax.reload(null,!1),B.fire("Deleted!","Category has been deleted.","success")}catch(i){let C="Delete failed.";((d=i.response)==null?void 0:d.status)===403&&(C="You don't have permission to delete this category."),B.fire("Error!",C,"error")}};return e.jsxs(P,{children:[e.jsx(L,{title:"Categories"}),e.jsxs(F,{className:"border-0 rounded-0 shadow-sm",children:[e.jsxs(F.Header,{className:"d-flex justify-content-between align-items-center bg-transparent",children:[e.jsx("h6",{className:"mb-0 fw-semibold",children:"Catalogue Management"}),e.jsx(H,{children:e.jsxs(_,{variant:"outline-secondary",size:"sm",className:"rounded-1 d-flex align-items-center",onClick:I,children:[e.jsx(R,{className:"me-1"}),"New Catalogue"]})})]}),e.jsx(F.Body,{className:"px-0",children:e.jsx(y,{bordered:!0,striped:!0,hover:!0,responsive:!0,id:"categoriesTable",className:"w-100"})})]}),e.jsx(X,{show:S,onHide:k,category:t,onSuccess:x,parentCategories:w})]})}export{he as default};
