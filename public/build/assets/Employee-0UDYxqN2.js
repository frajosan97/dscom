import{r as t,j as e,$ as O,Y as H}from"./app-Bt_zyVoS.js";import{u as M,v as K,w as X,e as V,B as q,a as J,b as Q,c as W,d as Z}from"./index-Dwb0v_39.js";import{S as ee}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{y as i,R as G,I as F,D as y}from"./Footer-BE8-uFgA.js";import{E as se}from"./ErpLayout-B7lFZRNn.js";import{x as z}from"./axios-C6h4k-PV.js";import{F as te,a as ae,b as re}from"./index-PdBTCQZK.js";import{M as I}from"./Modal-D9DeynXk.js";import{F as g,C as B}from"./Form-DzhKJdGd.js";import{B as u,C as le}from"./Image-DTP6OkpU.js";import{P as oe}from"./ProgressBar-DiunDLrb.js";import{B as L}from"./ButtonGroup-CLGMY21O.js";import{C as Y}from"./Card-BHcq6w0A.js";import{T as ne}from"./Table-D1gUGyH6.js";import"./iconBase-DHa3fQ9g.js";import"./CloseButton-hrm_xX80.js";/* empty css                      */function ie({show:x,onHide:N,onImportSuccess:d,importTemplateUrl:D}){const[p,v]=t.useState(null),[l,w]=t.useState(!1),[m,a]=t.useState(0),[T,f]=t.useState(""),[S,h]=t.useState([]),j=t.useRef(null),k=r=>{const n=r.target.files[0];if(!n)return;if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"].includes(n.type)){i.error("Please select a valid Excel or CSV file");return}if(n.size>5*1024*1024){i.error("File size should not exceed 5MB");return}v(n),h([])},P=async()=>{var n,c,U,A;if(!p){i.error("Please select a file to import");return}const r=new FormData;r.append("file",p),w(!0),a(0),f("Uploading..."),h([]);try{const b=setInterval(()=>{a(E=>E>=90?(clearInterval(b),90):E+10)},300),C=await z.post(route("employee.import"),r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:E=>{const _=Math.round(E.loaded*100/E.total);a(_)}});if(clearInterval(b),a(100),f("Processing..."),C.data.success)setTimeout(()=>{i.success(C.data.message||"Employees imported successfully!"),s(),N(),d==null||d()},1e3);else throw new Error(C.data.message||"Import failed")}catch(b){if(w(!1),f("Import failed"),(c=(n=b.response)==null?void 0:n.data)!=null&&c.errors){const C=Object.values(b.response.data.errors).flat();h(C),i.error("There were errors during import. Please check the error list.")}else i.error(((A=(U=b.response)==null?void 0:U.data)==null?void 0:A.message)||"Error importing file")}},R=async()=>{try{const r=await z.get(D||route("employee.import.template"),{responseType:"blob"}),n=window.URL.createObjectURL(new Blob([r.data])),c=document.createElement("a");c.href=n,c.setAttribute("download","employee_import_template.xlsx"),document.body.appendChild(c),c.click(),c.remove(),i.success("Template downloaded successfully!")}catch{i.error("Failed to download template")}},s=()=>{v(null),h([]),a(0),f(""),w(!1),j.current&&(j.current.value="")},o=()=>{l?window.confirm("Import is in progress. Are you sure you want to cancel?")&&(s(),N()):(s(),N())};return e.jsxs(I,{show:x,onHide:o,size:"lg",backdrop:l?"static":!0,keyboard:!l,children:[e.jsx(I.Header,{closeButton:!l,children:e.jsxs(I.Title,{className:"d-flex align-items-center",children:[e.jsx(M,{className:"me-2"}),"Import Employees from Excel"]})}),e.jsxs(I.Body,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs(g.Group,{children:[e.jsx(g.Label,{className:"fw-semibold",children:"Select Excel/CSV File"}),e.jsx("div",{className:"border rounded p-4 text-center",children:p?e.jsxs("div",{className:"d-flex align-items-center justify-content-between bg-light p-3 rounded",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(K,{className:"fs-4 text-primary me-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:p.name}),e.jsxs("small",{className:"text-muted",children:[(p.size/1024).toFixed(2)," ","KB"]})]})]}),e.jsx(u,{variant:"outline-danger",size:"sm",onClick:s,disabled:l,children:e.jsx(X,{})})]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"fs-1 text-muted mb-3"}),e.jsx("p",{className:"text-muted mb-3",children:"Drag & drop your Excel file here or click to browse"}),e.jsx(u,{variant:"outline-primary",onClick:()=>{var r;return(r=j.current)==null?void 0:r.click()},disabled:l,children:"Browse Files"}),e.jsx(g.Control,{type:"file",ref:j,onChange:k,accept:".xlsx,.xls,.csv",className:"d-none",disabled:l})]})}),e.jsx(g.Text,{className:"text-muted",children:"Supported formats: .xlsx, .xls, .csv (Max 5MB)"})]})}),l&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("small",{className:"text-muted",children:"Import Progress"}),e.jsxs("small",{className:"text-muted",children:[m,"%"]})]}),e.jsx(oe,{now:m,animated:m<100,variant:m===100?"success":"primary",className:"mb-2"}),T&&e.jsx("small",{className:"text-muted d-block text-center",children:T})]}),S.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-danger mb-2",children:"Import Errors:"}),e.jsx("div",{className:"border border-danger rounded p-3 bg-danger bg-opacity-10",children:e.jsx("ul",{className:"mb-0 ps-3",children:S.map((r,n)=>e.jsx("li",{className:"text-danger small",children:r},n))})})]}),e.jsx("div",{className:"border-top pt-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1",children:"Need a template?"}),e.jsx("p",{className:"small text-muted mb-0",children:"Download our Excel template with proper column formatting"})]}),e.jsxs(u,{variant:"outline-success",onClick:R,disabled:l,size:"sm",children:[e.jsx(V,{className:"me-1"}),"Download Template"]})]})})]}),e.jsxs(I.Footer,{children:[e.jsx(u,{variant:"secondary",onClick:o,disabled:l,children:"Cancel"}),e.jsx(u,{variant:"primary",onClick:P,disabled:!p||l,children:l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),"Importing..."]}):"Start Import"})]})]})}function Ee(){const[x,N]=t.useState(""),[d,D]=t.useState("all"),[p,v]=t.useState(!1),[l,w]=t.useState(""),m=t.useRef(!1),a=t.useRef(null);t.useEffect(()=>{w(route("employee.import.template"))},[]);const T=t.useCallback(()=>{if(m.current)return;$.fn.DataTable.isDataTable("#employeeTable")&&$("#employeeTable").DataTable().destroy();const s=$("#employeeTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("employee.index"),type:"GET",data:function(o){o.search=x,o.status=d!=="all"?d:""}},columns:[{data:"profile_image",title:"Photo",className:"text-center",width:"3%",orderable:!1,searchable:!1},{data:"name",title:"Name",className:"text-start"},{data:"contact",title:"Contact",className:"text-start"},{data:"role",title:"Role",className:"text-start",width:"10%"},{data:"salary",title:"Salary",className:"text-end"},{data:"status",title:"Status",className:"text-center",width:"10%"},{data:"action",title:"Actions",className:"text-center",width:"15%"}],drawCallback:function(){$(".edit-btn").off("click").on("click",function(){const o=$(this).data("id");S(o)}),$(".view-btn").off("click").on("click",function(){const o=$(this).data("id");h(o)}),$(".delete-btn").off("click").on("click",function(){const o=$(this).data("id");j(o)})},initComplete:function(){m.current=!0},language:{emptyTable:'<div class="text-center py-5"><i class="bi bi-inbox display-4 text-muted"></i><p class="mt-2">No employees records found</p></div>',zeroRecords:'<div class="text-center py-5"><i class="bi bi-search display-4 text-muted"></i><p class="mt-2">No matching records found</p></div>'},responsive:!0,order:[[0,"desc"]]});return a.current=s,s},[x,d]);t.useEffect(()=>{m.current&&a.current&&a.current.ajax.reload()},[x,d]),t.useEffect(()=>(T(),()=>{$.fn.DataTable.isDataTable("#employeeTable")&&($("#employeeTable").DataTable().destroy(),m.current=!1)}),[T]);const f=()=>{a.current&&a.current.ajax.reload()},S=s=>{window.location.href=route("employee.edit",s)},h=s=>{window.location.href=route("employee.show",s)},j=async s=>{var o,r;try{if(!(await ee.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;const c=await z.delete(route("employee.destroy",s));c.data.success&&(i.success(c.data.message),a.current&&a.current.ajax.reload())}catch(n){i.error(((r=(o=n.response)==null?void 0:o.data)==null?void 0:r.message)||"An error occurred while deleting the employee")}},k=()=>{i.info("Export feature coming soon!")},P=()=>{i.info("Print feature coming soon!")},R=()=>{a.current&&(a.current.ajax.reload(),i.success("Employee list refreshed!"))};return e.jsxs(se,{children:[e.jsx(O,{title:"Employee Management"}),e.jsxs(le,{fluid:!0,children:[e.jsxs(G,{className:"mb-4 align-items-center",children:[e.jsxs(B,{md:6,children:[e.jsxs("h3",{className:"fw-bold text-primary mb-2",children:[e.jsx(q,{className:"me-2"}),"Employee Management"]}),e.jsx("p",{className:"text-muted mb-0",children:"View, manage, and maintain all employee accounts."})]}),e.jsx(B,{md:6,className:"text-md-end",children:e.jsxs(L,{className:"mb-2 mb-md-0",children:[e.jsxs(u,{variant:"outline-primary",as:H,href:route("employee.create"),className:"d-flex align-items-center",children:[e.jsx(J,{className:"me-1"}),"Add Employee"]}),e.jsxs(u,{variant:"primary",onClick:()=>v(!0),className:"d-flex align-items-center",children:[e.jsx(M,{className:"me-1"}),"Import Excel"]})]})})]}),e.jsxs(G,{className:"mb-4",children:[e.jsx(B,{md:6,lg:4,children:e.jsxs(F,{children:[e.jsx(F.Text,{children:e.jsx(Q,{})}),e.jsx(g.Control,{type:"text",placeholder:"Search employees...",value:x,onChange:s=>N(s.target.value)})]})}),e.jsx(B,{md:6,lg:4,children:e.jsxs(F,{children:[e.jsx(F.Text,{children:e.jsx(W,{})}),e.jsxs(g.Select,{value:d,onChange:s=>D(s.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"Enable",children:"Active"}),e.jsx("option",{value:"Disable",children:"Inactive"})]})]})}),e.jsx(B,{md:12,lg:4,className:"text-lg-end mt-2 mt-lg-0",children:e.jsxs(L,{className:"d-flex gap-2",children:[e.jsxs(u,{variant:"outline-info",onClick:R,className:"d-flex align-items-center rounded",children:[e.jsx(Z,{className:"me-1"}),"Refresh"]}),e.jsxs(y,{children:[e.jsxs(y.Toggle,{variant:"outline-secondary",className:"d-flex align-items-center",children:[e.jsx(V,{className:"me-1"}),"Export"]}),e.jsxs(y.Menu,{children:[e.jsxs(y.Item,{onClick:()=>k(),children:[e.jsx(te,{className:"me-2 text-success"})," ","Excel"]}),e.jsxs(y.Item,{onClick:()=>k(),children:[e.jsx(ae,{className:"me-2 text-danger"})," ","PDF"]}),e.jsxs(y.Item,{onClick:P,children:[e.jsx(re,{className:"me-2 text-secondary"})," ","Print"]})]})]})]})})]}),e.jsx(Y,{children:e.jsx(Y.Body,{className:"p-0",children:e.jsx("div",{className:"table-responsive",children:e.jsx(ne,{bordered:!0,hover:!0,responsive:!0,id:"employeeTable",className:"align-middle mb-0"})})})})]}),e.jsx(ie,{show:p,onHide:()=>v(!1),onImportSuccess:f,importTemplateUrl:l})]})}export{Ee as default};
