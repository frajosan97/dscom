import{q as V,r as d,j as e,$ as K}from"./app-Dad_-i9_.js";import{E as _}from"./ErpLayout-DMTrf_ot.js";import{B as Q}from"./index-_NQEgxYe.js";import{A}from"./Alert-CkvbrvMx.js";import{R as b,I as B}from"./Footer-DlTkX6Mv.js";import{C as c,F as i}from"./Form-U4ModQtX.js";import{J as F}from"./journal-C-ll6uT5.js";import{B as p}from"./Image-BqRrxf8V.js";import{P as $}from"./plus-circle-CQY776n2.js";import{C as j}from"./Card-Bgz6RJOm.js";import{S as U}from"./search-BUrOgnVE.js";import{T as Y}from"./Tabs-DzYlnz2o.js";import{T}from"./Tab-BBE0JvIx.js";import{T as Z}from"./Table-CKJkyCIB.js";import{R as ee}from"./receipt-CFKIg3ZG.js";import{B as f}from"./Badge-CTkHH2k9.js";import{M as l}from"./Modal-CgW4CF6b.js";import{C as te,X as se}from"./x-circle-DpNLcfPC.js";/* empty css                      */import"./iconBase-Iw_lzYxk.js";import"./CloseButton-BfcxKKqK.js";function Te(){const{flash:S}=V().props,[k,g]=d.useState(!1),[I,N]=d.useState(!1),[x,P]=d.useState(""),[C,R]=d.useState("all"),[G,O]=d.useState([]),w=[{code:"1001",name:"Cash on Hand",type:"Asset"},{code:"1002",name:"Bank Account",type:"Asset"},{code:"1101",name:"Accounts Receivable",type:"Asset"},{code:"1201",name:"Inventory",type:"Asset"},{code:"2001",name:"Accounts Payable",type:"Liability"},{code:"2002",name:"Credit Card Payable",type:"Liability"},{code:"4001",name:"Online Sales",type:"Income"},{code:"4002",name:"Shipping Revenue",type:"Income"},{code:"5001",name:"Cost of Goods Sold",type:"Expense"},{code:"5002",name:"Shipping Costs",type:"Expense"},{code:"5003",name:"Payment Processing Fees",type:"Expense"},{code:"5004",name:"Digital Marketing",type:"Expense"},{code:"5005",name:"Salaries & Wages",type:"Expense"}],[v,M]=d.useState([{id:1,date:"2025-10-01",reference:"INIT-001",entries:[{account:"1001",name:"Cash on Hand",debit:2e3,credit:0,description:"Initial capital investment"},{account:"3001",name:"Owner's Capital",debit:0,credit:2e3,description:"Initial capital investment"}],description:"Initial capital investment",status:"posted",type:"Capital Contribution"},{id:2,date:"2025-10-03",reference:"SALE-001",entries:[{account:"1002",name:"Bank Account",debit:5e3,credit:0,description:"Online sales revenue"},{account:"4001",name:"Online Sales",debit:0,credit:5e3,description:"Online sales revenue"}],description:"Online sales for October 3",status:"posted",type:"Sales"},{id:3,date:"2025-10-05",reference:"EXP-001",entries:[{account:"5001",name:"Cost of Goods Sold",debit:1200,credit:0,description:"Inventory cost for sales"},{account:"1201",name:"Inventory",debit:0,credit:1200,description:"Inventory cost for sales"}],description:"COGS for October sales",status:"posted",type:"Cost of Sales"},{id:4,date:"2025-10-07",reference:"PMT-001",entries:[{account:"2002",name:"Credit Card Payable",debit:800,credit:0,description:"Credit card payment"},{account:"1002",name:"Bank Account",debit:0,credit:800,description:"Credit card payment"}],description:"Credit card payment",status:"draft",type:"Payment"}]),[n,m]=d.useState({date:new Date().toISOString().split("T")[0],reference:`TRX-${Date.now().toString().slice(-4)}`,description:"",entries:[{account:"",name:"",debit:"",credit:"",description:""},{account:"",name:"",debit:"",credit:"",description:""}]}),E=d.useMemo(()=>v.filter(t=>{const s=t.reference.toLowerCase().includes(x.toLowerCase())||t.description.toLowerCase().includes(x.toLowerCase())||t.entries.some(a=>a.name.toLowerCase().includes(x.toLowerCase())||a.description.toLowerCase().includes(x.toLowerCase())),r=C==="all"||t.status===C;return s&&r}),[v,x,C]),z=t=>{const s=[],r=t.entries.reduce((o,u)=>o+(parseFloat(u.debit)||0),0),a=t.entries.reduce((o,u)=>o+(parseFloat(u.credit)||0),0);r!==a&&s.push(`Debit (${r}) must equal Credit (${a})`),t.entries.forEach((o,u)=>{o.account||s.push(`Entry ${u+1}: Account is required`),!o.debit&&!o.credit&&s.push(`Entry ${u+1}: Either debit or credit must be entered`),o.debit&&o.credit&&s.push(`Entry ${u+1}: Cannot have both debit and credit`)});const h=t.entries.map(o=>o.account).filter(Boolean);return new Set(h).size!==h.length&&s.push("Duplicate accounts in transaction"),s},J=()=>{const t=z(n);if(t.length>0){O(t),N(!0);return}const s={...n,id:Date.now(),status:"posted",entries:n.entries.map(r=>{var a;return{...r,debit:parseFloat(r.debit)||0,credit:parseFloat(r.credit)||0,name:((a=w.find(h=>h.code===r.account))==null?void 0:a.name)||r.name}})};M([...v,s]),g(!1),m({date:new Date().toISOString().split("T")[0],reference:`TRX-${Date.now().toString().slice(-4)}`,description:"",entries:[{account:"",name:"",debit:"",credit:"",description:""},{account:"",name:"",debit:"",credit:"",description:""}]})},y=(t,s,r)=>{const a=[...n.entries];if(a[t]={...a[t],[s]:r},s==="account"&&r){const h=w.find(D=>D.code===r);h&&(a[t].name=h.name)}m({...n,entries:a})},W=()=>{m({...n,entries:[...n.entries,{account:"",name:"",debit:"",credit:"",description:""}]})},H=t=>{if(n.entries.length<=2)return;const s=n.entries.filter((r,a)=>a!==t);m({...n,entries:s})},X=t=>{switch(t){case"posted":return e.jsx(f,{bg:"success",children:"Posted"});case"draft":return e.jsx(f,{bg:"warning",children:"Draft"});case"void":return e.jsx(f,{bg:"danger",children:"Void"});default:return e.jsx(f,{bg:"secondary",children:t})}},q=t=>{const s=t.entries.filter(a=>a.debit>0),r=t.entries.filter(a=>a.credit>0);return s.some(a=>a.account.startsWith("4"))&&r.some(a=>a.account.startsWith("1"))?"Sales":s.some(a=>a.account.startsWith("5"))&&r.some(a=>a.account.startsWith("1"))?"Expense":s.some(a=>a.account.startsWith("1"))&&r.some(a=>a.account.startsWith("2"))?"Payment":"General"},L=v.reduce((t,s)=>(s.status==="posted"&&s.entries.forEach(r=>{t.totalDebit+=r.debit,t.totalCredit+=r.credit}),t),{totalDebit:0,totalCredit:0});return e.jsxs(_,{children:[e.jsx(K,{title:"Journal Transactions"}),S.success&&e.jsx(A,{variant:"success",className:"mb-3",children:S.success}),e.jsxs(b,{className:"mb-4",children:[e.jsx(c,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(F,{className:"me-3 text-primary",size:32}),e.jsxs("div",{children:[e.jsx("h4",{className:"fw-semibold mb-1",children:"Journal Transactions"}),e.jsx("p",{className:"text-muted mb-0",children:"Manage all accounting entries and double-entry transactions"})]})]})}),e.jsx(c,{className:"text-end",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-end gap-3",children:[e.jsxs("div",{className:"text-end",children:[e.jsx("small",{className:"text-muted d-block",children:"Total Debit"}),e.jsxs("strong",{className:"text-success",children:["$",L.totalDebit.toLocaleString()]})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("small",{className:"text-muted d-block",children:"Total Credit"}),e.jsxs("strong",{className:"text-primary",children:["$",L.totalCredit.toLocaleString()]})]}),e.jsxs(p,{variant:"primary",className:"px-4",onClick:()=>g(!0),children:[e.jsx($,{className:"me-2"})," New Entry"]})]})})]}),e.jsx(j,{className:"shadow-sm border-0 mb-4",children:e.jsx(j.Body,{children:e.jsxs(b,{children:[e.jsx(c,{md:6,children:e.jsxs(B,{children:[e.jsx(B.Text,{children:e.jsx(U,{})}),e.jsx(i.Control,{placeholder:"Search by reference, description, or account...",value:x,onChange:t=>P(t.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(Y,{activeKey:C,onSelect:t=>R(t),className:"mb-0",children:[e.jsx(T,{eventKey:"all",title:"All Transactions"}),e.jsx(T,{eventKey:"posted",title:"Posted"}),e.jsx(T,{eventKey:"draft",title:"Draft"})]})})]})})}),e.jsx(j,{className:"shadow-sm border-0",children:e.jsx(j.Body,{children:e.jsx("div",{className:"table-responsive",children:e.jsxs(Z,{bordered:!0,hover:!0,className:"align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{width:"120",children:"Date"}),e.jsx("th",{width:"140",children:"Reference"}),e.jsx("th",{children:"Description"}),e.jsx("th",{width:"120",children:"Type"}),e.jsx("th",{width:"100",children:"Status"}),e.jsx("th",{width:"120",className:"text-end",children:"Debit Total"}),e.jsx("th",{width:"120",className:"text-end",children:"Credit Total"})]})}),e.jsx("tbody",{children:E.length>0?E.map(t=>{const s=t.entries.reduce((r,a)=>r+a.debit,0);return e.jsxs("tr",{children:[e.jsx("td",{className:"fw-semibold",children:t.date}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(ee,{className:"me-2 text-muted",size:14}),t.reference]})}),e.jsxs("td",{children:[e.jsx("div",{children:t.description}),e.jsx("small",{className:"text-muted",children:t.entries.map(r=>`${r.name}${r.debit>0?" (Dr)":" (Cr)"}`).join(" â†’ ")})]}),e.jsx("td",{children:e.jsx(f,{bg:"outline-primary",text:"dark",children:q(t)})}),e.jsx("td",{children:X(t.status)}),e.jsxs("td",{className:"text-end text-success fw-semibold",children:["$",s.toLocaleString()]}),e.jsxs("td",{className:"text-end text-primary fw-semibold",children:["$",s.toLocaleString()]})]},t.id)}):e.jsx("tr",{children:e.jsxs("td",{colSpan:"7",className:"text-center text-muted py-4",children:[e.jsx(F,{size:48,className:"mb-2"}),e.jsx("div",{children:"No transactions found"}),e.jsx("small",{children:"Try adjusting your search or create a new transaction"})]})})})]})})})}),e.jsxs(l,{show:k,onHide:()=>g(!1),centered:!0,size:"lg",children:[e.jsx(l.Header,{closeButton:!0,children:e.jsxs(l.Title,{children:[e.jsx(Q,{className:"me-2"}),"New Journal Entry"]})}),e.jsx(l.Body,{children:e.jsxs(i,{children:[e.jsxs(b,{children:[e.jsx(c,{md:6,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Date *"}),e.jsx(i.Control,{type:"date",value:n.date,onChange:t=>m({...n,date:t.target.value})})]})}),e.jsx(c,{md:6,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Reference *"}),e.jsx(i.Control,{type:"text",value:n.reference,onChange:t=>m({...n,reference:t.target.value}),placeholder:"e.g., TRX-001"})]})})]}),e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Description"}),e.jsx(i.Control,{as:"textarea",rows:2,value:n.description,onChange:t=>m({...n,description:t.target.value}),placeholder:"Brief description of the transaction..."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx(i.Label,{className:"fw-semibold",children:"Journal Entries"}),e.jsxs(p,{variant:"outline-primary",size:"sm",onClick:W,children:[e.jsx($,{size:12,className:"me-1"}),"Add Line"]})]}),n.entries.map((t,s)=>e.jsxs("div",{className:"border rounded p-3 mb-2",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("small",{className:"text-muted",children:["Entry #",s+1]}),n.entries.length>2&&e.jsx(p,{variant:"outline-danger",size:"sm",onClick:()=>H(s),children:"Remove"})]}),e.jsxs(b,{children:[e.jsx(c,{md:5,children:e.jsxs(i.Group,{className:"mb-2",children:[e.jsx(i.Label,{children:"Account *"}),e.jsxs(i.Select,{value:t.account,onChange:r=>y(s,"account",r.target.value),children:[e.jsx("option",{value:"",children:"Select Account"}),w.map(r=>e.jsxs("option",{value:r.code,children:[r.code," -"," ",r.name]},r.code))]})]})}),e.jsx(c,{md:3,children:e.jsxs(i.Group,{className:"mb-2",children:[e.jsx(i.Label,{children:"Debit"}),e.jsx(i.Control,{type:"number",step:"0.01",value:t.debit,onChange:r=>y(s,"debit",r.target.value),placeholder:"0.00"})]})}),e.jsx(c,{md:3,children:e.jsxs(i.Group,{className:"mb-2",children:[e.jsx(i.Label,{children:"Credit"}),e.jsx(i.Control,{type:"number",step:"0.01",value:t.credit,onChange:r=>y(s,"credit",r.target.value),placeholder:"0.00"})]})})]}),e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Description"}),e.jsx(i.Control,{type:"text",value:t.description,onChange:r=>y(s,"description",r.target.value),placeholder:"Line item description..."})]})]},s))]}),e.jsx(j,{className:"bg-light",children:e.jsx(j.Body,{className:"py-2",children:e.jsxs(b,{children:[e.jsxs(c,{children:[e.jsx("small",{className:"text-muted",children:"Total Debit:"}),e.jsxs("div",{className:"fw-semibold",children:["$",n.entries.reduce((t,s)=>t+(parseFloat(s.debit)||0),0).toFixed(2)]})]}),e.jsxs(c,{children:[e.jsx("small",{className:"text-muted",children:"Total Credit:"}),e.jsxs("div",{className:"fw-semibold",children:["$",n.entries.reduce((t,s)=>t+(parseFloat(s.credit)||0),0).toFixed(2)]})]}),e.jsxs(c,{children:[e.jsx("small",{className:"text-muted",children:"Balance:"}),e.jsx("div",{className:`fw-semibold ${n.entries.reduce((t,s)=>t+(parseFloat(s.debit)||0),0)===n.entries.reduce((t,s)=>t+(parseFloat(s.credit)||0),0)?"text-success":"text-danger"}`,children:n.entries.reduce((t,s)=>t+(parseFloat(s.debit)||0),0)-n.entries.reduce((t,s)=>t+(parseFloat(s.credit)||0),0)})]})]})})})]})}),e.jsxs(l.Footer,{children:[e.jsx(p,{variant:"secondary",onClick:()=>g(!1),children:"Cancel"}),e.jsxs(p,{variant:"primary",onClick:J,children:[e.jsx(te,{className:"me-2"}),"Post Transaction"]})]})]}),e.jsxs(l,{show:I,onHide:()=>N(!1),centered:!0,children:[e.jsx(l.Header,{closeButton:!0,children:e.jsxs(l.Title,{className:"text-danger",children:[e.jsx(se,{className:"me-2"}),"Validation Errors"]})}),e.jsx(l.Body,{children:e.jsxs(A,{variant:"danger",children:[e.jsx("strong",{children:"Please fix the following errors:"}),e.jsx("ul",{className:"mb-0 mt-2",children:G.map((t,s)=>e.jsx("li",{children:t},s))})]})}),e.jsx(l.Footer,{children:e.jsx(p,{variant:"danger",onClick:()=>N(!1),children:"Close"})})]})]})}export{Te as default};
