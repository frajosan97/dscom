import{j as e,r as u,$ as F}from"./app-Bf6XjMin.js";import{R as p,y as I}from"./Footer-KcMd7B25.js";import{F as W}from"./index-BrRlqxdl.js";import{E as D}from"./ErpLayout-CcqoWY3M.js";import{S as N}from"./hoist-non-react-statics.cjs-CiIQoDaf.js";import{x as T}from"./axios-DHJzAa6P.js";import{u as E}from"./formik.esm-mxnt_q6J.js";import{c as M,d as L,b as o}from"./index.esm-CBUoSnSW.js";import{M as y}from"./Modal-Dub380aG.js";import{F as t,C as l}from"./Form-CBfDXdOv.js";import{B as b}from"./Image-SIlH0Fxf.js";import{u as P}from"./useData-BzVf1W4_.js";import{C as S}from"./Card-BnYslkqX.js";import{B as q}from"./ButtonGroup-D-fEBcFe.js";import{T as A}from"./Table-C6uxQ5h8.js";import"./CloseButton-C4urQvqy.js";import"./iconBase-Ci6cckdQ.js";/* empty css                      */function O({show:g,onHide:c,warehouse:a,branches:j,onSuccess:v}){const x=!!a,_=M().shape({name:o().required("Name is required"),code:o().required("Code is required"),branch_id:o().nullable(),address:o().required("Address is required"),city:o().required("City is required"),state:o().required("State is required"),country:o().required("Country is required"),postal_code:o().required("Postal code is required"),contact_person:o().required("Contact person is required"),contact_phone:o().required("Contact phone is required"),contact_email:o().email("Invalid email format").required("Contact email is required"),is_active:L(),is_primary:L()}),n=E({enableReinitialize:!0,initialValues:{name:(a==null?void 0:a.name)||"",code:(a==null?void 0:a.code)||"",branch_id:(a==null?void 0:a.branch_id)||"",address:(a==null?void 0:a.address)||"",city:(a==null?void 0:a.city)||"",state:(a==null?void 0:a.state)||"",country:(a==null?void 0:a.country)||"Nigeria",postal_code:(a==null?void 0:a.postal_code)||"",latitude:(a==null?void 0:a.latitude)||"",longitude:(a==null?void 0:a.longitude)||"",contact_person:(a==null?void 0:a.contact_person)||"",contact_phone:(a==null?void 0:a.contact_phone)||"",contact_email:(a==null?void 0:a.contact_email)||"",contact_position:(a==null?void 0:a.contact_position)||"",opening_time:(a==null?void 0:a.opening_time)||"08:00",closing_time:(a==null?void 0:a.closing_time)||"18:00",working_days:(a==null?void 0:a.working_days)||[],is_primary:(a==null?void 0:a.is_primary)||!1,is_active:(a==null?void 0:a.is_active)??!0,notes:(a==null?void 0:a.notes)||"",_method:x?"PUT":"POST"},validationSchema:_,onSubmit:async(s,{setSubmitting:r,setErrors:h})=>{var d,i;try{const m=x?route("warehouse.update",a.id):route("warehouse.store"),C=await T.post(m,s);C.data.success===!0&&(v(C.data.message),c())}catch(m){(i=(d=m.response)==null?void 0:d.data)!=null&&i.errors?h(m.response.data.errors):console.error("Error submitting form:",m)}finally{r(!1)}}}),f=[{id:"monday",name:"Monday"},{id:"tuesday",name:"Tuesday"},{id:"wednesday",name:"Wednesday"},{id:"thursday",name:"Thursday"},{id:"friday",name:"Friday"},{id:"saturday",name:"Saturday"},{id:"sunday",name:"Sunday"}],k=s=>{const r=n.values.working_days||[],h=r.includes(s)?r.filter(d=>d!==s):[...r,s];n.setFieldValue("working_days",h)};return e.jsxs(y,{show:g,onHide:c,size:"lg",centered:!0,backdrop:"static",children:[e.jsx(y.Header,{closeButton:!0,children:e.jsx(y.Title,{children:x?"Edit Warehouse":"Create New Warehouse"})}),e.jsxs(t,{onSubmit:n.handleSubmit,children:[e.jsxs(y.Body,{children:[e.jsxs(p,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsxs(t.Group,{controlId:"name",children:[e.jsx(t.Label,{children:"Warehouse Name *"}),e.jsx(t.Control,{type:"text",name:"name",value:n.values.name,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.name&&!!n.errors.name}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.name})]})}),e.jsx(l,{md:6,children:e.jsxs(t.Group,{controlId:"code",children:[e.jsx(t.Label,{children:"Warehouse Code *"}),e.jsx(t.Control,{type:"text",name:"code",value:n.values.code,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.code&&!!n.errors.code}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.code})]})})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsxs(t.Group,{controlId:"branch_id",children:[e.jsx(t.Label,{children:"Branch"}),e.jsxs(t.Select,{name:"branch_id",value:n.values.branch_id,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.branch_id&&!!n.errors.branch_id,children:[e.jsx("option",{value:"",children:"Select Branch"}),j.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.branch_id})]})}),e.jsx(l,{md:6,children:e.jsx(t.Group,{controlId:"is_primary",children:e.jsx(t.Check,{type:"switch",id:"is_primary",label:"Primary Warehouse",checked:n.values.is_primary,onChange:n.handleChange,name:"is_primary"})})})]}),e.jsxs(t.Group,{controlId:"address",className:"mb-3",children:[e.jsx(t.Label,{children:"Address *"}),e.jsx(t.Control,{as:"textarea",rows:2,name:"address",value:n.values.address,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.address&&!!n.errors.address}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.address})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(l,{md:4,children:e.jsxs(t.Group,{controlId:"city",children:[e.jsx(t.Label,{children:"City *"}),e.jsx(t.Control,{type:"text",name:"city",value:n.values.city,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.city&&!!n.errors.city}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.city})]})}),e.jsx(l,{md:4,children:e.jsxs(t.Group,{controlId:"state",children:[e.jsx(t.Label,{children:"State *"}),e.jsx(t.Control,{type:"text",name:"state",value:n.values.state,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.state&&!!n.errors.state}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.state})]})}),e.jsx(l,{md:4,children:e.jsxs(t.Group,{controlId:"postal_code",children:[e.jsx(t.Label,{children:"Postal Code *"}),e.jsx(t.Control,{type:"text",name:"postal_code",value:n.values.postal_code,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.postal_code&&!!n.errors.postal_code}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.postal_code})]})})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsxs(t.Group,{controlId:"country",children:[e.jsx(t.Label,{children:"Country *"}),e.jsxs(t.Control,{as:"select",name:"country",value:n.values.country,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.country&&!!n.errors.country,children:[e.jsx("option",{value:"Nigeria",children:"Nigeria"}),e.jsx("option",{value:"Ghana",children:"Ghana"}),e.jsx("option",{value:"South Africa",children:"South Africa"}),e.jsx("option",{value:"Kenya",children:"Kenya"}),e.jsx("option",{value:"Other",children:"Other"})]}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.country})]})}),e.jsx(l,{md:6,children:e.jsx(t.Group,{controlId:"is_active",children:e.jsx(t.Check,{type:"switch",id:"is_active",label:"Is Active",checked:n.values.is_active,onChange:n.handleChange,name:"is_active"})})})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsxs(t.Group,{controlId:"latitude",children:[e.jsx(t.Label,{children:"Latitude"}),e.jsx(t.Control,{type:"number",step:"0.000001",name:"latitude",value:n.values.latitude,onChange:n.handleChange})]})}),e.jsx(l,{md:6,children:e.jsxs(t.Group,{controlId:"longitude",children:[e.jsx(t.Label,{children:"Longitude"}),e.jsx(t.Control,{type:"number",step:"0.000001",name:"longitude",value:n.values.longitude,onChange:n.handleChange})]})})]}),e.jsx("h5",{className:"mt-4 mb-3",children:"Contact Information"}),e.jsxs(p,{className:"mb-3",children:[e.jsx(l,{md:4,children:e.jsxs(t.Group,{controlId:"contact_person",children:[e.jsx(t.Label,{children:"Contact Person *"}),e.jsx(t.Control,{type:"text",name:"contact_person",value:n.values.contact_person,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.contact_person&&!!n.errors.contact_person}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.contact_person})]})}),e.jsx(l,{md:4,children:e.jsxs(t.Group,{controlId:"contact_phone",children:[e.jsx(t.Label,{children:"Contact Phone *"}),e.jsx(t.Control,{type:"text",name:"contact_phone",value:n.values.contact_phone,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.contact_phone&&!!n.errors.contact_phone}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.contact_phone})]})}),e.jsx(l,{md:4,children:e.jsxs(t.Group,{controlId:"contact_email",children:[e.jsx(t.Label,{children:"Contact Email *"}),e.jsx(t.Control,{type:"email",name:"contact_email",value:n.values.contact_email,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.contact_email&&!!n.errors.contact_email}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.errors.contact_email})]})})]}),e.jsxs(t.Group,{controlId:"contact_position",className:"mb-3",children:[e.jsx(t.Label,{children:"Contact Position"}),e.jsx(t.Control,{type:"text",name:"contact_position",value:n.values.contact_position,onChange:n.handleChange})]}),e.jsx("h5",{className:"mt-4 mb-3",children:"Operating Hours"}),e.jsxs(p,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsxs(t.Group,{controlId:"opening_time",children:[e.jsx(t.Label,{children:"Opening Time"}),e.jsx(t.Control,{type:"time",name:"opening_time",value:n.values.opening_time,onChange:n.handleChange})]})}),e.jsx(l,{md:6,children:e.jsxs(t.Group,{controlId:"closing_time",children:[e.jsx(t.Label,{children:"Closing Time"}),e.jsx(t.Control,{type:"time",name:"closing_time",value:n.values.closing_time,onChange:n.handleChange})]})})]}),e.jsxs(t.Group,{controlId:"working_days",className:"mb-3",children:[e.jsx(t.Label,{children:"Working Days"}),e.jsx("div",{className:"d-flex flex-wrap gap-2",children:f.map(s=>{var r;return e.jsx(b,{variant:(r=n.values.working_days)!=null&&r.includes(s.id)?"primary":"outline-secondary",onClick:()=>k(s.id),size:"sm",children:s.name},s.id)})})]}),e.jsxs(t.Group,{controlId:"notes",className:"mb-3",children:[e.jsx(t.Label,{children:"Notes"}),e.jsx(t.Control,{as:"textarea",rows:3,name:"notes",value:n.values.notes,onChange:n.handleChange})]})]}),e.jsxs(y.Footer,{children:[e.jsx(b,{variant:"secondary",onClick:c,children:"Cancel"}),e.jsx(b,{variant:"primary",type:"submit",disabled:n.isSubmitting,children:n.isSubmitting?"Saving...":"Save Changes"})]})]})]})}function le(){const[g,c]=u.useState(!1),[a,j]=u.useState(null),{branches:v}=P(),x=u.useCallback(()=>{$.fn.DataTable.isDataTable("#warehousesTable")&&$("#warehousesTable").DataTable().destroy(),$("#warehousesTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("warehouse.index"),type:"GET"},columns:[{data:"name",title:"Name"},{data:"code",title:"Code"},{data:"branch",title:"Branch"},{data:"location",title:"Location"},{data:"status",title:"Status"},{data:"action",title:"Actions"}],drawCallback:()=>{$(".edit-btn").off("click").on("click",function(){const r=$(this).data("id");k(r)}),$(".delete-btn").off("click").on("click",function(){const r=$(this).data("id");s(r)})}})},[]);u.useEffect(()=>{x()},[x]);const _=u.useCallback(()=>{j(null),c(!0)},[]),n=u.useCallback(()=>{c(!1),j(null)},[]),f=u.useCallback(r=>{I.success(r),$("#warehousesTable").DataTable().ajax.reload(null,!1),c(!1)},[]),k=async r=>{var h,d;try{const i=await T.get(route("warehouse.edit",r));i.data.success===!0?(j(i.data.data),c(!0)):I.error(i.data.message)}catch(i){I.error(((d=(h=i.response)==null?void 0:h.data)==null?void 0:d.message)||"An error occurred")}},s=async r=>{var d,i,m,C;if((await N.fire({title:"Delete Warehouse?",text:"This cannot be undone. All related inventory data will be affected.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await T.delete(route("warehouse.destroy",r)),$("#warehousesTable").DataTable().ajax.reload(null,!1),N.fire("Deleted!","Warehouse has been deleted.","success")}catch(G){let B="Delete failed.";((d=G.response)==null?void 0:d.status)===403?B="You don't have permission to delete this warehouse.":(C=(m=(i=G.response)==null?void 0:i.data)==null?void 0:m.message)!=null&&C.includes("foreign key constraint")&&(B="Cannot delete warehouse because it has associated inventory records."),N.fire("Error!",B,"error")}};return e.jsxs(D,{children:[e.jsx(F,{title:"Warehouses Management"}),e.jsxs(S,{className:"border-0 rounded-0 shadow-sm",children:[e.jsxs(S.Header,{className:"d-flex justify-content-between align-items-center bg-transparent",children:[e.jsx("h6",{className:"mb-0 fw-semibold",children:"Warehouse Management"}),e.jsx(q,{children:e.jsx(q,{children:e.jsxs(b,{variant:"outline-secondary",size:"sm",className:"rounded-1 d-flex align-items-center",onClick:_,children:[e.jsx(W,{className:"me-1"}),"New Warehouse"]})})})]}),e.jsx(S.Body,{className:"px-0",children:e.jsx(A,{bordered:!0,striped:!0,hover:!0,responsive:!0,id:"warehousesTable",className:"w-100"})})]}),e.jsx(O,{show:g,onHide:n,warehouse:a,branches:v,onSuccess:f})]})}export{le as default};
