import{r as l,j as e,$ as ae,Y as re}from"./app-B27A4gAu.js";import{f as le,p as ne,q as F,r as oe,s as ie,t as ce,u as z,v as de,w as me,x as ue}from"./index-BdGnjsTB.js";import{S as U}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{y as n,R as L,I as B}from"./Footer-CYHpKGKu.js";import{E as pe}from"./ErpLayout-DNMhQ0u8.js";import{x as D}from"./axios-DtJHdElN.js";import{C as xe,B as i}from"./Image-BsV_zh1h.js";import{C as y,F as x}from"./Form-DnVOYCGi.js";import{B as Y}from"./ButtonGroup-zTN1Lwfk.js";import{C as G}from"./Card-dwbIjSrg.js";import{T as fe}from"./Table-BHwRjuN6.js";import{M as v}from"./Modal-Br6RYDTu.js";import{P as he}from"./ProgressBar-CWeSYNXo.js";import"./iconBase-Dr2Sovul.js";import"./CloseButton-BcTf898R.js";/* empty css                      */function Pe(){const[N,_]=l.useState(""),[f,V]=l.useState("all"),[q,w]=l.useState(!1),[d,I]=l.useState(null),[o,C]=l.useState(!1),[T,m]=l.useState(0),[P,h]=l.useState(""),[R,S]=l.useState([]),[be,H]=l.useState(""),E=l.useRef(!1),c=l.useRef(null),u=l.useRef(null);l.useEffect(()=>{H(route("employee.import.template"))},[]);const A=l.useCallback(()=>{if(E.current)return;$.fn.DataTable.isDataTable("#employeeTable")&&$("#employeeTable").DataTable().destroy();const s=$("#employeeTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("employee.index"),type:"GET",data:function(t){t.search=N,t.status=f!=="all"?f:""}},columns:[{data:"DT_RowIndex",title:"#",className:"text-center",width:"1%",orderable:!1,searchable:!1},{data:"profile_image",title:"",className:"text-center",width:"3%",render:(t,a,r)=>t?`<img src="/storage/${t}" alt="${r.name}" class="rounded-circle" width="40" height="40" style="object-fit: cover;" />`:`<div class="rounded-circle bg-light d-flex align-items-center justify-content-center mx-auto" style="width: 40px; height: 40px;">
                            <i class="bi bi-person text-muted"></i>
                        </div>`,orderable:!1,searchable:!1},{data:"name",title:"Name",className:"text-start",render:(t,a,r)=>`<div>
                            <div class="fw-semibold">${t}</div>
                            <small class="text-muted">${r.designation||"N/A"}</small>
                        </div>`},{data:"contact",title:"Contact",className:"text-start",render:(t,a,r)=>`<div>
                            <div>${r.email||"N/A"}</div>
                            <small class="text-muted">${r.phone}</small>
                        </div>`},{data:"role",title:"Role",className:"text-start",width:"10%"},{data:"salary",title:"Salary",className:"text-end",render:t=>!t||t==="0"?"N/A":`<span class="fw-semibold">$${parseFloat(t).toLocaleString()}</span>`},{data:"status",title:"Status",className:"text-center",width:"10%",render:t=>{const r={Enable:{badge:"success",text:"Active",icon:"bi-check-circle"},Disable:{badge:"secondary",text:"Inactive",icon:"bi-x-circle"}}[t]||{badge:"warning",text:t,icon:"bi-question-circle"};return`<span class="badge bg-${r.badge} px-3 py-2">
                            <i class="bi ${r.icon} me-1"></i>
                            ${r.text}
                        </span>`}},{data:"action",title:"Actions",className:"text-center",width:"15%"}],drawCallback:function(){$(".edit-btn").off("click").on("click",function(){const t=$(this).data("id");J(t)}),$(".view-btn").off("click").on("click",function(){const t=$(this).data("id");Q(t)}),$(".delete-btn").off("click").on("click",function(){const t=$(this).data("id");W(t)})},initComplete:function(){E.current=!0},language:{processing:'<div class="spinner-border text-primary" role="status"></div>',emptyTable:"No employees found",zeroRecords:"No matching employees found"}});return c.current=s,s},[N,f]);l.useEffect(()=>{E.current&&c.current&&c.current.ajax.reload()},[N,f]),l.useEffect(()=>(A(),()=>{$.fn.DataTable.isDataTable("#employeeTable")&&($("#employeeTable").DataTable().destroy(),E.current=!1)}),[A]);const O=s=>{const t=s.target.files[0];if(!t)return;if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"].includes(t.type)){n.error("Please select a valid Excel or CSV file");return}if(t.size>5*1024*1024){n.error("File size should not exceed 5MB");return}I(t)},K=async()=>{var t,a,r,b;if(!d){n.error("Please select a file to import");return}const s=new FormData;s.append("file",d),C(!0),m(0),h("Uploading..."),S([]);try{const p=setInterval(()=>{m(g=>g>=90?(clearInterval(p),90):g+10)},300),j=await D.post(route("employee.import"),s,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:g=>{const se=Math.round(g.loaded*100/g.total);m(se)}});if(clearInterval(p),m(100),h("Processing..."),j.data.success)setTimeout(()=>{n.success(j.data.message||"Employees imported successfully!"),w(!1),I(null),C(!1),m(0),h(""),c.current&&c.current.ajax.reload(),u.current&&(u.current.value="")},1e3);else throw new Error(j.data.message||"Import failed")}catch(p){if(C(!1),h("Import failed"),(a=(t=p.response)==null?void 0:t.data)!=null&&a.errors){const j=Object.values(p.response.data.errors).flat();S(j),n.error("There were errors during import. Please check the error list.")}else n.error(((b=(r=p.response)==null?void 0:r.data)==null?void 0:b.message)||"Error importing file")}},X=async()=>{try{const s=await D.get(route("employee.import.template"),{responseType:"blob"}),t=window.URL.createObjectURL(new Blob([s.data])),a=document.createElement("a");a.href=t,a.setAttribute("download","employee_import_template.xlsx"),document.body.appendChild(a),a.click(),a.remove(),n.success("Template downloaded successfully!")}catch{n.error("Failed to download template")}},k=()=>{I(null),S([]),m(0),h(""),u.current&&(u.current.value="")},M=()=>{o?U.fire({title:"Cancel Import?",text:"Import is in progress. Are you sure you want to cancel?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, cancel it!",cancelButtonText:"Continue import"}).then(s=>{s.isConfirmed&&(w(!1),k(),C(!1))}):(w(!1),k())},J=s=>{window.location.href=route("employee.edit",s)},Q=s=>{window.location.href=route("employee.show",s)},W=async s=>{var t,a;try{if(!(await U.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;const b=await D.delete(route("employee.destroy",s));b.data.success&&(n.success(b.data.message),c.current&&c.current.ajax.reload())}catch(r){n.error(((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"An error occurred while deleting the employee")}},Z=()=>{n.info("Export feature coming soon!")},ee=()=>{n.info("Print feature coming soon!")},te=()=>{c.current&&(c.current.ajax.reload(),n.success("Employee list refreshed!"))};return e.jsxs(pe,{children:[e.jsx(ae,{title:"Employee Management"}),e.jsxs(xe,{fluid:!0,children:[e.jsxs(L,{className:"mb-4 align-items-center",children:[e.jsxs(y,{md:6,children:[e.jsxs("h3",{className:"fw-bold text-primary mb-2",children:[e.jsx(le,{className:"me-2"}),"Employee Management"]}),e.jsx("p",{className:"text-muted mb-0",children:"View, manage, and maintain all employee accounts."})]}),e.jsx(y,{md:6,className:"text-md-end",children:e.jsxs(Y,{className:"mb-2 mb-md-0",children:[e.jsxs(i,{variant:"outline-primary",as:re,href:route("employee.create"),className:"d-flex align-items-center",children:[e.jsx(ne,{className:"me-1"}),"Add Employee"]}),e.jsxs(i,{variant:"outline-success",onClick:()=>w(!0),className:"d-flex align-items-center",children:[e.jsx(F,{className:"me-1"}),"Import Excel"]})]})})]}),e.jsxs(L,{className:"mb-4",children:[e.jsx(y,{md:6,lg:4,children:e.jsxs(B,{children:[e.jsx(B.Text,{children:e.jsx(oe,{})}),e.jsx(x.Control,{type:"text",placeholder:"Search employees...",value:N,onChange:s=>_(s.target.value)})]})}),e.jsx(y,{md:6,lg:4,children:e.jsxs(B,{children:[e.jsx(B.Text,{children:e.jsx(ie,{})}),e.jsxs(x.Select,{value:f,onChange:s=>V(s.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"Enable",children:"Active"}),e.jsx("option",{value:"Disable",children:"Inactive"})]})]})}),e.jsx(y,{md:12,lg:4,className:"text-lg-end mt-2 mt-lg-0",children:e.jsxs(Y,{children:[e.jsxs(i,{variant:"outline-secondary",onClick:te,className:"d-flex align-items-center",children:[e.jsx(ce,{className:"me-1"}),"Refresh"]}),e.jsxs(i,{variant:"outline-info",onClick:Z,className:"d-flex align-items-center",children:[e.jsx(z,{className:"me-1"}),"Export"]}),e.jsxs(i,{variant:"outline-dark",onClick:ee,className:"d-flex align-items-center",children:[e.jsx(de,{className:"me-1"}),"Print"]})]})})]}),e.jsx(G,{children:e.jsx(G.Body,{className:"p-0",children:e.jsx("div",{className:"table-responsive",children:e.jsx(fe,{bordered:!0,hover:!0,responsive:!0,id:"employeeTable",className:"align-middle mb-0"})})})})]}),e.jsxs(v,{show:q,onHide:M,size:"lg",backdrop:o?"static":!0,keyboard:!o,children:[e.jsx(v.Header,{closeButton:!o,children:e.jsxs(v.Title,{className:"d-flex align-items-center",children:[e.jsx(F,{className:"me-2"}),"Import Employees from Excel"]})}),e.jsxs(v.Body,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs(x.Group,{children:[e.jsx(x.Label,{className:"fw-semibold",children:"Select Excel/CSV File"}),e.jsx("div",{className:"border rounded p-4 text-center",children:d?e.jsxs("div",{className:"d-flex align-items-center justify-content-between bg-light p-3 rounded",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(me,{className:"fs-4 text-primary me-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:d.name}),e.jsxs("small",{className:"text-muted",children:[(d.size/1024).toFixed(2)," ","KB"]})]})]}),e.jsx(i,{variant:"outline-danger",size:"sm",onClick:k,disabled:o,children:e.jsx(ue,{})})]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"fs-1 text-muted mb-3"}),e.jsx("p",{className:"text-muted mb-3",children:"Drag & drop your Excel file here or click to browse"}),e.jsx(i,{variant:"outline-primary",onClick:()=>{var s;return(s=u.current)==null?void 0:s.click()},children:"Browse Files"}),e.jsx(x.Control,{type:"file",ref:u,onChange:O,accept:".xlsx,.xls,.csv",className:"d-none",disabled:o})]})}),e.jsx(x.Text,{className:"text-muted",children:"Supported formats: .xlsx, .xls, .csv (Max 5MB)"})]})}),o&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("small",{className:"text-muted",children:"Import Progress"}),e.jsxs("small",{className:"text-muted",children:[T,"%"]})]}),e.jsx(he,{now:T,animated:T<100,variant:T===100?"success":"primary",className:"mb-2"}),P&&e.jsx("small",{className:"text-muted d-block text-center",children:P})]}),R.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-danger mb-2",children:"Import Errors:"}),e.jsx("div",{className:"border border-danger rounded p-3 bg-danger bg-opacity-10",children:e.jsx("ul",{className:"mb-0 ps-3",children:R.map((s,t)=>e.jsx("li",{className:"text-danger small",children:s},t))})})]}),e.jsx("div",{className:"border-top pt-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1",children:"Need a template?"}),e.jsx("p",{className:"small text-muted mb-0",children:"Download our Excel template with proper column formatting"})]}),e.jsxs(i,{variant:"outline-success",onClick:X,disabled:o,size:"sm",children:[e.jsx(z,{className:"me-1"}),"Download Template"]})]})})]}),e.jsxs(v.Footer,{children:[e.jsx(i,{variant:"secondary",onClick:M,disabled:o,children:"Cancel"}),e.jsx(i,{variant:"primary",onClick:K,disabled:!d||o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),"Importing..."]}):"Start Import"})]})]})]})}export{Pe as default};
