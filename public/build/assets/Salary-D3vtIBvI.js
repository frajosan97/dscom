import{r as c,j as e,$ as ie}from"./app-DdIX6d_6.js";import{h as ce,v as de,w as ue,x as me,y as he,z as xe}from"./index-DuXVde2B.js";import{S as N}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{y as h,R as x,I as R}from"./Footer-BYsUKS50.js";import{E as pe}from"./ErpLayout-CCrlVePp.js";import{x as p}from"./axios-UiVjVQIz.js";import{u as be}from"./useData-DYFN6rev.js";import{C as je,B as b}from"./Image-C4wVi4fk.js";import{C as i,F as s}from"./Form-D_I3dj_K.js";import{B as Y}from"./ButtonGroup-CQW-hObI.js";import{C as m}from"./Card-Dcy67VlY.js";import{T as ye}from"./Table-wPH_v57Z.js";import{M as v}from"./Modal-DvRX44EJ.js";import"./iconBase-Bxk0bmeF.js";import"./CloseButton-DjMRf_Ll.js";/* empty css                      */function Ee(){const[f,I]=c.useState(""),[j,H]=c.useState("all"),[y,O]=c.useState("all"),[S,q]=c.useState(new Date().getFullYear().toString()),[z,g]=c.useState(!1),[w,L]=c.useState(null),{employees:B}=be(),[ge,F]=c.useState(null),[n,_]=c.useState({employee_id:"",month:new Date().toLocaleString("default",{month:"long"}),year:new Date().getFullYear(),basic_salary:0,allowances:0,deductions:0,overtime_hours:0,overtime_rate:0,bonus:0,tax:0,insurance:0,other_allowances:0,other_deductions:0,status:"pending",payment_date:"",notes:""}),[T,k]=c.useState(0),C=c.useRef(!1),u=c.useRef(null),A=c.useCallback(()=>{const t=parseFloat(n.basic_salary)||0,a=parseFloat(n.allowances)||0,r=(parseFloat(n.overtime_hours)||0)*(parseFloat(n.overtime_rate)||0),l=parseFloat(n.bonus)||0,o=parseFloat(n.other_allowances)||0,se=parseFloat(n.deductions)||0,te=parseFloat(n.tax)||0,re=parseFloat(n.insurance)||0,ne=parseFloat(n.other_deductions)||0,le=t+a+r+l+o,oe=se+te+re+ne;return Math.max(0,le-oe)},[n]);c.useEffect(()=>{k(A())},[n,A]);const J=t=>{const a=B.find(r=>r.id===parseInt(t));F(a),_(r=>({...r,employee_id:t,basic_salary:(a==null?void 0:a.salary)||0}))},G=["January","February","March","April","May","June","July","August","September","October","November","December"],U=new Date().getFullYear(),E=Array.from({length:11},(t,a)=>U-5+a),P=c.useCallback(()=>{if(C.current)return;$.fn.DataTable.isDataTable("#salaryTable")&&$("#salaryTable").DataTable().destroy();const t=$("#salaryTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("salary.index"),type:"GET",data:function(a){a.search=f,a.status=j!=="all"?j:"",a.month=y!=="all"?y:"",a.year=S}},columns:[{data:"DT_RowIndex",title:"#",className:"text-center",width:"1%",orderable:!1,searchable:!1},{data:"employee",title:"Employee",className:"text-start",render:(a,r,l)=>`<div>
                            <div class="fw-semibold">${(a==null?void 0:a.name)||"N/A"}</div>
                            <small class="text-muted">${(a==null?void 0:a.designation)||"N/A"} | ${(a==null?void 0:a.department)||"N/A"}</small>
                        </div>`},{data:"period",title:"Period",className:"text-start",render:(a,r,l)=>`<div>
                            <div class="fw-semibold">${l.month} ${l.year}</div>
                            ${l.payment_date?`<small class="text-muted">Paid: ${new Date(l.payment_date).toLocaleDateString()}</small>`:""}
                        </div>`},{data:"basic_salary",title:"Basic",className:"text-end",render:a=>`<span class="fw-semibold">$${parseFloat(a).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}</span>`},{data:"allowances",title:"Allowances",className:"text-end",render:(a,r,l)=>`<span class="text-success">+$${(parseFloat(l.allowances||0)+parseFloat(l.overtime_amount||0)+parseFloat(l.bonus||0)).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}</span>`},{data:"deductions",title:"Deductions",className:"text-end",render:(a,r,l)=>`<span class="text-danger">-$${(parseFloat(l.deductions||0)+parseFloat(l.tax||0)+parseFloat(l.insurance||0)).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}</span>`},{data:"net_salary",title:"Net Salary",className:"text-end",render:a=>`<span class="fw-bold text-primary">$${parseFloat(a).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}</span>`},{data:"status",title:"Status",className:"text-center",width:"10%",render:a=>{const l={paid:{badge:"success",text:"Paid",icon:"bi-check-circle"},processing:{badge:"warning",text:"Processing",icon:"bi-clock-history"},pending:{badge:"danger",text:"Pending",icon:"bi-exclamation-circle"}}[a]||{badge:"secondary",text:a,icon:"bi-question-circle"};return`<span class="badge bg-${l.badge} px-3 py-2">
                            <i class="bi ${l.icon} me-1"></i>
                            ${l.text}
                        </span>`}},{data:"action",title:"Actions",className:"text-center",width:"15%",orderable:!1,searchable:!1,render:(a,r,l)=>`<div class="d-flex justify-content-center gap-2">
                            <button class="btn btn-sm btn-outline-primary edit-btn" data-id="${l.id}" title="Edit Salary">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-info view-btn" data-id="${l.id}" title="View Details">
                                <i class="bi bi-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-success pay-btn" data-id="${l.id}" title="Mark as Paid" ${l.status==="paid"?"disabled":""}>
                                <i class="bi bi-cash"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger delete-btn" data-id="${l.id}" title="Delete">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>`}],drawCallback:function(){$(".edit-btn").off("click").on("click",function(){const a=$(this).data("id");K(a)}),$(".view-btn").off("click").on("click",function(){const a=$(this).data("id");Q(a)}),$(".pay-btn").off("click").on("click",function(){const a=$(this).data("id");W(a)}),$(".delete-btn").off("click").on("click",function(){const a=$(this).data("id");X(a)})},initComplete:function(){C.current=!0},language:{processing:'<div class="spinner-border text-primary" role="status"></div>',emptyTable:"No salary records found",zeroRecords:"No matching salary records found"}});return u.current=t,t},[f,j,y,S]);c.useEffect(()=>{C.current&&u.current&&u.current.ajax.reload()},[f,j,y,S]),c.useEffect(()=>(P(),()=>{$.fn.DataTable.isDataTable("#salaryTable")&&($("#salaryTable").DataTable().destroy(),C.current=!1)}),[P]);const d=t=>{const{name:a,value:r}=t.target;_(l=>({...l,[a]:a.includes("salary")||a.includes("allowances")||a.includes("deductions")||a.includes("overtime")||a.includes("bonus")||a.includes("tax")||a.includes("insurance")?parseFloat(r)||0:r}))},V=async t=>{var a,r;t.preventDefault();try{const l={...n,net_salary:T,overtime_amount:n.overtime_hours*n.overtime_rate};if(w){const o=await p.put(route("salary.update",w.id),l);o.data.success&&(h.success(o.data.message),g(!1),D(),u.current&&u.current.ajax.reload())}else{const o=await p.post(route("salary.store"),l);o.data.success&&(h.success(o.data.message),g(!1),D(),u.current&&u.current.ajax.reload())}}catch(l){h.error(((r=(a=l.response)==null?void 0:a.data)==null?void 0:r.message)||"An error occurred while saving salary")}},D=()=>{_({employee_id:"",month:new Date().toLocaleString("default",{month:"long"}),year:new Date().getFullYear(),basic_salary:0,allowances:0,deductions:0,overtime_hours:0,overtime_rate:0,bonus:0,tax:0,insurance:0,other_allowances:0,other_deductions:0,status:"pending",payment_date:"",notes:""}),L(null),F(null),k(0)},K=async t=>{try{const r=(await p.get(route("salary.show",t))).data;L(r),F(r.employee),_({employee_id:r.employee_id,month:r.month,year:r.year,basic_salary:r.basic_salary,allowances:r.allowances,deductions:r.deductions,overtime_hours:r.overtime_hours||0,overtime_rate:r.overtime_rate||0,bonus:r.bonus||0,tax:r.tax||0,insurance:r.insurance||0,other_allowances:r.other_allowances||0,other_deductions:r.other_deductions||0,status:r.status,payment_date:r.payment_date||"",notes:r.notes||""}),g(!0)}catch{h.error("Failed to load salary details")}},Q=async t=>{var a,r;try{const o=(await p.get(route("salary.show",t))).data;N.fire({title:"Salary Details",html:`
                    <div class="text-start">
                        <div class="row mb-3">
                            <div class="col-6">
                                <strong>Employee:</strong>
                                <p class="mb-0">${(a=o.employee)==null?void 0:a.name}</p>
                                <small class="text-muted">${(r=o.employee)==null?void 0:r.designation}</small>
                            </div>
                            <div class="col-6">
                                <strong>Period:</strong>
                                <p>${o.month} ${o.year}</p>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-6">
                                <strong>Basic Salary:</strong>
                                <p>$${parseFloat(o.basic_salary).toLocaleString()}</p>
                            </div>
                            <div class="col-6">
                                <strong>Net Salary:</strong>
                                <p class="text-primary fw-bold">$${parseFloat(o.net_salary).toLocaleString()}</p>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-6">
                                <strong>Total Allowances:</strong>
                                <p class="text-success">$${parseFloat(o.allowances+(o.overtime_amount||0)+(o.bonus||0)).toLocaleString()}</p>
                            </div>
                            <div class="col-6">
                                <strong>Total Deductions:</strong>
                                <p class="text-danger">$${parseFloat(o.deductions+(o.tax||0)+(o.insurance||0)).toLocaleString()}</p>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-6">
                                <strong>Status:</strong>
                                <p><span class="badge bg-${o.status==="paid"?"success":o.status==="processing"?"warning":"danger"}">${o.status}</span></p>
                            </div>
                            ${o.payment_date?`
                            <div class="col-6">
                                <strong>Payment Date:</strong>
                                <p>${new Date(o.payment_date).toLocaleDateString()}</p>
                            </div>
                            `:""}
                        </div>
                    </div>
                `,showCloseButton:!0,showConfirmButton:!1,width:"600px"})}catch{h.error("Failed to load salary details")}},W=async t=>{var a,r;try{if(!(await N.fire({title:"Mark as Paid?",text:"This will mark the salary as paid and record the payment date.",icon:"question",showCancelButton:!0,confirmButtonColor:"#10b981",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, mark as paid",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;const o=await p.put(route("salary.mark-paid",t),{payment_date:new Date().toISOString().split("T")[0]});o.data.success&&(h.success(o.data.message),u.current&&u.current.ajax.reload())}catch(l){h.error(((r=(a=l.response)==null?void 0:a.data)==null?void 0:r.message)||"An error occurred while updating salary")}},X=async t=>{var a,r;try{if(!(await N.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;const o=await p.delete(route("salary.destroy",t));o.data.success&&(h.success(o.data.message),u.current&&u.current.ajax.reload())}catch(l){h.error(((r=(a=l.response)==null?void 0:a.data)==null?void 0:r.message)||"An error occurred while deleting the salary record")}},Z=()=>{h.info("Export feature coming soon!")},ee=()=>{h.info("Print feature coming soon!")},ae=()=>{u.current&&(u.current.ajax.reload(),h.success("Salary list refreshed!"))},M=()=>{g(!1),D()};return e.jsxs(pe,{children:[e.jsx(ie,{title:"Salary Management"}),e.jsxs(je,{fluid:!0,children:[e.jsxs(x,{className:"mb-4",children:[e.jsxs(i,{children:[e.jsxs("h3",{className:"fw-bold text-primary",children:[e.jsx(ce,{className:"me-2"}),"Salary Management"]}),e.jsx("p",{className:"text-muted mb-0",children:"Manage employee salaries, allowances, and deductions."})]}),e.jsx(i,{className:"text-end",children:e.jsx(Y,{children:e.jsxs(b,{variant:"outline-primary",onClick:()=>g(!0),className:"d-flex align-items-center",children:[e.jsx(de,{className:"me-1"}),"Add Salary"]})})})]}),e.jsx(m,{className:"mb-4",children:e.jsx(m.Body,{children:e.jsxs(x,{className:"g-3",children:[e.jsx(i,{md:3,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Search Employee"}),e.jsxs(R,{children:[e.jsx(R.Text,{children:e.jsx(ue,{})}),e.jsx(s.Control,{type:"text",placeholder:"Search by name or ID...",value:f,onChange:t=>I(t.target.value)})]})]})}),e.jsx(i,{md:2,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Status"}),e.jsxs(s.Select,{value:j,onChange:t=>H(t.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"pending",children:"Pending"})]})]})}),e.jsx(i,{md:2,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Month"}),e.jsxs(s.Select,{value:y,onChange:t=>O(t.target.value),children:[e.jsx("option",{value:"all",children:"All Months"}),G.map(t=>e.jsx("option",{value:t,children:t},t))]})]})}),e.jsx(i,{md:2,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Year"}),e.jsx(s.Select,{value:S,onChange:t=>q(t.target.value),children:E.map(t=>e.jsx("option",{value:t,children:t},t))})]})}),e.jsx(i,{md:3,className:"d-flex align-items-end",children:e.jsxs(Y,{className:"w-100",children:[e.jsx(b,{variant:"outline-primary",onClick:ae,title:"Refresh",children:e.jsx(me,{})}),e.jsx(b,{variant:"outline-success",onClick:Z,title:"Export",children:e.jsx(he,{})}),e.jsx(b,{variant:"outline-secondary",onClick:ee,title:"Print",children:e.jsx(xe,{})})]})})]})})}),e.jsx(m,{children:e.jsx(m.Body,{children:e.jsx("div",{className:"table-responsive",children:e.jsx(ye,{bordered:!0,hover:!0,responsive:!0,id:"salaryTable",className:"align-middle mb-0"})})})}),e.jsxs(v,{show:z,onHide:M,size:"xl",centered:!0,children:[e.jsx(v.Header,{closeButton:!0,children:e.jsx(v.Title,{children:w?"Edit Salary Record":"Add New Salary Record"})}),e.jsxs(s,{onSubmit:V,children:[e.jsx(v.Body,{children:e.jsxs(x,{className:"g-3",children:[e.jsx(i,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Select Employee *"}),e.jsxs(s.Select,{name:"employee_id",value:n.employee_id,onChange:t=>J(t.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Choose employee..."}),B.map(t=>{var a;return e.jsxs("option",{value:t.id,children:[t.name," -"," ",t.designation," ($",(a=t.salary)==null?void 0:a.toLocaleString(),")"]},t.id)})]})]})}),e.jsx(i,{md:3,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Month *"}),e.jsx(s.Select,{name:"month",value:n.month,onChange:d,required:!0,children:G.map(t=>e.jsx("option",{value:t,children:t},t))})]})}),e.jsx(i,{md:3,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Year *"}),e.jsx(s.Select,{name:"year",value:n.year,onChange:d,required:!0,children:E.map(t=>e.jsx("option",{value:t,children:t},t))})]})}),e.jsx(i,{md:12,children:e.jsx("h5",{className:"mb-3",children:"Salary Breakdown"})}),e.jsx(i,{md:6,children:e.jsxs(m,{className:"border-success",children:[e.jsx(m.Header,{className:"bg-success text-white",children:e.jsx("h6",{className:"mb-0",children:"Earnings"})}),e.jsx(m.Body,{children:e.jsxs(x,{className:"g-2",children:[e.jsx(i,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Basic Salary"}),e.jsx(s.Control,{type:"number",name:"basic_salary",value:n.basic_salary,onChange:d,step:"0.01"})]})}),e.jsx(i,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Allowances"}),e.jsx(s.Control,{type:"number",name:"allowances",value:n.allowances,onChange:d,step:"0.01"})]})}),e.jsx(i,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Overtime Hours"}),e.jsx(s.Control,{type:"number",name:"overtime_hours",value:n.overtime_hours,onChange:d,step:"0.5"})]})}),e.jsx(i,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Overtime Rate"}),e.jsx(s.Control,{type:"number",name:"overtime_rate",value:n.overtime_rate,onChange:d,step:"0.01"})]})}),e.jsx(i,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Bonus"}),e.jsx(s.Control,{type:"number",name:"bonus",value:n.bonus,onChange:d,step:"0.01"})]})}),e.jsx(i,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Other Allowances"}),e.jsx(s.Control,{type:"number",name:"other_allowances",value:n.other_allowances,onChange:d,step:"0.01"})]})})]})})]})}),e.jsx(i,{md:6,children:e.jsxs(m,{className:"border-danger",children:[e.jsx(m.Header,{className:"bg-danger text-white",children:e.jsx("h6",{className:"mb-0",children:"Deductions"})}),e.jsx(m.Body,{children:e.jsxs(x,{className:"g-2",children:[e.jsx(i,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Deductions"}),e.jsx(s.Control,{type:"number",name:"deductions",value:n.deductions,onChange:d,step:"0.01"})]})}),e.jsx(i,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Tax"}),e.jsx(s.Control,{type:"number",name:"tax",value:n.tax,onChange:d,step:"0.01"})]})}),e.jsx(i,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Insurance"}),e.jsx(s.Control,{type:"number",name:"insurance",value:n.insurance,onChange:d,step:"0.01"})]})}),e.jsx(i,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Other Deductions"}),e.jsx(s.Control,{type:"number",name:"other_deductions",value:n.other_deductions,onChange:d,step:"0.01"})]})})]})})]})}),e.jsx(i,{md:12,children:e.jsxs(m,{className:"border-primary",children:[e.jsx(m.Header,{className:"bg-primary text-white",children:e.jsx("h6",{className:"mb-0",children:"Summary"})}),e.jsx(m.Body,{children:e.jsxs(x,{children:[e.jsx(i,{md:4,children:e.jsxs("div",{className:"text-center p-3 bg-light rounded",children:[e.jsx("small",{className:"text-muted d-block",children:"Total Earnings"}),e.jsxs("h4",{className:"text-success mb-0",children:["$",((parseFloat(n.basic_salary)||0)+(parseFloat(n.allowances)||0)+parseFloat(n.overtime_hours)*parseFloat(n.overtime_rate)+(parseFloat(n.bonus)||0)+(parseFloat(n.other_allowances)||0)).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})}),e.jsx(i,{md:4,children:e.jsxs("div",{className:"text-center p-3 bg-light rounded",children:[e.jsx("small",{className:"text-muted d-block",children:"Total Deductions"}),e.jsxs("h4",{className:"text-danger mb-0",children:["$",((parseFloat(n.deductions)||0)+(parseFloat(n.tax)||0)+(parseFloat(n.insurance)||0)+(parseFloat(n.other_deductions)||0)).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})}),e.jsx(i,{md:4,children:e.jsxs("div",{className:"text-center p-3 bg-light rounded",children:[e.jsx("small",{className:"text-muted d-block",children:"Net Salary"}),e.jsxs("h3",{className:"text-primary mb-0",children:["$",T.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})})]})})]})}),e.jsx(i,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Status"}),e.jsxs(s.Select,{name:"status",value:n.status,onChange:d,children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"paid",children:"Paid"})]})]})}),n.status==="paid"&&e.jsx(i,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Payment Date"}),e.jsx(s.Control,{type:"date",name:"payment_date",value:n.payment_date,onChange:d})]})}),e.jsx(i,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Notes"}),e.jsx(s.Control,{as:"textarea",rows:3,name:"notes",value:n.notes,onChange:d,placeholder:"Additional notes or comments..."})]})})]})}),e.jsxs(v.Footer,{children:[e.jsx(b,{variant:"secondary",onClick:M,children:"Cancel"}),e.jsx(b,{variant:"primary",type:"submit",children:w?"Update Salary":"Save Salary"})]})]})]})]})]})}export{Ee as default};
