import{r as s,j as e,$ as C}from"./app-C8okO_FY.js";import{f as E}from"./index-EA8oOjr2.js";import{E as v}from"./ErpLayout-enYR1Bf_.js";import{F,a as R,b as I,c as A}from"./index-5vgjvAW0.js";import{y as m}from"./Footer-DnT14h8L.js";import{x as k}from"./axios-CrvAxd_j.js";import{C as b}from"./Card-CMRoatnC.js";import{B as w}from"./ButtonGroup-D0OsDQls.js";import{B as h}from"./Image-eY5NvQ05.js";import{T as S}from"./Table-BgGj5UP2.js";import{T as z}from"./Tabs-CoT3Pq-E.js";import{T as B}from"./Tab-Hgb5Jy1w.js";import"./iconBase-ClMMaQi3.js";/* empty css                      */import"./CloseButton-B9TEQAOu.js";import"./Form-WKlbRvmM.js";function O(){const[p,d]=s.useState(!1),[c,T]=s.useState(()=>new Date().toISOString().split("T")[0]),u=s.useRef(!1),n=s.useRef(null),f=s.useCallback(async(a,t,r)=>{var l,o,j;d(!0);try{const i=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0}),x=[{id:a,clockIn:t==="clockIn"?i:null,clockOut:t==="clockOut"?i:null,status:"present"}];(await k.post(route("attendance.store"),{date:c,attendance:x})).data.success&&(m.success(`${r} ${t==="clockIn"?"clocked in":"clocked out"} successfully`),(l=n.current)==null||l.ajax.reload(null,!1))}catch(i){console.error("Mark attendance error:",i);const x=t==="clockIn"?"clock in":"clock out";m.error(((j=(o=i.response)==null?void 0:o.data)==null?void 0:j.message)||`Failed to ${x}`)}finally{d(!1)}},[c]),g=s.useCallback(async a=>{var t,r,l;if(confirm("Are you sure you want to reset this attendance record?")){d(!0);try{(await k.delete(route("attendance.destroy",a))).data.success&&(m.success("Attendance record reset successfully"),(t=n.current)==null||t.ajax.reload(null,!1))}catch(o){m.error(((l=(r=o.response)==null?void 0:r.data)==null?void 0:l.message)||"Failed to reset attendance record")}finally{d(!1)}}},[]),y=s.useCallback(()=>{if(u.current)return;$.fn.DataTable.isDataTable("#attendanceRegisterTable")&&$("#attendanceRegisterTable").DataTable().destroy();const a=$("#attendanceRegisterTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("attendance.index"),type:"GET",data:{date:c}},columns:[{data:"name",name:"name",title:"Employee",className:"text-start"},{data:"department.name",name:"department.name",title:"Department",className:"text-start"},{data:"clockin",name:"clockin",title:"Clock In",className:"text-start"},{data:"clockout",name:"clockout",title:"Clock Out",className:"text-start"},{data:"status",name:"status",title:"Status",className:"text-start"}],language:{emptyTable:"No attendance records found for selected date",search:"Filter employees:",searchPlaceholder:"By name or department..."}});$(a.table().body()).on("click",".clock-in-btn",function(){const t=$(this).data("id"),r=$(this).data("name");f(t,"clockIn",r)}),$(a.table().body()).on("click",".clock-out-btn",function(){const t=$(this).data("id"),r=$(this).data("name");f(t,"clockOut",r)}),$(a.table().body()).on("click",".reset-btn",function(){const t=$(this).data("id");g(t)}),u.current=!0,n.current=a},[c,f,g]),N=a=>{T(a.target.value)};s.useEffect(()=>(y(),()=>{$.fn.DataTable.isDataTable("#attendanceRegisterTable")&&($("#attendanceRegisterTable").DataTable().destroy(),u.current=!1)}),[y]),s.useEffect(()=>{u.current&&n.current&&n.current.ajax.reload()},[c]);const D=()=>{n.current&&n.current.ajax.reload()};return e.jsxs(b,{className:"border-0 rounded-0 shadow-sm",children:[e.jsxs(b.Header,{className:"d-flex justify-content-between align-items-center bg-transparent py-2",children:[e.jsx("h6",{className:"mb-0 fw-semibold",children:"Attendance Register"}),e.jsxs("div",{className:"d-flex justify-content-end align-items-center gap-2",children:[e.jsxs("div",{className:"input-group input-group-sm me-2",style:{width:"200px"},children:[e.jsx("span",{className:"input-group-text",children:e.jsx(F,{})}),e.jsx("input",{type:"date",className:"form-control",value:c,onChange:N,disabled:p})]}),e.jsxs(w,{className:"gap-2",children:[e.jsx(h,{variant:"outline-primary",size:"sm",className:"rounded-1",onClick:D,disabled:p,title:"Refresh data",children:e.jsx(R,{className:p?"spinning":""})}),e.jsx(h,{variant:"outline-danger",size:"sm",className:"rounded-1",title:"Export to PDF",children:e.jsx(I,{})}),e.jsx(h,{variant:"outline-success",size:"sm",className:"rounded-1",title:"Export to Excel",children:e.jsx(A,{})})]})]})]}),e.jsx(b.Body,{className:"p-0",children:e.jsx(S,{size:"sm",bordered:!0,hover:!0,striped:!0,responsive:!0,id:"attendanceRegisterTable",className:"m-0 align-middle"})})]})}function te(){return e.jsxs(v,{children:[e.jsx(C,{title:"Attendance Management"}),e.jsx(z,{defaultActiveKey:"register",className:"users-tabs mb-3",id:"attendance-tabs",children:e.jsx(B,{eventKey:"register",title:e.jsxs(e.Fragment,{children:[e.jsx(E,{size:16,className:"me-1"})," ","Register"]}),children:e.jsx(O,{})})})]})}export{te as default};
