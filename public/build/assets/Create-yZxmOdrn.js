import{r as n,v as G,j as a,$ as J,m as K}from"./app-DDPmmEsP.js";import{R as V,B as W,y as g}from"./Footer-DHiARg5T.js";import{F as X,a as Y}from"./index-CjSf-fsN.js";import{E as Z}from"./ErpLayout-BTroGK5i.js";import{u as ee}from"./useData-DDLfDtqJ.js";import{P as te,S as ae,a as se,C as oe}from"./CustomerModal-BLVMQNJr.js";import{x as re}from"./axios-CX_3tIE5.js";import{n as d}from"./helpers-B-PK6d0z.js";import{C as ie}from"./Image-CfrpkxQr.js";import{C}from"./Form-Cqgl9C35.js";import{C as u}from"./Card-BnTkWAgR.js";import"./CloseButton-bKfF9Hr0.js";import"./iconBase-CZOCq8hy.js";/* empty css                      */import"./Table-DWCTgkd7.js";import"./trash-DDTWIvwR.js";import"./react-select.esm-BXcQi4PR.js";import"./hoist-non-react-statics.cjs-C-Qo8PK8.js";import"./floating-ui.dom-DvtPwI1-.js";import"./plus-circle-CjFKlHv7.js";import"./truck-B5bJhqhR.js";import"./index.esm-CdR14npU.js";import"./Modal-CuFKoZEN.js";function De(){const{customers:S=[],products:P=[],paymentMethods:w=[],warehouses:N=[],shippingMethods:F=[],refreshCustomers:O}=ee(),[D,x]=n.useState(!1),[q,y]=n.useState(!1),[f,E]=n.useState(""),[i,c]=n.useState([]),[M,T]=n.useState("percentage"),[b,A]=n.useState(new Date().toISOString().split("T")[0]),{data:r,setData:v,errors:R}=G({date:new Date().toISOString().split("T")[0],reference:`ORD-${Math.floor(1e3+Math.random()*9e3)}`,branch_id:null,user_id:null,customer_id:null,customer_email:"",customer_phone:"",customer_first_name:"",customer_last_name:"",customer_company:"",customer_tax_number:"",billing_address:{street:"",city:"",state:"",postal_code:"",country:""},shipping_address:{street:"",city:"",state:"",postal_code:"",country:""},shipping_same_as_billing:!0,status:"pending",fulfillment_status:"unfulfilled",subtotal:0,tax:0,shipping_cost:0,discount:0,total:0,total_paid:0,total_refunded:0,currency:"$",payment_method_id:null,payment_method_code:"",payment_method_name:"",payment_status:"pending",payment_reference:"",payment_date:b,shipping_method_id:null,tracking_number:"",tracking_url:"",shipped_at:null,delivered_at:null,coupon_id:null,coupon_code:"",coupon_value:0,customer_note:"",private_notes:"",items:[]});n.useEffect(()=>{const e=i.reduce((o,_)=>o+d(_.price)*d(_.quantity),0),s=d(r.tax_percentage),t=s>0?e*s/100:d(r.tax),m=d(r.discount),p=d(r.shipping_cost),l=+(e+t-m+p).toFixed(2),h=+(l-d(r.total_paid)).toFixed(2);v({...r,subtotal:e,tax:t,discount:m,total:l,total_paid:r.total_paid||0,due_amount:h,items:i.map(o=>({product_id:o.product_id,product_variant_id:o.product_variant_id,product_name:o.product_name,description:o.description,price:o.price,original_price:o.original_price,tax_amount:o.tax_amount,discount_amount:o.discount_amount,quantity:o.quantity,total:o.price*o.quantity,options:o.options,attributes:o.attributes}))})},[i,r.tax,r.discount,r.shipping_cost,r.total_paid]);const j=async e=>{var s,t,m,p;e.preventDefault(),x(!0);try{const l=await re.post(route("sales.store"),r);l.data.success&&(g.success(l.data.message),K.visit(route("sales.show",sale.id)))}catch(l){if(x(!1),(t=(s=l.response)==null?void 0:s.data)!=null&&t.errors){const h=l.response.data.errors;Object.values(h).forEach(o=>{o.forEach(_=>{g.error(_)})})}else g.error(((p=(m=l.response)==null?void 0:m.data)==null?void 0:p.message)||"An error occurred while updating the order")}},I=e=>{const s=i.find(t=>t.product_id===e.id);c(s?i.map(t=>t.product_id===e.id?{...t,quantity:t.quantity+1,total:t.price*(t.quantity+1)}:t):[...i,{product_id:e.id,product_name:e.name,description:e.description,price:e.price,original_price:e.price,tax_amount:0,discount_amount:0,quantity:1,total:e.price,options:e.options||null,attributes:e.attributes||null}])},L=e=>{c(i.filter(s=>s.product_id!==e))},B=(e,s)=>{s<1||c(i.map(t=>t.product_id===e?{...t,quantity:parseInt(s),total:t.price*parseInt(s)}:t))},$=(e,s)=>{c(i.map(t=>t.product_id===e?{...t,price:parseFloat(s),total:parseFloat(s)*t.quantity}:t))},H=(P||[]).filter(e=>{var s,t;return((s=e==null?void 0:e.name)==null?void 0:s.toLowerCase().includes(f.toLowerCase()))||((t=e==null?void 0:e.code)==null?void 0:t.toLowerCase().includes(f.toLowerCase()))}),k=[{value:"pending",label:"Pending"},{value:"confirmed",label:"Confirmed"},{value:"processing",label:"Processing"},{value:"shipped",label:"Shipped"},{value:"delivered",label:"Delivered"},{value:"cancelled",label:"Cancelled"},{value:"refunded",label:"Refunded"},{value:"partially_refunded",label:"Partially Refunded"},{value:"on_hold",label:"On Hold"},{value:"failed",label:"Failed"},{value:"completed",label:"Completed"}],Q=[{value:"pending",label:"Pending"},{value:"paid",label:"Paid"},{value:"failed",label:"Failed"},{value:"partially_paid",label:"Partially Paid"},{value:"refunded",label:"Refunded"}],U=[{value:"unfulfilled",label:"Unfulfilled"},{value:"partially_fulfilled",label:"Partially Fulfilled"},{value:"fulfilled",label:"Fulfilled"}],z=()=>{O()};return a.jsxs(Z,{children:[a.jsx(J,{title:"Create New Order"}),a.jsxs(ie,{fluid:!0,children:[a.jsx("form",{onSubmit:j,children:a.jsxs(V,{className:"g-4",children:[a.jsx(C,{lg:8,children:a.jsxs(u,{className:"mb-4",children:[a.jsxs(u.Header,{className:"bg-white d-flex justify-content-between align-items-center",children:[a.jsxs("div",{children:[a.jsx(X,{className:"me-2"}),a.jsx("strong",{children:"Create New Order"})]}),a.jsxs(W,{bg:"success",children:[a.jsx(Y,{className:"me-1"})," New"]})]}),a.jsxs(u.Body,{children:[a.jsx(te,{products:H,searchTerm:f,setSearchTerm:E,addProduct:I}),a.jsxs(u,{className:"mt-3",children:[a.jsx(u.Header,{className:"bg-light",children:a.jsx("h6",{className:"mb-0",children:"Order Items"})}),a.jsx(u.Body,{className:"p-0",children:a.jsx(ae,{selectedProducts:i,removeProduct:L,updateProductQuantity:B,updateProductPrice:$,currency:r.currency})})]})]})]})}),a.jsx(C,{lg:4,children:a.jsx(se,{data:r,setData:v,errors:R,processing:D,customers:S,warehouses:N,paymentMethods:w,shippingMethods:F,statusOptions:k,paymentStatusOptions:Q,fulfillmentStatusOptions:U,discountType:M,setDiscountType:T,paymentDate:b,setPaymentDate:A,handleSubmit:j,setShowCustomerModal:y,isEdit:!1})})]})}),a.jsx(oe,{show:q,onClose:()=>y(!1),onCustomerAdded:z})]})]})}export{De as default};
