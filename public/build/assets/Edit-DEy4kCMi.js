import{r as u,v as W,j as t,$ as X,m as Y}from"./app-CGCcTJnQ.js";import{R as Z,y as x,B as o}from"./Footer-CRm-FYLZ.js";import{b as ee}from"./index-By0aXlS4.js";import{E as te}from"./ErpLayout-Dd3SuRvB.js";import{u as re}from"./useData-B88Lp9nY.js";import{P as se,S as ie,a as ae,C as ne}from"./CustomerModal-CjLIPNKv.js";import{x as oe}from"./axios-Q-ZagsbW.js";import{n as l}from"./helpers-CQXteve5.js";import{C as de}from"./Image-C1oIC0_0.js";import{C as w}from"./Form-CztmhhS9.js";import{C as m}from"./Card-BYpRWYjG.js";import"./CloseButton-DfHhhRN2.js";import"./iconBase-D3lLr6E1.js";/* empty css                      */import"./Table-DdKforGC.js";import"./trash-CiEw8jyA.js";import"./react-select.esm-Daph9GMX.js";import"./hoist-non-react-statics.cjs-C-Qo8PK8.js";import"./floating-ui.dom-DvtPwI1-.js";import"./plus-circle-DHFvihAX.js";import"./truck-_044fpEH.js";import"./index.esm-DQ4HJBQI.js";import"./Modal-BLOzEIBk.js";function qe({sale:e}){var S;const{customers:E=[],products:D=[],paymentMethods:F=[],warehouses:N=[],shippingMethods:O=[],refreshCustomers:q}=re(),[R,y]=u.useState(!1),[k,v]=u.useState(!1),[g,A]=u.useState(""),[d,p]=u.useState(e.items||[]),[T,L]=u.useState(((S=e.coupon)==null?void 0:S.type)==="fixed_amount"?"fixed":"percentage"),[j,M]=u.useState(e.payment_date||new Date().toISOString().split("T")[0]),{data:n,setData:P,errors:B}=W({order_number:e.order_number,invoice_number:e.invoice_number,branch_id:e.branch_id,user_id:e.user_id,customer_id:e.customer_id,customer_email:e.customer_email,customer_phone:e.customer_phone,customer_first_name:e.customer_first_name,customer_last_name:e.customer_last_name,customer_company:e.customer_company,customer_tax_number:e.customer_tax_number,billing_address:e.billing_address,shipping_address:e.shipping_address,shipping_same_as_billing:e.shipping_same_as_billing,status:e.status,fulfillment_status:e.fulfillment_status,subtotal:e.subtotal,tax:e.tax,shipping_cost:e.shipping_cost,discount:e.discount,total:e.total,total_paid:e.total_paid,total_refunded:e.total_refunded,currency:e.currency,payment_method_id:e.payment_method_id,payment_method_code:e.payment_method_code,payment_method_name:e.payment_method_name,payment_status:e.payment_status,payment_reference:e.payment_reference,payment_date:j,shipping_method_id:e.shipping_method_id,tracking_number:e.tracking_number,tracking_url:e.tracking_url,shipped_at:e.shipped_at,delivered_at:e.delivered_at,coupon_id:e.coupon_id,coupon_code:e.coupon_code,coupon_value:e.coupon_value,customer_note:e.customer_note,private_notes:e.private_notes,custom_fields:e.custom_fields,ip_address:e.ip_address,user_agent:e.user_agent,items:e.items||[]});u.useEffect(()=>{const r=d.reduce((a,f)=>a+l(f.price)*l(f.quantity),0),i=l(n.tax_percentage),s=i>0?r*i/100:l(n.tax),_=l(n.discount),h=l(n.shipping_cost),c=+(r+s-_+h).toFixed(2),b=+(c-l(n.total_paid)).toFixed(2);P({...n,subtotal:r,tax:s,discount:_,total:c,total_paid:n.total_paid||0,due_amount:b,items:d.map(a=>({product_id:a.product_id,product_variant_id:a.product_variant_id,product_name:a.product_name,description:a.description,price:a.price,original_price:a.original_price,tax_amount:a.tax_amount,discount_amount:a.discount_amount,quantity:a.quantity,total:a.price*a.quantity,options:a.options,attributes:a.attributes}))})},[d,n.tax,n.discount,n.shipping_cost,n.total_paid]);const C=async r=>{var i,s,_,h;r.preventDefault(),y(!0);try{const c=await oe.put(route("sales.update",e.id),n);c.data.success&&(x.success(c.data.message),Y.visit(route("sales.show",e.id)))}catch(c){if(y(!1),(s=(i=c.response)==null?void 0:i.data)!=null&&s.errors){const b=c.response.data.errors;Object.values(b).forEach(a=>{a.forEach(f=>{x.error(f)})})}else x.error(((h=(_=c.response)==null?void 0:_.data)==null?void 0:h.message)||"An error occurred while updating the order")}},H=r=>{const i=d.find(s=>s.product_id===r.id);p(i?d.map(s=>s.product_id===r.id?{...s,quantity:s.quantity+1,total:s.price*(s.quantity+1)}:s):[...d,{product_id:r.id,product_name:r.name,description:r.description,price:r.price,original_price:r.price,tax_amount:0,discount_amount:0,quantity:1,total:r.price,options:r.options||null,attributes:r.attributes||null}])},I=r=>{p(d.filter(i=>i.product_id!==r))},$=(r,i)=>{i<1||p(d.map(s=>s.product_id===r?{...s,quantity:parseInt(i),total:s.price*parseInt(i)}:s))},U=(r,i)=>{p(d.map(s=>s.product_id===r?{...s,price:parseFloat(i),total:parseFloat(i)*s.quantity}:s))},Q=(D||[]).filter(r=>{var i,s;return((i=r==null?void 0:r.name)==null?void 0:i.toLowerCase().includes(g.toLowerCase()))||((s=r==null?void 0:r.code)==null?void 0:s.toLowerCase().includes(g.toLowerCase()))}),z=[{value:"pending",label:"Pending"},{value:"confirmed",label:"Confirmed"},{value:"processing",label:"Processing"},{value:"shipped",label:"Shipped"},{value:"delivered",label:"Delivered"},{value:"cancelled",label:"Cancelled"},{value:"refunded",label:"Refunded"},{value:"partially_refunded",label:"Partially Refunded"},{value:"on_hold",label:"On Hold"},{value:"failed",label:"Failed"},{value:"completed",label:"Completed"}],G=[{value:"pending",label:"Pending"},{value:"paid",label:"Paid"},{value:"failed",label:"Failed"},{value:"partially_paid",label:"Partially Paid"},{value:"refunded",label:"Refunded"}],J=[{value:"unfulfilled",label:"Unfulfilled"},{value:"partially_fulfilled",label:"Partially Fulfilled"},{value:"fulfilled",label:"Fulfilled"}],K=()=>{q()},V=r=>{switch(r){case"pending":return t.jsx(o,{bg:"warning",children:"Pending"});case"confirmed":return t.jsx(o,{bg:"primary",children:"Confirmed"});case"processing":return t.jsx(o,{bg:"info",children:"Processing"});case"shipped":return t.jsx(o,{bg:"secondary",children:"Shipped"});case"delivered":return t.jsx(o,{bg:"success",children:"Delivered"});case"cancelled":return t.jsx(o,{bg:"danger",children:"Cancelled"});case"refunded":return t.jsx(o,{bg:"light",text:"dark",children:"Refunded"});case"partially_refunded":return t.jsx(o,{bg:"light",text:"dark",children:"Partially Refunded"});case"on_hold":return t.jsx(o,{bg:"warning",children:"On Hold"});case"failed":return t.jsx(o,{bg:"danger",children:"Failed"});case"completed":return t.jsx(o,{bg:"success",children:"Completed"});default:return t.jsx(o,{bg:"secondary",children:"Unknown"})}};return t.jsxs(te,{children:[t.jsx(X,{title:`Edit Order #${e.order_number}`}),t.jsxs(de,{fluid:!0,children:[t.jsx("form",{onSubmit:C,children:t.jsxs(Z,{className:"g-4",children:[t.jsx(w,{lg:8,children:t.jsxs(m,{className:"mb-4",children:[t.jsxs(m.Header,{className:"bg-white d-flex justify-content-between align-items-center",children:[t.jsxs("div",{children:[t.jsx(ee,{className:"me-2"}),t.jsxs("strong",{children:["Edit Order #",e.order_number]}),t.jsx("span",{className:"ms-3",children:V(e.status)})]}),t.jsx("div",{children:t.jsxs("small",{className:"text-muted",children:["Created: ",new Date(e.created_at).toLocaleString()]})})]}),t.jsxs(m.Body,{children:[t.jsx(se,{products:Q,searchTerm:g,setSearchTerm:A,addProduct:H}),t.jsxs(m,{className:"mt-3",children:[t.jsx(m.Header,{className:"bg-light",children:t.jsx("h6",{className:"mb-0",children:"Order Items"})}),t.jsx(m.Body,{className:"p-0",children:t.jsx(ie,{selectedProducts:d,removeProduct:I,updateProductQuantity:$,updateProductPrice:U,currency:n.currency})})]})]})]})}),t.jsx(w,{lg:4,children:t.jsx(ae,{data:n,setData:P,errors:B,processing:R,customers:E,warehouses:N,paymentMethods:F,shippingMethods:O,statusOptions:z,paymentStatusOptions:G,fulfillmentStatusOptions:J,discountType:T,setDiscountType:L,paymentDate:j,setPaymentDate:M,handleSubmit:C,setShowCustomerModal:v,isEdit:!0,order:e})})]})}),t.jsx(ne,{show:k,onClose:()=>v(!1),onCustomerAdded:K})]})]})}export{qe as default};
