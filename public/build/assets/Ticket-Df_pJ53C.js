import{r as o,j as e,$ as A}from"./app-Bt_zyVoS.js";import{q as T,n as U,b as z,c as S,d as J,e as K}from"./index-Dwb0v_39.js";import{S as Q}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{y as p,R as j,I as u,D as m}from"./Footer-BE8-uFgA.js";import{E as V}from"./ErpLayout-B7lFZRNn.js";import{x as _}from"./axios-C6h4k-PV.js";import{F as W,a as X,b as Y}from"./index-PdBTCQZK.js";import{C as Z,B as f}from"./Image-DTP6OkpU.js";import{C as l,F as s}from"./Form-DzhKJdGd.js";import{B as D}from"./ButtonGroup-CLGMY21O.js";import{C as F}from"./Card-BHcq6w0A.js";import{T as ee}from"./Table-D1gUGyH6.js";import{M as v}from"./Modal-D9DeynXk.js";import"./iconBase-DHa3fQ9g.js";import"./CloseButton-hrm_xX80.js";/* empty css                      */function be(){const[b,L]=o.useState(""),[h,P]=o.useState("all"),[x,B]=o.useState("all"),[E,y]=o.useState(!1),[c,C]=o.useState({subject:"",customer_name:"",customer_email:"",priority:"medium",status:"open",description:"",category:"",assigned_to:""}),g=o.useRef(!1),n=o.useRef(null),k=o.useCallback(()=>{if(g.current)return;$.fn.DataTable.isDataTable("#ticketTable")&&$("#ticketTable").DataTable().destroy();const r=$("#ticketTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("ticket.index"),type:"GET",data:function(t){t.search=b,t.status=h!=="all"?h:"",t.priority=x!=="all"?x:""}},columns:[{data:"ticket_number",title:"Ticket #",className:"text-center",width:"8%"},{data:"subject",title:"Subject",className:"text-start fw-semibold",render:function(t,a,i){return`
                            <div>
                                <div>${t}</div>
                                <small class="text-muted">${i.category||"General"}</small>
                            </div>
                        `}},{data:"customer_name",title:"Customer",className:"text-start"},{data:"customer_email",title:"Email",className:"text-start"},{data:"priority",title:"Priority",className:"text-center",width:"8%",render:function(t){let a="bg-warning text-dark",i="Medium";return t==="high"?(a="bg-danger",i="High"):t==="low"?(a="bg-info",i="Low"):t==="critical"&&(a="bg-dark",i="Critical"),`<span class="badge ${a}">${i}</span>`}},{data:"status",title:"Status",className:"text-center",width:"8%",render:function(t){let a="bg-success",i="Open";return t==="in_progress"?(a="bg-primary",i="In Progress"):t==="on_hold"?(a="bg-warning text-dark",i="On Hold"):t==="resolved"?(a="bg-info",i="Resolved"):t==="closed"&&(a="bg-secondary",i="Closed"),`<span class="badge ${a}">${i}</span>`}},{data:"created_at",title:"Created",className:"text-center",width:"10%",render:function(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"})}},{data:"last_updated",title:"Updated",className:"text-center",width:"10%",render:function(t){return t?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"-"}},{data:"id",title:"Actions",className:"text-center",width:"12%",orderable:!1,searchable:!1,render:function(t,a,i){return`
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-sm btn-outline-info view-btn" data-id="${t}">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-primary edit-btn" data-id="${t}">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-success assign-btn" data-id="${t}">
                                    <i class="bi bi-person-plus"></i>
                                </button>
                            </div>
                        `}}],drawCallback:function(){$(".view-btn").off("click").on("click",function(){const t=$(this).data("id");I(t)}),$(".edit-btn").off("click").on("click",function(){const t=$(this).data("id");M(t)}),$(".assign-btn").off("click").on("click",function(){const t=$(this).data("id");O(t)})},initComplete:function(){g.current=!0},language:{emptyTable:'<div class="text-center py-5"><i class="bi bi-ticket-detailed display-4 text-muted"></i><p class="mt-2">No tickets found</p></div>',zeroRecords:'<div class="text-center py-5"><i class="bi bi-search display-4 text-muted"></i><p class="mt-2">No matching tickets found</p></div>'},responsive:!0,order:[[6,"desc"]],pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]]});return n.current=r,r},[b,h,x]);o.useEffect(()=>{g.current&&n.current&&n.current.ajax.reload()},[b,h,x]),o.useEffect(()=>(k(),()=>{$.fn.DataTable.isDataTable("#ticketTable")&&($("#ticketTable").DataTable().destroy(),g.current=!1)}),[k]);const G=()=>y(!0),w=()=>{y(!1),C({subject:"",customer_name:"",customer_email:"",priority:"medium",status:"open",description:"",category:"",assigned_to:""})},d=r=>{C({...c,[r.target.name]:r.target.value})},R=async r=>{var t,a;r.preventDefault();try{(await _.post(route("ticket.store"),c)).data.success&&(p.success("Ticket created successfully!"),w(),n.current&&n.current.ajax.reload())}catch(i){p.error(((a=(t=i.response)==null?void 0:t.data)==null?void 0:a.message)||"An error occurred while creating ticket")}},I=r=>{window.location.href=route("ticket.show",r)},M=r=>{window.location.href=route("ticket.edit",r)},O=async r=>{try{const{value:t}=await Q.fire({title:"Assign Ticket",input:"select",inputOptions:{},inputPlaceholder:"Select a staff member",showCancelButton:!0});t&&(await _.patch(route("ticket.assign",r),{assigned_to:t})).data.success&&(p.success("Ticket assigned successfully!"),n.current&&n.current.ajax.reload())}catch{p.error("Failed to assign ticket")}},N=r=>{if(n.current){const t=n.current.ajax.params(),a=new URL(route("ticket.export"));Object.keys(t).forEach(i=>{i!=="draw"&&i!=="_"&&i!=="start"&&i!=="length"&&a.searchParams.append(i,t[i])}),a.searchParams.append("type",r),window.open(a.toString(),"_blank")}},H=()=>{if(n.current){const r=n.current.ajax.params(),t=new URL(route("ticket.print"));Object.keys(r).forEach(a=>{a!=="draw"&&a!=="_"&&a!=="start"&&a!=="length"&&t.searchParams.append(a,r[a])}),window.open(t.toString(),"_blank")}},q=()=>{n.current&&(n.current.ajax.reload(),p.success("Tickets list refreshed!"))};return e.jsxs(V,{children:[e.jsx(A,{title:"Customer Tickets"}),e.jsxs(Z,{fluid:!0,children:[e.jsxs(j,{className:"mb-4 align-items-center",children:[e.jsxs(l,{md:6,children:[e.jsxs("h3",{className:"fw-bold text-primary mb-2",children:[e.jsx(T,{className:"me-2"}),"Customer Support Tickets"]}),e.jsx("p",{className:"text-muted mb-0",children:"Manage customer support tickets and track their progress."})]}),e.jsx(l,{md:6,className:"text-md-end",children:e.jsx(D,{className:"mb-2 mb-md-0",children:e.jsxs(f,{variant:"outline-primary",onClick:G,className:"d-flex align-items-center",children:[e.jsx(U,{className:"me-1"}),"New Ticket"]})})})]}),e.jsxs(j,{className:"mb-4",children:[e.jsx(l,{md:6,lg:3,children:e.jsxs(u,{children:[e.jsx(u.Text,{children:e.jsx(z,{})}),e.jsx(s.Control,{type:"text",placeholder:"Search tickets...",value:b,onChange:r=>L(r.target.value)})]})}),e.jsx(l,{md:6,lg:2,children:e.jsxs(u,{children:[e.jsx(u.Text,{children:e.jsx(S,{})}),e.jsxs(s.Select,{value:h,onChange:r=>P(r.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"on_hold",children:"On Hold"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"closed",children:"Closed"})]})]})}),e.jsx(l,{md:6,lg:2,children:e.jsxs(u,{children:[e.jsx(u.Text,{children:e.jsx(S,{})}),e.jsxs(s.Select,{value:x,onChange:r=>B(r.target.value),children:[e.jsx("option",{value:"all",children:"All Priorities"}),e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]})}),e.jsx(l,{md:12,lg:5,className:"text-lg-end mt-2 mt-lg-0",children:e.jsxs(D,{className:"d-flex gap-2",children:[e.jsxs(f,{variant:"outline-info",onClick:q,className:"d-flex align-items-center rounded",children:[e.jsx(J,{className:"me-1"}),"Refresh"]}),e.jsxs(m,{children:[e.jsxs(m.Toggle,{variant:"outline-secondary",className:"d-flex align-items-center",children:[e.jsx(K,{className:"me-1"}),"Export"]}),e.jsxs(m.Menu,{children:[e.jsxs(m.Item,{onClick:()=>N("excel"),children:[e.jsx(W,{className:"me-2 text-success"})," ","Excel"]}),e.jsxs(m.Item,{onClick:()=>N("pdf"),children:[e.jsx(X,{className:"me-2 text-danger"})," ","PDF"]}),e.jsxs(m.Item,{onClick:H,children:[e.jsx(Y,{className:"me-2 text-secondary"})," ","Print"]})]})]})]})})]}),e.jsx(F,{children:e.jsx(F.Body,{className:"p-0",children:e.jsx("div",{className:"table-responsive",children:e.jsx(ee,{bordered:!0,hover:!0,responsive:!0,id:"ticketTable",className:"align-middle mb-0"})})})})]}),e.jsxs(v,{show:E,onHide:w,centered:!0,size:"lg",children:[e.jsx(v.Header,{closeButton:!0,children:e.jsxs(v.Title,{className:"d-flex align-items-center",children:[e.jsx(T,{className:"me-2"}),"Create New Ticket"]})}),e.jsx(v.Body,{children:e.jsxs(s,{onSubmit:R,children:[e.jsxs(j,{children:[e.jsx(l,{md:8,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Subject"}),e.jsx(s.Control,{type:"text",name:"subject",value:c.subject,onChange:d,required:!0})]})}),e.jsx(l,{md:4,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Category"}),e.jsxs(s.Select,{name:"category",value:c.category,onChange:d,children:[e.jsx("option",{value:"",children:"Select Category"}),e.jsx("option",{value:"billing",children:"Billing"}),e.jsx("option",{value:"technical",children:"Technical"}),e.jsx("option",{value:"sales",children:"Sales"}),e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"feature_request",children:"Feature Request"})]})]})})]}),e.jsxs(j,{children:[e.jsx(l,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Customer Name"}),e.jsx(s.Control,{type:"text",name:"customer_name",value:c.customer_name,onChange:d,required:!0})]})}),e.jsx(l,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Email"}),e.jsx(s.Control,{type:"email",name:"customer_email",value:c.customer_email,onChange:d,required:!0})]})})]}),e.jsxs(j,{children:[e.jsx(l,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Priority"}),e.jsxs(s.Select,{name:"priority",value:c.priority,onChange:d,children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]})]})}),e.jsx(l,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Status"}),e.jsxs(s.Select,{name:"status",value:c.status,onChange:d,children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"on_hold",children:"On Hold"})]})]})})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Description"}),e.jsx(s.Control,{as:"textarea",rows:4,name:"description",value:c.description,onChange:d,required:!0})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Assign To (Optional)"}),e.jsx(s.Control,{type:"text",name:"assigned_to",value:c.assigned_to,onChange:d,placeholder:"Staff member username or ID"})]}),e.jsxs("div",{className:"text-end",children:[e.jsx(f,{variant:"secondary",onClick:w,className:"me-2",children:"Cancel"}),e.jsx(f,{variant:"primary",type:"submit",children:"Create Ticket"})]})]})})]})]})}export{be as default};
