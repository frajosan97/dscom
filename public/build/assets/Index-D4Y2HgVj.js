import{r as d,j as e,a as y,$ as U}from"./app-BiuRToP-.js";import{S as Y}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{E as D}from"./ErpLayout-D0g2LxLo.js";import{w as H}from"./sweetalert2-react-content.es-DkzQCFd6.js";import{u as S,c as X,a as W,b as L,d as N}from"./index.esm-C-wRHYDi.js";import{M as b}from"./Modal-D2A1iNes.js";import{F as t,C as m}from"./Form-BA0l1WBA.js";import{R as F,I as v}from"./Footer-BFQJwEZ5.js";import{I as J,B as _,C as K}from"./Image---NnaHc0.js";import{S as Q}from"./Spinner-DbU-VvBa.js";import{B as Z}from"./ButtonGroup-mV9uetrb.js";import{C as G}from"./Card-CQupX1hM.js";import{T as ee}from"./Table-BQgD3-2Y.js";/* empty css                      */import"./hoist-non-react-statics.cjs-C-Qo8PK8.js";import"./CloseButton-B--YT67x.js";const ae=X().shape({name:N().required("Category name is required").max(255,"Category name must not exceed 255 characters"),icon:N().max(255,"Icon must not exceed 255 characters"),parent_id:N().nullable(),is_active:L(),is_featured:L(),order:W().integer("Must be an integer")});function te({showModal:w,setShowModal:u,formData:s,handleInputChange:g,handleFileChange:T,handleSubmit:C,isSubmitting:r,parentCategories:k}){const a=S({initialValues:{id:"",name:"",icon:"",description:"",parent_id:"",is_active:!0,is_featured:!1,image:null,meta_title:"",meta_description:"",order:0},validationSchema:ae,enableReinitialize:!0,onSubmit:o=>{C(o)}});return d.useEffect(()=>{s&&a.setValues({...a.values,...s,is_active:s.is_active!==void 0?s.is_active:!0,is_featured:s.is_featured!==void 0?s.is_featured:!1})},[s]),e.jsx(b,{centered:!0,show:w,onHide:()=>{r||(u(!1),a.resetForm())},backdrop:r?"static":!0,keyboard:!r,size:"lg",children:e.jsxs(t,{onSubmit:a.handleSubmit,noValidate:!0,children:[e.jsx(b.Header,{closeButton:!r,children:e.jsx(b.Title,{children:s.id?"Edit Category":"Create Category"})}),e.jsx(b.Body,{children:e.jsxs(F,{children:[e.jsxs(m,{md:8,children:[e.jsxs(t.Group,{className:"mb-3",children:[e.jsxs(t.Label,{children:["Category Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(v,{children:[e.jsx(v.Text,{children:e.jsx("i",{className:"bi bi-tag"})}),e.jsx(t.Control,{type:"text",name:"name",value:a.values.name,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.name&&!!a.errors.name,disabled:r,required:!0}),e.jsx(t.Control.Feedback,{type:"invalid",children:a.errors.name})]})]}),e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"Icon"}),e.jsxs(v,{children:[e.jsx(v.Text,{children:e.jsx("i",{className:"bi bi-emoji-smile"})}),e.jsx(t.Control,{type:"text",name:"icon",value:a.values.icon,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.icon&&!!a.errors.icon,disabled:r}),e.jsx(t.Control.Feedback,{type:"invalid",children:a.errors.icon})]}),e.jsx(t.Text,{className:"text-muted",children:'Enter icon class (e.g., "bi bi-arrow-right")'})]}),e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"Description"}),e.jsx(t.Control,{as:"textarea",rows:3,name:"description",value:a.values.description,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.description&&!!a.errors.description,disabled:r}),e.jsx(t.Control.Feedback,{type:"invalid",children:a.errors.description})]}),e.jsxs(F,{children:[e.jsx(m,{md:6,children:e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"Parent Category"}),e.jsxs(t.Select,{name:"parent_id",value:a.values.parent_id,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.parent_id&&!!a.errors.parent_id,disabled:r,children:[e.jsx("option",{value:"",children:"None (Top Level)"}),k.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]}),e.jsx(t.Control.Feedback,{type:"invalid",children:a.errors.parent_id})]})}),e.jsx(m,{md:6,children:e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"Order"}),e.jsx(t.Control,{type:"number",name:"order",value:a.values.order,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.order&&!!a.errors.order,disabled:r}),e.jsx(t.Control.Feedback,{type:"invalid",children:a.errors.order})]})})]})]}),e.jsxs(m,{md:4,children:[e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"Category Image"}),e.jsx(t.Control,{type:"file",accept:"image/*",onChange:o=>{a.setFieldValue("image",o.target.files[0]),T(o)},disabled:r}),(a.values.image||(s==null?void 0:s.image_url))&&e.jsxs("div",{className:"mt-3 text-center",children:[e.jsx(J,{src:typeof a.values.image=="string"?a.values.image:a.values.image?URL.createObjectURL(a.values.image):s==null?void 0:s.image_url,alt:"Image Preview",fluid:!0,thumbnail:!0,style:{maxHeight:"150px"}}),e.jsx(_,{variant:"link",size:"sm",className:"text-danger mt-2",onClick:()=>{a.setFieldValue("image",null)},disabled:r,children:"Remove Image"})]})]}),e.jsx(t.Group,{className:"mb-3",children:e.jsx(t.Check,{type:"switch",id:"is_active",name:"is_active",label:"Active",checked:a.values.is_active,onChange:a.handleChange,disabled:r})}),e.jsx(t.Group,{className:"mb-3",children:e.jsx(t.Check,{type:"switch",id:"is_featured",name:"is_featured",label:"Featured",checked:a.values.is_featured,onChange:a.handleChange,disabled:r})}),e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"Meta Title"}),e.jsx(t.Control,{type:"text",name:"meta_title",value:a.values.meta_title,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.meta_title&&!!a.errors.meta_title,disabled:r}),e.jsx(t.Control.Feedback,{type:"invalid",children:a.errors.meta_title})]}),e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"Meta Description"}),e.jsx(t.Control,{as:"textarea",rows:2,name:"meta_description",value:a.values.meta_description,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.meta_description&&!!a.errors.meta_description,disabled:r}),e.jsx(t.Control.Feedback,{type:"invalid",children:a.errors.meta_description})]})]})]})}),e.jsxs(b.Footer,{children:[e.jsx(_,{variant:"outline-danger",onClick:()=>{u(!1),a.resetForm()},disabled:r,children:"Cancel"}),e.jsx(_,{variant:"outline-light",type:"submit",disabled:r||!a.isValid,children:r?e.jsxs(e.Fragment,{children:[e.jsx(Q,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),e.jsx("span",{className:"ms-2",children:s.id?"Updating...":"Creating..."})]}):s.id?"Update":"Create"})]})]})})}const l=H(Y),R=()=>({id:"",name:"",slug:"",description:"",parent_id:null,image:null,icon:"",meta_title:"",meta_description:"",is_active:!1,is_featured:!1,order:0});function Ce(){const[w,u]=d.useState(!1),[s,g]=d.useState(R()),[T,C]=d.useState(!1),[r,k]=d.useState([]),a=d.useCallback(()=>{$.fn.DataTable.isDataTable("#categoriesTable")&&$("#categoriesTable").DataTable().ajax.reload(null,!1)},[]),o=d.useCallback(async()=>{try{const i=await y.get(route("api.categories"));k(i.data)}catch{l.fire("Error","Failed to load parent categories.","error")}},[]),I=d.useCallback(()=>{$.fn.DataTable.isDataTable("#categoriesTable")&&$("#categoriesTable").DataTable().destroy(),$("#categoriesTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("category.index"),type:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}},columns:[{data:"DT_RowIndex",name:"DT_RowIndex",title:"#",orderable:!1,searchable:!1,width:"5%"},{data:"image_preview",name:"image_preview",title:"Image"},{data:"icon",name:"icon",title:"Icon"},{data:"name",name:"name",title:"Name"},{data:"status_badge",name:"status_badge",title:"Status"},{data:"featured_badge",name:"featured_badge",title:"Is Featured"},{data:"products_count",name:"products_count",title:"Products Count"},{data:"action",name:"action",title:"Actions",orderable:!1,searchable:!1,width:"10%"}],order:[[0,"desc"]],drawCallback:()=>{$(".edit-btn").off("click").on("click",function(){const i=$(this).data("id");q(i)}),$(".delete-btn").off("click").on("click",function(){const i=$(this).data("id");z(i)})}})},[]),M=i=>{const{name:n,value:f,type:p,checked:h}=i.target;g(j=>({...j,[n]:p==="checkbox"?h:f}))},P=i=>{g(n=>({...n,image:i.target.files[0]}))},V=()=>{g(R()),u(!0)},q=async i=>{try{const n=await y.get(route("category.edit",i));g({...n.data,is_active:!!n.data.is_active,is_featured:!!n.data.is_featured}),u(!0)}catch{l.fire("Error","Failed to load category data.","error")}},z=async i=>{var f;if((await l.fire({title:"Delete Category?",text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await y.delete(route("category.destroy",i)),a(),l.fire("Deleted!","Category has been deleted.","success")}catch(p){let h="Delete failed.";((f=p.response)==null?void 0:f.status)===403&&(h="You don't have permission to delete this category."),l.fire("Error!",h,"error")}},A=async i=>{var p,h,j,E;const n=!!i.id;if((await l.fire({title:n?"Update category?":"Create category?",text:n?"Are you sure you want to update this category?":"Are you sure you want to create a new category?",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:n?"Yes, update it!":"Yes, create it!"})).isConfirmed){C(!0),l.fire({icon:"info",title:"Processing...",text:"Please wait...",allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>l.showLoading()});try{const c=new FormData;Object.entries(i).forEach(([O,B])=>{B!=null&&c.append(O,B)}),n&&c.append("_method","put");const x=n?route("category.update",i.id):route("category.store");await y.post(x,c,{headers:{"Content-Type":"multipart/form-data"}}),u(!1),a(),o(),l.fire("Success",`Category ${n?"updated":"created"} successfully.`,"success")}catch(c){let x="Failed to save category.";(h=(p=c.response)==null?void 0:p.data)!=null&&h.message?x=c.response.data.message:((j=c.response)==null?void 0:j.status)===422?x="Validation error. Please check your input.":((E=c.response)==null?void 0:E.status)===403&&(x="You don't have permission to perform this action."),l.fire("Error",x,"error")}finally{C(!1)}}};return d.useEffect(()=>(I(),o(),()=>{$.fn.DataTable.isDataTable("#categoriesTable")&&$("#categoriesTable").DataTable().destroy()}),[I,o]),e.jsxs(D,{children:[e.jsx(U,{title:"Categories"}),e.jsxs(K,{children:[e.jsxs(F,{className:"g-3",children:[e.jsxs(m,{md:12,className:"d-flex justify-content-between align-items-center",children:[e.jsx("h2",{className:"mb-0",children:"Categories"}),e.jsx(Z,{className:"gap-2",children:e.jsxs(_,{variant:"outline-primary",className:"rounded",onClick:V,children:[e.jsx("i",{className:"bi bi-plus-circle"})," ","Create Category"]})})]}),e.jsx(m,{md:12,children:e.jsx("hr",{className:"dashed-hr"})}),e.jsx(m,{md:12,children:e.jsx(G,{children:e.jsx(G.Body,{children:e.jsx(ee,{bordered:!0,striped:!0,hover:!0,responsive:!0,id:"categoriesTable",className:"w-100"})})})})]}),e.jsx(te,{showModal:w,setShowModal:u,formData:s,handleInputChange:M,handleFileChange:P,handleSubmit:A,isSubmitting:T,parentCategories:r})]})]})}export{Ce as default};
