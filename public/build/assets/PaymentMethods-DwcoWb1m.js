import{m as _,j as e,r as F}from"./app-C8okO_FY.js";import{u as w}from"./formik.esm-BfHSEgFn.js";import{c as E,a as h}from"./index.esm-Dfr3_SDK.js";import{y as q,R as P}from"./Footer-DnT14h8L.js";import{x as D}from"./axios-CrvAxd_j.js";import{M as p}from"./Modal-DFnRobbl.js";import{F as o,C as x,b as k}from"./Form-WKlbRvmM.js";import{B as y}from"./Image-eY5NvQ05.js";import{f as M}from"./helpers-DTZMUUc8.js";import{e as V,q as G,r as T,g as L}from"./index-5vgjvAW0.js";import{C as B}from"./Card-CMRoatnC.js";import{T as R}from"./Tabs-CoT3Pq-E.js";import{T as z}from"./Tab-Hgb5Jy1w.js";import{T as H}from"./Table-BgGj5UP2.js";const K=E().shape({name:h().required("Customer name is required").max(255,"Customer name must not exceed 255 characters"),email:h().email("Invalid email address").max(255,"Email must not exceed 255 characters"),phone:h().max(20,"Phone number must not exceed 20 characters"),tax_number:h().max(50,"Tax number must not exceed 50 characters"),address:h().max(500,"Address must not exceed 500 characters")});function le({show:C,onClose:d}){const r=w({initialValues:{name:"",email:"",phone:"",tax_number:"",address:""},validationSchema:K,onSubmit:async(b,{setSubmitting:m,resetForm:N})=>{var i,u;try{(await D.post(route("customers.store"),b)).data.success&&(q.success("Customer added successfully."),d(),_.reload())}catch(c){c.response&&c.response.data.errors?Object.entries(c.response.data.errors).forEach(([f,v])=>{v.forEach(g=>{q.error(`${f}: ${g}`)})}):q.error(((u=(i=c.response)==null?void 0:i.data)==null?void 0:u.message)||"An error occurred while adding the customer")}finally{m(!1)}}});return e.jsxs(p,{show:C,onHide:d,size:"lg",centered:!0,children:[e.jsx(p.Header,{closeButton:!0,className:"border-bottom-0",children:e.jsx(p.Title,{className:"h5",children:"Add New Customer"})}),e.jsxs(o,{onSubmit:r.handleSubmit,noValidate:!0,children:[e.jsx(p.Body,{className:"pt-0",children:e.jsxs(P,{children:[e.jsx(x,{md:6,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsxs(o.Label,{children:["Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(o.Control,{type:"text",name:"name",placeholder:"Customer name",value:r.values.name,onChange:r.handleChange,onBlur:r.handleBlur,isInvalid:r.touched.name&&!!r.errors.name,required:!0}),e.jsx(o.Control.Feedback,{type:"invalid",children:r.errors.name})]})}),e.jsx(x,{md:6,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Email"}),e.jsx(o.Control,{type:"email",name:"email",placeholder:"Customer email",value:r.values.email,onChange:r.handleChange,onBlur:r.handleBlur,isInvalid:r.touched.email&&!!r.errors.email}),e.jsx(o.Control.Feedback,{type:"invalid",children:r.errors.email})]})}),e.jsx(x,{md:6,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Phone"}),e.jsx(o.Control,{type:"text",name:"phone",placeholder:"Phone number",value:r.values.phone,onChange:r.handleChange,onBlur:r.handleBlur,isInvalid:r.touched.phone&&!!r.errors.phone}),e.jsx(o.Control.Feedback,{type:"invalid",children:r.errors.phone})]})}),e.jsx(x,{md:6,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Tax Number"}),e.jsx(o.Control,{type:"text",name:"tax_number",placeholder:"Tax identification number",value:r.values.tax_number,onChange:r.handleChange,onBlur:r.handleBlur,isInvalid:r.touched.tax_number&&!!r.errors.tax_number}),e.jsx(o.Control.Feedback,{type:"invalid",children:r.errors.tax_number})]})}),e.jsx(x,{md:12,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Address"}),e.jsx(o.Control,{as:"textarea",rows:3,name:"address",placeholder:"Full address",value:r.values.address,onChange:r.handleChange,onBlur:r.handleBlur,isInvalid:r.touched.address&&!!r.errors.address}),e.jsx(o.Control.Feedback,{type:"invalid",children:r.errors.address})]})})]})}),e.jsxs(p.Footer,{className:"border-top-0",children:[e.jsx(y,{variant:"outline-secondary",onClick:d,children:"Cancel"}),e.jsx(y,{variant:"primary",type:"submit",disabled:r.isSubmitting,children:r.isSubmitting?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Saving..."]}):"Save Customer"})]})]})]})}const ie=({paymentData:C,setPaymentData:d})=>{const r={cash:{icon:e.jsx(T,{className:"me-2"}),label:"Cash",fields:{date:{type:"date",placeholder:"Date"},name:{type:"text",placeholder:"Name"},phone:{type:"text",placeholder:"Phone Number"},amount:{type:"number",placeholder:"Amount"}},required:{name:"Name is required",phone:"Valid phone number is required",amount:"Valid amount is required"}},mpesa:{icon:e.jsx(T,{className:"me-2"}),label:"M-Pesa",fields:{date:{type:"date",placeholder:"Date"},transId:{type:"text",placeholder:"Transaction ID"},name:{type:"text",placeholder:"Name"},phone:{type:"text",placeholder:"Phone Number"},amount:{type:"number",placeholder:"Amount"}},required:{transId:"Transaction ID is required",name:"Name is required",phone:"Valid phone number is required",amount:"Valid amount is required"}},cheque:{icon:e.jsx(G,{className:"me-2"}),label:"Cheque",fields:{date:{type:"date",placeholder:"Date"},bankName:{type:"text",placeholder:"Bank Name"},branch:{type:"text",placeholder:"Branch"},chequeNo:{type:"text",placeholder:"Cheque No"},account:{type:"text",placeholder:"Account"},amount:{type:"number",placeholder:"Amount"}},required:{chequeNo:"Cheque number is required",bankName:"Bank name is required",account:"Account is required",branch:"Branch is required",amount:"Valid amount is required"}}},b=Object.fromEntries(Object.entries(r).map(([a,n])=>[a,Object.fromEntries(Object.keys(n.fields).map(t=>[t,t==="date"?new Date().toISOString().split("T")[0]:""]))])),[m,N]=F.useState(b),[i,u]=F.useState({}),c=Object.keys(r)[0]||null,[f,v]=F.useState(c),g=(a,n,t)=>{N(s=>({...s,[a]:{...s[a],[n]:t}})),i[`${a}_${n}`]&&u(s=>({...s,[`${a}_${n}`]:""}))},$=a=>{const n=m[a],t=r[a].required,s={};for(const[l,j]of Object.entries(t))(!n[l]||l==="amount"&&parseFloat(n[l])<=0)&&(s[`${a}_${l}`]=j),l==="phone"&&n.phone&&n.phone.length<10&&(s[`${a}_${l}`]=j);return u(s),Object.keys(s).length===0},S=a=>{if(!$(a))return;const n=m[a],t={id:Date.now(),...n,amount:parseFloat(n.amount)};d(s=>({...s,[a]:[...s[a]||[],t],balanceAccount:s.balanceAccount+t.amount})),N(s=>({...s,[a]:{...b[a],date:new Date().toISOString().split("T")[0]}}))},A=(a,n)=>{d(t=>{const s=t[a].find(l=>l.id===n);return{...t,[a]:t[a].filter(l=>l.id!==n),balanceAccount:t.balanceAccount-((s==null?void 0:s.amount)||0)}})},I=a=>{const n=m[a],t=r[a].fields;return Object.entries(t).map(([s,l])=>e.jsxs("td",{className:"p-1",children:[e.jsx(k,{type:l.type,placeholder:l.placeholder,value:n[s],onChange:j=>g(a,s,j.target.value),className:"rounded-0",isInvalid:!!i[`${a}_${s}`]}),i[`${a}_${s}`]&&e.jsx(k.Feedback,{type:"invalid",children:i[`${a}_${s}`]})]},s))},O=a=>{const n=C[a]||[],t=Object.keys(r[a].fields);return n.length>0?n.map(s=>e.jsxs("tr",{children:[t.map(l=>e.jsx("td",{children:l==="amount"?M(s[l]):s[l]},l)),e.jsx("td",{children:e.jsx(y,{variant:"danger",size:"sm",className:"rounded-0",onClick:()=>A(a,s.id),children:e.jsx(L,{})})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:t.length+1,className:"text-center",children:"No transactions found"})})};return e.jsx(B,{className:"border-0 rounded-0 shadow-sm mt-2",children:e.jsx(B.Body,{children:e.jsx(R,{activeKey:f,onSelect:v,transition:!1,children:Object.entries(r).map(([a,n])=>e.jsx(z,{eventKey:a,title:e.jsxs(e.Fragment,{children:[n.icon,n.label]}),children:e.jsxs(H,{striped:!0,responsive:!0,bordered:!0,hover:!0,size:"sm",className:"mt-3",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[Object.keys(n.fields).map(t=>e.jsx("th",{children:n.fields[t].placeholder},t)),e.jsx("th",{children:"Action"})]})}),e.jsxs("tbody",{children:[O(a),e.jsxs("tr",{className:"bg-light",children:[I(a),e.jsx("td",{className:"p-1",style:{width:"1px"},children:e.jsx(y,{variant:"success",className:"rounded-0",onClick:()=>S(a),children:e.jsx(V,{})})})]})]})]})},a))})})})};export{le as C,ie as P};
