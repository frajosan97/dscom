import{j as e,r as c,$ as q}from"./app-Dbf3h8vH.js";import{R as C,N as u,y as p}from"./Footer-BrnbheST.js";import{f as F}from"./helpers-BIQDmtTa.js";import{E as G}from"./ErpLayout-3UAfEC8K.js";import{u as K}from"./formik.esm-Cv2n-1MR.js";import{c as L,e as z,b as k,d as m,a as B}from"./index.esm-CV1EtPjf.js";import{x as D}from"./axios-DNHxlns_.js";import{u as E}from"./useData-CwLsMuws.js";import{M as j}from"./Modal--xVl4yVJ.js";import{F as s,C as o}from"./Form-CoztAQ2q.js";import{T as b}from"./Tab-CpCcWqUn.js";import{B as P}from"./Image-D1nToII8.js";import{S as T}from"./sweetalert2.esm.all-DpIEGYsy.js";import{C as N}from"./Card-BRq3Nmlv.js";import{B as A}from"./ButtonGroup-DDvgUvx3.js";import{P as W}from"./plus-circle-CMeG2tE8.js";import{T as H}from"./Table-CjjJdV2-.js";import"./CloseButton-Do14r1LH.js";/* empty css                      */function V({show:g,onHide:d,onSuccess:v,service:r}){var f,y;const x=!!r,{deviceTypes:_}=E(),S=L().shape({name:B().required("Name is required"),slug:B().required("Slug is required"),base_price:m().required("Base price is required").min(0,"Price must be positive"),estimated_duration:m().nullable().min(0,"Duration must be positive"),warranty_days:m().nullable().min(0,"Warranty days must be positive"),is_active:k(),is_featured:k(),device_types:z().of(L().shape({id:m().required(),price:m().required("Price is required").min(0,"Price must be positive"),min_price:m().nullable().min(0,"Min price must be positive"),max_price:m().nullable().min(0,"Max price must be positive"),is_flat_rate:k(),price_notes:B().nullable()}))}),a=K({enableReinitialize:!0,initialValues:{name:(r==null?void 0:r.name)||"",slug:(r==null?void 0:r.slug)||"",description:(r==null?void 0:r.description)||"",detailed_description:(r==null?void 0:r.detailed_description)||"",repair_process:(r==null?void 0:r.repair_process)||"",base_price:(r==null?void 0:r.base_price)||0,estimated_duration:(r==null?void 0:r.estimated_duration)||null,warranty_days:(r==null?void 0:r.warranty_days)||null,is_active:(r==null?void 0:r.is_active)??!0,is_featured:(r==null?void 0:r.is_featured)??!1,image:(r==null?void 0:r.image)||null,device_types:((f=r==null?void 0:r.device_types)==null?void 0:f.map(t=>({id:t.id,name:t.name,price:t.pivot.price,min_price:t.pivot.min_price,max_price:t.pivot.max_price,is_flat_rate:t.pivot.is_flat_rate,price_notes:t.pivot.price_notes})))||_.map(t=>({id:t.id,name:t.name,price:0,min_price:null,max_price:null,is_flat_rate:!1,price_notes:""})),_method:x?"PUT":"POST"},validationSchema:S,onSubmit:async(t,{setSubmitting:i,setErrors:h})=>{try{const l=x?route("repair-service.update",r.id):route("repair-service.store"),n=await D.post(l,t);n.data.success===!0?(p.success(n.data.message),v()):p.error(n.data.message),d()}catch(l){console.log(l),p.error(l.response.data.message)}finally{i(!1)}}});return e.jsxs(j,{show:g,onHide:d,size:"xl",centered:!0,backdrop:"static",children:[e.jsx(j.Header,{closeButton:!0,children:e.jsx(j.Title,{children:x?"Edit Repair Service":"Create New Repair Service"})}),e.jsxs(s,{onSubmit:a.handleSubmit,children:[e.jsx(j.Body,{children:e.jsx(b.Container,{defaultActiveKey:"basic",children:e.jsxs(C,{children:[e.jsx(o,{md:3,children:e.jsxs(u,{variant:"pills",className:"flex-column",children:[e.jsx(u.Item,{children:e.jsx(u.Link,{eventKey:"basic",children:"Basic Information"})}),e.jsx(u.Item,{children:e.jsx(u.Link,{eventKey:"pricing",children:"Pricing by Device"})}),e.jsx(u.Item,{children:e.jsx(u.Link,{eventKey:"details",children:"Service Details"})})]})}),e.jsx(o,{md:9,children:e.jsxs(b.Content,{children:[e.jsxs(b.Pane,{eventKey:"basic",children:[e.jsxs(C,{className:"mb-3",children:[e.jsx(o,{md:6,children:e.jsxs(s.Group,{controlId:"name",children:[e.jsx(s.Label,{children:"Service Name *"}),e.jsx(s.Control,{type:"text",name:"name",value:a.values.name,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.name&&!!a.errors.name}),e.jsx(s.Control.Feedback,{type:"invalid",children:a.errors.name})]})}),e.jsx(o,{md:6,children:e.jsxs(s.Group,{controlId:"slug",children:[e.jsx(s.Label,{children:"Slug *"}),e.jsx(s.Control,{type:"text",name:"slug",value:a.values.slug,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.slug&&!!a.errors.slug}),e.jsx(s.Control.Feedback,{type:"invalid",children:a.errors.slug})]})})]}),e.jsxs(C,{className:"mb-3",children:[e.jsx(o,{md:4,children:e.jsxs(s.Group,{controlId:"base_price",children:[e.jsx(s.Label,{children:"Base Price (â‚¦) *"}),e.jsx(s.Control,{type:"number",min:"0",step:"0.01",name:"base_price",value:a.values.base_price,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.base_price&&!!a.errors.base_price}),e.jsx(s.Control.Feedback,{type:"invalid",children:a.errors.base_price})]})}),e.jsx(o,{md:4,children:e.jsxs(s.Group,{controlId:"estimated_duration",children:[e.jsx(s.Label,{children:"Estimated Duration (minutes)"}),e.jsx(s.Control,{type:"number",min:"0",name:"estimated_duration",value:a.values.estimated_duration||"",onChange:a.handleChange})]})}),e.jsx(o,{md:4,children:e.jsxs(s.Group,{controlId:"warranty_days",children:[e.jsx(s.Label,{children:"Warranty (days)"}),e.jsx(s.Control,{type:"number",min:"0",name:"warranty_days",value:a.values.warranty_days||"",onChange:a.handleChange})]})})]}),e.jsxs(C,{className:"mb-3",children:[e.jsx(o,{children:e.jsx(s.Check,{type:"switch",id:"is_active",label:"Active",checked:a.values.is_active,onChange:a.handleChange,name:"is_active"})}),e.jsx(o,{children:e.jsx(s.Check,{type:"switch",id:"is_featured",label:"Featured",checked:a.values.is_featured,onChange:a.handleChange,name:"is_featured"})})]}),e.jsxs(s.Group,{controlId:"description",className:"mb-3",children:[e.jsx(s.Label,{children:"Short Description"}),e.jsx(s.Control,{as:"textarea",rows:3,name:"description",value:a.values.description,onChange:a.handleChange})]})]}),e.jsxs(b.Pane,{eventKey:"pricing",children:[e.jsx("h5",{className:"mb-3",children:"Device Type Pricing"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Device Type"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Min Price"}),e.jsx("th",{children:"Max Price"}),e.jsx("th",{children:"Flat Rate"}),e.jsx("th",{children:"Notes"})]})}),e.jsx("tbody",{children:(y=a.values.device_types)==null?void 0:y.map((t,i)=>e.jsxs("tr",{children:[e.jsx("td",{children:t.name}),e.jsx("td",{children:e.jsx(s.Control,{type:"number",min:"0",step:"0.01",name:`device_types[${i}].price`,value:t.price,onChange:a.handleChange,onBlur:a.handleBlur})}),e.jsx("td",{children:e.jsx(s.Control,{type:"number",min:"0",step:"0.01",name:`device_types[${i}].min_price`,value:t.min_price||"",onChange:a.handleChange,onBlur:a.handleBlur})}),e.jsx("td",{children:e.jsx(s.Control,{type:"number",min:"0",step:"0.01",name:`device_types[${i}].max_price`,value:t.max_price||"",onChange:a.handleChange,onBlur:a.handleBlur})}),e.jsx("td",{className:"text-center",children:e.jsx(s.Check,{type:"switch",name:`device_types[${i}].is_flat_rate`,checked:t.is_flat_rate,onChange:h=>{a.setFieldValue(`device_types[${i}].is_flat_rate`,h.target.checked)}})}),e.jsx("td",{children:e.jsx(s.Control,{type:"text",name:`device_types[${i}].price_notes`,value:t.price_notes||"",onChange:a.handleChange,onBlur:a.handleBlur})})]},t.id))})]})})]}),e.jsxs(b.Pane,{eventKey:"details",children:[e.jsxs(s.Group,{controlId:"detailed_description",className:"mb-3",children:[e.jsx(s.Label,{children:"Detailed Description"}),e.jsx(s.Control,{as:"textarea",rows:5,name:"detailed_description",value:a.values.detailed_description,onChange:a.handleChange})]}),e.jsxs(s.Group,{controlId:"repair_process",className:"mb-3",children:[e.jsx(s.Label,{children:"Repair Process"}),e.jsx(s.Control,{as:"textarea",rows:5,name:"repair_process",value:a.values.repair_process,onChange:a.handleChange})]})]})]})})]})})}),e.jsxs(j.Footer,{children:[e.jsx(P,{variant:"secondary",onClick:d,children:"Cancel"}),e.jsx(P,{variant:"primary",type:"submit",disabled:a.isSubmitting,children:a.isSubmitting?"Saving...":"Save Changes"})]})]})]})}function me(){const[g,d]=c.useState(!1),[v,r]=c.useState(null),{deviceTypes:x}=E(),_=c.useCallback(()=>{$.fn.DataTable.isDataTable("#repairServicesTable")&&$("#repairServicesTable").DataTable().destroy(),$("#repairServicesTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("repair-service.index"),type:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}},columns:[{data:"name",name:"name",title:"Service Name"},{data:"base_price",name:"base_price",title:"Base Price",render:function(i){return F(i)||"0"}},{data:"status",name:"status",title:"Status"},{data:"action",name:"action",title:"Actions",orderable:!1,searchable:!1,width:"10%"}],order:[[0,"desc"]],drawCallback:()=>{$(".edit-btn").off("click").on("click",function(){const i=$(this).data("id");y(i)}),$(".delete-btn").off("click").on("click",function(){const i=$(this).data("id");t(i)})}})},[]);c.useEffect(()=>{_()},[_]);const S=c.useCallback(()=>{r(null),d(!0)},[]),a=c.useCallback(()=>{d(!1),r(null)},[]),f=c.useCallback(i=>{p.success(i),$("#repairServicesTable").DataTable().ajax.reload(null,!1),d(!1)},[]),y=async i=>{var h,l;try{const n=await D.get(route("repair-service.edit",i));n.data.success===!0?(r(n.data.data),d(!0)):p.error(n.data.message)}catch(n){p.error(((l=(h=n.response)==null?void 0:h.data)==null?void 0:l.message)||"An error occurred")}},t=async i=>{var l,n,R,M;if((await T.fire({title:"Delete Repair Service?",text:"This cannot be undone. Make sure there are no orders associated with this service.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await D.delete(route("repair-service.destroy",i)),$("#repairServicesTable").DataTable().ajax.reload(null,!1),T.fire("Deleted!","Repair service has been deleted.","success")}catch(I){let w="Delete failed.";((l=I.response)==null?void 0:l.status)===403?w="You don't have permission to delete this service.":(M=(R=(n=I.response)==null?void 0:n.data)==null?void 0:R.message)!=null&&M.includes("existing orders")&&(w="Cannot delete service with existing orders."),T.fire("Error!",w,"error")}};return e.jsxs(G,{children:[e.jsx(q,{title:"Repair Services Management"}),e.jsxs(N,{className:"border-0 rounded-0 shadow-sm",children:[e.jsxs(N.Header,{className:"d-flex justify-content-between align-items-center bg-transparent",children:[e.jsx("h6",{className:"mb-0 fw-semibold",children:"Repair Services Management"}),e.jsx(A,{children:e.jsxs(P,{variant:"outline-secondary",size:"sm",className:"rounded-1 d-flex align-items-center",onClick:S,children:[e.jsx(W,{className:"me-1"}),"New Service"]})})]}),e.jsx(N.Body,{className:"px-0",children:e.jsx(H,{bordered:!0,striped:!0,hover:!0,responsive:!0,id:"repairServicesTable",className:"w-100"})})]}),e.jsx(V,{show:g,onHide:a,service:v,deviceTypes:x,onSuccess:f})]})}export{me as default};
