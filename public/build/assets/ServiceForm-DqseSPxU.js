import{r as m,j as e,$ as Ne,b as ye}from"./app-CcdzEu0R.js";import{y as M,R as b,I as w,N as z}from"./Footer-4Livvlxt.js";import{E as _e}from"./ErpLayout-u_y7Ersr.js";import{x as Ce}from"./axios-COTtbvZI.js";import{m as we,n as Se,h as ke,i as Fe,j as Le,k as je}from"./index-BMkeTrLY.js";import{C as Ae,P as Pe}from"./PaymentMethods-C6mLRo8L.js";import{C as h}from"./Card-CSAU_t4j.js";import{F as n,C as r,b as E}from"./Form-CLPTCCgE.js";import{L as H}from"./ListGroup-Dslilh18.js";import{S as V}from"./react-select.esm-BQQQSlpr.js";import{u as fe}from"./useData-CRgTl60a.js";import{f as I}from"./helpers-B9XmgPRl.js";import{S as B}from"./sweetalert2.esm.all-DpIEGYsy.js";import{T as G}from"./Tab-B5PsefMC.js";import{B as U}from"./Image-D_GvnDn_.js";import"./CloseButton-Bv_xupVB.js";/* empty css                      */import"./iconBase-CciruWzR.js";import"./formik.esm-pgZf8OxT.js";import"./index.esm-lEXyK6iT.js";import"./Modal-BeCmzXVe.js";import"./Tabs-CvU7mztw.js";import"./Table-D-OHgQ10.js";const Te=({customerData:s,setCustomerData:x})=>{const[o,u]=m.useState("customer"),[c,g]=m.useState(!1),[d,l]=m.useState(s==null?void 0:s.customer_name),[i,y]=m.useState([]),[F,p]=m.useState(!1),[t,N]=m.useState(!1),j=m.useRef(null),P=m.useRef(null),f=m.useMemo(()=>["customer","dealer"].map(a=>({value:a,label:a.charAt(0).toUpperCase()+a.slice(1)})),[]),O=m.useCallback(async a=>{var S,T;if(a.length<2){p(!1),y([]);return}N(!0);try{const{data:A}=await Ce.get(route("api.customer.search"),{params:{value:a}});A.success?(y(A.customers||[]),p(!0)):(M.error(A.message),p(!1))}catch(A){M.error(((T=(S=A.response)==null?void 0:S.data)==null?void 0:T.message)||"An error occurred"),p(!1)}finally{N(!1)}},[]),J=m.useCallback(a=>{const S=a.target.value;l(S),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{O(S)},500)},[O]),q=m.useCallback(a=>{x({customer_id:a.id,customer_name:a.full_name,customer_phone:a.phone,customer_email:a.email,customer_address:a.address,customer_city:a.city,customer_country:a.country}),l(a.full_name),p(!1)},[x]),K=m.useCallback(()=>{g(!0),p(!1)},[]);return m.useEffect(()=>{const a=S=>{P.current&&!P.current.contains(S.target)&&p(!1)};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[]),m.useEffect(()=>()=>{j.current&&clearTimeout(j.current)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(h,{className:"border-0 rounded-0 shadow-sm mb-3",children:[e.jsxs(h.Header,{className:"bg-transparent d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"mb-0 fw-semibold text-capitalize",children:[o," Information"]}),e.jsx("div",{className:"d-flex gap-3",children:f.map(({value:a,label:S})=>e.jsx(n.Check,{inline:!0,type:"radio",id:`is${a}`,label:S,name:"customerType",value:a,checked:o===a,onChange:T=>u(T.target.value),className:"fw-medium"},a))})]}),e.jsx(h.Body,{className:"p-4",children:e.jsxs(b,{children:[e.jsx(r,{md:12,className:"mb-3",ref:P,children:e.jsxs(w,{children:[e.jsx(w.Text,{className:"rounded-0",children:e.jsx(we,{})}),e.jsx(n.Control,{type:"search",placeholder:"Search customer by name, phone, or email...",className:"rounded-0",value:d,onChange:J,onFocus:()=>d.length>1&&p(!0)}),e.jsx(w.Text,{className:"rounded-0 cursor-pointer",onClick:K,children:e.jsx(Se,{})}),F&&e.jsx(H,{className:"position-absolute rounded-0 w-100",style:{zIndex:1050,top:"100%"},children:t?e.jsx(H.Item,{className:"rounded-0 text-center",children:"Searching..."}):i.length>0?i.map(a=>e.jsxs(H.Item,{action:!0,onClick:()=>q(a),className:"rounded-0",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"fw-medium",children:a.full_name||a.name}),e.jsx("small",{className:"text-muted",children:a.phone})]}),a.email&&e.jsx("div",{className:"small text-muted text-truncate",children:a.email})]},a.id)):e.jsx(H.Item,{className:"rounded-0 text-center text-muted",children:"No customers found"})})]})}),e.jsx(r,{md:4,className:"mb-3",children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Customer Name"}),e.jsx(n.Control,{type:"text",value:s.customer_name||"",readOnly:!0,className:"bg-light"})]})}),e.jsx(r,{md:4,className:"mb-3",children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Phone"}),e.jsx(n.Control,{type:"text",value:s.customer_phone||"",readOnly:!0,className:"bg-light"})]})}),e.jsx(r,{md:4,className:"mb-3",children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Email"}),e.jsx(n.Control,{type:"email",value:s.customer_email||"",readOnly:!0,className:"bg-light"})]})}),e.jsxs(r,{md:6,className:"mb-3",children:[e.jsx(n.Label,{className:"fw-medium",children:"Address"}),e.jsx(n.Control,{type:"text",value:s.customer_address||"",placeholder:"Auto-filled address",disabled:!0,className:"bg-light"})]}),e.jsxs(r,{md:3,className:"mb-3",children:[e.jsx(n.Label,{className:"fw-medium",children:"City"}),e.jsx(n.Control,{type:"text",value:s.customer_city||"",placeholder:"Auto-filled city",disabled:!0,className:"bg-light"})]}),e.jsxs(r,{md:3,className:"mb-3",children:[e.jsx(n.Label,{className:"fw-medium",children:"Country"}),e.jsx(n.Control,{type:"text",value:s.customer_country||"",placeholder:"Auto-filled country",disabled:!0,className:"bg-light"})]})]})})]}),e.jsx(Ae,{show:c,onHide:()=>g(!1),onClose:()=>g(!1)})]})},Ge=({initialCheckData:s,setInitialCheckData:x})=>{const o=["Display","Back Panel","Devices Status","Hello"],u=["Sim Tray","Back Panel","Battery","Sim","Headset","Cover","Tes"],c=(d,l)=>{x(i=>({...i,status:{...i.status,[d]:l}}))},g=d=>{x(l=>{var i;return{...l,accessories:{...l.accessories,[d]:!((i=l.accessories)!=null&&i[d])}}})};return e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"mb-4 g-3",children:o.map((d,l)=>{var i,y,F,p;return e.jsx(r,{md:3,children:e.jsx(h,{className:"border-0 shadow-sm h-100",children:e.jsxs(h.Body,{children:[e.jsx(h.Title,{className:"fs-6 mb-3 text-capitalize",children:d}),e.jsxs("div",{className:"d-flex flex-column gap-1",children:[e.jsx(n.Check,{type:"radio",label:"Working",name:`status-${l}`,checked:((i=s==null?void 0:s.status)==null?void 0:i[d])==="Working",onChange:()=>c(d,"Working")}),e.jsx(n.Check,{type:"radio",label:"Not Working",name:`status-${l}`,checked:((y=s==null?void 0:s.status)==null?void 0:y[d])==="Not Working",onChange:()=>c(d,"Not Working")}),e.jsx(n.Check,{type:"radio",label:"Not Checked",name:`status-${l}`,checked:!((F=s==null?void 0:s.status)!=null&&F[d])||((p=s==null?void 0:s.status)==null?void 0:p[d])==="Not Checked",onChange:()=>c(d,"Not Checked")})]})]})})},l)})}),e.jsxs(b,{className:"mb-4 g-3",children:[e.jsx(r,{md:6,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Physical Condition"}),e.jsx(V,{placeholder:"Search Physical Conditions",value:s!=null&&s.physicalCondition?{label:s.physicalCondition,value:s.physicalCondition}:null,onChange:d=>x(l=>({...l,physicalCondition:(d==null?void 0:d.value)||""})),options:[{value:"Good",label:"Good"},{value:"Average",label:"Average"},{value:"Poor",label:"Poor"}]})]})}),e.jsx(r,{md:6,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Risk Agreed By Customer"}),e.jsx(V,{placeholder:"Search Risk Agreements",value:s!=null&&s.riskAgreement?{label:s.riskAgreement,value:s.riskAgreement}:null,onChange:d=>x(l=>({...l,riskAgreement:(d==null?void 0:d.value)||""})),options:[{value:"Screen Replacement",label:"Screen Replacement"},{value:"Data Loss",label:"Data Loss"},{value:"Other",label:"Other"}]})]})})]}),e.jsxs(h,{className:"border-0 shadow-sm",children:[e.jsxs(h.Header,{className:"bg-white fw-bold",children:["Accessories",e.jsx("div",{className:"fw-normal small",children:"Subtitle"})]}),e.jsx(h.Body,{children:e.jsxs(b,{className:"g-3",children:[e.jsx(r,{md:8,children:e.jsx(n.Group,{className:"d-flex flex-wrap gap-3",children:u.map((d,l)=>{var i;return e.jsx(n.Check,{type:"checkbox",id:`acc-${l}`,label:d,checked:!!((i=s==null?void 0:s.accessories)!=null&&i[d]),onChange:()=>g(d)},l)})})}),e.jsx(r,{md:4,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Other Remarks"}),e.jsx(n.Control,{as:"textarea",rows:2,placeholder:"Other Remarks",value:(s==null?void 0:s.remarks)||"",onChange:d=>x(l=>({...l,remarks:d.target.value}))})]})})]})})]})]})},Oe=({jobDetailsData:s,setJobDetailsData:x,errors:o={}})=>{const{services:u}=fe(),c=(l,i)=>{x(y=>({...y,[l]:i}))},g=u==null?void 0:u.map(l=>({value:l.id,label:l.name})),d=m.useMemo(()=>s!=null&&s.repair_service_id?g.find(i=>i.value===s.repair_service_id)||{value:s.repair_service_id,label:"Name"}:null,[s==null?void 0:s.repair_service_id,g]);return e.jsxs(e.Fragment,{children:[e.jsxs(h,{className:"border-0 rounded-0 shadow-sm mb-3",children:[e.jsx(h.Header,{className:"bg-transparent fw-semibold",children:"Job Information"}),e.jsx(h.Body,{children:e.jsxs(b,{className:"g-3",children:[e.jsx(r,{md:4,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{htmlFor:"orderNumber",children:"Job Number"}),e.jsx(n.Control,{id:"orderNumber",type:"text",value:(s==null?void 0:s.order_number)||"",placeholder:"Auto-generated",disabled:!0,className:"bg-light"})]})}),e.jsx(r,{md:4,children:e.jsxs(n.Group,{children:[e.jsxs(n.Label,{htmlFor:"entryDate",children:["Entry Date"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(n.Control,{id:"entryDate",type:"date",value:(s==null?void 0:s.entry_date)||"",onChange:l=>c("entry_date",l.target.value),isInvalid:!!o.entry_date,required:!0}),e.jsx(n.Control.Feedback,{type:"invalid",children:o.entry_date})]})}),e.jsx(r,{md:4,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Warranty Status"}),e.jsx("div",{children:[{value:"out",label:"Out Warranty"},{value:"on",label:"On Warranty"}].map(l=>e.jsx(n.Check,{inline:!0,type:"radio",id:`warranty-${l.value}`,label:l.label,name:"warranty",value:l.value,checked:(s==null?void 0:s.warranty)===l.value,onChange:i=>c("warranty",i.target.value),className:"fw-medium"},l.value))}),o.warranty&&e.jsx("div",{className:"invalid-feedback d-block",children:o.warranty})]})})]})})]}),e.jsxs(b,{children:[e.jsx(r,{md:6,children:e.jsxs(h,{className:"border-0 rounded-0 shadow-sm mb-3",children:[e.jsx(h.Header,{className:"bg-transparent fw-semibold",children:"Device Information"}),e.jsx(h.Body,{children:e.jsxs(b,{className:"g-3",children:[e.jsx(r,{md:6,children:e.jsxs(n.Group,{children:[e.jsxs(n.Label,{htmlFor:"company",children:["Company"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(n.Control,{id:"company",value:(s==null?void 0:s.company)||"",onChange:l=>c("company",l.target.value),placeholder:"Search Company",isInvalid:!!o.company,required:!0}),e.jsx(n.Control.Feedback,{type:"invalid",children:o.company})]})}),e.jsx(r,{md:6,children:e.jsxs(n.Group,{children:[e.jsxs(n.Label,{htmlFor:"brand",children:["brand"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(n.Control,{id:"brand",value:(s==null?void 0:s.brand)||"",onChange:l=>c("brand",l.target.value),placeholder:"Select brand",isInvalid:!!o.brand,required:!0}),e.jsx(n.Control.Feedback,{type:"invalid",children:o.brand})]})}),e.jsx(r,{md:6,children:e.jsxs(n.Group,{children:[e.jsxs(n.Label,{htmlFor:"model",children:["Model"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(n.Control,{id:"model",value:(s==null?void 0:s.model)||"",onChange:l=>c("model",l.target.value),placeholder:"Select Model",isInvalid:!!o.model,required:!0}),e.jsx(n.Control.Feedback,{type:"invalid",children:o.model})]})}),e.jsx(r,{md:6,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{htmlFor:"color",children:"Color"}),e.jsx(n.Control,{id:"color",value:(s==null?void 0:s.color)||"",onChange:l=>c("color",l.target.value),placeholder:"Device Color"})]})}),e.jsx(r,{md:6,children:e.jsxs(n.Group,{children:[e.jsxs(n.Label,{htmlFor:"imeiSerial",children:["IMEI/Serial"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(n.Control,{id:"imeiSerial",value:(s==null?void 0:s.serial)||"",onChange:l=>c("serial",l.target.value),placeholder:"IMEI / Serial",isInvalid:!!o.serial,required:!0}),e.jsx(n.Control.Feedback,{type:"invalid",children:o.serial})]})}),e.jsx(r,{md:6,children:e.jsxs(n.Group,{children:[e.jsxs(n.Label,{htmlFor:"devicePassword",children:["Device Password"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(n.Control,{id:"devicePassword",type:"text",value:(s==null?void 0:s.password)||"",onChange:l=>c("password",l.target.value),placeholder:"Device Password",isInvalid:!!o.password,required:!0}),e.jsx(n.Control.Feedback,{type:"invalid",children:o.password})]})}),e.jsx(r,{md:6,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{htmlFor:"providerInfo",children:"Provider Information"}),e.jsx(n.Control,{id:"providerInfo",as:"textarea",rows:1,value:(s==null?void 0:s.provider)||"",onChange:l=>c("provider",l.target.value),placeholder:"Provider Information"})]})}),e.jsx(r,{md:6,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{htmlFor:"specsInfo",children:"Device Specifications"}),e.jsx(n.Control,{id:"specsInfo",as:"textarea",rows:1,value:(s==null?void 0:s.specs)||"",onChange:l=>c("specs",l.target.value),placeholder:"Device Specifications"})]})}),e.jsx(r,{md:12,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{htmlFor:"issueDescription",children:"Issue Identified"}),e.jsx(n.Control,{id:"issueDescription",as:"textarea",rows:1,value:(s==null?void 0:s.issue)||"",onChange:l=>c("issue",l.target.value),placeholder:"Issue Identified"})]})}),e.jsx(r,{md:12,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{htmlFor:"remarksDescription",children:"Remarks"}),e.jsx(n.Control,{id:"remarksDescription",as:"textarea",rows:1,value:(s==null?void 0:s.remarks)||"",onChange:l=>c("remarks",l.target.value),placeholder:"Remarks"})]})})]})})]})}),e.jsx(r,{md:6,children:e.jsxs(h,{className:"border-0 rounded-0 shadow-sm mb-3",children:[e.jsx(h.Header,{className:"bg-transparent fw-semibold",children:"Complaint Details"}),e.jsx(h.Body,{children:e.jsxs(b,{className:"g-3",children:[e.jsx(r,{md:12,className:"mb-3",children:e.jsxs(n.Group,{children:[e.jsxs(n.Label,{htmlFor:"complaint",children:["Service Complaint"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(V,{inputId:"complaint",options:g,value:d,onChange:l=>c("complaint",(l==null?void 0:l.value)||""),placeholder:"Select complaint",isClearable:!0,styles:{control:l=>({...l,borderColor:o.complaint?"#dc3545":l.borderColor,"&:hover":{borderColor:o.complaint?"#dc3545":l.borderColor}})}}),o.complaint&&e.jsx("div",{className:"invalid-feedback d-block",children:o.complaint})]})}),e.jsx(r,{md:12,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{htmlFor:"remarks",children:"Other Remarks"}),e.jsx(n.Control,{id:"remarks",as:"textarea",rows:3,value:(s==null?void 0:s.remarks)||"",onChange:l=>c("remarks",l.target.value),placeholder:"Other Remarks"})]})})]})})]})})]})]})},Be=({paymentData:s,setPaymentData:x,totalPaid:o})=>{const u=()=>{const t=Number(s==null?void 0:s.diagnosis_fee)||0,N=Number(s==null?void 0:s.estimated_cost)||0,j=Number(s==null?void 0:s.final_cost)||0;return t+N+j},c=m.useMemo(()=>u(),[s==null?void 0:s.diagnosis_fee,s==null?void 0:s.estimated_cost,s==null?void 0:s.final_cost]),g=t=>Array.isArray(t)?t:t&&Array.isArray(t.transactions)?t.transactions:[],d=m.useMemo(()=>Object.entries(s).filter(([,t])=>Array.isArray(t)||Array.isArray(t==null?void 0:t.transactions)).map(([t,N])=>{const P=g(N).reduce((f,O)=>f+(Number(O.amount)||0),0);return{method:t,total:P}}),[s]),l=m.useMemo(()=>d.reduce((t,N)=>t+N.total,0),[d]),i=typeof o=="number"?o:l,y=Math.max(c-i,0),F=i>c?i-c:0,p=(t,N)=>{x(j=>({...j,[t]:N}))};return e.jsxs(e.Fragment,{children:[e.jsxs(h,{className:"border-0 shadow-sm mb-3",children:[e.jsx(h.Header,{className:"bg-white fw-bold",children:"Payment Info"}),e.jsx(h.Body,{children:e.jsxs(b,{className:"g-3",children:[e.jsx(r,{md:4,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Diagnosis Fees"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:"$"}),e.jsx(n.Control,{type:"number",placeholder:"Diagnosis Fees",value:(s==null?void 0:s.diagnosis_fee)||"",onChange:t=>{p("diagnosis_fee",t.target.value)}})]})]})}),e.jsx(r,{md:4,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Estimate Fees"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:"$"}),e.jsx(n.Control,{type:"number",placeholder:"Estimate Fees",value:(s==null?void 0:s.estimated_cost)||"",onChange:t=>{p("estimated_cost",t.target.value)}})]})]})}),e.jsx(r,{md:4,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Final Cost"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:"$"}),e.jsx(n.Control,{type:"number",placeholder:"Final Cost",value:(s==null?void 0:s.final_cost)||"",onChange:t=>{p("final_cost",t.target.value)}})]})]})})]})})]}),e.jsxs(b,{className:"g-3",children:[e.jsx(r,{md:8,children:e.jsx(Pe,{paymentData:s,setPaymentData:x})}),e.jsx(r,{md:4,children:e.jsxs(h,{className:"border-0 shadow-sm h-100",children:[e.jsx(h.Header,{className:"bg-white fw-bold",children:"Summary"}),e.jsxs(h.Body,{children:[e.jsx("div",{className:"mb-3",children:e.jsxs(w,{children:[e.jsxs(w.Text,{className:"fw-bold bg-light",style:{width:"160px"},children:[e.jsx(ke,{className:"me-1"}),"Total Billed"]}),e.jsx(E,{value:I(c),className:"text-end fw-bold bg-light",disabled:!0})]})}),e.jsx(b,{className:"g-2 mb-3",children:d.map(({method:t,total:N})=>e.jsx(r,{md:12,children:e.jsxs(w,{children:[e.jsxs(w.Text,{className:"fw-bold bg-light text-capitalize",style:{width:"160px"},children:[e.jsx(Fe,{className:"me-1"}),t]}),e.jsx(E,{value:I(N),className:"text-end fw-bold bg-light",disabled:!0})]})},t))}),e.jsx("hr",{}),e.jsx("div",{className:"mb-2",children:e.jsxs(w,{children:[e.jsxs(w.Text,{className:"fw-bold bg-light",style:{width:"160px"},children:[e.jsx(Le,{className:"me-1"}),"Total Paid"]}),e.jsx(E,{value:I(i),className:"text-end fw-bold bg-light",disabled:!0})]})}),e.jsx("div",{className:"mb-2",children:e.jsxs(w,{children:[e.jsxs(w.Text,{className:`fw-bold ${y>0?"text-warning":"text-success"} bg-light`,style:{width:"160px"},children:[e.jsx(je,{className:"me-1"}),"Balance Due"]}),e.jsx(E,{value:I(y),className:`text-end fw-bold ${y>0?"text-warning":"text-success"}`,disabled:!0})]})}),F>0&&e.jsx("div",{className:"mb-2",children:e.jsxs(w,{children:[e.jsxs(w.Text,{className:"fw-bold text-info bg-light",style:{width:"160px"},children:[e.jsx(je,{className:"me-1"}),"Change"]}),e.jsx(E,{value:I(F),className:"text-end fw-bold text-info",disabled:!0})]})})]})]})})]})]})},Re=({otherInfoData:s,setOtherInfoData:x})=>{const o=(u,c)=>{x(g=>({...g,[u]:c}))};return e.jsxs(h,{className:"border-0 shadow-sm mb-3",children:[e.jsx(h.Header,{className:"bg-white fw-bold",children:"Other Information"}),e.jsxs(h.Body,{children:[e.jsxs(b,{className:"g-3 mb-3",children:[e.jsx(r,{md:6,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Completion Date"}),e.jsx(n.Control,{type:"date",value:(s==null?void 0:s.completion_date)||"",onChange:u=>o("completion_date",u.target.value)})]})}),e.jsx(r,{md:6,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Attachments (Photos,Documents etc)"}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(n.Control,{type:"file",className:"d-none",id:"attachments",onChange:u=>o("attachments",u.target.files[0]||null)}),e.jsx(n.Label,{htmlFor:"attachments",className:"btn btn-outline-secondary me-2 mb-0",children:"Choose File"}),e.jsx("span",{className:"text-muted",children:(s==null?void 0:s.attachments)||"No file chosen"})]})]})})]}),e.jsx(b,{className:"g-3 mb-3",children:e.jsx(r,{md:12,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Customer Signature"}),e.jsx("div",{style:{height:"100px",border:"1px dashed #ccc",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",color:"#6c757d"},children:(s==null?void 0:s.signature)||"Signature Area"})]})})}),e.jsx(b,{className:"mb-3",children:e.jsx(r,{children:e.jsxs("div",{className:"d-flex flex-wrap gap-3",children:[e.jsx(n.Check,{type:"checkbox",id:"sendSms",label:"Send SMS",checked:!!(s!=null&&s.sendSms),onChange:u=>o("sendSms",u.target.checked)}),e.jsx(n.Check,{type:"checkbox",id:"sendWhatsApp",label:"Send WhatsApp",checked:!!(s!=null&&s.sendWhatsApp),onChange:u=>o("sendWhatsApp",u.target.checked)}),e.jsx(n.Check,{type:"checkbox",id:"sendEmail",label:"Send Email",checked:!!(s!=null&&s.sendEmail),onChange:u=>o("sendEmail",u.target.checked)})]})})})]})]})},ds=({service:s=null})=>{var S,T,A,Y,Q,X,Z,v,D,ee,se,ne,le,re,de,oe,ae,te,ce,me,ie,he,ue,xe;const[x,o]=m.useState("customer");console.log(s);const{paymentMethods:u}=fe(),[c,g]=m.useState({}),d=()=>{const k=new Date().toISOString().slice(0,10).replace(/-/g,""),L=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`JOB-${k}-${L}`},l=()=>new Date().toISOString().split("T")[0],[i,y]=m.useState({customer_id:((S=s==null?void 0:s.customer)==null?void 0:S.id)||"",customer_name:((T=s==null?void 0:s.customer)==null?void 0:T.full_name)||"",customer_phone:((A=s==null?void 0:s.customer)==null?void 0:A.phone)||"",customer_email:((Y=s==null?void 0:s.customer)==null?void 0:Y.email)||""}),[F,p]=m.useState({order_number:(s==null?void 0:s.order_number)||d,entry_date:(s==null?void 0:s.entry_date)||l,company:((Q=s==null?void 0:s.device_metadata)==null?void 0:Q.company)||"",brand:((X=s==null?void 0:s.device_metadata)==null?void 0:X.brand)||"",model:((Z=s==null?void 0:s.device_metadata)==null?void 0:Z.model)||"",serial:((v=s==null?void 0:s.device_metadata)==null?void 0:v.serial)||"",specs:((D=s==null?void 0:s.device_metadata)==null?void 0:D.specs)||"",password:((ee=s==null?void 0:s.device_metadata)==null?void 0:ee.password)||"",color:((se=s==null?void 0:s.device_metadata)==null?void 0:se.color)||"",issue:((ne=s==null?void 0:s.device_metadata)==null?void 0:ne.issue)||"",remarks:((le=s==null?void 0:s.device_metadata)==null?void 0:le.remarks)||"",provider:((re=s==null?void 0:s.device_metadata)==null?void 0:re.provider)||"",warranty:((de=s==null?void 0:s.device_metadata)==null?void 0:de.warranty)||"",service_type:(s==null?void 0:s.service_type)||"",priority:(s==null?void 0:s.priority)||"normal",assigned_technician_id:(s==null?void 0:s.assigned_technician_id)||"",expected_completion_date:(s==null?void 0:s.expected_completion_date)||"",repair_service_id:(s==null?void 0:s.repair_service_id)||""}),[t,N]=m.useState({display:((oe=s==null?void 0:s.initial_check_metadata)==null?void 0:oe.display)||"",back_panel:((ae=s==null?void 0:s.initial_check_metadata)==null?void 0:ae.back_panel)||"",status:((te=s==null?void 0:s.initial_check_metadata)==null?void 0:te.status)||"",physical_condition:((ce=s==null?void 0:s.initial_check_metadata)==null?void 0:ce.physical_condition)||"",risk_agreed:((me=s==null?void 0:s.initial_check_metadata)==null?void 0:me.risk_agreed)||"",accessories:((ie=s==null?void 0:s.initial_check_metadata)==null?void 0:ie.accessories)||[],remarks:((he=s==null?void 0:s.initial_check_metadata)==null?void 0:he.remarks)||"",checked_by:((ue=s==null?void 0:s.initial_check_metadata)==null?void 0:ue.checked_by)||"",check_date:((xe=s==null?void 0:s.initial_check_metadata)==null?void 0:xe.check_date)||""}),[j,P]=m.useState({assigned_technician_id:(s==null?void 0:s.assigned_technician_id)||"",created_by:(s==null?void 0:s.created_by)||"",completion_date:(s==null?void 0:s.completion_date)||"",attachments:(s==null?void 0:s.attachments)||[]});m.useEffect(()=>{if(s){const _=u.reduce((k,L)=>{var C;const $=((C=s==null?void 0:s.payments)==null?void 0:C.filter(R=>{var W;return((W=R.payment_method_name)==null?void 0:W.toLowerCase())===L.name.toLowerCase()}))||[];return k[L.name.toLowerCase()]=$.map(R=>R.metadata),k},{});g(_)}},[s,u]);const f=m.useMemo(()=>[{key:"customer",label:"Customer Info",icon:"bi-person"},{key:"details",label:"Job Details",icon:"bi-clipboard"},{key:"initial-check",label:"Initial Check",icon:"bi-check-circle"},{key:"payment-info",label:"Payment Info",icon:"bi-credit-card"},{key:"other-info",label:"Other Info",icon:"bi-info-circle"}],[]),O=m.useCallback(()=>{const _=f.findIndex(k=>k.key===x);_<f.length-1&&o(f[_+1].key)},[x,f]),J=m.useCallback(()=>{const _=f.findIndex(k=>k.key===x);_>0&&o(f[_-1].key)},[x,f]),q=x===f[0].key,K=x===f[f.length-1].key,a=async _=>{var L,$;if(_.preventDefault(),!!(await B.fire({title:"Confirm Submission",text:s?"Update this service entry?":"Create new service entry?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:s?"Yes, update it!":"Yes, create it!"})).isConfirmed){B.fire({title:"Please wait...",allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>{B.showLoading()}});try{const C=new FormData;C.append("customer",JSON.stringify(i)),C.append("job_details",JSON.stringify(F)),C.append("initial_check",JSON.stringify(t)),C.append("payment_info",JSON.stringify(c)),C.append("other_info",JSON.stringify(j)),j.attachments&&j.attachments.length>0&&j.attachments.forEach((ge,be)=>{ge instanceof File&&C.append(`attachments[${be}]`,ge)});const R=s?route("services.update",s==null?void 0:s.id):route("services.store"),W=s?"put":"post",{data:pe}=await ye[W](R,C,{headers:{"Content-Type":"multipart/form-data"}});pe.success?(B.close(),M.success(pe.message)):(B.close(),M.error("Something went wrong!"))}catch(C){B.close(),console.log(C),M.error((($=(L=C.response)==null?void 0:L.data)==null?void 0:$.message)||"Request failed")}}};return e.jsxs(_e,{children:[e.jsx(Ne,{title:s?"Edit Service":"Create Service"}),e.jsx(n,{onSubmit:a,children:e.jsx(G.Container,{activeKey:x,onSelect:o,children:e.jsxs(b,{children:[e.jsx(r,{sm:3,md:2,className:"border-end bg-light",children:e.jsx(z,{variant:"pills",className:"flex-column",children:f.map(({key:_,label:k,icon:L})=>e.jsx(z.Item,{children:e.jsxs(z.Link,{eventKey:_,className:"d-flex align-items-center",children:[e.jsx("i",{className:`${L} me-2`}),e.jsx("span",{className:"d-none d-md-inline",children:k})]})},_))})}),e.jsxs(r,{sm:9,md:10,children:[e.jsxs(G.Content,{children:[e.jsx(G.Pane,{eventKey:"customer",children:e.jsx(Te,{customerData:i,setCustomerData:y})}),e.jsx(G.Pane,{eventKey:"details",children:e.jsx(Oe,{jobDetailsData:F,setJobDetailsData:p})}),e.jsx(G.Pane,{eventKey:"initial-check",children:e.jsx(Ge,{initialCheckData:t,setInitialCheckData:N})}),e.jsx(G.Pane,{eventKey:"payment-info",children:e.jsx(Be,{paymentData:c,setPaymentData:g})}),e.jsx(G.Pane,{eventKey:"other-info",children:e.jsx(Re,{otherInfoData:j,setOtherInfoData:P})})]}),e.jsxs("div",{className:"d-flex justify-content-between mt-4 pt-3 border-top",children:[e.jsxs(U,{variant:"outline-secondary",onClick:J,disabled:q,className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-chevron-left me-1"}),"Previous"]}),K?e.jsxs(U,{type:"submit",variant:"primary",className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-check-circle me-1"}),s?"Update":"Submit"]}):e.jsxs(U,{variant:"primary",onClick:O,className:"d-flex align-items-center",children:["Next",e.jsx("i",{className:"bi bi-chevron-right ms-1"})]})]})]})]})})})]})};export{ds as default};
