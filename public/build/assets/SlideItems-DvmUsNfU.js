import{r as u,j as e,$ as O}from"./app-CG0rYmwP.js";import{F as V}from"./index-Di6UYymB.js";import{S as D}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{R as H,I as d,y as x}from"./Footer-CVrb9yvl.js";import{x as w}from"./axios-Dckr6nFm.js";import{u as J,c as K,a as G,h as Q,b as R,d as W}from"./index.esm-DoQ_g8ot.js";import{M as N}from"./Modal-DaZAfTy_.js";import{F as a,C as c}from"./Form-DBT1bdVP.js";import{B as E}from"./Image-DOSiFVRD.js";import{S as X}from"./Spinner-DOcr2JCN.js";import{E as Y}from"./ErpLayout-lZW-50vv.js";import{C as k}from"./Card-CewoDW1c.js";import{B as Z}from"./ButtonGroup-C8dF5zH6.js";import{A as S}from"./Alert-Bz1djl1I.js";import{T as ee}from"./Table-DxO-cu9g.js";import"./iconBase-JZvYHVIv.js";import"./CloseButton-BDXCjQ_i.js";import"./hoist-non-react-statics.cjs-C-Qo8PK8.js";/* empty css                      */const te=K().shape({title:R().max(255,"Title must not exceed 255 characters"),subtitle:R().max(255,"Subtitle must not exceed 255 characters"),image:Q().nullable().test("is-required","Desktop image is required",function(r){return this.parent.id||r}),start_at:G().nullable(),end_at:G().nullable().min(W("start_at"),"End date must be after start date")});function ae({showModal:r,setShowModal:C,formData:n,handleSubmit:j,isSubmitting:l}){const f=u.useMemo(()=>({id:"",slider_id:"",title:"",subtitle:"",description:"",image:null,mobile_image:null,button_text:"",button_url:"",secondary_button_text:"",secondary_button_url:"",order:0,is_active:!0,text_color:"#ffffff",start_at:"",end_at:""}),[]),t=J({initialValues:f,validationSchema:te,enableReinitialize:!0,onSubmit:i=>{console.log("Form submitted:",i),j(i)}});u.useEffect(()=>{n&&r&&(console.log("Setting form data in modal:",n),t.setValues({...f,...n,is_active:n.is_active!==void 0?n.is_active:!0,image:n.image||null,mobile_image:n.mobile_image||null,start_at:n.start_at?y(n.start_at):"",end_at:n.end_at?y(n.end_at):""}))},[n,r,f]);const y=i=>i?new Date(i).toISOString().slice(0,16):"",B=(i,_)=>{const h=i.target.files[0];if(t.setFieldValue(_,h),h){const T=new FileReader;T.onload=I=>{console.log("File preview loaded")},T.readAsDataURL(h)}},g=()=>{l||(C(!1),setTimeout(()=>{t.resetForm()},300))};return e.jsx(N,{centered:!0,show:r,onHide:g,backdrop:l?"static":!0,keyboard:!l,size:"lg",children:e.jsxs(a,{onSubmit:t.handleSubmit,noValidate:!0,children:[e.jsx(N.Header,{closeButton:!l,children:e.jsx(N.Title,{children:t.values.id?"Edit Slide Item":"Create Slide Item"})}),e.jsx(N.Body,{children:e.jsxs(H,{className:"g-3",children:[e.jsx(c,{md:12,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Title"}),e.jsxs(d,{children:[e.jsx(d.Text,{children:e.jsx("i",{className:"bi bi-text-paragraph"})}),e.jsx(a.Control,{type:"text",name:"title",value:t.values.title,onChange:t.handleChange,onBlur:t.handleBlur,isInvalid:t.touched.title&&!!t.errors.title,disabled:l,placeholder:"Enter title"}),e.jsx(a.Control.Feedback,{type:"invalid",children:t.errors.title})]})]})}),e.jsx(c,{md:12,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Subtitle"}),e.jsxs(d,{children:[e.jsx(d.Text,{children:e.jsx("i",{className:"bi bi-text-center"})}),e.jsx(a.Control,{type:"text",name:"subtitle",value:t.values.subtitle,onChange:t.handleChange,onBlur:t.handleBlur,isInvalid:t.touched.subtitle&&!!t.errors.subtitle,disabled:l,placeholder:"Enter subtitle"}),e.jsx(a.Control.Feedback,{type:"invalid",children:t.errors.subtitle})]})]})}),e.jsx(c,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsxs(a.Label,{children:["Desktop Image"," ",!t.values.id&&e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(a.Control,{type:"file",name:"image",accept:"image/*",onChange:i=>B(i,"image"),onBlur:t.handleBlur,isInvalid:t.touched.image&&!!t.errors.image,disabled:l}),e.jsx(a.Text,{className:"text-muted",children:t.values.id?"Leave empty to keep current image":"Required for new items"}),e.jsx(a.Control.Feedback,{type:"invalid",children:t.errors.image}),t.values.image&&typeof t.values.image=="string"&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:`/${t.values.image}`,alt:"Current",className:"img-thumbnail",width:100})})]})}),e.jsx(c,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Mobile Image"}),e.jsx(a.Control,{type:"file",name:"mobile_image",accept:"image/*",onChange:i=>B(i,"mobile_image"),onBlur:t.handleBlur,isInvalid:t.touched.mobile_image&&!!t.errors.mobile_image,disabled:l}),e.jsx(a.Control.Feedback,{type:"invalid",children:t.errors.mobile_image}),t.values.mobile_image&&typeof t.values.mobile_image=="string"&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:`/${t.values.mobile_image}`,alt:"Mobile Preview",className:"img-thumbnail",style:{maxHeight:"150px"}})})]})}),e.jsx(c,{md:3,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Primary Button Text"}),e.jsxs(d,{children:[e.jsx(d.Text,{children:e.jsx("i",{className:"bi bi-button-play"})}),e.jsx(a.Control,{type:"text",name:"button_text",value:t.values.button_text,onChange:t.handleChange,onBlur:t.handleBlur,isInvalid:t.touched.button_text&&!!t.errors.button_text,disabled:l,placeholder:"Button text"}),e.jsx(a.Control.Feedback,{type:"invalid",children:t.errors.button_text})]})]})}),e.jsx(c,{md:3,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Primary Button URL"}),e.jsxs(d,{children:[e.jsx(d.Text,{children:e.jsx("i",{className:"bi bi-link-45deg"})}),e.jsx(a.Control,{type:"url",name:"button_url",value:t.values.button_url,onChange:t.handleChange,onBlur:t.handleBlur,isInvalid:t.touched.button_url&&!!t.errors.button_url,disabled:l,placeholder:"https://example.com"}),e.jsx(a.Control.Feedback,{type:"invalid",children:t.errors.button_url})]})]})}),e.jsx(c,{md:3,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Secondary Button Text"}),e.jsxs(d,{children:[e.jsx(d.Text,{children:e.jsx("i",{className:"bi bi-button-play"})}),e.jsx(a.Control,{type:"text",name:"secondary_button_text",value:t.values.secondary_button_text,onChange:t.handleChange,onBlur:t.handleBlur,isInvalid:t.touched.secondary_button_text&&!!t.errors.secondary_button_text,disabled:l,placeholder:"Secondary button text"}),e.jsx(a.Control.Feedback,{type:"invalid",children:t.errors.secondary_button_text})]})]})}),e.jsx(c,{md:3,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Secondary Button URL"}),e.jsxs(d,{children:[e.jsx(d.Text,{children:e.jsx("i",{className:"bi bi-link-45deg"})}),e.jsx(a.Control,{type:"url",name:"secondary_button_url",value:t.values.secondary_button_url,onChange:t.handleChange,onBlur:t.handleBlur,isInvalid:t.touched.secondary_button_url&&!!t.errors.secondary_button_url,disabled:l,placeholder:"https://example.com"}),e.jsx(a.Control.Feedback,{type:"invalid",children:t.errors.secondary_button_url})]})]})}),e.jsx(c,{md:3,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Order"}),e.jsxs(d,{children:[e.jsx(d.Text,{children:e.jsx("i",{className:"bi bi-sort-numeric-down"})}),e.jsx(a.Control,{type:"number",name:"order",min:"0",value:t.values.order,onChange:t.handleChange,onBlur:t.handleBlur,isInvalid:t.touched.order&&!!t.errors.order,disabled:l}),e.jsx(a.Control.Feedback,{type:"invalid",children:t.errors.order})]})]})}),e.jsx(c,{md:3,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Text Color"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(a.Control,{type:"color",name:"text_color",value:t.values.text_color,onChange:t.handleChange,onBlur:t.handleBlur,isInvalid:t.touched.text_color&&!!t.errors.text_color,style:{width:"60px",height:"38px",padding:"3px"},disabled:l}),e.jsx(a.Control,{type:"text",name:"text_color",value:t.values.text_color,onChange:t.handleChange,onBlur:t.handleBlur,isInvalid:t.touched.text_color&&!!t.errors.text_color,disabled:l})]}),e.jsx(a.Control.Feedback,{type:"invalid",children:t.errors.text_color})]})}),e.jsx(c,{md:3,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Start Date/Time"}),e.jsx(a.Control,{type:"datetime-local",name:"start_at",value:t.values.start_at,onChange:t.handleChange,onBlur:t.handleBlur,isInvalid:t.touched.start_at&&!!t.errors.start_at,disabled:l}),e.jsx(a.Control.Feedback,{type:"invalid",children:t.errors.start_at})]})}),e.jsx(c,{md:3,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"End Date/Time"}),e.jsx(a.Control,{type:"datetime-local",name:"end_at",value:t.values.end_at,onChange:t.handleChange,onBlur:t.handleBlur,isInvalid:t.touched.end_at&&!!t.errors.end_at,min:t.values.start_at,disabled:l}),e.jsx(a.Control.Feedback,{type:"invalid",children:t.errors.end_at})]})}),e.jsx(c,{md:12,children:e.jsx(a.Group,{className:"mb-3",children:e.jsx(a.Check,{type:"switch",id:"is_active",name:"is_active",label:"Active",checked:t.values.is_active,onChange:t.handleChange,disabled:l})})})]})}),e.jsxs(N.Footer,{children:[e.jsx(E,{variant:"outline-secondary",onClick:g,disabled:l,children:"Cancel"}),e.jsx(E,{variant:"primary",type:"submit",disabled:l||!t.isValid,children:l?e.jsxs(e.Fragment,{children:[e.jsx(X,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true",className:"me-2"}),t.values.id?"Updating...":"Creating..."]}):t.values.id?"Update":"Create"})]})]})})}const A={slider_id:"",title:"",subtitle:"",description:"",button_text:"",button_url:"",is_active:!0,order:0,image:null};function Ce({slider:r,onSuccess:C}){const[n,j]=u.useState(!1),[l,f]=u.useState(A),[t,y]=u.useState(!1),[B,g]=u.useState(!0),[i,_]=u.useState(null),h=u.useRef(null),T=u.useRef(!1),I=u.useCallback(()=>{h.current&&h.current.ajax.reload(null,!1)},[]),L=u.useCallback(()=>{if(!(r!=null&&r.id)){_("No slider selected"),g(!1);return}if($.fn.DataTable.isDataTable("#sliderItemsTable")){I();return}g(!0),_(null);const m=$("#sliderItemsTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("slider-item.index"),type:"GET",data:{slider:r.id},dataSrc:s=>(console.log("DataTable response:",s),s.data||[]),error:s=>{console.error("DataTable error:",s),_("Failed to load slider items"),x.error("Failed to load slider items")}},columns:[{data:"DT_RowIndex",name:"DT_RowIndex",orderable:!1,searchable:!1},{data:"image_preview",name:"image_preview",orderable:!1,searchable:!1},{data:"title",name:"title"},{data:"subtitle",name:"subtitle"},{data:"is_active",name:"is_active",render:s=>s?'<span class="badge bg-success">Active</span>':'<span class="badge bg-secondary">Inactive</span>'},{data:"order",name:"order"},{data:"id",name:"actions",orderable:!1,searchable:!1,render:s=>`
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-secondary edit-item-btn" data-id="${s}">
                                    <i class="bi bi-pencil"></i> Edit
                                </button>
                                <button class="btn btn-outline-danger delete-item-btn" data-id="${s}">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            </div>
                        `}],drawCallback:function(s){console.log("DataTable draw complete"),$("#sliderItemsTable").off("click",".edit-item-btn").on("click",".edit-item-btn",function(b){b.preventDefault();const o=$(this).data("id");console.log("Edit button clicked:",o),z(o)}),$("#sliderItemsTable").off("click",".delete-item-btn").on("click",".delete-item-btn",function(b){b.preventDefault();const o=$(this).data("id");console.log("Delete button clicked:",o),U(o)})},initComplete:function(){console.log("DataTable initialized"),T.current=!0,g(!1)}});h.current=m},[r==null?void 0:r.id,I]),M=()=>{f({...A,slider_id:r.id}),j(!0)},z=async m=>{try{console.log("Editing item:",m);const s=await w.get(route("slider-item.edit",m));console.log("Edit response:",s.data),s.data.item?(f({...s.data.item,slider_id:r.id}),j(!0)):s.data.data?(f({...s.data.data,slider_id:r.id}),j(!0)):x.error("Item data not found in response")}catch(s){console.error("Edit error:",s),x.error("Failed to load item")}},U=async m=>{if((await D.fire({title:"Delete item?",icon:"warning",showCancelButton:!0})).isConfirmed)try{const b=await w.delete(route("slider-item.destroy",m));b.data.success?(x.success(b.data.message),I()):x.error(b.data.message)}catch{x.error("Delete failed")}},P=async m=>{const s=!!m.id;if((await D.fire({title:s?"Update item?":"Create item?",showCancelButton:!0,icon:"question"})).isConfirmed){y(!0);try{const o=new FormData;Object.entries(m).forEach(([v,p])=>{p!==null&&(v==="image"&&p instanceof File||v==="mobile_image"&&p instanceof File?o.append(v,p):typeof p=="boolean"?o.append(v,p?1:0):o.append(v,p))}),s&&o.append("_method","PUT");const q=s?route("slider-item.update",m.id):route("slider-item.store"),F=await w.post(q,o,{headers:{"Content-Type":"multipart/form-data"}});F.data.success?(j(!1),I(),C==null||C(),x.success(F.data.message)):x.error(F.data.message)}catch(o){console.error("Submit error:",o),x.error("Submit failed")}y(!1)}};return u.useEffect(()=>{if(console.log("Slider ID changed:",r==null?void 0:r.id),r!=null&&r.id){const m=setTimeout(()=>{console.log("Initializing DataTable..."),L()},100);return()=>clearTimeout(m)}},[r==null?void 0:r.id,L]),u.useEffect(()=>()=>{h.current&&(h.current.destroy(!0),h.current=null,T.current=!1)},[]),e.jsxs(Y,{children:[e.jsx(O,{title:"Slides Items Management"}),r!=null&&r.id?e.jsxs(k,{className:"shadow-sm border-0 rounded-0",children:[e.jsxs(k.Header,{className:"d-flex justify-content-between bg-transparent",children:[e.jsxs("h6",{className:"mb-0 fw-semibold",children:[r.name," - Items"]}),e.jsx(Z,{children:e.jsxs(E,{variant:"outline-primary",size:"sm",onClick:M,children:[e.jsx(V,{className:"me-1"}),"New Item"]})})]}),e.jsxs(k.Body,{className:"px-0",children:[i&&e.jsx(S,{variant:"danger",className:"mx-3",children:i}),e.jsx("div",{className:"table-responsive px-2",children:e.jsxs(ee,{id:"sliderItemsTable",className:"table table-bordered table-striped w-100",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Image"}),e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Sub Title"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Order"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{})]})})]})]}):e.jsx(S,{variant:"warning",className:"text-center",children:"Please select a slider to manage."}),e.jsx(ae,{showModal:n,setShowModal:j,formData:l,handleSubmit:P,isSubmitting:t})]})}export{Ce as default};
