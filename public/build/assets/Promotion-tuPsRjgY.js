import{r as c,j as e,$ as O}from"./app-V9r-X-AE.js";import{p as S,n as Y,b as J,c as D,d as K,e as Q}from"./index-BwZ8nvxZ.js";import{S as V}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{y as m,R as p,I as x,D as h}from"./Footer-DzCvt54Q.js";import{E as W}from"./ErpLayout-nhBgb16w.js";import{x as P}from"./axios-ieEUQTu7.js";import{F as X,a as Z,b as ee}from"./index-B3mf7D57.js";import{C as te,B as v}from"./Image-Dv6K2MWK.js";import{C as i,F as s}from"./Form-BBQmeiIu.js";import{B}from"./ButtonGroup-DhA5YJ4Y.js";import{C as F}from"./Card-DEhYGpAN.js";import{T as se}from"./Table-DzA7Bq8n.js";import{M as y}from"./Modal-qrCrV0uy.js";import"./iconBase-DG-LLbDw.js";import"./CloseButton-CxHVE5YY.js";/* empty css                      */function ge(){const[f,E]=c.useState(""),[b,L]=c.useState("all"),[j,A]=c.useState("all"),[G,w]=c.useState(!1),[l,N]=c.useState({title:"",code:"",discount_type:"percentage",discount_value:"",start_date:"",end_date:"",status:"active",usage_limit:"",minimum_purchase:""}),g=c.useRef(!1),o=c.useRef(null),_=c.useCallback(()=>{if(g.current)return;$.fn.DataTable.isDataTable("#promotionTable")&&$("#promotionTable").DataTable().destroy();const r=$("#promotionTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("promotion.index"),type:"GET",data:function(t){t.search=f,t.status=b!=="all"?b:"",t.type=j!=="all"?j:""}},columns:[{data:"DT_RowIndex",title:"#",className:"text-center",width:"3%",orderable:!1,searchable:!1},{data:"title",title:"Title",className:"text-start fw-semibold"},{data:"code",title:"Code",className:"text-center",width:"10%",render:function(t){return`<code class="bg-light p-1 rounded">${t}</code>`}},{data:"discount_display",title:"Discount",className:"text-center",width:"10%",render:function(t,a,n){let u="bg-success";return n.discount_type==="fixed"&&(u="bg-info"),`<span class="badge ${u}">${t}</span>`}},{data:"start_date",title:"Start Date",className:"text-center",width:"10%",render:function(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}},{data:"end_date",title:"End Date",className:"text-center",width:"10%",render:function(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}},{data:"usage_count",title:"Usage",className:"text-center",width:"8%",render:function(t,a,n){const u=t||0,H=n.usage_limit||"âˆž";return`
                            <div class="d-flex flex-column align-items-center">
                                <span class="fw-semibold">${u}</span>
                                <small class="text-muted">/ ${H}</small>
                            </div>
                        `}},{data:"status",title:"Status",className:"text-center",width:"8%",render:function(t){let a="bg-success",n="Active";return t==="upcoming"?(a="bg-warning text-dark",n="Upcoming"):t==="expired"?(a="bg-secondary",n="Expired"):t==="inactive"&&(a="bg-danger",n="Inactive"),`<span class="badge ${a}">${n}</span>`}},{data:"id",title:"Actions",className:"text-center",width:"15%",orderable:!1,searchable:!1,render:function(t,a,n){return`
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-sm btn-outline-info view-btn" data-id="${t}">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-primary edit-btn" data-id="${t}">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-success copy-btn" data-code="${n.code}">
                                    <i class="bi bi-clipboard"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-danger delete-btn" data-id="${t}">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        `}}],drawCallback:function(){$(".view-btn").off("click").on("click",function(){const t=$(this).data("id");I(t)}),$(".edit-btn").off("click").on("click",function(){const t=$(this).data("id");M(t)}),$(".copy-btn").off("click").on("click",function(){const t=$(this).data("code");navigator.clipboard.writeText(t),m.success(`Copied: ${t}`)}),$(".delete-btn").off("click").on("click",function(){const t=$(this).data("id");U(t)})},initComplete:function(){g.current=!0},language:{emptyTable:'<div class="text-center py-5"><i class="bi bi-percent display-4 text-muted"></i><p class="mt-2">No promotions found</p></div>',zeroRecords:'<div class="text-center py-5"><i class="bi bi-search display-4 text-muted"></i><p class="mt-2">No matching promotions found</p></div>'},responsive:!0,order:[[4,"desc"]],pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]]});return o.current=r,r},[f,b,j]);c.useEffect(()=>{g.current&&o.current&&o.current.ajax.reload()},[f,b,j]),c.useEffect(()=>(_(),()=>{$.fn.DataTable.isDataTable("#promotionTable")&&($("#promotionTable").DataTable().destroy(),g.current=!1)}),[_]);const k=()=>w(!0),C=()=>{w(!1),N({title:"",code:"",discount_type:"percentage",discount_value:"",start_date:"",end_date:"",status:"active",usage_limit:"",minimum_purchase:""})},d=r=>{const{name:t,value:a}=r.target;N(n=>({...n,[t]:t==="discount_value"||t==="usage_limit"||t==="minimum_purchase"?a===""?"":Number(a):a}))},R=async r=>{var t,a;r.preventDefault();try{(await P.post(route("promotion.store"),l)).data.success&&(m.success("Promotion created successfully!"),C(),o.current&&o.current.ajax.reload())}catch(n){m.error(((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"An error occurred while creating promotion")}},I=r=>{window.location.href=route("promotion.show",r)},M=r=>{window.location.href=route("promotion.edit",r)},U=async r=>{var t,a;try{if(!(await V.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;const u=await P.delete(route("promotion.destroy",r));u.data.success&&(m.success(u.data.message),o.current&&o.current.ajax.reload())}catch(n){m.error(((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"An error occurred while deleting the promotion")}},T=r=>{if(o.current){const t=o.current.ajax.params(),a=new URL(route("promotion.export"));Object.keys(t).forEach(n=>{n!=="draw"&&n!=="_"&&n!=="start"&&n!=="length"&&a.searchParams.append(n,t[n])}),a.searchParams.append("type",r),window.open(a.toString(),"_blank")}},q=()=>{if(o.current){const r=o.current.ajax.params(),t=new URL(route("promotion.print"));Object.keys(r).forEach(a=>{a!=="draw"&&a!=="_"&&a!=="start"&&a!=="length"&&t.searchParams.append(a,r[a])}),window.open(t.toString(),"_blank")}},z=()=>{o.current&&(o.current.ajax.reload(),m.success("Promotions list refreshed!"))};return e.jsxs(W,{children:[e.jsx(O,{title:"Customer Promotions"}),e.jsxs(te,{fluid:!0,children:[e.jsxs(p,{className:"mb-4 align-items-center",children:[e.jsxs(i,{md:6,children:[e.jsxs("h3",{className:"fw-bold text-primary mb-2",children:[e.jsx(S,{className:"me-2"}),"Customer Promotions"]}),e.jsx("p",{className:"text-muted mb-0",children:"Manage customer promotions, discounts, and offers."})]}),e.jsx(i,{md:6,className:"text-md-end",children:e.jsx(B,{className:"mb-2 mb-md-0",children:e.jsxs(v,{variant:"outline-primary",onClick:k,className:"d-flex align-items-center",children:[e.jsx(Y,{className:"me-1"}),"New Promotion"]})})})]}),e.jsxs(p,{className:"mb-4",children:[e.jsx(i,{md:6,lg:3,children:e.jsxs(x,{children:[e.jsx(x.Text,{children:e.jsx(J,{})}),e.jsx(s.Control,{type:"text",placeholder:"Search promotions...",value:f,onChange:r=>E(r.target.value)})]})}),e.jsx(i,{md:6,lg:2,children:e.jsxs(x,{children:[e.jsx(x.Text,{children:e.jsx(D,{})}),e.jsxs(s.Select,{value:b,onChange:r=>L(r.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"upcoming",children:"Upcoming"}),e.jsx("option",{value:"expired",children:"Expired"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})}),e.jsx(i,{md:6,lg:2,children:e.jsxs(x,{children:[e.jsx(x.Text,{children:e.jsx(D,{})}),e.jsxs(s.Select,{value:j,onChange:r=>A(r.target.value),children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"percentage",children:"Percentage"}),e.jsx("option",{value:"fixed",children:"Fixed Amount"})]})]})}),e.jsx(i,{md:12,lg:5,className:"text-lg-end mt-2 mt-lg-0",children:e.jsxs(B,{className:"d-flex gap-2",children:[e.jsxs(v,{variant:"outline-info",onClick:z,className:"d-flex align-items-center rounded",children:[e.jsx(K,{className:"me-1"}),"Refresh"]}),e.jsxs(h,{children:[e.jsxs(h.Toggle,{variant:"outline-secondary",className:"d-flex align-items-center",children:[e.jsx(Q,{className:"me-1"}),"Export"]}),e.jsxs(h.Menu,{children:[e.jsxs(h.Item,{onClick:()=>T("excel"),children:[e.jsx(X,{className:"me-2 text-success"})," ","Excel"]}),e.jsxs(h.Item,{onClick:()=>T("pdf"),children:[e.jsx(Z,{className:"me-2 text-danger"})," ","PDF"]}),e.jsxs(h.Item,{onClick:q,children:[e.jsx(ee,{className:"me-2 text-secondary"})," ","Print"]})]})]})]})})]}),e.jsx(F,{children:e.jsx(F.Body,{className:"p-0",children:e.jsx("div",{className:"table-responsive",children:e.jsx(se,{bordered:!0,hover:!0,responsive:!0,id:"promotionTable",className:"align-middle mb-0"})})})})]}),e.jsxs(y,{show:G,onHide:C,centered:!0,size:"lg",children:[e.jsx(y.Header,{closeButton:!0,children:e.jsxs(y.Title,{className:"d-flex align-items-center",children:[e.jsx(S,{className:"me-2"}),"Create Promotion"]})}),e.jsx(y.Body,{children:e.jsxs(s,{onSubmit:R,children:[e.jsxs(p,{children:[e.jsx(i,{md:8,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Title"}),e.jsx(s.Control,{type:"text",name:"title",value:l.title,onChange:d,required:!0})]})}),e.jsx(i,{md:4,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Promo Code"}),e.jsx(s.Control,{type:"text",name:"code",value:l.code,onChange:d,required:!0})]})})]}),e.jsxs(p,{children:[e.jsx(i,{md:4,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Discount Type"}),e.jsxs(s.Select,{name:"discount_type",value:l.discount_type,onChange:d,children:[e.jsx("option",{value:"percentage",children:"Percentage (%)"}),e.jsx("option",{value:"fixed",children:"Fixed Amount ($)"})]})]})}),e.jsx(i,{md:4,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:l.discount_type==="percentage"?"Percentage (%)":"Amount ($)"}),e.jsx(s.Control,{type:"number",name:"discount_value",value:l.discount_value,onChange:d,required:!0,min:"0",step:l.discount_type==="percentage"?"1":"0.01"})]})}),e.jsx(i,{md:4,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Status"}),e.jsxs(s.Select,{name:"status",value:l.status,onChange:d,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"upcoming",children:"Upcoming"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})})]}),e.jsxs(p,{children:[e.jsx(i,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Start Date"}),e.jsx(s.Control,{type:"date",name:"start_date",value:l.start_date,onChange:d,required:!0})]})}),e.jsx(i,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"End Date"}),e.jsx(s.Control,{type:"date",name:"end_date",value:l.end_date,onChange:d,required:!0})]})})]}),e.jsxs(p,{children:[e.jsx(i,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Usage Limit"}),e.jsx(s.Control,{type:"number",name:"usage_limit",value:l.usage_limit,onChange:d,placeholder:"Unlimited if empty",min:"0"})]})}),e.jsx(i,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Minimum Purchase ($)"}),e.jsx(s.Control,{type:"number",name:"minimum_purchase",value:l.minimum_purchase,onChange:d,placeholder:"No minimum",min:"0",step:"0.01"})]})})]}),e.jsxs("div",{className:"text-end",children:[e.jsx(v,{variant:"secondary",onClick:C,className:"me-2",children:"Cancel"}),e.jsx(v,{variant:"primary",type:"submit",children:"Save Promotion"})]})]})})]})]})}export{ge as default};
