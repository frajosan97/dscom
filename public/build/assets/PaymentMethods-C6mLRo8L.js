import{j as e,r as q}from"./app-CcdzEu0R.js";import{u as _}from"./formik.esm-pgZf8OxT.js";import{c as w,a as p}from"./index.esm-lEXyK6iT.js";import{y as k,R as E}from"./Footer-4Livvlxt.js";import{x as P}from"./axios-COTtbvZI.js";import{M as x}from"./Modal-BeCmzXVe.js";import{F as o,C as b,b as T}from"./Form-CLPTCCgE.js";import{B as N}from"./Image-D_GvnDn_.js";import{f as D}from"./helpers-B9XmgPRl.js";import{e as M,q as V,r as B,g as G}from"./index-BMkeTrLY.js";import{C as $}from"./Card-CSAU_t4j.js";import{T as L}from"./Tabs-CvU7mztw.js";import{T as R}from"./Tab-B5PsefMC.js";import{T as z}from"./Table-D-OHgQ10.js";const H=w().shape({name:p().required("Customer name is required").max(255,"Customer name must not exceed 255 characters"),email:p().email("Invalid email address").max(255,"Email must not exceed 255 characters"),phone:p().max(20,"Phone number must not exceed 20 characters"),tax_number:p().max(50,"Tax number must not exceed 50 characters"),address:p().max(500,"Address must not exceed 500 characters")});function oe({show:f,onClose:d,onCustomerAdded:i}){const a=_({initialValues:{name:"",email:"",phone:"",tax_number:"",address:""},validationSchema:H,onSubmit:async(u,{setSubmitting:j,resetForm:m})=>{var h,y;try{(await P.post(route("customers.store"),u)).data.success&&(k.success("Customer added successfully."),m(),d(),i())}catch(c){c.response&&c.response.data.errors?Object.entries(c.response.data.errors).forEach(([v,g])=>{g.forEach(F=>{k.error(`${v}: ${F}`)})}):k.error(((y=(h=c.response)==null?void 0:h.data)==null?void 0:y.message)||"An error occurred while adding the customer")}finally{j(!1)}}});return e.jsxs(x,{show:f,onHide:d,size:"lg",centered:!0,children:[e.jsx(x.Header,{closeButton:!0,className:"border-bottom-0",children:e.jsx(x.Title,{className:"h5",children:"Add New Customer"})}),e.jsxs(o,{onSubmit:a.handleSubmit,noValidate:!0,children:[e.jsx(x.Body,{className:"pt-0",children:e.jsxs(E,{children:[e.jsx(b,{md:6,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsxs(o.Label,{children:["Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(o.Control,{type:"text",name:"name",placeholder:"Customer name",value:a.values.name,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.name&&!!a.errors.name,required:!0}),e.jsx(o.Control.Feedback,{type:"invalid",children:a.errors.name})]})}),e.jsx(b,{md:6,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Email"}),e.jsx(o.Control,{type:"email",name:"email",placeholder:"Customer email",value:a.values.email,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.email&&!!a.errors.email}),e.jsx(o.Control.Feedback,{type:"invalid",children:a.errors.email})]})}),e.jsx(b,{md:6,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Phone"}),e.jsx(o.Control,{type:"text",name:"phone",placeholder:"Phone number",value:a.values.phone,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.phone&&!!a.errors.phone}),e.jsx(o.Control.Feedback,{type:"invalid",children:a.errors.phone})]})}),e.jsx(b,{md:6,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Tax Number"}),e.jsx(o.Control,{type:"text",name:"tax_number",placeholder:"Tax identification number",value:a.values.tax_number,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.tax_number&&!!a.errors.tax_number}),e.jsx(o.Control.Feedback,{type:"invalid",children:a.errors.tax_number})]})}),e.jsx(b,{md:12,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Address"}),e.jsx(o.Control,{as:"textarea",rows:3,name:"address",placeholder:"Full address",value:a.values.address,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.address&&!!a.errors.address}),e.jsx(o.Control.Feedback,{type:"invalid",children:a.errors.address})]})})]})}),e.jsxs(x.Footer,{className:"border-top-0",children:[e.jsx(N,{variant:"outline-secondary",onClick:d,children:"Cancel"}),e.jsx(N,{variant:"primary",type:"submit",disabled:a.isSubmitting,children:a.isSubmitting?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Saving..."]}):"Save Customer"})]})]})]})}const le=({paymentData:f,setPaymentData:d})=>{const i={cash:{icon:e.jsx(B,{className:"me-2"}),label:"Cash",fields:{date:{type:"date",placeholder:"Date"},name:{type:"text",placeholder:"Name"},phone:{type:"text",placeholder:"Phone Number"},amount:{type:"number",placeholder:"Amount"}},required:{name:"Name is required",phone:"Valid phone number is required",amount:"Valid amount is required"}},mpesa:{icon:e.jsx(B,{className:"me-2"}),label:"M-Pesa",fields:{date:{type:"date",placeholder:"Date"},transId:{type:"text",placeholder:"Transaction ID"},name:{type:"text",placeholder:"Name"},phone:{type:"text",placeholder:"Phone Number"},amount:{type:"number",placeholder:"Amount"}},required:{transId:"Transaction ID is required",name:"Name is required",phone:"Valid phone number is required",amount:"Valid amount is required"}},cheque:{icon:e.jsx(V,{className:"me-2"}),label:"Cheque",fields:{date:{type:"date",placeholder:"Date"},bankName:{type:"text",placeholder:"Bank Name"},branch:{type:"text",placeholder:"Branch"},chequeNo:{type:"text",placeholder:"Cheque No"},account:{type:"text",placeholder:"Account"},amount:{type:"number",placeholder:"Amount"}},required:{chequeNo:"Cheque number is required",bankName:"Bank name is required",account:"Account is required",branch:"Branch is required",amount:"Valid amount is required"}}},a=Object.fromEntries(Object.entries(i).map(([r,n])=>[r,Object.fromEntries(Object.keys(n.fields).map(t=>[t,t==="date"?new Date().toISOString().split("T")[0]:""]))])),[u,j]=q.useState(a),[m,h]=q.useState({}),y=Object.keys(i)[0]||null,[c,v]=q.useState(y),g=(r,n,t)=>{j(s=>({...s,[r]:{...s[r],[n]:t}})),m[`${r}_${n}`]&&h(s=>({...s,[`${r}_${n}`]:""}))},F=r=>{const n=u[r],t=i[r].required,s={};for(const[l,C]of Object.entries(t))(!n[l]||l==="amount"&&parseFloat(n[l])<=0)&&(s[`${r}_${l}`]=C),l==="phone"&&n.phone&&n.phone.length<10&&(s[`${r}_${l}`]=C);return h(s),Object.keys(s).length===0},S=r=>{if(!F(r))return;const n=u[r],t={id:Date.now(),...n,amount:parseFloat(n.amount)};d(s=>({...s,[r]:[...s[r]||[],t],balanceAccount:s.balanceAccount+t.amount})),j(s=>({...s,[r]:{...a[r],date:new Date().toISOString().split("T")[0]}}))},A=(r,n)=>{d(t=>{const s=t[r].find(l=>l.id===n);return{...t,[r]:t[r].filter(l=>l.id!==n),balanceAccount:t.balanceAccount-((s==null?void 0:s.amount)||0)}})},I=r=>{const n=u[r],t=i[r].fields;return Object.entries(t).map(([s,l])=>e.jsxs("td",{className:"p-1",children:[e.jsx(T,{type:l.type,placeholder:l.placeholder,value:n[s],onChange:C=>g(r,s,C.target.value),className:"rounded-0",isInvalid:!!m[`${r}_${s}`]}),m[`${r}_${s}`]&&e.jsx(T.Feedback,{type:"invalid",children:m[`${r}_${s}`]})]},s))},O=r=>{const n=f[r]||[],t=Object.keys(i[r].fields);return n.length>0?n.map(s=>e.jsxs("tr",{children:[t.map(l=>e.jsx("td",{children:l==="amount"?D(s[l]):s[l]},l)),e.jsx("td",{children:e.jsx(N,{variant:"danger",size:"sm",className:"rounded-0",onClick:()=>A(r,s.id),children:e.jsx(G,{})})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:t.length+1,className:"text-center",children:"No transactions found"})})};return e.jsx($,{className:"border-0 rounded-0 shadow-sm mt-2",children:e.jsx($.Body,{children:e.jsx(L,{activeKey:c,onSelect:v,transition:!1,children:Object.entries(i).map(([r,n])=>e.jsx(R,{eventKey:r,title:e.jsxs(e.Fragment,{children:[n.icon,n.label]}),children:e.jsxs(z,{striped:!0,responsive:!0,bordered:!0,hover:!0,size:"sm",className:"mt-3",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[Object.keys(n.fields).map(t=>e.jsx("th",{children:n.fields[t].placeholder},t)),e.jsx("th",{children:"Action"})]})}),e.jsxs("tbody",{children:[O(r),e.jsxs("tr",{className:"bg-light",children:[I(r),e.jsx("td",{className:"p-1",style:{width:"1px"},children:e.jsx(N,{variant:"success",className:"rounded-0",onClick:()=>S(r),children:e.jsx(M,{})})})]})]})]})},r))})})})};export{oe as C,le as P};
