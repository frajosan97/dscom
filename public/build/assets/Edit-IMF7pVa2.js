import{r as g,v as E,j as e,$ as T,m as F}from"./app-B06hfKGj.js";import{R as b,B,y as v}from"./Footer-DDeWqo-b.js";import{c as I,b as M}from"./index-DP5C25IF.js";import{E as A}from"./ErpLayout-B3oWaJaT.js";import{u as q}from"./useData-jd9QCWiO.js";import{D as H}from"./DeviceTypeModal-Btsa1lxr.js";import{x as $}from"./axios-y2uZTyoQ.js";import{C as z,B as _}from"./Image-CGBT7qjj.js";import{C as u,F as s}from"./Form-BAgPDe-D.js";import{C as o}from"./Card-DRqWWn-y.js";import"./CloseButton-rn___kEl.js";import"./iconBase-DVvsfse2.js";/* empty css                      */import"./index.esm-BbrbZb-t.js";import"./hoist-non-react-statics.cjs-C-Qo8PK8.js";import"./Modal-DBVdl20f.js";function ne({service:i}){const{deviceTypes:f=[],refreshDeviceTypes:N}=q(),[w,D]=g.useState(!1),[d,x]=g.useState(i.pricings||[]),{data:n,setData:l,errors:c,processing:y}=E({name:i.name,slug:i.slug,description:i.description,detailed_description:i.detailed_description,repair_process:i.repair_process,base_price:i.base_price,estimated_duration:i.estimated_duration,warranty_days:i.warranty_days,is_active:i.is_active,is_featured:i.is_featured,image:i.image,metadata:i.metadata||{},pricings:i.pricings||[]});g.useEffect(()=>{x(i.pricings||[])},[i]);const S=async a=>{var t,r,h,C;a.preventDefault();try{const m=await $.put(route("repair-services.update",i.id),{...n,pricings:d.filter(j=>j.device_type_id)});m.data.success&&(v.success(m.data.message),F.visit(route("repair-services.show",i.id)))}catch(m){if(console.error(m),(r=(t=m.response)==null?void 0:t.data)!=null&&r.errors){const j=m.response.data.errors;Object.values(j).forEach(P=>{P.forEach(R=>{v.error(R)})})}else v.error(((C=(h=m.response)==null?void 0:h.data)==null?void 0:C.message)||"An error occurred while updating the service")}},G=()=>{x([...d,{device_type_id:null,price:0,min_price:null,max_price:null,is_flat_rate:!1,price_notes:""}])},k=a=>{if(d.length>1){const t=[...d];t.splice(a,1),x(t)}},p=(a,t,r)=>{const h=[...d];h[a][t]=r,x(h)},L=()=>{N()};return e.jsxs(A,{children:[e.jsx(T,{title:`Edit ${i.name}`}),e.jsxs(z,{fluid:!0,children:[e.jsx("form",{onSubmit:S,children:e.jsxs(b,{className:"g-4",children:[e.jsx(u,{lg:8,children:e.jsxs(o,{className:"mb-4",children:[e.jsxs(o.Header,{className:"bg-white d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx(I,{className:"me-2"}),e.jsx("strong",{children:"Edit Repair Service"})]}),e.jsxs(B,{bg:"info",children:[e.jsx(M,{className:"me-1"})," Editing"]})]}),e.jsxs(o.Body,{children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Service Name *"}),e.jsx(s.Control,{type:"text",value:n.name,onChange:a=>l("name",a.target.value),isInvalid:!!c.name,required:!0}),c.name&&e.jsx(s.Text,{className:"text-danger",children:c.name})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Slug *"}),e.jsx(s.Control,{type:"text",value:n.slug,onChange:a=>l("slug",a.target.value),isInvalid:!!c.slug,required:!0}),c.slug&&e.jsx(s.Text,{className:"text-danger",children:c.slug})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Description"}),e.jsx(s.Control,{as:"textarea",rows:3,value:n.description,onChange:a=>l("description",a.target.value)})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Detailed Description"}),e.jsx(s.Control,{as:"textarea",rows:5,value:n.detailed_description,onChange:a=>l("detailed_description",a.target.value)})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Repair Process"}),e.jsx(s.Control,{as:"textarea",rows:5,value:n.repair_process,onChange:a=>l("repair_process",a.target.value),placeholder:"Step-by-step repair process..."})]})]})]})}),e.jsxs(u,{lg:4,children:[e.jsxs(o,{className:"mb-4",children:[e.jsx(o.Header,{className:"bg-light",children:e.jsx("h6",{className:"mb-0",children:"Service Settings"})}),e.jsxs(o.Body,{children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Base Price *"}),e.jsx(s.Control,{type:"number",min:"0",step:"0.01",value:n.base_price,onChange:a=>l("base_price",parseFloat(a.target.value)||0),isInvalid:!!c.base_price,required:!0}),c.base_price&&e.jsx(s.Text,{className:"text-danger",children:c.base_price})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Estimated Duration (minutes)"}),e.jsx(s.Control,{type:"number",min:"0",value:n.estimated_duration,onChange:a=>l("estimated_duration",parseInt(a.target.value)||null)})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Warranty Days"}),e.jsx(s.Control,{type:"number",min:"0",value:n.warranty_days,onChange:a=>l("warranty_days",parseInt(a.target.value)||null)})]}),e.jsx(s.Group,{className:"mb-3",children:e.jsx(s.Check,{type:"checkbox",label:"Active Service",checked:n.is_active,onChange:a=>l("is_active",a.target.checked)})}),e.jsx(s.Group,{className:"mb-3",children:e.jsx(s.Check,{type:"checkbox",label:"Featured Service",checked:n.is_featured,onChange:a=>l("is_featured",a.target.checked)})})]})]}),e.jsxs(o,{className:"mb-4",children:[e.jsxs(o.Header,{className:"bg-light d-flex justify-content-between align-items-center",children:[e.jsx("h6",{className:"mb-0",children:"Device Type Pricing"}),e.jsxs(_,{variant:"outline-primary",size:"sm",onClick:G,children:[e.jsx(FiPlus,{})," Add Pricing"]})]}),e.jsx(o.Body,{children:d.map((a,t)=>e.jsxs("div",{className:"mb-3 border-bottom pb-3",children:[e.jsxs(b,{children:[e.jsx(u,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{children:"Device Type"}),e.jsxs(s.Select,{value:a.device_type_id||"",onChange:r=>p(t,"device_type_id",r.target.value?parseInt(r.target.value):null),children:[e.jsx("option",{value:"",children:"Select device type"}),f.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]})}),e.jsx(u,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{children:"Price *"}),e.jsx(s.Control,{type:"number",min:"0",step:"0.01",value:a.price,onChange:r=>p(t,"price",parseFloat(r.target.value)||0),required:!0})]})})]}),e.jsxs(b,{children:[e.jsx(u,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{children:"Min Price"}),e.jsx(s.Control,{type:"number",min:"0",step:"0.01",value:a.min_price||"",onChange:r=>p(t,"min_price",r.target.value?parseFloat(r.target.value):null)})]})}),e.jsx(u,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{children:"Max Price"}),e.jsx(s.Control,{type:"number",min:"0",step:"0.01",value:a.max_price||"",onChange:r=>p(t,"max_price",r.target.value?parseFloat(r.target.value):null)})]})})]}),e.jsx(s.Group,{className:"mb-2",children:e.jsx(s.Check,{type:"checkbox",label:"Flat Rate (ignore min/max)",checked:a.is_flat_rate,onChange:r=>p(t,"is_flat_rate",r.target.checked)})}),e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{children:"Price Notes"}),e.jsx(s.Control,{as:"textarea",rows:2,value:a.price_notes,onChange:r=>p(t,"price_notes",r.target.value)})]}),d.length>1&&e.jsx("div",{className:"text-end",children:e.jsx(_,{variant:"outline-danger",size:"sm",onClick:()=>k(t),children:"Remove"})})]},t))})]}),e.jsx("div",{className:"d-grid gap-2",children:e.jsx(_,{variant:"primary",type:"submit",disabled:y,className:"mb-2",children:y?"Processing...":"Update Service"})})]})]})}),e.jsx(H,{show:w,onClose:()=>D(!1),onDeviceTypeAdded:L})]})]})}export{ne as default};
