import{j as e,r as d,$ as z}from"./app-BHgsMdMN.js";import{R as b,y as w}from"./Footer-D2ooF5pp.js";import{E as A}from"./ErpLayout-BrY7BVt6.js";import{u as O}from"./formik.esm-DTi6m-CK.js";import{c as U,d as F,f as Y,b as k}from"./index.esm-CWCVgkP0.js";import{x as _}from"./axios-C1gTDpqO.js";import{M as x}from"./Modal-DO71Vgag.js";import{F as r,C as i}from"./Form-C31rj1ON.js";import{B as N,C as V}from"./Image-DXsOGyib.js";import{S as y}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{B as H}from"./ButtonGroup-uLXoY3tg.js";import{P as J}from"./plus-circle-DNM8nBv8.js";import{C as q}from"./Card-DbtgvX4L.js";import{T as K}from"./Table-D7zmiFHo.js";import"./CloseButton-qahUCrdS.js";/* empty css                      */import"./hoist-non-react-statics.cjs-C-Qo8PK8.js";function Q({show:C,onHide:o,deviceType:a,parentDeviceTypes:u,onSuccess:v}){const p=!!a,j=U().shape({name:k().required("Name is required"),slug:k().required("Slug is required"),parent_id:F().nullable(),description:k().nullable(),is_active:Y(),order:F().min(0,"Order must be positive")}),s=O({enableReinitialize:!0,initialValues:{name:(a==null?void 0:a.name)||"",slug:(a==null?void 0:a.slug)||"",parent_id:(a==null?void 0:a.parent_id)||null,description:(a==null?void 0:a.description)||"",icon:(a==null?void 0:a.icon)||"",image:(a==null?void 0:a.image)||"",is_active:(a==null?void 0:a.is_active)??!0,order:(a==null?void 0:a.order)||0,_method:p?"PUT":"POST"},validationSchema:j,onSubmit:async(m,{setSubmitting:D,setErrors:S})=>{var g,t;try{const n=p?route("device-type.update",a.id):route("device-type.store"),c=await _.post(n,m);c.data.success===!0&&(v(c.data.message),o())}catch(n){(t=(g=n.response)==null?void 0:g.data)!=null&&t.errors?S(n.response.data.errors):console.error("Error submitting form:",n)}finally{D(!1)}}});return e.jsxs(x,{show:C,onHide:o,size:"lg",centered:!0,backdrop:"static",children:[e.jsx(x.Header,{closeButton:!0,children:e.jsx(x.Title,{children:p?"Edit Device Type":"Create New Device Type"})}),e.jsxs(r,{onSubmit:s.handleSubmit,children:[e.jsxs(x.Body,{children:[e.jsxs(b,{className:"mb-3",children:[e.jsx(i,{md:6,children:e.jsxs(r.Group,{controlId:"name",children:[e.jsx(r.Label,{children:"Name *"}),e.jsx(r.Control,{type:"text",name:"name",value:s.values.name,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.name&&!!s.errors.name}),e.jsx(r.Control.Feedback,{type:"invalid",children:s.errors.name})]})}),e.jsx(i,{md:6,children:e.jsxs(r.Group,{controlId:"slug",children:[e.jsx(r.Label,{children:"Slug *"}),e.jsx(r.Control,{type:"text",name:"slug",value:s.values.slug,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.slug&&!!s.errors.slug}),e.jsx(r.Control.Feedback,{type:"invalid",children:s.errors.slug})]})})]}),e.jsxs(b,{className:"mb-3",children:[e.jsx(i,{md:6,children:e.jsxs(r.Group,{controlId:"parent_id",children:[e.jsx(r.Label,{children:"Parent Category"}),e.jsxs(r.Select,{name:"parent_id",value:s.values.parent_id||"",onChange:s.handleChange,children:[e.jsx("option",{value:"",children:"No Parent (Top Level)"}),u==null?void 0:u.map(m=>e.jsx("option",{value:m.id,children:m.name},m.id))]})]})}),e.jsx(i,{md:6,children:e.jsxs(r.Group,{controlId:"order",children:[e.jsx(r.Label,{children:"Display Order"}),e.jsx(r.Control,{type:"number",min:"0",name:"order",value:s.values.order,onChange:s.handleChange})]})})]}),e.jsxs(r.Group,{controlId:"description",className:"mb-3",children:[e.jsx(r.Label,{children:"Description"}),e.jsx(r.Control,{as:"textarea",rows:3,name:"description",value:s.values.description,onChange:s.handleChange})]}),e.jsxs(b,{className:"mb-3",children:[e.jsx(i,{md:6,children:e.jsxs(r.Group,{controlId:"icon",children:[e.jsx(r.Label,{children:"Icon Class/Code"}),e.jsx(r.Control,{type:"text",name:"icon",value:s.values.icon,onChange:s.handleChange,placeholder:"e.g. fa-solid fa-mobile-screen"})]})}),e.jsx(i,{md:6,children:e.jsxs(r.Group,{controlId:"image",children:[e.jsx(r.Label,{children:"Image URL"}),e.jsx(r.Control,{type:"text",name:"image",value:s.values.image,onChange:s.handleChange,placeholder:"URL to device type image"})]})})]}),e.jsx(r.Group,{controlId:"is_active",className:"mb-3",children:e.jsx(r.Check,{type:"switch",id:"is_active",label:"Active",checked:s.values.is_active,onChange:s.handleChange,name:"is_active"})})]}),e.jsxs(x.Footer,{children:[e.jsx(N,{variant:"secondary",onClick:o,children:"Cancel"}),e.jsx(N,{variant:"primary",type:"submit",disabled:s.isSubmitting,children:s.isSubmitting?"Saving...":"Save Changes"})]})]})]})}function he(){const[C,o]=d.useState(!1),[a,u]=d.useState(null),[v,p]=d.useState([]),j=d.useCallback(()=>{$.fn.DataTable.isDataTable("#deviceTypesTable")&&$("#deviceTypesTable").DataTable().destroy(),$("#deviceTypesTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("device-type.index"),type:"GET"},columns:[{data:"name",title:"Device Type"},{data:"parent_name",title:"Parent Category"},{data:"repair_services_count",title:"Services"},{data:"orders_count",title:"Orders"},{data:"action",title:"Action"}],drawCallback:()=>{$(".edit-btn").off("click").on("click",function(){const t=$(this).data("id");S(t)}),$(".delete-btn").off("click").on("click",function(){const t=$(this).data("id");g(t)})}})},[]);d.useEffect(()=>{j()},[j]);const s=d.useCallback(()=>{u(null),o(!0)},[]),m=d.useCallback(()=>{o(!1),u(null)},[]),D=d.useCallback(t=>{w.success(t),$("#deviceTypesTable").DataTable().ajax.reload(null,!1),o(!1)},[]),S=async t=>{var n,c;try{const l=await _.get(route("device-type.edit",t));l.data.success===!0?(u(l.data.data),o(!0)):w.error(l.data.message)}catch(l){console.log(l),w.error(((c=(n=l.response)==null?void 0:n.data)==null?void 0:c.message)||"An error occurred")}},g=async t=>{var c,l,B,I,E,L,G,M,P,R;if((await y.fire({title:"Delete Device Type?",text:"This cannot be undone. Make sure there are no child categories, services, or orders associated.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await _.delete(route("device-type.destroy",t)),$("#deviceTypesTable").DataTable().ajax.reload(null,!1),y.fire("Deleted!","Device type has been deleted.","success")}catch(f){let h="Delete failed.";((c=f.response)==null?void 0:c.status)===403?h="You don't have permission to delete this device type.":(I=(B=(l=f.response)==null?void 0:l.data)==null?void 0:B.message)!=null&&I.includes("child categories")?h="Cannot delete device type with child categories.":(G=(L=(E=f.response)==null?void 0:E.data)==null?void 0:L.message)!=null&&G.includes("repair services")?h="Cannot delete device type with associated repair services.":(R=(P=(M=f.response)==null?void 0:M.data)==null?void 0:P.message)!=null&&R.includes("existing orders")&&(h="Cannot delete device type with existing orders."),y.fire("Error!",h,"error")}};return e.jsxs(A,{children:[e.jsx(z,{title:"Device Types Management"}),e.jsx(V,{fluid:!0,children:e.jsxs(b,{className:"g-3",children:[e.jsxs(i,{md:12,className:"d-flex justify-content-between align-items-center",children:[e.jsx("h2",{className:"mb-0",children:"Device Types"}),e.jsx(H,{children:e.jsxs(N,{variant:"primary",onClick:s,className:"d-flex align-items-center gap-2",children:[e.jsx(J,{size:18}),"Add New Device Type"]})})]}),e.jsx(i,{md:12,children:e.jsx("hr",{className:"dashed-hr"})}),e.jsx(i,{md:12,children:e.jsx(q,{children:e.jsx(q.Body,{children:e.jsx(K,{bordered:!0,striped:!0,hover:!0,responsive:!0,id:"deviceTypesTable",className:"w-100"})})})})]})}),e.jsx(Q,{show:C,onHide:m,deviceType:a,parentDeviceTypes:v,onSuccess:D})]})}export{he as default};
