import{r as a,j as e,$ as P}from"./app-CGCcTJnQ.js";import{y as d,R as _}from"./Footer-CRm-FYLZ.js";import{E as A}from"./ErpLayout-Dd3SuRvB.js";import{D as R}from"./DeviceTypeModal-C-f_Q-GE.js";import{S as p}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{x as C}from"./axios-Q-ZagsbW.js";import{C as z,B as G}from"./Image-C1oIC0_0.js";import{C as u}from"./Form-CztmhhS9.js";import{B as Y}from"./ButtonGroup-CGPVR6rS.js";import{P as H}from"./plus-circle-DHFvihAX.js";import{C as j}from"./Card-BYpRWYjG.js";import{T as L}from"./Table-DdKforGC.js";import"./CloseButton-DfHhhRN2.js";/* empty css                      */import"./index.esm-DQ4HJBQI.js";import"./hoist-non-react-statics.cjs-C-Qo8PK8.js";import"./Modal-BLOzEIBk.js";function oe(){const[g,o]=a.useState(!1),[w,n]=a.useState(null),[k,O]=a.useState([]),m=a.useCallback(()=>{$.fn.DataTable.isDataTable("#deviceTypesTable")&&$("#deviceTypesTable").DataTable().destroy(),$("#deviceTypesTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("device-type.index"),type:"GET"},columns:[{data:"name",title:"Device Type"},{data:"parent_name",title:"Parent Category"},{data:"repair_services_count",title:"Services"},{data:"orders_count",title:"Orders"},{data:"action",title:"Action"}],drawCallback:()=>{$(".edit-btn").off("click").on("click",function(){const t=$(this).data("id");M(t)}),$(".delete-btn").off("click").on("click",function(){const t=$(this).data("id");N(t)})}})},[]);a.useEffect(()=>{m()},[m]);const S=a.useCallback(()=>{n(null),o(!0)},[]),B=a.useCallback(()=>{o(!1),n(null)},[]),E=a.useCallback(t=>{d.success(t),$("#deviceTypesTable").DataTable().ajax.reload(null,!1),o(!1)},[]),M=async t=>{var l,r;try{const s=await C.get(route("device-type.edit",t));s.data.success===!0?(n(s.data.data),o(!0)):d.error(s.data.message)}catch(s){console.log(s),d.error(((r=(l=s.response)==null?void 0:l.data)==null?void 0:r.message)||"An error occurred")}},N=async t=>{var r,s,f,y,h,v,T,x,b,D;if((await p.fire({title:"Delete Device Type?",text:"This cannot be undone. Make sure there are no child categories, services, or orders associated.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await C.delete(route("device-type.destroy",t)),$("#deviceTypesTable").DataTable().ajax.reload(null,!1),p.fire("Deleted!","Device type has been deleted.","success")}catch(c){let i="Delete failed.";((r=c.response)==null?void 0:r.status)===403?i="You don't have permission to delete this device type.":(y=(f=(s=c.response)==null?void 0:s.data)==null?void 0:f.message)!=null&&y.includes("child categories")?i="Cannot delete device type with child categories.":(T=(v=(h=c.response)==null?void 0:h.data)==null?void 0:v.message)!=null&&T.includes("repair services")?i="Cannot delete device type with associated repair services.":(D=(b=(x=c.response)==null?void 0:x.data)==null?void 0:b.message)!=null&&D.includes("existing orders")&&(i="Cannot delete device type with existing orders."),p.fire("Error!",i,"error")}};return e.jsxs(A,{children:[e.jsx(P,{title:"Device Types Management"}),e.jsx(z,{fluid:!0,children:e.jsxs(_,{className:"g-3",children:[e.jsxs(u,{md:12,className:"d-flex justify-content-between align-items-center",children:[e.jsx("h2",{className:"mb-0",children:"Device Types"}),e.jsx(Y,{children:e.jsxs(G,{variant:"primary",onClick:S,className:"d-flex align-items-center gap-2",children:[e.jsx(H,{size:18}),"Add New Device Type"]})})]}),e.jsx(u,{md:12,children:e.jsx("hr",{className:"dashed-hr"})}),e.jsx(u,{md:12,children:e.jsx(j,{children:e.jsx(j.Body,{children:e.jsx(L,{bordered:!0,striped:!0,hover:!0,responsive:!0,id:"deviceTypesTable",className:"w-100"})})})})]})}),e.jsx(R,{show:g,onHide:B,deviceType:w,parentDeviceTypes:k,onSuccess:E})]})}export{oe as default};
