import{j as e,r as l,$ as q}from"./app-DCWOQcEB.js";import{R as C,y as v}from"./Footer-BFclObC5.js";import{F as B}from"./index-CEjvE2lS.js";import{E as D}from"./ErpLayout-BGMVtiLM.js";import{S as _}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{x as w}from"./axios-D5EJL0v2.js";import{c as E,b as h,e as I,d as M,u as G}from"./index.esm-BIUeSoKG.js";import{M as m}from"./Modal-Fiv6pqri.js";import{F as r,C as c}from"./Form-Dvgdn8VD.js";import{B as T}from"./Image-DQmrh284.js";import{C as k}from"./Card-DPWBKIrz.js";import{B as P}from"./ButtonGroup-54EaPK8M.js";import{T as L}from"./Table-BBH_MeAL.js";import"./CloseButton-1IPjPb9C.js";import"./iconBase-DX_qyhUT.js";/* empty css                      */import"./hoist-non-react-statics.cjs-C-Qo8PK8.js";function R({show:f,onHide:o,method:s,onSuccess:p}){const d=!!s,x=E().shape({name:h().required("Name is required"),code:h().required("Code is required"),description:h().nullable(),is_active:M(),is_default:M(),requires_approval:M(),processing_fee:I().min(0,"Fee cannot be negative"),fee_type:h().oneOf(["fixed","percentage"]).required("Fee type is required")}),a=G({enableReinitialize:!0,initialValues:{name:(s==null?void 0:s.name)||"",code:(s==null?void 0:s.code)||"",description:(s==null?void 0:s.description)||"",is_active:(s==null?void 0:s.is_active)??!0,is_default:(s==null?void 0:s.is_default)??!1,requires_approval:(s==null?void 0:s.requires_approval)??!1,processing_fee:(s==null?void 0:s.processing_fee)||0,fee_type:(s==null?void 0:s.fee_type)||"fixed",_method:d?"PUT":"POST"},validationSchema:x,onSubmit:async(y,{setSubmitting:b,setErrors:j})=>{var t,u;try{const n=d?route("payment-method.update",s.id):route("payment-method.store"),i=await w.post(n,y);i.data.success===!0&&(p(i.data.message),o())}catch(n){console.log(n),(u=(t=n.response)==null?void 0:t.data)!=null&&u.errors?j(n.response.data.errors):console.error("Error submitting form:",n)}finally{b(!1)}}});return e.jsxs(m,{show:f,onHide:o,size:"lg",centered:!0,backdrop:"static",children:[e.jsx(m.Header,{closeButton:!0,children:e.jsx(m.Title,{children:d?"Edit Payment Method":"Create New Payment Method"})}),e.jsxs(r,{onSubmit:a.handleSubmit,children:[e.jsxs(m.Body,{children:[e.jsxs(C,{className:"mb-3",children:[e.jsx(c,{md:6,children:e.jsxs(r.Group,{controlId:"name",children:[e.jsx(r.Label,{children:"Name *"}),e.jsx(r.Control,{type:"text",name:"name",value:a.values.name,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.name&&!!a.errors.name}),e.jsx(r.Control.Feedback,{type:"invalid",children:a.errors.name})]})}),e.jsx(c,{md:6,children:e.jsxs(r.Group,{controlId:"code",children:[e.jsx(r.Label,{children:"Code *"}),e.jsx(r.Control,{type:"text",name:"code",value:a.values.code,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.code&&!!a.errors.code}),e.jsx(r.Control.Feedback,{type:"invalid",children:a.errors.code})]})})]}),e.jsxs(r.Group,{controlId:"description",className:"mb-3",children:[e.jsx(r.Label,{children:"Description"}),e.jsx(r.Control,{as:"textarea",rows:2,name:"description",value:a.values.description,onChange:a.handleChange})]}),e.jsxs(C,{className:"mb-3",children:[e.jsx(c,{md:6,children:e.jsxs(r.Group,{controlId:"processing_fee",children:[e.jsx(r.Label,{children:"Processing Fee"}),e.jsx(r.Control,{type:"number",min:"0",step:"0.01",name:"processing_fee",value:a.values.processing_fee,onChange:a.handleChange,isInvalid:a.touched.processing_fee&&!!a.errors.processing_fee}),e.jsx(r.Control.Feedback,{type:"invalid",children:a.errors.processing_fee})]})}),e.jsx(c,{md:6,children:e.jsxs(r.Group,{controlId:"fee_type",children:[e.jsx(r.Label,{children:"Fee Type"}),e.jsxs(r.Select,{name:"fee_type",value:a.values.fee_type,onChange:a.handleChange,isInvalid:a.touched.fee_type&&!!a.errors.fee_type,children:[e.jsx("option",{value:"fixed",children:"Fixed Amount"}),e.jsx("option",{value:"percentage",children:"Percentage"})]}),e.jsx(r.Control.Feedback,{type:"invalid",children:a.errors.fee_type})]})})]}),e.jsxs(C,{className:"mb-3",children:[e.jsx(c,{children:e.jsx(r.Check,{type:"switch",id:"is_active",label:"Active",checked:a.values.is_active,onChange:a.handleChange,name:"is_active"})}),e.jsx(c,{children:e.jsx(r.Check,{type:"switch",id:"is_default",label:"Default Method",checked:a.values.is_default,onChange:a.handleChange,name:"is_default"})}),e.jsx(c,{children:e.jsx(r.Check,{type:"switch",id:"requires_approval",label:"Requires Approval",checked:a.values.requires_approval,onChange:a.handleChange,name:"requires_approval"})})]})]}),e.jsxs(m.Footer,{children:[e.jsx(T,{variant:"secondary",onClick:o,children:"Cancel"}),e.jsx(T,{variant:"primary",type:"submit",disabled:a.isSubmitting,children:a.isSubmitting?"Saving...":"Save Changes"})]})]})]})}function te(){const[f,o]=l.useState(!1),[s,p]=l.useState(null),d=l.useCallback(()=>{$.fn.DataTable.isDataTable("#paymentMethodsTable")&&$("#paymentMethodsTable").DataTable().destroy(),$("#paymentMethodsTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("payment-method.index"),type:"GET"},columns:[{data:"name",title:"Name"},{data:"code",title:"Code"},{data:"fee",title:"Processing Fee"},{data:"status",title:"Status"},{data:"action",title:"Actions"}],drawCallback:()=>{$(".edit-btn").off("click").on("click",function(){const t=$(this).data("id");b(t)}),$(".delete-btn").off("click").on("click",function(){const t=$(this).data("id");j(t)})}})},[]);l.useEffect(()=>{d()},[d]);const x=l.useCallback(()=>{p(null),o(!0)},[]),a=l.useCallback(()=>{o(!1),p(null)},[]),y=l.useCallback(t=>{v.success(t),$("#paymentMethodsTable").DataTable().ajax.reload(null,!1),o(!1)},[]),b=async t=>{var u,n;try{const i=await w.get(route("payment-method.edit",t));i.data.success===!0?(p(i.data.data),o(!0)):v.error(i.data.message)}catch(i){v.error(((n=(u=i.response)==null?void 0:u.data)==null?void 0:n.message)||"An error occurred")}},j=async t=>{var n,i,S,F;if((await _.fire({title:"Delete Payment Method?",text:"This cannot be undone. Transactions using this method will be preserved.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await w.delete(route("payment-method.destroy",t)),$("#paymentMethodsTable").DataTable().ajax.reload(null,!1),_.fire("Deleted!","Payment method has been deleted.","success")}catch(N){let g="Delete failed.";((n=N.response)==null?void 0:n.status)===403?g="You don't have permission to delete this method.":(F=(S=(i=N.response)==null?void 0:i.data)==null?void 0:S.message)!=null&&F.includes("default")&&(g="Cannot delete default payment method."),_.fire("Error!",g,"error")}};return e.jsxs(D,{children:[e.jsx(q,{title:"Payment Methods Management"}),e.jsxs(k,{className:"border-0 rounded-0 shadow-sm",children:[e.jsxs(k.Header,{className:"d-flex justify-content-between align-items-center bg-transparent",children:[e.jsx("h6",{className:"mb-0 fw-semibold",children:"Payment Methods Management"}),e.jsx(P,{children:e.jsx(P,{children:e.jsxs(T,{variant:"outline-secondary",size:"sm",className:"rounded-1 d-flex align-items-center",onClick:x,children:[e.jsx(B,{className:"me-1"}),"New Payment Method"]})})})]}),e.jsx(k.Body,{className:"px-0",children:e.jsx(L,{bordered:!0,striped:!0,hover:!0,responsive:!0,id:"paymentMethodsTable",className:"w-100"})})]}),e.jsx(R,{show:f,onHide:a,method:s,onSuccess:y})]})}export{te as default};
