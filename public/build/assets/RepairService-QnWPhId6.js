import{j as e,r as h,$ as E}from"./app-B06hfKGj.js";import{R as C,N as m,y as B}from"./Footer-DDeWqo-b.js";import{E as F}from"./ErpLayout-B3oWaJaT.js";import{c as M,e as G,b as T,a as p,d as N,u as q}from"./index.esm-BbrbZb-t.js";import{x as P}from"./axios-y2uZTyoQ.js";import{M as _}from"./Modal-DBVdl20f.js";import{F as s,C as l}from"./Form-BAgPDe-D.js";import{T as f}from"./Tab-BEO_8HHj.js";import{B as I,C as K}from"./Image-CGBT7qjj.js";import{S as D}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{u as A}from"./useData-jd9QCWiO.js";import{f as z}from"./helpers-DttltY_4.js";import{B as O}from"./ButtonGroup-Ii35VLGf.js";import{P as V}from"./plus-circle-yGFMuRom.js";import{C as L}from"./Card-DRqWWn-y.js";import{T as W}from"./Table-BvYtOJoC.js";import"./CloseButton-rn___kEl.js";/* empty css                      */import"./hoist-non-react-statics.cjs-C-Qo8PK8.js";function Y({show:v,onHide:o,service:r,deviceTypes:j,onSuccess:S}){var y,g;const x=!!r,w=M().shape({name:N().required("Name is required"),slug:N().required("Slug is required"),base_price:p().required("Base price is required").min(0,"Price must be positive"),estimated_duration:p().nullable().min(0,"Duration must be positive"),warranty_days:p().nullable().min(0,"Warranty days must be positive"),is_active:T(),is_featured:T(),device_types:G().of(M().shape({id:p().required(),price:p().required("Price is required").min(0,"Price must be positive"),min_price:p().nullable().min(0,"Min price must be positive"),max_price:p().nullable().min(0,"Max price must be positive"),is_flat_rate:T(),price_notes:N().nullable()}))}),a=q({enableReinitialize:!0,initialValues:{name:(r==null?void 0:r.name)||"",slug:(r==null?void 0:r.slug)||"",description:(r==null?void 0:r.description)||"",detailed_description:(r==null?void 0:r.detailed_description)||"",repair_process:(r==null?void 0:r.repair_process)||"",base_price:(r==null?void 0:r.base_price)||0,estimated_duration:(r==null?void 0:r.estimated_duration)||null,warranty_days:(r==null?void 0:r.warranty_days)||null,is_active:(r==null?void 0:r.is_active)??!0,is_featured:(r==null?void 0:r.is_featured)??!1,image:(r==null?void 0:r.image)||null,device_types:((y=r==null?void 0:r.device_types)==null?void 0:y.map(i=>({id:i.id,name:i.name,price:i.pivot.price,min_price:i.pivot.min_price,max_price:i.pivot.max_price,is_flat_rate:i.pivot.is_flat_rate,price_notes:i.pivot.price_notes})))||j.map(i=>({id:i.id,name:i.name,price:0,min_price:null,max_price:null,is_flat_rate:!1,price_notes:""})),_method:x?"PUT":"POST"},validationSchema:w,onSubmit:async(i,{setSubmitting:t,setErrors:c})=>{var d,n;try{const u=x?route("repair-service.update",r.id):route("repair-service.store"),b=await P.post(u,i);b.data.success===!0&&(S(b.data.message),o())}catch(u){(n=(d=u.response)==null?void 0:d.data)!=null&&n.errors&&c(u.response.data.errors)}finally{t(!1)}}});return e.jsxs(_,{show:v,onHide:o,size:"xl",centered:!0,backdrop:"static",children:[e.jsx(_.Header,{closeButton:!0,children:e.jsx(_.Title,{children:x?"Edit Repair Service":"Create New Repair Service"})}),e.jsxs(s,{onSubmit:a.handleSubmit,children:[e.jsx(_.Body,{children:e.jsx(f.Container,{defaultActiveKey:"basic",children:e.jsxs(C,{children:[e.jsx(l,{md:3,children:e.jsxs(m,{variant:"pills",className:"flex-column",children:[e.jsx(m.Item,{children:e.jsx(m.Link,{eventKey:"basic",children:"Basic Information"})}),e.jsx(m.Item,{children:e.jsx(m.Link,{eventKey:"pricing",children:"Pricing by Device"})}),e.jsx(m.Item,{children:e.jsx(m.Link,{eventKey:"details",children:"Service Details"})})]})}),e.jsx(l,{md:9,children:e.jsxs(f.Content,{children:[e.jsxs(f.Pane,{eventKey:"basic",children:[e.jsxs(C,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsxs(s.Group,{controlId:"name",children:[e.jsx(s.Label,{children:"Service Name *"}),e.jsx(s.Control,{type:"text",name:"name",value:a.values.name,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.name&&!!a.errors.name}),e.jsx(s.Control.Feedback,{type:"invalid",children:a.errors.name})]})}),e.jsx(l,{md:6,children:e.jsxs(s.Group,{controlId:"slug",children:[e.jsx(s.Label,{children:"Slug *"}),e.jsx(s.Control,{type:"text",name:"slug",value:a.values.slug,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.slug&&!!a.errors.slug}),e.jsx(s.Control.Feedback,{type:"invalid",children:a.errors.slug})]})})]}),e.jsxs(C,{className:"mb-3",children:[e.jsx(l,{md:4,children:e.jsxs(s.Group,{controlId:"base_price",children:[e.jsx(s.Label,{children:"Base Price (â‚¦) *"}),e.jsx(s.Control,{type:"number",min:"0",step:"0.01",name:"base_price",value:a.values.base_price,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.base_price&&!!a.errors.base_price}),e.jsx(s.Control.Feedback,{type:"invalid",children:a.errors.base_price})]})}),e.jsx(l,{md:4,children:e.jsxs(s.Group,{controlId:"estimated_duration",children:[e.jsx(s.Label,{children:"Estimated Duration (minutes)"}),e.jsx(s.Control,{type:"number",min:"0",name:"estimated_duration",value:a.values.estimated_duration||"",onChange:a.handleChange})]})}),e.jsx(l,{md:4,children:e.jsxs(s.Group,{controlId:"warranty_days",children:[e.jsx(s.Label,{children:"Warranty (days)"}),e.jsx(s.Control,{type:"number",min:"0",name:"warranty_days",value:a.values.warranty_days||"",onChange:a.handleChange})]})})]}),e.jsxs(C,{className:"mb-3",children:[e.jsx(l,{children:e.jsx(s.Check,{type:"switch",id:"is_active",label:"Active",checked:a.values.is_active,onChange:a.handleChange,name:"is_active"})}),e.jsx(l,{children:e.jsx(s.Check,{type:"switch",id:"is_featured",label:"Featured",checked:a.values.is_featured,onChange:a.handleChange,name:"is_featured"})})]}),e.jsxs(s.Group,{controlId:"description",className:"mb-3",children:[e.jsx(s.Label,{children:"Short Description"}),e.jsx(s.Control,{as:"textarea",rows:3,name:"description",value:a.values.description,onChange:a.handleChange})]})]}),e.jsxs(f.Pane,{eventKey:"pricing",children:[e.jsx("h5",{className:"mb-3",children:"Device Type Pricing"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Device Type"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Min Price"}),e.jsx("th",{children:"Max Price"}),e.jsx("th",{children:"Flat Rate"}),e.jsx("th",{children:"Notes"})]})}),e.jsx("tbody",{children:(g=a.values.device_types)==null?void 0:g.map((i,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:i.name}),e.jsx("td",{children:e.jsx(s.Control,{type:"number",min:"0",step:"0.01",name:`device_types[${t}].price`,value:i.price,onChange:a.handleChange,onBlur:a.handleBlur})}),e.jsx("td",{children:e.jsx(s.Control,{type:"number",min:"0",step:"0.01",name:`device_types[${t}].min_price`,value:i.min_price||"",onChange:a.handleChange,onBlur:a.handleBlur})}),e.jsx("td",{children:e.jsx(s.Control,{type:"number",min:"0",step:"0.01",name:`device_types[${t}].max_price`,value:i.max_price||"",onChange:a.handleChange,onBlur:a.handleBlur})}),e.jsx("td",{className:"text-center",children:e.jsx(s.Check,{type:"switch",name:`device_types[${t}].is_flat_rate`,checked:i.is_flat_rate,onChange:c=>{a.setFieldValue(`device_types[${t}].is_flat_rate`,c.target.checked)}})}),e.jsx("td",{children:e.jsx(s.Control,{type:"text",name:`device_types[${t}].price_notes`,value:i.price_notes||"",onChange:a.handleChange,onBlur:a.handleBlur})})]},i.id))})]})})]}),e.jsxs(f.Pane,{eventKey:"details",children:[e.jsxs(s.Group,{controlId:"detailed_description",className:"mb-3",children:[e.jsx(s.Label,{children:"Detailed Description"}),e.jsx(s.Control,{as:"textarea",rows:5,name:"detailed_description",value:a.values.detailed_description,onChange:a.handleChange})]}),e.jsxs(s.Group,{controlId:"repair_process",className:"mb-3",children:[e.jsx(s.Label,{children:"Repair Process"}),e.jsx(s.Control,{as:"textarea",rows:5,name:"repair_process",value:a.values.repair_process,onChange:a.handleChange})]})]})]})})]})})}),e.jsxs(_.Footer,{children:[e.jsx(I,{variant:"secondary",onClick:o,children:"Cancel"}),e.jsx(I,{variant:"primary",type:"submit",disabled:a.isSubmitting,children:a.isSubmitting?"Saving...":"Save Changes"})]})]})]})}function me(){const[v,o]=h.useState(!1),[r,j]=h.useState(null),{deviceTypes:S}=A(),x=h.useCallback(()=>{$.fn.DataTable.isDataTable("#repairServicesTable")&&$("#repairServicesTable").DataTable().destroy(),$("#repairServicesTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("repair-service.index"),type:"GET"},columns:[{data:"name",title:"Service Name"},{data:"base_price",title:"Base Price",render:function(t){return z(t)||"0"}},{data:"orders_count",title:"Orders"},{data:"status",title:"Status"},{data:"action",title:"Actions"}],drawCallback:()=>{$(".edit-btn").off("click").on("click",function(){const t=$(this).data("id");g(t)}),$(".delete-btn").off("click").on("click",function(){const t=$(this).data("id");i(t)})}})},[]);h.useEffect(()=>{x()},[x]);const w=h.useCallback(()=>{j(null),o(!0)},[]),a=h.useCallback(()=>{o(!1),j(null)},[]),y=h.useCallback(t=>{B.success(t),$("#repairServicesTable").DataTable().ajax.reload(null,!1),o(!1)},[]),g=async t=>{var c,d;try{const n=await P.get(route("repair-service.edit",t));n.data.success===!0?(j(n.data.data),o(!0)):B.error(n.data.message)}catch(n){console.log(n),B.error(((d=(c=n.response)==null?void 0:c.data)==null?void 0:d.message)||"An error occurred")}},i=async t=>{var d,n,u,b;if((await D.fire({title:"Delete Repair Service?",text:"This cannot be undone. Make sure there are no orders associated with this service.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await P.delete(route("repair-service.destroy",t)),$("#repairServicesTable").DataTable().ajax.reload(null,!1),D.fire("Deleted!","Repair service has been deleted.","success")}catch(R){let k="Delete failed.";((d=R.response)==null?void 0:d.status)===403?k="You don't have permission to delete this service.":(b=(u=(n=R.response)==null?void 0:n.data)==null?void 0:u.message)!=null&&b.includes("existing orders")&&(k="Cannot delete service with existing orders."),D.fire("Error!",k,"error")}};return e.jsxs(F,{children:[e.jsx(E,{title:"Repair Services Management"}),e.jsx(K,{fluid:!0,children:e.jsxs(C,{className:"g-3",children:[e.jsxs(l,{md:12,className:"d-flex justify-content-between align-items-center",children:[e.jsx("h2",{className:"mb-0",children:"Repair Services"}),e.jsx(O,{children:e.jsxs(I,{variant:"primary",onClick:w,className:"d-flex align-items-center gap-2",children:[e.jsx(V,{size:18}),"Add New Service"]})})]}),e.jsx(l,{md:12,children:e.jsx("hr",{className:"dashed-hr"})}),e.jsx(l,{md:12,children:e.jsx(L,{children:e.jsx(L.Body,{children:e.jsx(W,{bordered:!0,striped:!0,hover:!0,responsive:!0,id:"repairServicesTable",className:"w-100"})})})})]})}),e.jsx(Y,{show:v,onHide:a,service:r,deviceTypes:S,onSuccess:y})]})}export{me as default};
