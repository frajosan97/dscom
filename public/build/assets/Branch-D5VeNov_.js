import{j as e,r as x,$ as T}from"./app-B6bJk2Gh.js";import{R as d,y as B}from"./Footer-BPljjA9E.js";import{e as D}from"./index-DlT5eHnA.js";import{E as L}from"./ErpLayout-S_Bw1Fr5.js";import{S as w}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{x as N}from"./axios-Bz5UAVk7.js";import{u as G}from"./formik.esm-B4gcRhUr.js";import{c as q,b as c,f as y}from"./index.esm-Bxz4JLJR.js";import{M as C}from"./Modal-DiTdyzUT.js";import{F as l,C as n}from"./Form-Clbnm1Ud.js";import{B as g}from"./Image-CDh2egit.js";import{C as I}from"./Card-BMU9SnLN.js";import{B as F}from"./ButtonGroup-DpsXod-K.js";import{T as M}from"./Table-Dd8Z3mE4.js";import"./CloseButton-BElCAkq0.js";import"./iconBase-Gnfgm25M.js";/* empty css                      */import"./hoist-non-react-statics.cjs-C-Qo8PK8.js";function E({show:v,onHide:u,branch:a,onSuccess:j}){const p=!!a,_=q().shape({name:c().required("Name is required"),code:c().required("Code is required"),email:c().email("Invalid email format").nullable(),phone:c().required("Phone is required"),address:c().required("Address is required"),city:c().required("City is required"),state:c().required("State is required"),country:c().required("Country is required"),postal_code:c().required("Postal code is required"),is_active:y(),is_online:y(),has_pickup:y(),has_delivery:y(),currency:c().required("Currency is required")}),s=G({enableReinitialize:!0,initialValues:{name:(a==null?void 0:a.name)||"",code:(a==null?void 0:a.code)||"",email:(a==null?void 0:a.email)||"",phone:(a==null?void 0:a.phone)||"",manager_name:(a==null?void 0:a.manager_name)||"",manager_contact:(a==null?void 0:a.manager_contact)||"",address:(a==null?void 0:a.address)||"",city:(a==null?void 0:a.city)||"",state:(a==null?void 0:a.state)||"",country:(a==null?void 0:a.country)||"drc",postal_code:(a==null?void 0:a.postal_code)||"",latitude:(a==null?void 0:a.latitude)||"",longitude:(a==null?void 0:a.longitude)||"",opening_time:(a==null?void 0:a.opening_time)||"",closing_time:(a==null?void 0:a.closing_time)||"",working_days:(a==null?void 0:a.working_days)||[],is_active:(a==null?void 0:a.is_active)??!0,is_online:(a==null?void 0:a.is_online)??!1,has_pickup:(a==null?void 0:a.has_pickup)??!1,has_delivery:(a==null?void 0:a.has_delivery)??!1,delivery_radius:(a==null?void 0:a.delivery_radius)||"",delivery_fee:(a==null?void 0:a.delivery_fee)||"",currency:(a==null?void 0:a.currency)||"CDF",notes:(a==null?void 0:a.notes)||"",_method:p?"PUT":"POST"},validationSchema:_,onSubmit:async(i,{setSubmitting:t,setErrors:h})=>{var r,o;try{const m=p?route("branch.update",a.id):route("branch.store"),S=await N.post(m,i);S.data.success===!0&&(j(S.data.message),u())}catch(m){(o=(r=m.response)==null?void 0:r.data)!=null&&o.errors?h(m.response.data.errors):console.error("Error submitting form:",m)}finally{t(!1)}}}),f=[{id:1,name:"Monday"},{id:2,name:"Tuesday"},{id:3,name:"Wednesday"},{id:4,name:"Thursday"},{id:5,name:"Friday"},{id:6,name:"Saturday"},{id:7,name:"Sunday"}],k=i=>{const t=s.values.working_days||[],h=t.includes(i)?t.filter(r=>r!==i):[...t,i];s.setFieldValue("working_days",h)};return e.jsxs(C,{show:v,onHide:u,size:"lg",centered:!0,backdrop:"static",children:[e.jsx(C.Header,{closeButton:!0,children:e.jsx(C.Title,{children:p?"Edit Branch":"Create New Branch"})}),e.jsxs(l,{onSubmit:s.handleSubmit,children:[e.jsxs(C.Body,{children:[e.jsxs(d,{className:"mb-3",children:[e.jsx(n,{md:6,children:e.jsxs(l.Group,{controlId:"name",children:[e.jsx(l.Label,{children:"Name *"}),e.jsx(l.Control,{type:"text",name:"name",value:s.values.name,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.name&&!!s.errors.name}),e.jsx(l.Control.Feedback,{type:"invalid",children:s.errors.name})]})}),e.jsx(n,{md:6,children:e.jsxs(l.Group,{controlId:"code",children:[e.jsx(l.Label,{children:"Code *"}),e.jsx(l.Control,{type:"text",name:"code",value:s.values.code,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.code&&!!s.errors.code}),e.jsx(l.Control.Feedback,{type:"invalid",children:s.errors.code})]})})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(n,{md:6,children:e.jsxs(l.Group,{controlId:"email",children:[e.jsx(l.Label,{children:"Email"}),e.jsx(l.Control,{type:"email",name:"email",value:s.values.email,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.email&&!!s.errors.email}),e.jsx(l.Control.Feedback,{type:"invalid",children:s.errors.email})]})}),e.jsx(n,{md:6,children:e.jsxs(l.Group,{controlId:"phone",children:[e.jsx(l.Label,{children:"Phone *"}),e.jsx(l.Control,{type:"text",name:"phone",value:s.values.phone,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.phone&&!!s.errors.phone}),e.jsx(l.Control.Feedback,{type:"invalid",children:s.errors.phone})]})})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(n,{md:6,children:e.jsxs(l.Group,{controlId:"manager_name",children:[e.jsx(l.Label,{children:"Manager Name"}),e.jsx(l.Control,{type:"text",name:"manager_name",value:s.values.manager_name,onChange:s.handleChange})]})}),e.jsx(n,{md:6,children:e.jsxs(l.Group,{controlId:"manager_contact",children:[e.jsx(l.Label,{children:"Manager Contact"}),e.jsx(l.Control,{type:"text",name:"manager_contact",value:s.values.manager_contact,onChange:s.handleChange})]})})]}),e.jsxs(l.Group,{controlId:"address",className:"mb-3",children:[e.jsx(l.Label,{children:"Address *"}),e.jsx(l.Control,{as:"textarea",rows:2,name:"address",value:s.values.address,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.address&&!!s.errors.address}),e.jsx(l.Control.Feedback,{type:"invalid",children:s.errors.address})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(n,{md:4,children:e.jsxs(l.Group,{controlId:"city",children:[e.jsx(l.Label,{children:"City *"}),e.jsx(l.Control,{type:"text",name:"city",value:s.values.city,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.city&&!!s.errors.city}),e.jsx(l.Control.Feedback,{type:"invalid",children:s.errors.city})]})}),e.jsx(n,{md:4,children:e.jsxs(l.Group,{controlId:"state",children:[e.jsx(l.Label,{children:"State *"}),e.jsx(l.Control,{type:"text",name:"state",value:s.values.state,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.state&&!!s.errors.state}),e.jsx(l.Control.Feedback,{type:"invalid",children:s.errors.state})]})}),e.jsx(n,{md:4,children:e.jsxs(l.Group,{controlId:"postal_code",children:[e.jsx(l.Label,{children:"Postal Code *"}),e.jsx(l.Control,{type:"text",name:"postal_code",value:s.values.postal_code,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.postal_code&&!!s.errors.postal_code}),e.jsx(l.Control.Feedback,{type:"invalid",children:s.errors.postal_code})]})})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(n,{md:6,children:e.jsxs(l.Group,{controlId:"country",children:[e.jsx(l.Label,{children:"Country *"}),e.jsxs(l.Control,{as:"select",name:"country",value:s.values.country,onChange:s.handleChange,children:[e.jsx("option",{value:"drc",children:"DR Congo"}),e.jsx("option",{value:"other",children:"Other"})]})]})}),e.jsx(n,{md:6,children:e.jsxs(l.Group,{controlId:"currency",children:[e.jsx(l.Label,{children:"Currency *"}),e.jsxs(l.Control,{as:"select",name:"currency",value:s.values.currency,onChange:s.handleChange,children:[e.jsx("option",{value:"CDF",children:"CDF"}),e.jsx("option",{value:"USD",children:"USD"})]})]})})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(n,{md:6,children:e.jsxs(l.Group,{controlId:"opening_time",children:[e.jsx(l.Label,{children:"Opening Time"}),e.jsx(l.Control,{type:"time",name:"opening_time",value:s.values.opening_time,onChange:s.handleChange})]})}),e.jsx(n,{md:6,children:e.jsxs(l.Group,{controlId:"closing_time",children:[e.jsx(l.Label,{children:"Closing Time"}),e.jsx(l.Control,{type:"time",name:"closing_time",value:s.values.closing_time,onChange:s.handleChange})]})})]}),e.jsxs(l.Group,{controlId:"working_days",className:"mb-3",children:[e.jsx(l.Label,{children:"Working Days"}),e.jsx("div",{className:"d-flex flex-wrap gap-2",children:f.map(i=>{var t;return e.jsx(g,{variant:(t=s.values.working_days)!=null&&t.includes(i.id)?"primary":"outline-secondary",onClick:()=>k(i.id),size:"sm",children:i.name},i.id)})})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(n,{md:6,children:e.jsxs(l.Group,{controlId:"latitude",children:[e.jsx(l.Label,{children:"Latitude"}),e.jsx(l.Control,{type:"number",step:"0.000001",name:"latitude",value:s.values.latitude,onChange:s.handleChange})]})}),e.jsx(n,{md:6,children:e.jsxs(l.Group,{controlId:"longitude",children:[e.jsx(l.Label,{children:"Longitude"}),e.jsx(l.Control,{type:"number",step:"0.000001",name:"longitude",value:s.values.longitude,onChange:s.handleChange})]})})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(n,{children:e.jsx(l.Check,{type:"switch",id:"is_active",label:"Is Active",checked:s.values.is_active,onChange:s.handleChange,name:"is_active"})}),e.jsx(n,{children:e.jsx(l.Check,{type:"switch",id:"is_online",label:"Supports Online Orders",checked:s.values.is_online,onChange:s.handleChange,name:"is_online"})})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(n,{children:e.jsx(l.Check,{type:"switch",id:"has_pickup",label:"Supports Pickup",checked:s.values.has_pickup,onChange:s.handleChange,name:"has_pickup"})}),e.jsx(n,{children:e.jsx(l.Check,{type:"switch",id:"has_delivery",label:"Supports Delivery",checked:s.values.has_delivery,onChange:s.handleChange,name:"has_delivery"})})]}),s.values.has_delivery&&e.jsxs(d,{className:"mb-3",children:[e.jsx(n,{md:6,children:e.jsxs(l.Group,{controlId:"delivery_radius",children:[e.jsx(l.Label,{children:"Delivery Radius (km)"}),e.jsx(l.Control,{type:"number",min:"0",name:"delivery_radius",value:s.values.delivery_radius,onChange:s.handleChange})]})}),e.jsx(n,{md:6,children:e.jsxs(l.Group,{controlId:"delivery_fee",children:[e.jsx(l.Label,{children:"Delivery Fee"}),e.jsx(l.Control,{type:"number",min:"0",step:"0.01",name:"delivery_fee",value:s.values.delivery_fee,onChange:s.handleChange})]})})]}),e.jsxs(l.Group,{controlId:"notes",className:"mb-3",children:[e.jsx(l.Label,{children:"Notes"}),e.jsx(l.Control,{as:"textarea",rows:3,name:"notes",value:s.values.notes,onChange:s.handleChange})]})]}),e.jsxs(C.Footer,{children:[e.jsx(g,{variant:"secondary",onClick:u,children:"Cancel"}),e.jsx(g,{variant:"primary",type:"submit",disabled:s.isSubmitting,children:s.isSubmitting?"Saving...":"Save Changes"})]})]})]})}function ae(){const[v,u]=x.useState(!1),[a,j]=x.useState(null),p=x.useCallback(()=>{$.fn.DataTable.isDataTable("#branchesTable")&&$("#branchesTable").DataTable().destroy(),$("#branchesTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("branch.index"),type:"GET"},columns:[{data:"name",title:"Name"},{data:"code",title:"Code"},{data:"city",title:"City"},{data:"phone",title:"Phone"},{data:"status_badge",title:"Status"},{data:"action",title:"Actions"}],drawCallback:()=>{$(".edit-btn").off("click").on("click",function(){const t=$(this).data("id");k(t)}),$(".delete-btn").off("click").on("click",function(){const t=$(this).data("id");i(t)})}})},[]);x.useEffect(()=>{p()},[p]);const _=x.useCallback(()=>{j(null),u(!0)},[]),s=x.useCallback(()=>{u(!1),j(null)},[]),f=x.useCallback(t=>{B.success(t),$("#branchesTable").DataTable().ajax.reload(null,!1),u(!1)},[]),k=async t=>{var h,r;try{const o=await N.get(route("branch.edit",t));o.data.success===!0?(j(o.data.data),u(!0)):B.error(o.data.message)}catch(o){console.log(o),B.error(((r=(h=o.response)==null?void 0:h.data)==null?void 0:r.message)||"An error occurred")}},i=async t=>{var r;if((await w.fire({title:"Delete Branch?",text:"This cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await N.delete(route("branch.destroy",t)),$("#branchesTable").DataTable().ajax.reload(null,!1),w.fire("Deleted!","Branch has been deleted.","success")}catch(o){let m="Delete failed.";((r=o.response)==null?void 0:r.status)===403&&(m="You don't have permission to delete this branch."),w.fire("Error!",m,"error")}};return e.jsxs(L,{children:[e.jsx(T,{title:"Branches Management"}),e.jsxs(I,{className:"border-0 rounded-0 shadow-sm",children:[e.jsxs(I.Header,{className:"d-flex justify-content-between align-items-center bg-transparent",children:[e.jsx("h6",{className:"mb-0 fw-semibold",children:"Branches Management"}),e.jsx(F,{children:e.jsxs(g,{variant:"outline-secondary",size:"sm",className:"rounded-1 d-flex align-items-center",onClick:_,children:[e.jsx(D,{className:"me-1"}),"New Branch"]})})]}),e.jsx(I.Body,{className:"px-0",children:e.jsx(M,{bordered:!0,striped:!0,hover:!0,responsive:!0,id:"branchesTable",className:"w-100"})})]}),e.jsx(E,{show:v,onHide:s,branch:a,onSuccess:f})]})}export{ae as default};
