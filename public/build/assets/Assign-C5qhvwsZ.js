import{r as l,j as e,$ as C,Y as w,b as A,m as S}from"./app-CcdzEu0R.js";import{R as x,y as u}from"./Footer-4Livvlxt.js";import{d as j}from"./helpers-B9XmgPRl.js";import{S as D}from"./react-select.esm-BQQQSlpr.js";import{E as O}from"./ErpLayout-u_y7Ersr.js";import{u as _}from"./useData-CRgTl60a.js";import{S as I}from"./sweetalert2.esm.all-DpIEGYsy.js";import{C as n,F as d,b as B}from"./Form-CLPTCCgE.js";import{C as o}from"./Card-CSAU_t4j.js";import{T as R}from"./Table-D-OHgQ10.js";import{B as E}from"./Image-D_GvnDn_.js";import"./CloseButton-Bv_xupVB.js";/* empty css                      */function Q(){const{technicians:g}=_(),[m,N]=l.useState(null),[c,T]=l.useState(null),[p,b]=l.useState(!1),v=g.map(t=>({value:t.id,label:t.full_name})),h=l.useCallback(()=>($.fn.DataTable.isDataTable("#repairOrdersTable")&&$("#repairOrdersTable").DataTable().destroy(),$("#repairOrdersTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("repair-orders.index"),type:"GET"},columns:[{data:"order_number",title:"RO #"},{data:"created_at",title:"Date",render:function(a){return j(a)}},{data:"customer.name",title:"Customer"},{data:"device_model",title:"Device"},{data:"status",title:"Status"},{data:"technician.full_name",title:"Technician"},{data:"expected_completion_date",title:"ETA",render:function(a){return a?j(a):"N/A"}},{data:"id",title:"Actions",orderable:!1,searchable:!1,render:function(a,r,s){var i;return`
                            <div class="d-flex gap-1">
                                <button class="btn btn-sm btn-primary assign-btn" data-id="${a}" data-order="${s.order_number}" data-device="${((i=s.device)==null?void 0:i.model)||"N/A"}" data-complaint="${s.complaint||"N/A"}">
                                    <i class="fas fa-user-plus"></i> Assign
                                </button>
                            </div>
                        `}}],order:[[0,"desc"]],createdRow:function(a,r,s){$(a).find("td:not(:last-child)").css("cursor","pointer"),$(a).on("click",function(i){$(i.target).closest("button, a").length||(window.location=route("repair-orders.show",r.id))})},drawCallback:function(){$(".assign-btn").on("click",function(a){a.stopPropagation();const r=$(this).data("id"),s=$(this).data("order"),i=$(this).data("device"),f=$(this).data("complaint");N({id:r,order_number:s,device:i,complaint:f}),$("#jobNumberInput").val(s),$("#deviceInfo").text(i),$("#complaintInfo").text(f),document.getElementById("assignForm").scrollIntoView({behavior:"smooth"})})}})),[]);l.useEffect(()=>{const t=h();return()=>{$.fn.DataTable.isDataTable("#repairOrdersTable")&&t.destroy()}},[h]);const y=async()=>{var t,a;if(!m||!c){u.error("Please select a job and a technician");return}b(!0);try{if((await I.fire({title:"Confirm Assignment",text:`Assign job #${m.order_number} to ${c.label}?`,icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, assign it!"})).isConfirmed){const s=await A.post(route("repair-orders.assign-technician"),{job_id:m.id,technician_id:c.value});s.data.success?(u.success("Technician assigned successfully!"),S.visit(route("repair-orders.assign-technician"))):u.error(s.data.message||"Failed to assign technician")}}catch(r){console.error("Assignment error:",r),u.error(((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"An error occurred while assigning the technician")}finally{b(!1)}};return e.jsxs(O,{children:[e.jsx(C,{title:"Repair Orders"}),e.jsxs(x,{className:"g-2",children:[e.jsx(n,{md:8,children:e.jsxs(o,{className:"border-0 rounded-0 shadow-sm",children:[e.jsxs(o.Header,{className:"bg-transparent d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"mb-0",children:"Repair Orders"}),e.jsxs(w,{href:route("repair-orders.create"),className:"btn btn-primary btn-sm",children:[e.jsx("i",{className:"fas fa-plus me-1"})," New Repair Order"]})]}),e.jsx(o.Body,{className:"px-0",children:e.jsx(R,{bordered:!0,striped:!0,hover:!0,responsive:!0,id:"repairOrdersTable",className:"mb-0"})})]})}),e.jsx(n,{md:4,children:e.jsxs(o,{id:"assignForm",className:"border-0 rounded-0 shadow-sm",children:[e.jsx(o.Header,{className:"bg-transparent",children:e.jsx("h5",{className:"mb-0",children:"Assign Technician"})}),e.jsx(o.Body,{children:e.jsx(d,{children:e.jsxs(x,{children:[e.jsx(n,{md:12,className:"mb-2",children:e.jsxs(d.Group,{children:[e.jsx(d.Label,{children:"Job Number"}),e.jsx(B,{id:"jobNumberInput",type:"text",placeholder:"Select a job from the table",className:"py-2",disabled:!0,readOnly:!0})]})}),e.jsxs(n,{md:12,className:"mb-2",children:[e.jsx("p",{className:"p-0 m-0 fw-bold",children:"Device:"}),e.jsx("p",{id:"deviceInfo",className:"p-0 m-0 mb-1 text-muted",children:"No device selected"}),e.jsx("hr",{className:"p-0 m-0"}),e.jsx("p",{className:"p-0 m-0 mt-1 fw-bold",children:"Complaint:"}),e.jsx("p",{id:"complaintInfo",className:"p-0 m-0 text-muted",children:"No complaint selected"})]}),e.jsx(n,{md:12,className:"mb-2",children:e.jsxs(d.Group,{children:[e.jsx(d.Label,{children:"Technician"}),e.jsx(D,{options:v,value:c,onChange:T,placeholder:"Select a technician...",isClearable:!0})]})}),e.jsx(n,{md:12,children:e.jsx(E,{onClick:y,disabled:!m||!c||p,className:"w-100",children:p?"Assigning...":"Assign Technician"})})]})})})]})})]})]})}export{Q as default};
