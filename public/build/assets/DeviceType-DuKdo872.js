import{j as e,r as c,$ as z}from"./app-CcdzEu0R.js";import{R as w,y as S}from"./Footer-4Livvlxt.js";import{E as A}from"./ErpLayout-u_y7Ersr.js";import{u as O}from"./formik.esm-pgZf8OxT.js";import{c as U,d as F,b as H,a as k}from"./index.esm-lEXyK6iT.js";import{x as _}from"./axios-COTtbvZI.js";import{M as x}from"./Modal-BeCmzXVe.js";import{F as r,C as m}from"./Form-CLPTCCgE.js";import{B}from"./Image-D_GvnDn_.js";import{S as y}from"./sweetalert2.esm.all-DpIEGYsy.js";import{C as N}from"./Card-CSAU_t4j.js";import{B as X}from"./ButtonGroup-CEgI5t_N.js";import{P as Y}from"./plus-circle-Dz2giOhE.js";import{T as V}from"./Table-D-OHgQ10.js";import"./CloseButton-Bv_xupVB.js";/* empty css                      */function W({show:j,onHide:o,deviceType:s,parentDeviceTypes:d,onSuccess:C}){const p=!!s,g=U().shape({name:k().required("Name is required"),slug:k().required("Slug is required"),parent_id:F().nullable(),description:k().nullable(),is_active:H(),order:F().min(0,"Order must be positive")}),a=O({enableReinitialize:!0,initialValues:{name:(s==null?void 0:s.name)||"",slug:(s==null?void 0:s.slug)||"",parent_id:(s==null?void 0:s.parent_id)||null,description:(s==null?void 0:s.description)||"",icon:(s==null?void 0:s.icon)||"",image:(s==null?void 0:s.image)||"",is_active:(s==null?void 0:s.is_active)??!0,order:(s==null?void 0:s.order)||0,_method:p?"PUT":"POST"},validationSchema:g,onSubmit:async(u,{setSubmitting:v,setErrors:D})=>{var b,t;try{const n=p?route("device-type.update",s.id):route("device-type.store"),l=await _.post(n,u);l.data.success===!0&&(C(l.data.message),o())}catch(n){(t=(b=n.response)==null?void 0:b.data)!=null&&t.errors?D(n.response.data.errors):console.error("Error submitting form:",n)}finally{v(!1)}}});return e.jsxs(x,{show:j,onHide:o,size:"lg",centered:!0,backdrop:"static",children:[e.jsx(x.Header,{closeButton:!0,children:e.jsx(x.Title,{children:p?"Edit Device Type":"Create New Device Type"})}),e.jsxs(r,{onSubmit:a.handleSubmit,children:[e.jsxs(x.Body,{children:[e.jsxs(w,{className:"mb-3",children:[e.jsx(m,{md:6,children:e.jsxs(r.Group,{controlId:"name",children:[e.jsx(r.Label,{children:"Name *"}),e.jsx(r.Control,{type:"text",name:"name",value:a.values.name,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.name&&!!a.errors.name}),e.jsx(r.Control.Feedback,{type:"invalid",children:a.errors.name})]})}),e.jsx(m,{md:6,children:e.jsxs(r.Group,{controlId:"slug",children:[e.jsx(r.Label,{children:"Slug *"}),e.jsx(r.Control,{type:"text",name:"slug",value:a.values.slug,onChange:a.handleChange,onBlur:a.handleBlur,isInvalid:a.touched.slug&&!!a.errors.slug}),e.jsx(r.Control.Feedback,{type:"invalid",children:a.errors.slug})]})})]}),e.jsxs(w,{className:"mb-3",children:[e.jsx(m,{md:6,children:e.jsxs(r.Group,{controlId:"parent_id",children:[e.jsx(r.Label,{children:"Parent Category"}),e.jsxs(r.Select,{name:"parent_id",value:a.values.parent_id||"",onChange:a.handleChange,children:[e.jsx("option",{value:"",children:"No Parent (Top Level)"}),d==null?void 0:d.map(u=>e.jsx("option",{value:u.id,children:u.name},u.id))]})]})}),e.jsx(m,{md:6,children:e.jsxs(r.Group,{controlId:"order",children:[e.jsx(r.Label,{children:"Display Order"}),e.jsx(r.Control,{type:"number",min:"0",name:"order",value:a.values.order,onChange:a.handleChange})]})})]}),e.jsxs(r.Group,{controlId:"description",className:"mb-3",children:[e.jsx(r.Label,{children:"Description"}),e.jsx(r.Control,{as:"textarea",rows:3,name:"description",value:a.values.description,onChange:a.handleChange})]}),e.jsxs(w,{className:"mb-3",children:[e.jsx(m,{md:6,children:e.jsxs(r.Group,{controlId:"icon",children:[e.jsx(r.Label,{children:"Icon Class/Code"}),e.jsx(r.Control,{type:"text",name:"icon",value:a.values.icon,onChange:a.handleChange,placeholder:"e.g. fa-solid fa-mobile-screen"})]})}),e.jsx(m,{md:6,children:e.jsxs(r.Group,{controlId:"image",children:[e.jsx(r.Label,{children:"Image URL"}),e.jsx(r.Control,{type:"text",name:"image",value:a.values.image,onChange:a.handleChange,placeholder:"URL to device type image"})]})})]}),e.jsx(r.Group,{controlId:"is_active",className:"mb-3",children:e.jsx(r.Check,{type:"switch",id:"is_active",label:"Active",checked:a.values.is_active,onChange:a.handleChange,name:"is_active"})})]}),e.jsxs(x.Footer,{children:[e.jsx(B,{variant:"secondary",onClick:o,children:"Cancel"}),e.jsx(B,{variant:"primary",type:"submit",disabled:a.isSubmitting,children:a.isSubmitting?"Saving...":"Save Changes"})]})]})]})}function ue(){const[j,o]=c.useState(!1),[s,d]=c.useState(null),[C,p]=c.useState([]),g=c.useCallback(()=>{$.fn.DataTable.isDataTable("#deviceTypesTable")&&$("#deviceTypesTable").DataTable().destroy(),$("#deviceTypesTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("device-type.index"),type:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}},columns:[{data:"name",name:"name",title:"Device Type"},{data:"parent_name",name:"parent_name",title:"Parent Category"},{data:"action",name:"action",title:"Actions",orderable:!1,searchable:!1,width:"10%"}],order:[[0,"desc"]],drawCallback:()=>{$(".edit-btn").off("click").on("click",function(){const t=$(this).data("id");D(t)}),$(".delete-btn").off("click").on("click",function(){const t=$(this).data("id");b(t)})}})},[]);c.useEffect(()=>{g()},[g]);const a=c.useCallback(()=>{d(null),o(!0)},[]),u=c.useCallback(()=>{o(!1),d(null)},[]),v=c.useCallback(t=>{S.success(t),$("#deviceTypesTable").DataTable().ajax.reload(null,!1),o(!1)},[]),D=async t=>{var n,l;try{const i=await _.get(route("device-type.edit",t));i.data.success===!0?(d(i.data.data),o(!0)):S.error(i.data.message)}catch(i){S.error(((l=(n=i.response)==null?void 0:n.data)==null?void 0:l.message)||"An error occurred")}},b=async t=>{var l,i,I,L,M,E,G,R,P,q;if((await y.fire({title:"Delete Device Type?",text:"This cannot be undone. Make sure there are no child categories, services, or orders associated.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await _.delete(route("device-type.destroy",t)),$("#deviceTypesTable").DataTable().ajax.reload(null,!1),y.fire("Deleted!","Device type has been deleted.","success")}catch(f){let h="Delete failed.";((l=f.response)==null?void 0:l.status)===403?h="You don't have permission to delete this device type.":(L=(I=(i=f.response)==null?void 0:i.data)==null?void 0:I.message)!=null&&L.includes("child categories")?h="Cannot delete device type with child categories.":(G=(E=(M=f.response)==null?void 0:M.data)==null?void 0:E.message)!=null&&G.includes("repair services")?h="Cannot delete device type with associated repair services.":(q=(P=(R=f.response)==null?void 0:R.data)==null?void 0:P.message)!=null&&q.includes("existing orders")&&(h="Cannot delete device type with existing orders."),y.fire("Error!",h,"error")}};return e.jsxs(A,{children:[e.jsx(z,{title:"Device Types Management"}),e.jsxs(N,{className:"border-0 rounded-0 shadow-sm",children:[e.jsxs(N.Header,{className:"d-flex justify-content-between align-items-center bg-transparent",children:[e.jsx("h6",{className:"mb-0 fw-semibold",children:"Device Types Management"}),e.jsx(X,{children:e.jsxs(B,{variant:"outline-secondary",size:"sm",className:"rounded-1 d-flex align-items-center",onClick:a,children:[e.jsx(Y,{className:"me-1"}),"New Device Type"]})})]}),e.jsx(N.Body,{className:"px-0",children:e.jsx(V,{bordered:!0,striped:!0,hover:!0,responsive:!0,id:"deviceTypesTable",className:"w-100"})})]}),e.jsx(W,{show:j,onHide:u,deviceType:s,parentDeviceTypes:C,onSuccess:v})]})}export{ue as default};
