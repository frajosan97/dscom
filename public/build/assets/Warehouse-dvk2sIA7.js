import{j as e,r as u,$ as W}from"./app-C8okO_FY.js";import{R as p,y as I}from"./Footer-DnT14h8L.js";import{d as F}from"./index-KQAv9TcM.js";import{E as D}from"./ErpLayout-enYR1Bf_.js";import{S as N}from"./sweetalert2.esm.all-DpIEGYsy.js";import{x as T}from"./axios-CrvAxd_j.js";import{u as E}from"./formik.esm-BfHSEgFn.js";import{c as M,b as L,a as o}from"./index.esm-Dfr3_SDK.js";import{M as y}from"./Modal-DFnRobbl.js";import{F as a,C as l}from"./Form-WKlbRvmM.js";import{B as b}from"./Image-eY5NvQ05.js";import{u as P}from"./useData-cXWwj9f-.js";import{C as S}from"./Card-CMRoatnC.js";import{B as q}from"./ButtonGroup-D0OsDQls.js";import{T as A}from"./Table-BgGj5UP2.js";import"./CloseButton-B9TEQAOu.js";import"./iconBase-ClMMaQi3.js";/* empty css                      */function O({show:g,onHide:c,warehouse:t,branches:j,onSuccess:v}){const x=!!t,_=M().shape({name:o().required("Name is required"),code:o().required("Code is required"),branch_id:o().nullable(),address:o().required("Address is required"),city:o().required("City is required"),state:o().required("State is required"),country:o().required("Country is required"),postal_code:o().required("Postal code is required"),contact_person:o().required("Contact person is required"),contact_phone:o().required("Contact phone is required"),contact_email:o().email("Invalid email format").required("Contact email is required"),is_active:L(),is_primary:L()}),n=E({enableReinitialize:!0,initialValues:{name:(t==null?void 0:t.name)||"",code:(t==null?void 0:t.code)||"",branch_id:(t==null?void 0:t.branch_id)||"",address:(t==null?void 0:t.address)||"",city:(t==null?void 0:t.city)||"",state:(t==null?void 0:t.state)||"",country:(t==null?void 0:t.country)||"Nigeria",postal_code:(t==null?void 0:t.postal_code)||"",latitude:(t==null?void 0:t.latitude)||"",longitude:(t==null?void 0:t.longitude)||"",contact_person:(t==null?void 0:t.contact_person)||"",contact_phone:(t==null?void 0:t.contact_phone)||"",contact_email:(t==null?void 0:t.contact_email)||"",contact_position:(t==null?void 0:t.contact_position)||"",opening_time:(t==null?void 0:t.opening_time)||"08:00",closing_time:(t==null?void 0:t.closing_time)||"18:00",working_days:(t==null?void 0:t.working_days)||[],is_primary:(t==null?void 0:t.is_primary)||!1,is_active:(t==null?void 0:t.is_active)??!0,notes:(t==null?void 0:t.notes)||"",_method:x?"PUT":"POST"},validationSchema:_,onSubmit:async(s,{setSubmitting:r,setErrors:h})=>{var d,i;try{const m=x?route("warehouse.update",t.id):route("warehouse.store"),C=await T.post(m,s);C.data.success===!0&&(v(C.data.message),c())}catch(m){(i=(d=m.response)==null?void 0:d.data)!=null&&i.errors?h(m.response.data.errors):console.error("Error submitting form:",m)}finally{r(!1)}}}),f=[{id:"monday",name:"Monday"},{id:"tuesday",name:"Tuesday"},{id:"wednesday",name:"Wednesday"},{id:"thursday",name:"Thursday"},{id:"friday",name:"Friday"},{id:"saturday",name:"Saturday"},{id:"sunday",name:"Sunday"}],k=s=>{const r=n.values.working_days||[],h=r.includes(s)?r.filter(d=>d!==s):[...r,s];n.setFieldValue("working_days",h)};return e.jsxs(y,{show:g,onHide:c,size:"lg",centered:!0,backdrop:"static",children:[e.jsx(y.Header,{closeButton:!0,children:e.jsx(y.Title,{children:x?"Edit Warehouse":"Create New Warehouse"})}),e.jsxs(a,{onSubmit:n.handleSubmit,children:[e.jsxs(y.Body,{children:[e.jsxs(p,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsxs(a.Group,{controlId:"name",children:[e.jsx(a.Label,{children:"Warehouse Name *"}),e.jsx(a.Control,{type:"text",name:"name",value:n.values.name,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.name&&!!n.errors.name}),e.jsx(a.Control.Feedback,{type:"invalid",children:n.errors.name})]})}),e.jsx(l,{md:6,children:e.jsxs(a.Group,{controlId:"code",children:[e.jsx(a.Label,{children:"Warehouse Code *"}),e.jsx(a.Control,{type:"text",name:"code",value:n.values.code,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.code&&!!n.errors.code}),e.jsx(a.Control.Feedback,{type:"invalid",children:n.errors.code})]})})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsxs(a.Group,{controlId:"branch_id",children:[e.jsx(a.Label,{children:"Branch"}),e.jsxs(a.Select,{name:"branch_id",value:n.values.branch_id,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.branch_id&&!!n.errors.branch_id,children:[e.jsx("option",{value:"",children:"Select Branch"}),j.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(a.Control.Feedback,{type:"invalid",children:n.errors.branch_id})]})}),e.jsx(l,{md:6,children:e.jsx(a.Group,{controlId:"is_primary",children:e.jsx(a.Check,{type:"switch",id:"is_primary",label:"Primary Warehouse",checked:n.values.is_primary,onChange:n.handleChange,name:"is_primary"})})})]}),e.jsxs(a.Group,{controlId:"address",className:"mb-3",children:[e.jsx(a.Label,{children:"Address *"}),e.jsx(a.Control,{as:"textarea",rows:2,name:"address",value:n.values.address,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.address&&!!n.errors.address}),e.jsx(a.Control.Feedback,{type:"invalid",children:n.errors.address})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(l,{md:4,children:e.jsxs(a.Group,{controlId:"city",children:[e.jsx(a.Label,{children:"City *"}),e.jsx(a.Control,{type:"text",name:"city",value:n.values.city,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.city&&!!n.errors.city}),e.jsx(a.Control.Feedback,{type:"invalid",children:n.errors.city})]})}),e.jsx(l,{md:4,children:e.jsxs(a.Group,{controlId:"state",children:[e.jsx(a.Label,{children:"State *"}),e.jsx(a.Control,{type:"text",name:"state",value:n.values.state,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.state&&!!n.errors.state}),e.jsx(a.Control.Feedback,{type:"invalid",children:n.errors.state})]})}),e.jsx(l,{md:4,children:e.jsxs(a.Group,{controlId:"postal_code",children:[e.jsx(a.Label,{children:"Postal Code *"}),e.jsx(a.Control,{type:"text",name:"postal_code",value:n.values.postal_code,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.postal_code&&!!n.errors.postal_code}),e.jsx(a.Control.Feedback,{type:"invalid",children:n.errors.postal_code})]})})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsxs(a.Group,{controlId:"country",children:[e.jsx(a.Label,{children:"Country *"}),e.jsxs(a.Control,{as:"select",name:"country",value:n.values.country,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.country&&!!n.errors.country,children:[e.jsx("option",{value:"Nigeria",children:"Nigeria"}),e.jsx("option",{value:"Ghana",children:"Ghana"}),e.jsx("option",{value:"South Africa",children:"South Africa"}),e.jsx("option",{value:"Kenya",children:"Kenya"}),e.jsx("option",{value:"Other",children:"Other"})]}),e.jsx(a.Control.Feedback,{type:"invalid",children:n.errors.country})]})}),e.jsx(l,{md:6,children:e.jsx(a.Group,{controlId:"is_active",children:e.jsx(a.Check,{type:"switch",id:"is_active",label:"Is Active",checked:n.values.is_active,onChange:n.handleChange,name:"is_active"})})})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsxs(a.Group,{controlId:"latitude",children:[e.jsx(a.Label,{children:"Latitude"}),e.jsx(a.Control,{type:"number",step:"0.000001",name:"latitude",value:n.values.latitude,onChange:n.handleChange})]})}),e.jsx(l,{md:6,children:e.jsxs(a.Group,{controlId:"longitude",children:[e.jsx(a.Label,{children:"Longitude"}),e.jsx(a.Control,{type:"number",step:"0.000001",name:"longitude",value:n.values.longitude,onChange:n.handleChange})]})})]}),e.jsx("h5",{className:"mt-4 mb-3",children:"Contact Information"}),e.jsxs(p,{className:"mb-3",children:[e.jsx(l,{md:4,children:e.jsxs(a.Group,{controlId:"contact_person",children:[e.jsx(a.Label,{children:"Contact Person *"}),e.jsx(a.Control,{type:"text",name:"contact_person",value:n.values.contact_person,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.contact_person&&!!n.errors.contact_person}),e.jsx(a.Control.Feedback,{type:"invalid",children:n.errors.contact_person})]})}),e.jsx(l,{md:4,children:e.jsxs(a.Group,{controlId:"contact_phone",children:[e.jsx(a.Label,{children:"Contact Phone *"}),e.jsx(a.Control,{type:"text",name:"contact_phone",value:n.values.contact_phone,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.contact_phone&&!!n.errors.contact_phone}),e.jsx(a.Control.Feedback,{type:"invalid",children:n.errors.contact_phone})]})}),e.jsx(l,{md:4,children:e.jsxs(a.Group,{controlId:"contact_email",children:[e.jsx(a.Label,{children:"Contact Email *"}),e.jsx(a.Control,{type:"email",name:"contact_email",value:n.values.contact_email,onChange:n.handleChange,onBlur:n.handleBlur,isInvalid:n.touched.contact_email&&!!n.errors.contact_email}),e.jsx(a.Control.Feedback,{type:"invalid",children:n.errors.contact_email})]})})]}),e.jsxs(a.Group,{controlId:"contact_position",className:"mb-3",children:[e.jsx(a.Label,{children:"Contact Position"}),e.jsx(a.Control,{type:"text",name:"contact_position",value:n.values.contact_position,onChange:n.handleChange})]}),e.jsx("h5",{className:"mt-4 mb-3",children:"Operating Hours"}),e.jsxs(p,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsxs(a.Group,{controlId:"opening_time",children:[e.jsx(a.Label,{children:"Opening Time"}),e.jsx(a.Control,{type:"time",name:"opening_time",value:n.values.opening_time,onChange:n.handleChange})]})}),e.jsx(l,{md:6,children:e.jsxs(a.Group,{controlId:"closing_time",children:[e.jsx(a.Label,{children:"Closing Time"}),e.jsx(a.Control,{type:"time",name:"closing_time",value:n.values.closing_time,onChange:n.handleChange})]})})]}),e.jsxs(a.Group,{controlId:"working_days",className:"mb-3",children:[e.jsx(a.Label,{children:"Working Days"}),e.jsx("div",{className:"d-flex flex-wrap gap-2",children:f.map(s=>{var r;return e.jsx(b,{variant:(r=n.values.working_days)!=null&&r.includes(s.id)?"primary":"outline-secondary",onClick:()=>k(s.id),size:"sm",children:s.name},s.id)})})]}),e.jsxs(a.Group,{controlId:"notes",className:"mb-3",children:[e.jsx(a.Label,{children:"Notes"}),e.jsx(a.Control,{as:"textarea",rows:3,name:"notes",value:n.values.notes,onChange:n.handleChange})]})]}),e.jsxs(y.Footer,{children:[e.jsx(b,{variant:"secondary",onClick:c,children:"Cancel"}),e.jsx(b,{variant:"primary",type:"submit",disabled:n.isSubmitting,children:n.isSubmitting?"Saving...":"Save Changes"})]})]})]})}function le(){const[g,c]=u.useState(!1),[t,j]=u.useState(null),{branches:v}=P(),x=u.useCallback(()=>{$.fn.DataTable.isDataTable("#warehousesTable")&&$("#warehousesTable").DataTable().destroy(),$("#warehousesTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("warehouse.index"),type:"GET"},columns:[{data:"name",title:"Name"},{data:"code",title:"Code"},{data:"branch",title:"Branch"},{data:"location",title:"Location"},{data:"status",title:"Status"},{data:"action",title:"Actions"}],drawCallback:()=>{$(".edit-btn").off("click").on("click",function(){const r=$(this).data("id");k(r)}),$(".delete-btn").off("click").on("click",function(){const r=$(this).data("id");s(r)})}})},[]);u.useEffect(()=>{x()},[x]);const _=u.useCallback(()=>{j(null),c(!0)},[]),n=u.useCallback(()=>{c(!1),j(null)},[]),f=u.useCallback(r=>{I.success(r),$("#warehousesTable").DataTable().ajax.reload(null,!1),c(!1)},[]),k=async r=>{var h,d;try{const i=await T.get(route("warehouse.edit",r));i.data.success===!0?(j(i.data.data),c(!0)):I.error(i.data.message)}catch(i){I.error(((d=(h=i.response)==null?void 0:h.data)==null?void 0:d.message)||"An error occurred")}},s=async r=>{var d,i,m,C;if((await N.fire({title:"Delete Warehouse?",text:"This cannot be undone. All related inventory data will be affected.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await T.delete(route("warehouse.destroy",r)),$("#warehousesTable").DataTable().ajax.reload(null,!1),N.fire("Deleted!","Warehouse has been deleted.","success")}catch(G){let B="Delete failed.";((d=G.response)==null?void 0:d.status)===403?B="You don't have permission to delete this warehouse.":(C=(m=(i=G.response)==null?void 0:i.data)==null?void 0:m.message)!=null&&C.includes("foreign key constraint")&&(B="Cannot delete warehouse because it has associated inventory records."),N.fire("Error!",B,"error")}};return e.jsxs(D,{children:[e.jsx(W,{title:"Warehouses Management"}),e.jsxs(S,{className:"border-0 rounded-0 shadow-sm",children:[e.jsxs(S.Header,{className:"d-flex justify-content-between align-items-center bg-transparent",children:[e.jsx("h6",{className:"mb-0 fw-semibold",children:"Warehouse Management"}),e.jsx(q,{children:e.jsx(q,{children:e.jsxs(b,{variant:"outline-secondary",size:"sm",className:"rounded-1 d-flex align-items-center",onClick:_,children:[e.jsx(F,{className:"me-1"}),"New Warehouse"]})})})]}),e.jsx(S.Body,{className:"px-0",children:e.jsx(A,{bordered:!0,striped:!0,hover:!0,responsive:!0,id:"warehousesTable",className:"w-100"})})]}),e.jsx(O,{show:g,onHide:n,warehouse:t,branches:v,onSuccess:f})]})}export{le as default};
